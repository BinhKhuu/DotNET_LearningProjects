import"./chunk-X6YHEMIY.js";import{$ as ct,A as pu,Aa as Ih,B as oh,Ba as Su,C as ih,Ca as Iu,D as sh,Da as wh,E as pe,Ea as Rh,F as ah,Fa as _h,G as ge,Ga as Kn,H as Y,Ha as wu,I as ir,Ia as Dh,J as P,Ja as bh,K as bt,Ka as kh,L as ch,La as fi,M as K,Ma as Oh,N as gu,Na as Mh,O as w,Oa as Ph,P as R,Pa as se,Q as uh,Qa as Ru,R as lh,Ra as _u,S as dh,Sa as ca,T as Hn,Ta as Du,U as at,V as na,Va as Nh,W as mu,Wa as Lh,X as Nr,Xa as Fh,Y as hh,Z as fh,_ as $n,a as Xd,aa as Cu,b as Zd,ba as ph,c as uu,ca as gh,d as lu,da as yu,e as He,ea as mh,f as Ie,fa as Gn,g as eh,ga as vu,h as qe,ha as Ch,i as z,ia as Eu,j as I,ja as yh,k as li,ka as di,l as th,la as hi,m as rh,ma as vh,n as $,na as kt,o as ta,oa as Eh,p as we,pa as Au,q as du,qa as Ah,r as nh,ra as oa,s as hu,sa as Lr,t as Pe,ta as Ot,u as ot,ua as ia,v as it,va as Th,w as fu,wa as Sh,x as st,xa as sa,y as ra,ya as aa,z as or,za as Tu}from"./chunk-CLOVXZGA.js";import{a as f,b as T,c as nr,d as Me,e as Bn,f as d}from"./chunk-ZY7WU73K.js";var Bh=null;function ut(){return Bh}function bu(n){Bh??=n}var pi=class{},gi=(()=>{class n{historyGo(t){throw new Error("")}static \u0275fac=function(r){return new(r||n)};static \u0275prov=P({token:n,factory:()=>R(Hh),providedIn:"platform"})}return n})(),ku=new K(""),Hh=(()=>{class n extends gi{_location;_history;_doc=R(se);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return ut().getBaseHref(this._doc)}onPopState(t){let r=ut().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",t,!1),()=>r.removeEventListener("popstate",t)}onHashChange(t){let r=ut().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",t,!1),()=>r.removeEventListener("hashchange",t)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(t){this._location.pathname=t}pushState(t,r,o){this._history.pushState(t,r,o)}replaceState(t,r,o){this._history.replaceState(t,r,o)}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}static \u0275fac=function(r){return new(r||n)};static \u0275prov=P({token:n,factory:()=>new n,providedIn:"platform"})}return n})();function ua(n,e){return n?e?n.endsWith("/")?e.startsWith("/")?n+e.slice(1):n+e:e.startsWith("/")?n+e:`${n}/${e}`:n:e}function Uh(n){let e=n.search(/#|\?|$/);return n[e-1]==="/"?n.slice(0,e-1)+n.slice(e):n}function Ve(n){return n&&n[0]!=="?"?`?${n}`:n}var Pt=(()=>{class n{historyGo(t){throw new Error("")}static \u0275fac=function(r){return new(r||n)};static \u0275prov=P({token:n,factory:()=>R(da),providedIn:"root"})}return n})(),la=new K(""),da=(()=>{class n extends Pt{_platformLocation;_baseHref;_removeListenerFns=[];constructor(t,r){super(),this._platformLocation=t,this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??R(se).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return ua(this._baseHref,t)}path(t=!1){let r=this._platformLocation.pathname+Ve(this._platformLocation.search),o=this._platformLocation.hash;return o&&t?`${r}${o}`:r}pushState(t,r,o,i){let s=this.prepareExternalUrl(o+Ve(i));this._platformLocation.pushState(t,r,s)}replaceState(t,r,o,i){let s=this.prepareExternalUrl(o+Ve(i));this._platformLocation.replaceState(t,r,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static \u0275fac=function(r){return new(r||n)(w(gi),w(la,8))};static \u0275prov=P({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),$e=(()=>{class n{_subject=new He;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(t){this._locationStrategy=t;let r=this._locationStrategy.getBaseHref();this._basePath=Lg(Uh(xh(r))),this._locationStrategy.onPopState(o=>{this._subject.next({url:this.path(!0),pop:!0,state:o.state,type:o.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,r=""){return this.path()==this.normalize(t+Ve(r))}normalize(t){return n.stripTrailingSlash(Ng(this._basePath,xh(t)))}prepareExternalUrl(t){return t&&t[0]!=="/"&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,r="",o=null){this._locationStrategy.pushState(o,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Ve(r)),o)}replaceState(t,r="",o=null){this._locationStrategy.replaceState(o,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Ve(r)),o)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription??=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)}),()=>{let r=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(r,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",r){this._urlChangeListeners.forEach(o=>o(t,r))}subscribe(t,r,o){return this._subject.subscribe({next:t,error:r??void 0,complete:o??void 0})}static normalizeQueryParams=Ve;static joinWithSlash=ua;static stripTrailingSlash=Uh;static \u0275fac=function(r){return new(r||n)(w(Pt))};static \u0275prov=P({token:n,factory:()=>Pg(),providedIn:"root"})}return n})();function Pg(){return new $e(w(Pt))}function Ng(n,e){if(!n||!e.startsWith(n))return e;let t=e.substring(n.length);return t===""||["/",";","?","#"].includes(t[0])?t:e}function xh(n){return n.replace(/\/index.html$/,"")}function Lg(n){if(new RegExp("^(https?:)?//").test(n)){let[,t]=n.split(/\/\/[^\/]+/);return t}return n}var Ou=(()=>{class n extends Pt{_platformLocation;_baseHref="";_removeListenerFns=[];constructor(t,r){super(),this._platformLocation=t,r!=null&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){let r=this._platformLocation.hash??"#";return r.length>0?r.substring(1):r}prepareExternalUrl(t){let r=ua(this._baseHref,t);return r.length>0?"#"+r:r}pushState(t,r,o,i){let s=this.prepareExternalUrl(o+Ve(i))||this._platformLocation.pathname;this._platformLocation.pushState(t,r,s)}replaceState(t,r,o,i){let s=this.prepareExternalUrl(o+Ve(i))||this._platformLocation.pathname;this._platformLocation.replaceState(t,r,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}static \u0275fac=function(r){return new(r||n)(w(gi),w(la,8))};static \u0275prov=P({token:n,factory:n.\u0275fac})}return n})();var mi=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275mod=Ot({type:n});static \u0275inj=bt({})}return n})();var Kh=(()=>{class n{static \u0275prov=P({token:n,providedIn:"root",factory:()=>new Mu(R(se),window)})}return n})(),Mu=class{document;window;offset=()=>[0,0];constructor(e,t){this.document=e,this.window=t}setOffset(e){Array.isArray(e)?this.offset=()=>e:this.offset=e}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(e){this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){let t=Bg(this.document,e);t&&(this.scrollToElement(t),t.focus())}setHistoryScrollRestoration(e){this.window.history.scrollRestoration=e}scrollToElement(e){let t=e.getBoundingClientRect(),r=t.left+this.window.pageXOffset,o=t.top+this.window.pageYOffset,i=this.offset();this.window.scrollTo(r-i[0],o-i[1])}};function Bg(n,e){let t=n.getElementById(e)||n.getElementsByName(e)[0];if(t)return t;if(typeof n.createTreeWalker=="function"&&n.body&&typeof n.body.attachShadow=="function"){let r=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT),o=r.currentNode;for(;o;){let i=o.shadowRoot;if(i){let s=i.getElementById(e)||i.querySelector(`[name="${e}"]`);if(s)return s}o=r.nextNode()}}return null}var pa=new K(""),Fu=(()=>{class n{_zone;_plugins;_eventNameToPlugin=new Map;constructor(t,r){this._zone=r,t.forEach(o=>{o.manager=this}),this._plugins=t.slice().reverse()}addEventListener(t,r,o,i){return this._findPluginFor(r).addEventListener(t,r,o,i)}getZone(){return this._zone}_findPluginFor(t){let r=this._eventNameToPlugin.get(t);if(r)return r;if(r=this._plugins.find(i=>i.supports(t)),!r)throw new Y(5101,!1);return this._eventNameToPlugin.set(t,r),r}static \u0275fac=function(r){return new(r||n)(w(pa),w(ct))};static \u0275prov=P({token:n,factory:n.\u0275fac})}return n})(),Ci=class{_doc;constructor(e){this._doc=e}manager},ha="ng-app-id";function zh(n){for(let e of n)e.remove()}function jh(n,e){let t=e.createElement("style");return t.textContent=n,t}function $g(n,e,t,r){let o=n.head?.querySelectorAll(`style[${ha}="${e}"],link[${ha}="${e}"]`);if(o)for(let i of o)i.removeAttribute(ha),i instanceof HTMLLinkElement?r.set(i.href.slice(i.href.lastIndexOf("/")+1),{usage:0,elements:[i]}):i.textContent&&t.set(i.textContent,{usage:0,elements:[i]})}function Nu(n,e){let t=e.createElement("link");return t.setAttribute("rel","stylesheet"),t.setAttribute("href",n),t}var Uu=(()=>{class n{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;isServer;constructor(t,r,o,i={}){this.doc=t,this.appId=r,this.nonce=o,this.isServer=ca(i),$g(t,r,this.inline,this.external),this.hosts.add(t.head)}addStyles(t,r){for(let o of t)this.addUsage(o,this.inline,jh);r?.forEach(o=>this.addUsage(o,this.external,Nu))}removeStyles(t,r){for(let o of t)this.removeUsage(o,this.inline);r?.forEach(o=>this.removeUsage(o,this.external))}addUsage(t,r,o){let i=r.get(t);i?i.usage++:r.set(t,{usage:1,elements:[...this.hosts].map(s=>this.addElement(s,o(t,this.doc)))})}removeUsage(t,r){let o=r.get(t);o&&(o.usage--,o.usage<=0&&(zh(o.elements),r.delete(t)))}ngOnDestroy(){for(let[,{elements:t}]of[...this.inline,...this.external])zh(t);this.hosts.clear()}addHost(t){this.hosts.add(t);for(let[r,{elements:o}]of this.inline)o.push(this.addElement(t,jh(r,this.doc)));for(let[r,{elements:o}]of this.external)o.push(this.addElement(t,Nu(r,this.doc)))}removeHost(t){this.hosts.delete(t)}addElement(t,r){return this.nonce&&r.setAttribute("nonce",this.nonce),this.isServer&&r.setAttribute(ha,this.appId),t.appendChild(r)}static \u0275fac=function(r){return new(r||n)(w(se),w(yu),w(vu,8),w(Gn))};static \u0275prov=P({token:n,factory:n.\u0275fac})}return n})(),Pu={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},xu=/%COMP%/g;var Vh="%COMP%",Gg=`_nghost-${Vh}`,Kg=`_ngcontent-${Vh}`,zg=!0,jg=new K("",{providedIn:"root",factory:()=>zg});function qg(n){return Kg.replace(xu,n)}function Vg(n){return Gg.replace(xu,n)}function Wh(n,e){return e.map(t=>t.replace(xu,n))}var Bu=(()=>{class n{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;platformId;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(t,r,o,i,s,a,c,l=null,h=null){this.eventManager=t,this.sharedStylesHost=r,this.appId=o,this.removeStylesOnCompDestroy=i,this.doc=s,this.platformId=a,this.ngZone=c,this.nonce=l,this.tracingService=h,this.platformIsServer=ca(a),this.defaultRenderer=new yi(t,s,c,this.platformIsServer,this.tracingService)}createRenderer(t,r){if(!t||!r)return this.defaultRenderer;this.platformIsServer&&r.encapsulation===di.ShadowDom&&(r=T(f({},r),{encapsulation:di.Emulated}));let o=this.getOrCreateRenderer(t,r);return o instanceof fa?o.applyToHost(t):o instanceof vi&&o.applyStyles(),o}getOrCreateRenderer(t,r){let o=this.rendererByCompId,i=o.get(r.id);if(!i){let s=this.doc,a=this.ngZone,c=this.eventManager,l=this.sharedStylesHost,h=this.removeStylesOnCompDestroy,m=this.platformIsServer,y=this.tracingService;switch(r.encapsulation){case di.Emulated:i=new fa(c,l,r,this.appId,h,s,a,m,y);break;case di.ShadowDom:return new Lu(c,l,t,r,s,a,this.nonce,m,y);default:i=new vi(c,l,r,h,s,a,m,y);break}o.set(r.id,i)}return i}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(t){this.rendererByCompId.delete(t)}static \u0275fac=function(r){return new(r||n)(w(Fu),w(Uu),w(yu),w(jg),w(se),w(Gn),w(ct),w(vu),w(Ch,8))};static \u0275prov=P({token:n,factory:n.\u0275fac})}return n})(),yi=class{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(e,t,r,o,i){this.eventManager=e,this.doc=t,this.ngZone=r,this.platformIsServer=o,this.tracingService=i}destroy(){}destroyNode=null;createElement(e,t){return t?this.doc.createElementNS(Pu[t]||t,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,t){(qh(e)?e.content:e).appendChild(t)}insertBefore(e,t,r){e&&(qh(e)?e.content:e).insertBefore(t,r)}removeChild(e,t){t.remove()}selectRootElement(e,t){let r=typeof e=="string"?this.doc.querySelector(e):e;if(!r)throw new Y(-5104,!1);return t||(r.textContent=""),r}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,r,o){if(o){t=o+":"+t;let i=Pu[o];i?e.setAttributeNS(i,t,r):e.setAttribute(t,r)}else e.setAttribute(t,r)}removeAttribute(e,t,r){if(r){let o=Pu[r];o?e.removeAttributeNS(o,t):e.removeAttribute(`${r}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,r,o){o&(hi.DashCase|hi.Important)?e.style.setProperty(t,r,o&hi.Important?"important":""):e.style[t]=r}removeStyle(e,t,r){r&hi.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,r){e!=null&&(e[t]=r)}setValue(e,t){e.nodeValue=t}listen(e,t,r,o){if(typeof e=="string"&&(e=ut().getGlobalEventTarget(this.doc,e),!e))throw new Y(5102,!1);let i=this.decoratePreventDefault(r);return this.tracingService?.wrapEventListener&&(i=this.tracingService.wrapEventListener(e,t,i)),this.eventManager.addEventListener(e,t,i,o)}decoratePreventDefault(e){return t=>{if(t==="__ngUnwrap__")return e;(this.platformIsServer?this.ngZone.runGuarded(()=>e(t)):e(t))===!1&&t.preventDefault()}}};function qh(n){return n.tagName==="TEMPLATE"&&n.content!==void 0}var Lu=class extends yi{sharedStylesHost;hostEl;shadowRoot;constructor(e,t,r,o,i,s,a,c,l){super(e,i,s,c,l),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let h=o.styles;h=Wh(o.id,h);for(let y of h){let S=document.createElement("style");a&&S.setAttribute("nonce",a),S.textContent=y,this.shadowRoot.appendChild(S)}let m=o.getExternalStyles?.();if(m)for(let y of m){let S=Nu(y,i);a&&S.setAttribute("nonce",a),this.shadowRoot.appendChild(S)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,r){return super.insertBefore(this.nodeOrShadowRoot(e),t,r)}removeChild(e,t){return super.removeChild(null,t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},vi=class extends yi{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(e,t,r,o,i,s,a,c,l){super(e,i,s,a,c),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=o;let h=r.styles;this.styles=l?Wh(l,h):h,this.styleUrls=r.getExternalStyles?.(l)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},fa=class extends vi{contentAttr;hostAttr;constructor(e,t,r,o,i,s,a,c,l){let h=o+"-"+r.id;super(e,t,r,i,s,a,c,l,h),this.contentAttr=qg(h),this.hostAttr=Vg(h)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){let r=super.createElement(e,t);return super.setAttribute(r,this.contentAttr,""),r}};var ga=class n extends pi{supportsDOMEvents=!0;static makeCurrent(){bu(new n)}onAndCancel(e,t,r,o){return e.addEventListener(t,r,o),()=>{e.removeEventListener(t,r,o)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.remove()}createElement(e,t){return t=t||this.getDefaultDocument(),t.createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return t==="window"?window:t==="document"?e:t==="body"?e.body:null}getBaseHref(e){let t=Wg();return t==null?null:Yg(t)}resetBaseElement(){Ei=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return Ru(document.cookie,e)}},Ei=null;function Wg(){return Ei=Ei||document.head.querySelector("base"),Ei?Ei.getAttribute("href"):null}function Yg(n){return new URL(n,document.baseURI).pathname}var ma=class{addToWindow(e){ir.getAngularTestability=(r,o=!0)=>{let i=e.findTestabilityInTree(r,o);if(i==null)throw new Y(5103,!1);return i},ir.getAllAngularTestabilities=()=>e.getAllTestabilities(),ir.getAllAngularRootElements=()=>e.getAllRootElements();let t=r=>{let o=ir.getAllAngularTestabilities(),i=o.length,s=function(){i--,i==0&&r()};o.forEach(a=>{a.whenStable(s)})};ir.frameworkStabilizers||(ir.frameworkStabilizers=[]),ir.frameworkStabilizers.push(t)}findTestabilityInTree(e,t,r){if(t==null)return null;let o=e.getTestability(t);return o??(r?ut().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null)}},Qg=(()=>{class n{build(){return new XMLHttpRequest}static \u0275fac=function(r){return new(r||n)};static \u0275prov=P({token:n,factory:n.\u0275fac})}return n})(),Qh=(()=>{class n extends Ci{constructor(t){super(t)}supports(t){return!0}addEventListener(t,r,o,i){return t.addEventListener(r,o,i),()=>this.removeEventListener(t,r,o,i)}removeEventListener(t,r,o,i){return t.removeEventListener(r,o,i)}static \u0275fac=function(r){return new(r||n)(w(se))};static \u0275prov=P({token:n,factory:n.\u0275fac})}return n})(),Yh=["alt","control","meta","shift"],Jg={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Xg={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey},Jh=(()=>{class n extends Ci{constructor(t){super(t)}supports(t){return n.parseEventName(t)!=null}addEventListener(t,r,o,i){let s=n.parseEventName(r),a=n.eventCallback(s.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>ut().onAndCancel(t,s.domEventName,a,i))}static parseEventName(t){let r=t.toLowerCase().split("."),o=r.shift();if(r.length===0||!(o==="keydown"||o==="keyup"))return null;let i=n._normalizeKey(r.pop()),s="",a=r.indexOf("code");if(a>-1&&(r.splice(a,1),s="code."),Yh.forEach(l=>{let h=r.indexOf(l);h>-1&&(r.splice(h,1),s+=l+".")}),s+=i,r.length!=0||i.length===0)return null;let c={};return c.domEventName=o,c.fullKey=s,c}static matchEventFullKeyCode(t,r){let o=Jg[t.key]||t.key,i="";return r.indexOf("code.")>-1&&(o=t.code,i="code."),o==null||!o?!1:(o=o.toLowerCase(),o===" "?o="space":o==="."&&(o="dot"),Yh.forEach(s=>{if(s!==o){let a=Xg[s];a(t)&&(i+=s+".")}}),i+=o,i===r)}static eventCallback(t,r,o){return i=>{n.matchEventFullKeyCode(i,t)&&o.runGuarded(()=>r(i))}}static _normalizeKey(t){return t==="esc"?"escape":t}static \u0275fac=function(r){return new(r||n)(w(se))};static \u0275prov=P({token:n,factory:n.\u0275fac})}return n})();function Hu(n,e){return Mh(f({rootComponent:n},Zg(e)))}function Zg(n){return{appProviders:[...Xh,...n?.providers??[]],platformProviders:nm}}function em(){ga.makeCurrent()}function tm(){return new Cu}function rm(){return gh(document),document}var nm=[{provide:Gn,useValue:_u},{provide:mh,useValue:em,multi:!0},{provide:se,useFactory:rm}];var om=[{provide:sa,useClass:ma},{provide:Sh,useClass:aa,deps:[ct,Tu,sa]},{provide:aa,useClass:aa,deps:[ct,Tu,sa]}],Xh=[{provide:dh,useValue:"root"},{provide:Cu,useFactory:tm},{provide:pa,useClass:Qh,multi:!0,deps:[se]},{provide:pa,useClass:Jh,multi:!0,deps:[se]},Bu,Uu,Fu,{provide:vh,useExisting:Bu},{provide:Du,useClass:Qg},[]],$u=(()=>{class n{constructor(){}static \u0275fac=function(r){return new(r||n)};static \u0275mod=Ot({type:n});static \u0275inj=bt({providers:[...Xh,...om],imports:[mi,Oh]})}return n})();var Zh=(()=>{class n{_doc;constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}static \u0275fac=function(r){return new(r||n)(w(se))};static \u0275prov=P({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var N="primary",Pi=Symbol("RouteTitle"),qu=class{params;constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}};function xr(n){return new qu(n)}function cf(n,e,t){let r=t.path.split("/");if(r.length>n.length||t.pathMatch==="full"&&(e.hasChildren()||r.length<n.length))return null;let o={};for(let i=0;i<r.length;i++){let s=r[i],a=n[i];if(s[0]===":")o[s.substring(1)]=a;else if(s!==a.path)return null}return{consumed:n.slice(0,r.length),posParams:o}}function sm(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!lt(n[t],e[t]))return!1;return!0}function lt(n,e){let t=n?Vu(n):void 0,r=e?Vu(e):void 0;if(!t||!r||t.length!=r.length)return!1;let o;for(let i=0;i<t.length;i++)if(o=t[i],!uf(n[o],e[o]))return!1;return!0}function Vu(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}function uf(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;let t=[...n].sort(),r=[...e].sort();return t.every((o,i)=>r[i]===o)}else return n===e}function lf(n){return n.length>0?n[n.length-1]:null}function ur(n){return th(n)?n:Ih(n)?z(Promise.resolve(n)):I(n)}var am={exact:hf,subset:ff},df={exact:cm,subset:um,ignored:()=>!0};function ef(n,e,t){return am[t.paths](n.root,e.root,t.matrixParams)&&df[t.queryParams](n.queryParams,e.queryParams)&&!(t.fragment==="exact"&&n.fragment!==e.fragment)}function cm(n,e){return lt(n,e)}function hf(n,e,t){if(!Fr(n.segments,e.segments)||!va(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(let r in e.children)if(!n.children[r]||!hf(n.children[r],e.children[r],t))return!1;return!0}function um(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>uf(n[t],e[t]))}function ff(n,e,t){return pf(n,e,e.segments,t)}function pf(n,e,t,r){if(n.segments.length>t.length){let o=n.segments.slice(0,t.length);return!(!Fr(o,t)||e.hasChildren()||!va(o,t,r))}else if(n.segments.length===t.length){if(!Fr(n.segments,t)||!va(n.segments,t,r))return!1;for(let o in e.children)if(!n.children[o]||!ff(n.children[o],e.children[o],r))return!1;return!0}else{let o=t.slice(0,n.segments.length),i=t.slice(n.segments.length);return!Fr(n.segments,o)||!va(n.segments,o,r)||!n.children[N]?!1:pf(n.children[N],e,i,r)}}function va(n,e,t){return e.every((r,o)=>df[t](n[o].parameters,r.parameters))}var ht=class{root;queryParams;fragment;_queryParamMap;constructor(e=new H([],{}),t={},r=null){this.root=e,this.queryParams=t,this.fragment=r}get queryParamMap(){return this._queryParamMap??=xr(this.queryParams),this._queryParamMap}toString(){return hm.serialize(this)}},H=class{segments;children;parent=null;constructor(e,t){this.segments=e,this.children=t,Object.values(t).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Ea(this)}},sr=class{path;parameters;_parameterMap;constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap??=xr(this.parameters),this._parameterMap}toString(){return mf(this)}};function lm(n,e){return Fr(n,e)&&n.every((t,r)=>lt(t.parameters,e[r].parameters))}function Fr(n,e){return n.length!==e.length?!1:n.every((t,r)=>t.path===e[r].path)}function dm(n,e){let t=[];return Object.entries(n.children).forEach(([r,o])=>{r===N&&(t=t.concat(e(o,r)))}),Object.entries(n.children).forEach(([r,o])=>{r!==N&&(t=t.concat(e(o,r)))}),t}var Br=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275prov=P({token:n,factory:()=>new ar,providedIn:"root"})}return n})(),ar=class{parse(e){let t=new Yu(e);return new ht(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){let t=`/${Ai(e.root,!0)}`,r=gm(e.queryParams),o=typeof e.fragment=="string"?`#${fm(e.fragment)}`:"";return`${t}${r}${o}`}},hm=new ar;function Ea(n){return n.segments.map(e=>mf(e)).join("/")}function Ai(n,e){if(!n.hasChildren())return Ea(n);if(e){let t=n.children[N]?Ai(n.children[N],!1):"",r=[];return Object.entries(n.children).forEach(([o,i])=>{o!==N&&r.push(`${o}:${Ai(i,!1)}`)}),r.length>0?`${t}(${r.join("//")})`:t}else{let t=dm(n,(r,o)=>o===N?[Ai(n.children[N],!1)]:[`${o}:${Ai(r,!1)}`]);return Object.keys(n.children).length===1&&n.children[N]!=null?`${Ea(n)}/${t[0]}`:`${Ea(n)}/(${t.join("//")})`}}function gf(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Ca(n){return gf(n).replace(/%3B/gi,";")}function fm(n){return encodeURI(n)}function Wu(n){return gf(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Aa(n){return decodeURIComponent(n)}function tf(n){return Aa(n.replace(/\+/g,"%20"))}function mf(n){return`${Wu(n.path)}${pm(n.parameters)}`}function pm(n){return Object.entries(n).map(([e,t])=>`;${Wu(e)}=${Wu(t)}`).join("")}function gm(n){let e=Object.entries(n).map(([t,r])=>Array.isArray(r)?r.map(o=>`${Ca(t)}=${Ca(o)}`).join("&"):`${Ca(t)}=${Ca(r)}`).filter(t=>t);return e.length?`?${e.join("&")}`:""}var mm=/^[^\/()?;#]+/;function Gu(n){let e=n.match(mm);return e?e[0]:""}var Cm=/^[^\/()?;=#]+/;function ym(n){let e=n.match(Cm);return e?e[0]:""}var vm=/^[^=?&#]+/;function Em(n){let e=n.match(vm);return e?e[0]:""}var Am=/^[^&#]+/;function Tm(n){let e=n.match(Am);return e?e[0]:""}var Yu=class{url;remaining;constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new H([],{}):new H([],this.parseChildren())}parseQueryParams(){let e={};if(this.consumeOptional("?"))do this.parseQueryParam(e);while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(r[N]=new H(e,t)),r}parseSegment(){let e=Gu(this.remaining);if(e===""&&this.peekStartsWith(";"))throw new Y(4009,!1);return this.capture(e),new sr(Aa(e),this.parseMatrixParams())}parseMatrixParams(){let e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){let t=ym(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){let o=Gu(this.remaining);o&&(r=o,this.capture(r))}e[Aa(t)]=Aa(r)}parseQueryParam(e){let t=Em(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){let s=Tm(this.remaining);s&&(r=s,this.capture(r))}let o=tf(t),i=tf(r);if(e.hasOwnProperty(o)){let s=e[o];Array.isArray(s)||(s=[s],e[o]=s),s.push(i)}else e[o]=i}parseParens(e){let t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let r=Gu(this.remaining),o=this.remaining[r.length];if(o!=="/"&&o!==")"&&o!==";")throw new Y(4010,!1);let i;r.indexOf(":")>-1?(i=r.slice(0,r.indexOf(":")),this.capture(i),this.capture(":")):e&&(i=N);let s=this.parseChildren();t[i]=Object.keys(s).length===1?s[N]:new H([],s),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return this.peekStartsWith(e)?(this.remaining=this.remaining.substring(e.length),!0):!1}capture(e){if(!this.consumeOptional(e))throw new Y(4011,!1)}};function Cf(n){return n.segments.length>0?new H([],{[N]:n}):n}function yf(n){let e={};for(let[r,o]of Object.entries(n.children)){let i=yf(o);if(r===N&&i.segments.length===0&&i.hasChildren())for(let[s,a]of Object.entries(i.children))e[s]=a;else(i.segments.length>0||i.hasChildren())&&(e[r]=i)}let t=new H(n.segments,e);return Sm(t)}function Sm(n){if(n.numberOfChildren===1&&n.children[N]){let e=n.children[N];return new H(n.segments.concat(e.segments),e.children)}return n}function Wn(n){return n instanceof ht}function vf(n,e,t=null,r=null){let o=Ef(n);return Af(o,e,t,r)}function Ef(n){let e;function t(i){let s={};for(let c of i.children){let l=t(c);s[c.outlet]=l}let a=new H(i.url,s);return i===n&&(e=a),a}let r=t(n.root),o=Cf(r);return e??o}function Af(n,e,t,r){let o=n;for(;o.parent;)o=o.parent;if(e.length===0)return Ku(o,o,o,t,r);let i=Im(e);if(i.toRoot())return Ku(o,o,new H([],{}),t,r);let s=wm(i,o,n),a=s.processChildren?Si(s.segmentGroup,s.index,i.commands):Sf(s.segmentGroup,s.index,i.commands);return Ku(o,s.segmentGroup,a,t,r)}function Sa(n){return typeof n=="object"&&n!=null&&!n.outlets&&!n.segmentPath}function wi(n){return typeof n=="object"&&n!=null&&n.outlets}function Ku(n,e,t,r,o){let i={};r&&Object.entries(r).forEach(([c,l])=>{i[c]=Array.isArray(l)?l.map(h=>`${h}`):`${l}`});let s;n===e?s=t:s=Tf(n,e,t);let a=Cf(yf(s));return new ht(a,i,o)}function Tf(n,e,t){let r={};return Object.entries(n.children).forEach(([o,i])=>{i===e?r[o]=t:r[o]=Tf(i,e,t)}),new H(n.segments,r)}var Ia=class{isAbsolute;numberOfDoubleDots;commands;constructor(e,t,r){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=r,e&&r.length>0&&Sa(r[0]))throw new Y(4003,!1);let o=r.find(wi);if(o&&o!==lf(r))throw new Y(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function Im(n){if(typeof n[0]=="string"&&n.length===1&&n[0]==="/")return new Ia(!0,0,n);let e=0,t=!1,r=n.reduce((o,i,s)=>{if(typeof i=="object"&&i!=null){if(i.outlets){let a={};return Object.entries(i.outlets).forEach(([c,l])=>{a[c]=typeof l=="string"?l.split("/"):l}),[...o,{outlets:a}]}if(i.segmentPath)return[...o,i.segmentPath]}return typeof i!="string"?[...o,i]:s===0?(i.split("/").forEach((a,c)=>{c==0&&a==="."||(c==0&&a===""?t=!0:a===".."?e++:a!=""&&o.push(a))}),o):[...o,i]},[]);return new Ia(t,e,r)}var qn=class{segmentGroup;processChildren;index;constructor(e,t,r){this.segmentGroup=e,this.processChildren=t,this.index=r}};function wm(n,e,t){if(n.isAbsolute)return new qn(e,!0,0);if(!t)return new qn(e,!1,NaN);if(t.parent===null)return new qn(t,!0,0);let r=Sa(n.commands[0])?0:1,o=t.segments.length-1+r;return Rm(t,o,n.numberOfDoubleDots)}function Rm(n,e,t){let r=n,o=e,i=t;for(;i>o;){if(i-=o,r=r.parent,!r)throw new Y(4005,!1);o=r.segments.length}return new qn(r,!1,o-i)}function _m(n){return wi(n[0])?n[0].outlets:{[N]:n}}function Sf(n,e,t){if(n??=new H([],{}),n.segments.length===0&&n.hasChildren())return Si(n,e,t);let r=Dm(n,e,t),o=t.slice(r.commandIndex);if(r.match&&r.pathIndex<n.segments.length){let i=new H(n.segments.slice(0,r.pathIndex),{});return i.children[N]=new H(n.segments.slice(r.pathIndex),n.children),Si(i,0,o)}else return r.match&&o.length===0?new H(n.segments,{}):r.match&&!n.hasChildren()?Qu(n,e,t):r.match?Si(n,0,o):Qu(n,e,t)}function Si(n,e,t){if(t.length===0)return new H(n.segments,{});{let r=_m(t),o={};if(Object.keys(r).some(i=>i!==N)&&n.children[N]&&n.numberOfChildren===1&&n.children[N].segments.length===0){let i=Si(n.children[N],e,t);return new H(n.segments,i.children)}return Object.entries(r).forEach(([i,s])=>{typeof s=="string"&&(s=[s]),s!==null&&(o[i]=Sf(n.children[i],e,s))}),Object.entries(n.children).forEach(([i,s])=>{r[i]===void 0&&(o[i]=s)}),new H(n.segments,o)}}function Dm(n,e,t){let r=0,o=e,i={match:!1,pathIndex:0,commandIndex:0};for(;o<n.segments.length;){if(r>=t.length)return i;let s=n.segments[o],a=t[r];if(wi(a))break;let c=`${a}`,l=r<t.length-1?t[r+1]:null;if(o>0&&c===void 0)break;if(c&&l&&typeof l=="object"&&l.outlets===void 0){if(!nf(c,l,s))return i;r+=2}else{if(!nf(c,{},s))return i;r++}o++}return{match:!0,pathIndex:o,commandIndex:r}}function Qu(n,e,t){let r=n.segments.slice(0,e),o=0;for(;o<t.length;){let i=t[o];if(wi(i)){let c=bm(i.outlets);return new H(r,c)}if(o===0&&Sa(t[0])){let c=n.segments[e];r.push(new sr(c.path,rf(t[0]))),o++;continue}let s=wi(i)?i.outlets[N]:`${i}`,a=o<t.length-1?t[o+1]:null;s&&a&&Sa(a)?(r.push(new sr(s,rf(a))),o+=2):(r.push(new sr(s,{})),o++)}return new H(r,{})}function bm(n){let e={};return Object.entries(n).forEach(([t,r])=>{typeof r=="string"&&(r=[r]),r!==null&&(e[t]=Qu(new H([],{}),0,r))}),e}function rf(n){let e={};return Object.entries(n).forEach(([t,r])=>e[t]=`${r}`),e}function nf(n,e,t){return n==t.path&&lt(e,t.parameters)}var Ta="imperative",ue=function(n){return n[n.NavigationStart=0]="NavigationStart",n[n.NavigationEnd=1]="NavigationEnd",n[n.NavigationCancel=2]="NavigationCancel",n[n.NavigationError=3]="NavigationError",n[n.RoutesRecognized=4]="RoutesRecognized",n[n.ResolveStart=5]="ResolveStart",n[n.ResolveEnd=6]="ResolveEnd",n[n.GuardsCheckStart=7]="GuardsCheckStart",n[n.GuardsCheckEnd=8]="GuardsCheckEnd",n[n.RouteConfigLoadStart=9]="RouteConfigLoadStart",n[n.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",n[n.ChildActivationStart=11]="ChildActivationStart",n[n.ChildActivationEnd=12]="ChildActivationEnd",n[n.ActivationStart=13]="ActivationStart",n[n.ActivationEnd=14]="ActivationEnd",n[n.Scroll=15]="Scroll",n[n.NavigationSkipped=16]="NavigationSkipped",n}(ue||{}),Le=class{id;url;constructor(e,t){this.id=e,this.url=t}},cr=class extends Le{type=ue.NavigationStart;navigationTrigger;restoredState;constructor(e,t,r="imperative",o=null){super(e,t),this.navigationTrigger=r,this.restoredState=o}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Ye=class extends Le{urlAfterRedirects;type=ue.NavigationEnd;constructor(e,t,r){super(e,t),this.urlAfterRedirects=r}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},Re=function(n){return n[n.Redirect=0]="Redirect",n[n.SupersededByNewNavigation=1]="SupersededByNewNavigation",n[n.NoDataFromResolver=2]="NoDataFromResolver",n[n.GuardRejected=3]="GuardRejected",n}(Re||{}),Yn=function(n){return n[n.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",n[n.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",n}(Yn||{}),dt=class extends Le{reason;code;type=ue.NavigationCancel;constructor(e,t,r,o){super(e,t),this.reason=r,this.code=o}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},ft=class extends Le{reason;code;type=ue.NavigationSkipped;constructor(e,t,r,o){super(e,t),this.reason=r,this.code=o}},Qn=class extends Le{error;target;type=ue.NavigationError;constructor(e,t,r,o){super(e,t),this.error=r,this.target=o}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Ri=class extends Le{urlAfterRedirects;state;type=ue.RoutesRecognized;constructor(e,t,r,o){super(e,t),this.urlAfterRedirects=r,this.state=o}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},wa=class extends Le{urlAfterRedirects;state;type=ue.GuardsCheckStart;constructor(e,t,r,o){super(e,t),this.urlAfterRedirects=r,this.state=o}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Ra=class extends Le{urlAfterRedirects;state;shouldActivate;type=ue.GuardsCheckEnd;constructor(e,t,r,o,i){super(e,t),this.urlAfterRedirects=r,this.state=o,this.shouldActivate=i}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},_a=class extends Le{urlAfterRedirects;state;type=ue.ResolveStart;constructor(e,t,r,o){super(e,t),this.urlAfterRedirects=r,this.state=o}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Da=class extends Le{urlAfterRedirects;state;type=ue.ResolveEnd;constructor(e,t,r,o){super(e,t),this.urlAfterRedirects=r,this.state=o}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},ba=class{route;type=ue.RouteConfigLoadStart;constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},ka=class{route;type=ue.RouteConfigLoadEnd;constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},Oa=class{snapshot;type=ue.ChildActivationStart;constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Ma=class{snapshot;type=ue.ChildActivationEnd;constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Pa=class{snapshot;type=ue.ActivationStart;constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Na=class{snapshot;type=ue.ActivationEnd;constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Jn=class{routerEvent;position;anchor;type=ue.Scroll;constructor(e,t,r){this.routerEvent=e,this.position=t,this.anchor=r}toString(){let e=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${e}')`}},_i=class{},Xn=class{url;navigationBehaviorOptions;constructor(e,t){this.url=e,this.navigationBehaviorOptions=t}};function km(n,e){return n.providers&&!n._injector&&(n._injector=oa(n.providers,e,`Route: ${n.path}`)),n._injector??e}function We(n){return n.outlet||N}function Om(n,e){let t=n.filter(r=>We(r)===e);return t.push(...n.filter(r=>We(r)!==e)),t}function Ni(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){let t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}var La=class{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return Ni(this.route?.snapshot)??this.rootInjector}constructor(e){this.rootInjector=e,this.children=new Hr(this.rootInjector)}},Hr=(()=>{class n{rootInjector;contexts=new Map;constructor(t){this.rootInjector=t}onChildOutletCreated(t,r){let o=this.getOrCreateContext(t);o.outlet=r,this.contexts.set(t,o)}onChildOutletDestroyed(t){let r=this.getContext(t);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){let t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let r=this.getContext(t);return r||(r=new La(this.rootInjector),this.contexts.set(t,r)),r}getContext(t){return this.contexts.get(t)||null}static \u0275fac=function(r){return new(r||n)(w(Hn))};static \u0275prov=P({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Fa=class{_root;constructor(e){this._root=e}get root(){return this._root.value}parent(e){let t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){let t=Ju(e,this._root);return t?t.children.map(r=>r.value):[]}firstChild(e){let t=Ju(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){let t=Xu(e,this._root);return t.length<2?[]:t[t.length-2].children.map(o=>o.value).filter(o=>o!==e)}pathFromRoot(e){return Xu(e,this._root).map(t=>t.value)}};function Ju(n,e){if(n===e.value)return e;for(let t of e.children){let r=Ju(n,t);if(r)return r}return null}function Xu(n,e){if(n===e.value)return[e];for(let t of e.children){let r=Xu(n,t);if(r.length)return r.unshift(e),r}return[]}var Ne=class{value;children;constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}};function jn(n){let e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}var Di=class extends Fa{snapshot;constructor(e,t){super(e),this.snapshot=t,sl(this,e)}toString(){return this.snapshot.toString()}};function If(n){let e=Mm(n),t=new Ie([new sr("",{})]),r=new Ie({}),o=new Ie({}),i=new Ie({}),s=new Ie(""),a=new Nt(t,r,i,s,o,N,n,e.root);return a.snapshot=e.root,new Di(new Ne(a,[]),e)}function Mm(n){let e={},t={},r={},o="",i=new Ur([],e,r,o,t,N,n,null,{});return new bi("",new Ne(i,[]))}var Nt=class{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(e,t,r,o,i,s,a,c){this.urlSubject=e,this.paramsSubject=t,this.queryParamsSubject=r,this.fragmentSubject=o,this.dataSubject=i,this.outlet=s,this.component=a,this._futureSnapshot=c,this.title=this.dataSubject?.pipe($(l=>l[Pi]))??I(void 0),this.url=e,this.params=t,this.queryParams=r,this.fragment=o,this.data=i}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe($(e=>xr(e))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe($(e=>xr(e))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function Ua(n,e,t="emptyOnly"){let r,{routeConfig:o}=n;return e!==null&&(t==="always"||o?.path===""||!e.component&&!e.routeConfig?.loadComponent)?r={params:f(f({},e.params),n.params),data:f(f({},e.data),n.data),resolve:f(f(f(f({},n.data),e.data),o?.data),n._resolvedData)}:r={params:f({},n.params),data:f({},n.data),resolve:f(f({},n.data),n._resolvedData??{})},o&&Rf(o)&&(r.resolve[Pi]=o.title),r}var Ur=class{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[Pi]}constructor(e,t,r,o,i,s,a,c,l){this.url=e,this.params=t,this.queryParams=r,this.fragment=o,this.data=i,this.outlet=s,this.component=a,this.routeConfig=c,this._resolve=l}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=xr(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=xr(this.queryParams),this._queryParamMap}toString(){let e=this.url.map(r=>r.toString()).join("/"),t=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${e}', path:'${t}')`}},bi=class extends Fa{url;constructor(e,t){super(t),this.url=e,sl(this,t)}toString(){return wf(this._root)}};function sl(n,e){e.value._routerState=n,e.children.forEach(t=>sl(n,t))}function wf(n){let e=n.children.length>0?` { ${n.children.map(wf).join(", ")} } `:"";return`${n.value}${e}`}function zu(n){if(n.snapshot){let e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,lt(e.queryParams,t.queryParams)||n.queryParamsSubject.next(t.queryParams),e.fragment!==t.fragment&&n.fragmentSubject.next(t.fragment),lt(e.params,t.params)||n.paramsSubject.next(t.params),sm(e.url,t.url)||n.urlSubject.next(t.url),lt(e.data,t.data)||n.dataSubject.next(t.data)}else n.snapshot=n._futureSnapshot,n.dataSubject.next(n._futureSnapshot.data)}function Zu(n,e){let t=lt(n.params,e.params)&&lm(n.url,e.url),r=!n.parent!=!e.parent;return t&&!r&&(!n.parent||Zu(n.parent,e.parent))}function Rf(n){return typeof n.title=="string"||n.title===null}var _f=new K(""),$r=(()=>{class n{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=N;activateEvents=new $n;deactivateEvents=new $n;attachEvents=new $n;detachEvents=new $n;routerOutletData=ph(void 0);parentContexts=R(Hr);location=R(Au);changeDetector=R(fi);inputBinder=R(Li,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(t){if(t.name){let{firstChange:r,previousValue:o}=t.name;if(r)return;this.isTrackedInParentContexts(o)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(o)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Y(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Y(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Y(4012,!1);this.location.detach();let t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,r){this.activated=t,this._activatedRoute=r,this.location.insert(t.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){let t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,r){if(this.isActivated)throw new Y(4013,!1);this._activatedRoute=t;let o=this.location,s=t.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,c=new el(t,a,o.injector,this.routerOutletData);this.activated=o.createComponent(s,{index:o.length,injector:c,environmentInjector:r}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(r){return new(r||n)};static \u0275dir=ia({type:n,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[na]})}return n})(),el=class{route;childContexts;parent;outletData;constructor(e,t,r,o){this.route=e,this.childContexts=t,this.parent=r,this.outletData=o}get(e,t){return e===Nt?this.route:e===Hr?this.childContexts:e===_f?this.outletData:this.parent.get(e,t)}},Li=new K(""),al=(()=>{class n{outletDataSubscriptions=new Map;bindActivatedRouteToOutletComponent(t){this.unsubscribeFromRouteData(t),this.subscribeToRouteData(t)}unsubscribeFromRouteData(t){this.outletDataSubscriptions.get(t)?.unsubscribe(),this.outletDataSubscriptions.delete(t)}subscribeToRouteData(t){let{activatedRoute:r}=t,o=ta([r.queryParams,r.params,r.data]).pipe(pe(([i,s,a],c)=>(a=f(f(f({},i),s),a),c===0?I(a):Promise.resolve(a)))).subscribe(i=>{if(!t.isActivated||!t.activatedComponentRef||t.activatedRoute!==r||r.component===null){this.unsubscribeFromRouteData(t);return}let s=Ph(r.component);if(!s){this.unsubscribeFromRouteData(t);return}for(let{templateName:a}of s.inputs)t.activatedComponentRef.setInput(a,i[a])});this.outletDataSubscriptions.set(t,o)}static \u0275fac=function(r){return new(r||n)};static \u0275prov=P({token:n,factory:n.\u0275fac})}return n})(),cl=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275cmp=Lr({type:n,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(r,o){r&1&&Kn(0,"router-outlet")},dependencies:[$r],encapsulation:2})}return n})();function ul(n){let e=n.children&&n.children.map(ul),t=e?T(f({},n),{children:e}):f({},n);return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==N&&(t.component=cl),t}function Pm(n,e,t){let r=ki(n,e._root,t?t._root:void 0);return new Di(r,e)}function ki(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){let r=t.value;r._futureSnapshot=e.value;let o=Nm(n,e,t);return new Ne(r,o)}else{if(n.shouldAttach(e.value)){let i=n.retrieve(e.value);if(i!==null){let s=i.route;return s.value._futureSnapshot=e.value,s.children=e.children.map(a=>ki(n,a)),s}}let r=Lm(e.value),o=e.children.map(i=>ki(n,i));return new Ne(r,o)}}function Nm(n,e,t){return e.children.map(r=>{for(let o of t.children)if(n.shouldReuseRoute(r.value,o.value.snapshot))return ki(n,r,o);return ki(n,r)})}function Lm(n){return new Nt(new Ie(n.url),new Ie(n.params),new Ie(n.queryParams),new Ie(n.fragment),new Ie(n.data),n.outlet,n.component,n)}var Zn=class{redirectTo;navigationBehaviorOptions;constructor(e,t){this.redirectTo=e,this.navigationBehaviorOptions=t}},Df="ngNavigationCancelingError";function xa(n,e){let{redirectTo:t,navigationBehaviorOptions:r}=Wn(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,o=bf(!1,Re.Redirect);return o.url=t,o.navigationBehaviorOptions=r,o}function bf(n,e){let t=new Error(`NavigationCancelingError: ${n||""}`);return t[Df]=!0,t.cancellationCode=e,t}function Fm(n){return kf(n)&&Wn(n.url)}function kf(n){return!!n&&n[Df]}var Um=(n,e,t,r)=>$(o=>(new tl(e,o.targetRouterState,o.currentRouterState,t,r).activate(n),o)),tl=class{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(e,t,r,o,i){this.routeReuseStrategy=e,this.futureState=t,this.currState=r,this.forwardEvent=o,this.inputBindingEnabled=i}activate(e){let t=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,r,e),zu(this.futureState.root),this.activateChildRoutes(t,r,e)}deactivateChildRoutes(e,t,r){let o=jn(t);e.children.forEach(i=>{let s=i.value.outlet;this.deactivateRoutes(i,o[s],r),delete o[s]}),Object.values(o).forEach(i=>{this.deactivateRouteAndItsChildren(i,r)})}deactivateRoutes(e,t,r){let o=e.value,i=t?t.value:null;if(o===i)if(o.component){let s=r.getContext(o.outlet);s&&this.deactivateChildRoutes(e,t,s.children)}else this.deactivateChildRoutes(e,t,r);else i&&this.deactivateRouteAndItsChildren(t,r)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){let r=t.getContext(e.value.outlet),o=r&&e.value.component?r.children:t,i=jn(e);for(let s of Object.values(i))this.deactivateRouteAndItsChildren(s,o);if(r&&r.outlet){let s=r.outlet.detach(),a=r.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:s,route:e,contexts:a})}}deactivateRouteAndOutlet(e,t){let r=t.getContext(e.value.outlet),o=r&&e.value.component?r.children:t,i=jn(e);for(let s of Object.values(i))this.deactivateRouteAndItsChildren(s,o);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(e,t,r){let o=jn(t);e.children.forEach(i=>{this.activateRoutes(i,o[i.value.outlet],r),this.forwardEvent(new Na(i.value.snapshot))}),e.children.length&&this.forwardEvent(new Ma(e.value.snapshot))}activateRoutes(e,t,r){let o=e.value,i=t?t.value:null;if(zu(o),o===i)if(o.component){let s=r.getOrCreateContext(o.outlet);this.activateChildRoutes(e,t,s.children)}else this.activateChildRoutes(e,t,r);else if(o.component){let s=r.getOrCreateContext(o.outlet);if(this.routeReuseStrategy.shouldAttach(o.snapshot)){let a=this.routeReuseStrategy.retrieve(o.snapshot);this.routeReuseStrategy.store(o.snapshot,null),s.children.onOutletReAttached(a.contexts),s.attachRef=a.componentRef,s.route=a.route.value,s.outlet&&s.outlet.attach(a.componentRef,a.route.value),zu(a.route.value),this.activateChildRoutes(e,null,s.children)}else s.attachRef=null,s.route=o,s.outlet&&s.outlet.activateWith(o,s.injector),this.activateChildRoutes(e,null,s.children)}else this.activateChildRoutes(e,null,r)}},Ba=class{path;route;constructor(e){this.path=e,this.route=this.path[this.path.length-1]}},Vn=class{component;route;constructor(e,t){this.component=e,this.route=t}};function xm(n,e,t){let r=n._root,o=e?e._root:null;return Ti(r,o,t,[r.value])}function Bm(n){let e=n.routeConfig?n.routeConfig.canActivateChild:null;return!e||e.length===0?null:{node:n,guards:e}}function to(n,e){let t=Symbol(),r=e.get(n,t);return r===t?typeof n=="function"&&!ch(n)?n:e.get(n):r}function Ti(n,e,t,r,o={canDeactivateChecks:[],canActivateChecks:[]}){let i=jn(e);return n.children.forEach(s=>{Hm(s,i[s.value.outlet],t,r.concat([s.value]),o),delete i[s.value.outlet]}),Object.entries(i).forEach(([s,a])=>Ii(a,t.getContext(s),o)),o}function Hm(n,e,t,r,o={canDeactivateChecks:[],canActivateChecks:[]}){let i=n.value,s=e?e.value:null,a=t?t.getContext(n.value.outlet):null;if(s&&i.routeConfig===s.routeConfig){let c=$m(s,i,i.routeConfig.runGuardsAndResolvers);c?o.canActivateChecks.push(new Ba(r)):(i.data=s.data,i._resolvedData=s._resolvedData),i.component?Ti(n,e,a?a.children:null,r,o):Ti(n,e,t,r,o),c&&a&&a.outlet&&a.outlet.isActivated&&o.canDeactivateChecks.push(new Vn(a.outlet.component,s))}else s&&Ii(e,a,o),o.canActivateChecks.push(new Ba(r)),i.component?Ti(n,null,a?a.children:null,r,o):Ti(n,null,t,r,o);return o}function $m(n,e,t){if(typeof t=="function")return t(n,e);switch(t){case"pathParamsChange":return!Fr(n.url,e.url);case"pathParamsOrQueryParamsChange":return!Fr(n.url,e.url)||!lt(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Zu(n,e)||!lt(n.queryParams,e.queryParams);case"paramsChange":default:return!Zu(n,e)}}function Ii(n,e,t){let r=jn(n),o=n.value;Object.entries(r).forEach(([i,s])=>{o.component?e?Ii(s,e.children.getContext(i),t):Ii(s,null,t):Ii(s,e,t)}),o.component?e&&e.outlet&&e.outlet.isActivated?t.canDeactivateChecks.push(new Vn(e.outlet.component,o)):t.canDeactivateChecks.push(new Vn(null,o)):t.canDeactivateChecks.push(new Vn(null,o))}function Fi(n){return typeof n=="function"}function Gm(n){return typeof n=="boolean"}function Km(n){return n&&Fi(n.canLoad)}function zm(n){return n&&Fi(n.canActivate)}function jm(n){return n&&Fi(n.canActivateChild)}function qm(n){return n&&Fi(n.canDeactivate)}function Vm(n){return n&&Fi(n.canMatch)}function Of(n){return n instanceof rh||n?.name==="EmptyError"}var ya=Symbol("INITIAL_VALUE");function eo(){return pe(n=>ta(n.map(e=>e.pipe(st(1),sh(ya)))).pipe($(e=>{for(let t of e)if(t!==!0){if(t===ya)return ya;if(t===!1||Wm(t))return t}return!0}),Pe(e=>e!==ya),st(1)))}function Wm(n){return Wn(n)||n instanceof Zn}function Ym(n,e){return we(t=>{let{targetSnapshot:r,currentSnapshot:o,guards:{canActivateChecks:i,canDeactivateChecks:s}}=t;return s.length===0&&i.length===0?I(T(f({},t),{guardsResult:!0})):Qm(s,r,o,n).pipe(we(a=>a&&Gm(a)?Jm(r,i,n,e):I(a)),$(a=>T(f({},t),{guardsResult:a})))})}function Qm(n,e,t,r){return z(n).pipe(we(o=>rC(o.component,o.route,t,e,r)),or(o=>o!==!0,!0))}function Jm(n,e,t,r){return z(e).pipe(it(o=>nh(Zm(o.route.parent,r),Xm(o.route,r),tC(n,o.path,t),eC(n,o.route,t))),or(o=>o!==!0,!0))}function Xm(n,e){return n!==null&&e&&e(new Pa(n)),I(!0)}function Zm(n,e){return n!==null&&e&&e(new Oa(n)),I(!0)}function eC(n,e,t){let r=e.routeConfig?e.routeConfig.canActivate:null;if(!r||r.length===0)return I(!0);let o=r.map(i=>hu(()=>{let s=Ni(e)??t,a=to(i,s),c=zm(a)?a.canActivate(e,n):at(s,()=>a(e,n));return ur(c).pipe(or())}));return I(o).pipe(eo())}function tC(n,e,t){let r=e[e.length-1],i=e.slice(0,e.length-1).reverse().map(s=>Bm(s)).filter(s=>s!==null).map(s=>hu(()=>{let a=s.guards.map(c=>{let l=Ni(s.node)??t,h=to(c,l),m=jm(h)?h.canActivateChild(r,n):at(l,()=>h(r,n));return ur(m).pipe(or())});return I(a).pipe(eo())}));return I(i).pipe(eo())}function rC(n,e,t,r,o){let i=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!i||i.length===0)return I(!0);let s=i.map(a=>{let c=Ni(e)??o,l=to(a,c),h=qm(l)?l.canDeactivate(n,e,t,r):at(c,()=>l(n,e,t,r));return ur(h).pipe(or())});return I(s).pipe(eo())}function nC(n,e,t,r){let o=e.canLoad;if(o===void 0||o.length===0)return I(!0);let i=o.map(s=>{let a=to(s,n),c=Km(a)?a.canLoad(e,t):at(n,()=>a(e,t));return ur(c)});return I(i).pipe(eo(),Mf(r))}function Mf(n){return Zd(ge(e=>{if(typeof e!="boolean")throw xa(n,e)}),$(e=>e===!0))}function oC(n,e,t,r){let o=e.canMatch;if(!o||o.length===0)return I(!0);let i=o.map(s=>{let a=to(s,n),c=Vm(a)?a.canMatch(e,t):at(n,()=>a(e,t));return ur(c)});return I(i).pipe(eo(),Mf(r))}var Oi=class{segmentGroup;constructor(e){this.segmentGroup=e||null}},Mi=class extends Error{urlTree;constructor(e){super(),this.urlTree=e}};function zn(n){return li(new Oi(n))}function iC(n){return li(new Y(4e3,!1))}function sC(n){return li(bf(!1,Re.GuardRejected))}var rl=class{urlSerializer;urlTree;constructor(e,t){this.urlSerializer=e,this.urlTree=t}lineralizeSegments(e,t){let r=[],o=t.root;for(;;){if(r=r.concat(o.segments),o.numberOfChildren===0)return I(r);if(o.numberOfChildren>1||!o.children[N])return iC(`${e.redirectTo}`);o=o.children[N]}}applyRedirectCommands(e,t,r,o,i){if(typeof t!="string"){let a=t,{queryParams:c,fragment:l,routeConfig:h,url:m,outlet:y,params:S,data:_,title:x}=o,V=at(i,()=>a({params:S,data:_,queryParams:c,fragment:l,routeConfig:h,url:m,outlet:y,title:x}));if(V instanceof ht)throw new Mi(V);t=V}let s=this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),e,r);if(t[0]==="/")throw new Mi(s);return s}applyRedirectCreateUrlTree(e,t,r,o){let i=this.createSegmentGroup(e,t.root,r,o);return new ht(i,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){let r={};return Object.entries(e).forEach(([o,i])=>{if(typeof i=="string"&&i[0]===":"){let a=i.substring(1);r[o]=t[a]}else r[o]=i}),r}createSegmentGroup(e,t,r,o){let i=this.createSegments(e,t.segments,r,o),s={};return Object.entries(t.children).forEach(([a,c])=>{s[a]=this.createSegmentGroup(e,c,r,o)}),new H(i,s)}createSegments(e,t,r,o){return t.map(i=>i.path[0]===":"?this.findPosParam(e,i,o):this.findOrReturn(i,r))}findPosParam(e,t,r){let o=r[t.path.substring(1)];if(!o)throw new Y(4001,!1);return o}findOrReturn(e,t){let r=0;for(let o of t){if(o.path===e.path)return t.splice(r),o;r++}return e}},nl={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function aC(n,e,t,r,o){let i=Pf(n,e,t);return i.matched?(r=km(e,r),oC(r,e,t,o).pipe($(s=>s===!0?i:f({},nl)))):I(i)}function Pf(n,e,t){if(e.path==="**")return cC(t);if(e.path==="")return e.pathMatch==="full"&&(n.hasChildren()||t.length>0)?f({},nl):{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};let o=(e.matcher||cf)(t,n,e);if(!o)return f({},nl);let i={};Object.entries(o.posParams??{}).forEach(([a,c])=>{i[a]=c.path});let s=o.consumed.length>0?f(f({},i),o.consumed[o.consumed.length-1].parameters):i;return{matched:!0,consumedSegments:o.consumed,remainingSegments:t.slice(o.consumed.length),parameters:s,positionalParamSegments:o.posParams??{}}}function cC(n){return{matched:!0,parameters:n.length>0?lf(n).parameters:{},consumedSegments:n,remainingSegments:[],positionalParamSegments:{}}}function of(n,e,t,r){return t.length>0&&dC(n,t,r)?{segmentGroup:new H(e,lC(r,new H(t,n.children))),slicedSegments:[]}:t.length===0&&hC(n,t,r)?{segmentGroup:new H(n.segments,uC(n,t,r,n.children)),slicedSegments:t}:{segmentGroup:new H(n.segments,n.children),slicedSegments:t}}function uC(n,e,t,r){let o={};for(let i of t)if($a(n,e,i)&&!r[We(i)]){let s=new H([],{});o[We(i)]=s}return f(f({},r),o)}function lC(n,e){let t={};t[N]=e;for(let r of n)if(r.path===""&&We(r)!==N){let o=new H([],{});t[We(r)]=o}return t}function dC(n,e,t){return t.some(r=>$a(n,e,r)&&We(r)!==N)}function hC(n,e,t){return t.some(r=>$a(n,e,r))}function $a(n,e,t){return(n.hasChildren()||e.length>0)&&t.pathMatch==="full"?!1:t.path===""}function fC(n,e,t){return e.length===0&&!n.children[t]}var ol=class{};function pC(n,e,t,r,o,i,s="emptyOnly"){return new il(n,e,t,r,o,s,i).recognize()}var gC=31,il=class{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(e,t,r,o,i,s,a){this.injector=e,this.configLoader=t,this.rootComponentType=r,this.config=o,this.urlTree=i,this.paramsInheritanceStrategy=s,this.urlSerializer=a,this.applyRedirects=new rl(this.urlSerializer,this.urlTree)}noMatchError(e){return new Y(4002,`'${e.segmentGroup}'`)}recognize(){let e=of(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(e).pipe($(({children:t,rootSnapshot:r})=>{let o=new Ne(r,t),i=new bi("",o),s=vf(r,[],this.urlTree.queryParams,this.urlTree.fragment);return s.queryParams=this.urlTree.queryParams,i.url=this.urlSerializer.serialize(s),{state:i,tree:s}}))}match(e){let t=new Ur([],Object.freeze({}),Object.freeze(f({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),N,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,e,N,t).pipe($(r=>({children:r,rootSnapshot:t})),ot(r=>{if(r instanceof Mi)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof Oi?this.noMatchError(r):r}))}processSegmentGroup(e,t,r,o,i){return r.segments.length===0&&r.hasChildren()?this.processChildren(e,t,r,i):this.processSegment(e,t,r,r.segments,o,!0,i).pipe($(s=>s instanceof Ne?[s]:[]))}processChildren(e,t,r,o){let i=[];for(let s of Object.keys(r.children))s==="primary"?i.unshift(s):i.push(s);return z(i).pipe(it(s=>{let a=r.children[s],c=Om(t,s);return this.processSegmentGroup(e,c,a,s,o)}),ih((s,a)=>(s.push(...a),s)),fu(null),oh(),we(s=>{if(s===null)return zn(r);let a=Nf(s);return mC(a),I(a)}))}processSegment(e,t,r,o,i,s,a){return z(t).pipe(it(c=>this.processSegmentAgainstRoute(c._injector??e,t,c,r,o,i,s,a).pipe(ot(l=>{if(l instanceof Oi)return I(null);throw l}))),or(c=>!!c),ot(c=>{if(Of(c))return fC(r,o,i)?I(new ol):zn(r);throw c}))}processSegmentAgainstRoute(e,t,r,o,i,s,a,c){return We(r)!==s&&(s===N||!$a(o,i,r))?zn(o):r.redirectTo===void 0?this.matchSegmentAgainstRoute(e,o,r,i,s,c):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(e,o,t,r,i,s,c):zn(o)}expandSegmentAgainstRouteUsingRedirect(e,t,r,o,i,s,a){let{matched:c,parameters:l,consumedSegments:h,positionalParamSegments:m,remainingSegments:y}=Pf(t,o,i);if(!c)return zn(t);typeof o.redirectTo=="string"&&o.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>gC&&(this.allowRedirects=!1));let S=new Ur(i,l,Object.freeze(f({},this.urlTree.queryParams)),this.urlTree.fragment,sf(o),We(o),o.component??o._loadedComponent??null,o,af(o)),_=Ua(S,a,this.paramsInheritanceStrategy);S.params=Object.freeze(_.params),S.data=Object.freeze(_.data);let x=this.applyRedirects.applyRedirectCommands(h,o.redirectTo,m,S,e);return this.applyRedirects.lineralizeSegments(o,x).pipe(we(V=>this.processSegment(e,r,t,V.concat(y),s,!1,a)))}matchSegmentAgainstRoute(e,t,r,o,i,s){let a=aC(t,r,o,e,this.urlSerializer);return r.path==="**"&&(t.children={}),a.pipe(pe(c=>c.matched?(e=r._injector??e,this.getChildConfig(e,r,o).pipe(pe(({routes:l})=>{let h=r._loadedInjector??e,{parameters:m,consumedSegments:y,remainingSegments:S}=c,_=new Ur(y,m,Object.freeze(f({},this.urlTree.queryParams)),this.urlTree.fragment,sf(r),We(r),r.component??r._loadedComponent??null,r,af(r)),x=Ua(_,s,this.paramsInheritanceStrategy);_.params=Object.freeze(x.params),_.data=Object.freeze(x.data);let{segmentGroup:V,slicedSegments:ve}=of(t,y,S,l);if(ve.length===0&&V.hasChildren())return this.processChildren(h,l,V,_).pipe($(je=>new Ne(_,je)));if(l.length===0&&ve.length===0)return I(new Ne(_,[]));let Dt=We(r)===i;return this.processSegment(h,l,V,ve,Dt?N:i,!0,_).pipe($(je=>new Ne(_,je instanceof Ne?[je]:[])))}))):zn(t)))}getChildConfig(e,t,r){return t.children?I({routes:t.children,injector:e}):t.loadChildren?t._loadedRoutes!==void 0?I({routes:t._loadedRoutes,injector:t._loadedInjector}):nC(e,t,r,this.urlSerializer).pipe(we(o=>o?this.configLoader.loadChildren(e,t).pipe(ge(i=>{t._loadedRoutes=i.routes,t._loadedInjector=i.injector})):sC(t))):I({routes:[],injector:e})}};function mC(n){n.sort((e,t)=>e.value.outlet===N?-1:t.value.outlet===N?1:e.value.outlet.localeCompare(t.value.outlet))}function CC(n){let e=n.value.routeConfig;return e&&e.path===""}function Nf(n){let e=[],t=new Set;for(let r of n){if(!CC(r)){e.push(r);continue}let o=e.find(i=>r.value.routeConfig===i.value.routeConfig);o!==void 0?(o.children.push(...r.children),t.add(o)):e.push(r)}for(let r of t){let o=Nf(r.children);e.push(new Ne(r.value,o))}return e.filter(r=>!t.has(r))}function sf(n){return n.data||{}}function af(n){return n.resolve||{}}function yC(n,e,t,r,o,i){return we(s=>pC(n,e,t,r,s.extractedUrl,o,i).pipe($(({state:a,tree:c})=>T(f({},s),{targetSnapshot:a,urlAfterRedirects:c}))))}function vC(n,e){return we(t=>{let{targetSnapshot:r,guards:{canActivateChecks:o}}=t;if(!o.length)return I(t);let i=new Set(o.map(c=>c.route)),s=new Set;for(let c of i)if(!s.has(c))for(let l of Lf(c))s.add(l);let a=0;return z(s).pipe(it(c=>i.has(c)?EC(c,r,n,e):(c.data=Ua(c,c.parent,n).resolve,I(void 0))),ge(()=>a++),pu(1),we(c=>a===s.size?I(t):qe))})}function Lf(n){let e=n.children.map(t=>Lf(t)).flat();return[n,...e]}function EC(n,e,t,r){let o=n.routeConfig,i=n._resolve;return o?.title!==void 0&&!Rf(o)&&(i[Pi]=o.title),AC(i,n,e,r).pipe($(s=>(n._resolvedData=s,n.data=Ua(n,n.parent,t).resolve,null)))}function AC(n,e,t,r){let o=Vu(n);if(o.length===0)return I({});let i={};return z(o).pipe(we(s=>TC(n[s],e,t,r).pipe(or(),ge(a=>{if(a instanceof Zn)throw xa(new ar,a);i[s]=a}))),pu(1),$(()=>i),ot(s=>Of(s)?qe:li(s)))}function TC(n,e,t,r){let o=Ni(e)??r,i=to(n,o),s=i.resolve?i.resolve(e,t):at(o,()=>i(e,t));return ur(s)}function ju(n){return pe(e=>{let t=n(e);return t?z(t).pipe($(()=>e)):I(e)})}var ll=(()=>{class n{buildTitle(t){let r,o=t.root;for(;o!==void 0;)r=this.getResolvedTitleForRoute(o)??r,o=o.children.find(i=>i.outlet===N);return r}getResolvedTitleForRoute(t){return t.data[Pi]}static \u0275fac=function(r){return new(r||n)};static \u0275prov=P({token:n,factory:()=>R(Ff),providedIn:"root"})}return n})(),Ff=(()=>{class n extends ll{title;constructor(t){super(),this.title=t}updateTitle(t){let r=this.buildTitle(t);r!==void 0&&this.title.setTitle(r)}static \u0275fac=function(r){return new(r||n)(w(Zh))};static \u0275prov=P({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Gr=new K("",{providedIn:"root",factory:()=>({})}),Kr=new K(""),Ga=(()=>{class n{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=R(bh);loadComponent(t){if(this.componentLoaders.get(t))return this.componentLoaders.get(t);if(t._loadedComponent)return I(t._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(t);let r=ur(t.loadComponent()).pipe($(xf),ge(i=>{this.onLoadEndListener&&this.onLoadEndListener(t),t._loadedComponent=i}),ra(()=>{this.componentLoaders.delete(t)})),o=new lu(r,()=>new He).pipe(uu());return this.componentLoaders.set(t,o),o}loadChildren(t,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return I({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);let i=Uf(r,this.compiler,t,this.onLoadEndListener).pipe(ra(()=>{this.childrenLoaders.delete(r)})),s=new lu(i,()=>new He).pipe(uu());return this.childrenLoaders.set(r,s),s}static \u0275fac=function(r){return new(r||n)};static \u0275prov=P({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function Uf(n,e,t,r){return ur(n.loadChildren()).pipe($(xf),we(o=>o instanceof Ah||Array.isArray(o)?I(o):z(e.compileModuleAsync(o))),$(o=>{r&&r(n);let i,s,a=!1;return Array.isArray(o)?(s=o,a=!0):(i=o.create(t).injector,s=i.get(Kr,[],{optional:!0,self:!0}).flat()),{routes:s.map(ul),injector:i}}))}function SC(n){return n&&typeof n=="object"&&"default"in n}function xf(n){return SC(n)?n.default:n}var Ka=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275prov=P({token:n,factory:()=>R(IC),providedIn:"root"})}return n})(),IC=(()=>{class n{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,r){return t}static \u0275fac=function(r){return new(r||n)};static \u0275prov=P({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),dl=new K(""),hl=new K("");function Bf(n,e,t){let r=n.get(hl),o=n.get(se);return n.get(ct).runOutsideAngular(()=>{if(!o.startViewTransition||r.skipNextTransition)return r.skipNextTransition=!1,new Promise(l=>setTimeout(l));let i,s=new Promise(l=>{i=l}),a=o.startViewTransition(()=>(i(),wC(n))),{onViewTransitionCreated:c}=r;return c&&at(n,()=>c({transition:a,from:e,to:t})),s})}function wC(n){return new Promise(e=>{yh({read:()=>setTimeout(e)},{injector:n})})}var fl=new K(""),za=(()=>{class n{currentNavigation=null;currentTransition=null;lastSuccessfulNavigation=null;events=new He;transitionAbortSubject=new He;configLoader=R(Ga);environmentInjector=R(Hn);destroyRef=R(hh);urlSerializer=R(Br);rootContexts=R(Hr);location=R($e);inputBindingEnabled=R(Li,{optional:!0})!==null;titleStrategy=R(ll);options=R(Gr,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=R(Ka);createViewTransition=R(dl,{optional:!0});navigationErrorHandler=R(fl,{optional:!0});navigationId=0;get hasRequestedNavigation(){return this.navigationId!==0}transitions;afterPreactivation=()=>I(void 0);rootComponentType=null;destroyed=!1;constructor(){let t=o=>this.events.next(new ba(o)),r=o=>this.events.next(new ka(o));this.configLoader.onLoadEndListener=r,this.configLoader.onLoadStartListener=t,this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(t){let r=++this.navigationId;this.transitions?.next(T(f({},t),{extractedUrl:this.urlHandlingStrategy.extract(t.rawUrl),targetSnapshot:null,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null,id:r}))}setupNavigations(t){return this.transitions=new Ie(null),this.transitions.pipe(Pe(r=>r!==null),pe(r=>{let o=!1,i=!1;return I(r).pipe(pe(s=>{if(this.navigationId>r.id)return this.cancelNavigationTransition(r,"",Re.SupersededByNewNavigation),qe;this.currentTransition=r,this.currentNavigation={id:s.id,initialUrl:s.rawUrl,extractedUrl:s.extractedUrl,targetBrowserUrl:typeof s.extras.browserUrl=="string"?this.urlSerializer.parse(s.extras.browserUrl):s.extras.browserUrl,trigger:s.source,extras:s.extras,previousNavigation:this.lastSuccessfulNavigation?T(f({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let a=!t.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),c=s.extras.onSameUrlNavigation??t.onSameUrlNavigation;if(!a&&c!=="reload"){let l="";return this.events.next(new ft(s.id,this.urlSerializer.serialize(s.rawUrl),l,Yn.IgnoredSameUrlNavigation)),s.resolve(!1),qe}if(this.urlHandlingStrategy.shouldProcessUrl(s.rawUrl))return I(s).pipe(pe(l=>(this.events.next(new cr(l.id,this.urlSerializer.serialize(l.extractedUrl),l.source,l.restoredState)),l.id!==this.navigationId?qe:Promise.resolve(l))),yC(this.environmentInjector,this.configLoader,this.rootComponentType,t.config,this.urlSerializer,this.paramsInheritanceStrategy),ge(l=>{r.targetSnapshot=l.targetSnapshot,r.urlAfterRedirects=l.urlAfterRedirects,this.currentNavigation=T(f({},this.currentNavigation),{finalUrl:l.urlAfterRedirects});let h=new Ri(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(h)}));if(a&&this.urlHandlingStrategy.shouldProcessUrl(s.currentRawUrl)){let{id:l,extractedUrl:h,source:m,restoredState:y,extras:S}=s,_=new cr(l,this.urlSerializer.serialize(h),m,y);this.events.next(_);let x=If(this.rootComponentType).snapshot;return this.currentTransition=r=T(f({},s),{targetSnapshot:x,urlAfterRedirects:h,extras:T(f({},S),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=h,I(r)}else{let l="";return this.events.next(new ft(s.id,this.urlSerializer.serialize(s.extractedUrl),l,Yn.IgnoredByUrlHandlingStrategy)),s.resolve(!1),qe}}),ge(s=>{let a=new wa(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects),s.targetSnapshot);this.events.next(a)}),$(s=>(this.currentTransition=r=T(f({},s),{guards:xm(s.targetSnapshot,s.currentSnapshot,this.rootContexts)}),r)),Ym(this.environmentInjector,s=>this.events.next(s)),ge(s=>{if(r.guardsResult=s.guardsResult,s.guardsResult&&typeof s.guardsResult!="boolean")throw xa(this.urlSerializer,s.guardsResult);let a=new Ra(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects),s.targetSnapshot,!!s.guardsResult);this.events.next(a)}),Pe(s=>s.guardsResult?!0:(this.cancelNavigationTransition(s,"",Re.GuardRejected),!1)),ju(s=>{if(s.guards.canActivateChecks.length!==0)return I(s).pipe(ge(a=>{let c=new _a(a.id,this.urlSerializer.serialize(a.extractedUrl),this.urlSerializer.serialize(a.urlAfterRedirects),a.targetSnapshot);this.events.next(c)}),pe(a=>{let c=!1;return I(a).pipe(vC(this.paramsInheritanceStrategy,this.environmentInjector),ge({next:()=>c=!0,complete:()=>{c||this.cancelNavigationTransition(a,"",Re.NoDataFromResolver)}}))}),ge(a=>{let c=new Da(a.id,this.urlSerializer.serialize(a.extractedUrl),this.urlSerializer.serialize(a.urlAfterRedirects),a.targetSnapshot);this.events.next(c)}))}),ju(s=>{let a=c=>{let l=[];c.routeConfig?.loadComponent&&!c.routeConfig._loadedComponent&&l.push(this.configLoader.loadComponent(c.routeConfig).pipe(ge(h=>{c.component=h}),$(()=>{})));for(let h of c.children)l.push(...a(h));return l};return ta(a(s.targetSnapshot.root)).pipe(fu(null),st(1))}),ju(()=>this.afterPreactivation()),pe(()=>{let{currentSnapshot:s,targetSnapshot:a}=r,c=this.createViewTransition?.(this.environmentInjector,s.root,a.root);return c?z(c).pipe($(()=>r)):I(r)}),$(s=>{let a=Pm(t.routeReuseStrategy,s.targetSnapshot,s.currentRouterState);return this.currentTransition=r=T(f({},s),{targetRouterState:a}),this.currentNavigation.targetRouterState=a,r}),ge(()=>{this.events.next(new _i)}),Um(this.rootContexts,t.routeReuseStrategy,s=>this.events.next(s),this.inputBindingEnabled),st(1),ge({next:s=>{o=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Ye(s.id,this.urlSerializer.serialize(s.extractedUrl),this.urlSerializer.serialize(s.urlAfterRedirects))),this.titleStrategy?.updateTitle(s.targetRouterState.snapshot),s.resolve(!0)},complete:()=>{o=!0}}),ah(this.transitionAbortSubject.pipe(ge(s=>{throw s}))),ra(()=>{!o&&!i&&this.cancelNavigationTransition(r,"",Re.SupersededByNewNavigation),this.currentTransition?.id===r.id&&(this.currentNavigation=null,this.currentTransition=null)}),ot(s=>{if(this.destroyed)return r.resolve(!1),qe;if(i=!0,kf(s))this.events.next(new dt(r.id,this.urlSerializer.serialize(r.extractedUrl),s.message,s.cancellationCode)),Fm(s)?this.events.next(new Xn(s.url,s.navigationBehaviorOptions)):r.resolve(!1);else{let a=new Qn(r.id,this.urlSerializer.serialize(r.extractedUrl),s,r.targetSnapshot??void 0);try{let c=at(this.environmentInjector,()=>this.navigationErrorHandler?.(a));if(c instanceof Zn){let{message:l,cancellationCode:h}=xa(this.urlSerializer,c);this.events.next(new dt(r.id,this.urlSerializer.serialize(r.extractedUrl),l,h)),this.events.next(new Xn(c.redirectTo,c.navigationBehaviorOptions))}else throw this.events.next(a),s}catch(c){this.options.resolveNavigationPromiseOnError?r.resolve(!1):r.reject(c)}}return qe}))}))}cancelNavigationTransition(t,r,o){let i=new dt(t.id,this.urlSerializer.serialize(t.extractedUrl),r,o);this.events.next(i),t.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let t=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),r=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return t.toString()!==r?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static \u0275fac=function(r){return new(r||n)};static \u0275prov=P({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function RC(n){return n!==Ta}var Hf=(()=>{class n{static \u0275fac=function(r){return new(r||n)};static \u0275prov=P({token:n,factory:()=>R(_C),providedIn:"root"})}return n})(),Ha=class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}},_C=(()=>{class n extends Ha{static \u0275fac=(()=>{let t;return function(o){return(t||(t=mu(n)))(o||n)}})();static \u0275prov=P({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),$f=(()=>{class n{urlSerializer=R(Br);options=R(Gr,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";location=R($e);urlHandlingStrategy=R(Ka);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new ht;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}createBrowserPath({finalUrl:t,initialUrl:r,targetBrowserUrl:o}){let i=t!==void 0?this.urlHandlingStrategy.merge(t,r):r,s=o??i;return s instanceof ht?this.urlSerializer.serialize(s):s}commitTransition({targetRouterState:t,finalUrl:r,initialUrl:o}){r&&t?(this.currentUrlTree=r,this.rawUrlTree=this.urlHandlingStrategy.merge(r,o),this.routerState=t):this.rawUrlTree=o}routerState=If(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();updateStateMemento(){this.stateMemento=this.createStateMemento()}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}resetInternalState({finalUrl:t}){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t??this.rawUrlTree)}static \u0275fac=function(r){return new(r||n)};static \u0275prov=P({token:n,factory:()=>R(DC),providedIn:"root"})}return n})(),DC=(()=>{class n extends $f{currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}registerNonRouterCurrentEntryChangeListener(t){return this.location.subscribe(r=>{r.type==="popstate"&&setTimeout(()=>{t(r.url,r.state,"popstate")})})}handleRouterEvent(t,r){t instanceof cr?this.updateStateMemento():t instanceof ft?this.commitTransition(r):t instanceof Ri?this.urlUpdateStrategy==="eager"&&(r.extras.skipLocationChange||this.setBrowserUrl(this.createBrowserPath(r),r)):t instanceof _i?(this.commitTransition(r),this.urlUpdateStrategy==="deferred"&&!r.extras.skipLocationChange&&this.setBrowserUrl(this.createBrowserPath(r),r)):t instanceof dt&&(t.code===Re.GuardRejected||t.code===Re.NoDataFromResolver)?this.restoreHistory(r):t instanceof Qn?this.restoreHistory(r,!0):t instanceof Ye&&(this.lastSuccessfulId=t.id,this.currentPageId=this.browserPageId)}setBrowserUrl(t,{extras:r,id:o}){let{replaceUrl:i,state:s}=r;if(this.location.isCurrentPathEqualTo(t)||i){let a=this.browserPageId,c=f(f({},s),this.generateNgRouterState(o,a));this.location.replaceState(t,"",c)}else{let a=f(f({},s),this.generateNgRouterState(o,this.browserPageId+1));this.location.go(t,"",a)}}restoreHistory(t,r=!1){if(this.canceledNavigationResolution==="computed"){let o=this.browserPageId,i=this.currentPageId-o;i!==0?this.location.historyGo(i):this.getCurrentUrlTree()===t.finalUrl&&i===0&&(this.resetInternalState(t),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(r&&this.resetInternalState(t),this.resetUrlToCurrentUrlTree())}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.getRawUrlTree()),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,r){return this.canceledNavigationResolution==="computed"?{navigationId:t,\u0275routerPageId:r}:{navigationId:t}}static \u0275fac=(()=>{let t;return function(o){return(t||(t=mu(n)))(o||n)}})();static \u0275prov=P({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function ja(n,e){n.events.pipe(Pe(t=>t instanceof Ye||t instanceof dt||t instanceof Qn||t instanceof ft),$(t=>t instanceof Ye||t instanceof ft?0:(t instanceof dt?t.code===Re.Redirect||t.code===Re.SupersededByNewNavigation:!1)?2:1),Pe(t=>t!==2),st(1)).subscribe(()=>{e()})}var bC={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},kC={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},Fe=(()=>{class n{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=R(Th);stateManager=R($f);options=R(Gr,{optional:!0})||{};pendingTasks=R(fh);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=R(za);urlSerializer=R(Br);location=R($e);urlHandlingStrategy=R(Ka);_events=new He;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=R(Hf);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=R(Kr,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!R(Li,{optional:!0});constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this).subscribe({error:t=>{this.console.warn(t)}}),this.subscribeToNavigationEvents()}eventsSubscription=new Xd;subscribeToNavigationEvents(){let t=this.navigationTransitions.events.subscribe(r=>{try{let o=this.navigationTransitions.currentTransition,i=this.navigationTransitions.currentNavigation;if(o!==null&&i!==null){if(this.stateManager.handleRouterEvent(r,i),r instanceof dt&&r.code!==Re.Redirect&&r.code!==Re.SupersededByNewNavigation)this.navigated=!0;else if(r instanceof Ye)this.navigated=!0;else if(r instanceof Xn){let s=r.navigationBehaviorOptions,a=this.urlHandlingStrategy.merge(r.url,o.currentRawUrl),c=f({browserUrl:o.extras.browserUrl,info:o.extras.info,skipLocationChange:o.extras.skipLocationChange,replaceUrl:o.extras.replaceUrl||this.urlUpdateStrategy==="eager"||RC(o.source)},s);this.scheduleNavigation(a,Ta,null,c,{resolve:o.resolve,reject:o.reject,promise:o.promise})}}MC(r)&&this._events.next(r)}catch(o){this.navigationTransitions.transitionAbortSubject.next(o)}});this.eventsSubscription.add(t)}resetRootComponentType(t){this.routerState.root.component=t,this.navigationTransitions.rootComponentType=t}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Ta,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((t,r,o)=>{this.navigateToSyncWithBrowser(t,o,r)})}navigateToSyncWithBrowser(t,r,o){let i={replaceUrl:!0},s=o?.navigationId?o:null;if(o){let c=f({},o);delete c.navigationId,delete c.\u0275routerPageId,Object.keys(c).length!==0&&(i.state=c)}let a=this.parseUrl(t);this.scheduleNavigation(a,r,s,i)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(t){this.config=t.map(ul),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(t,r={}){let{relativeTo:o,queryParams:i,fragment:s,queryParamsHandling:a,preserveFragment:c}=r,l=c?this.currentUrlTree.fragment:s,h=null;switch(a??this.options.defaultQueryParamsHandling){case"merge":h=f(f({},this.currentUrlTree.queryParams),i);break;case"preserve":h=this.currentUrlTree.queryParams;break;default:h=i||null}h!==null&&(h=this.removeEmptyProps(h));let m;try{let y=o?o.snapshot:this.routerState.snapshot.root;m=Ef(y)}catch{(typeof t[0]!="string"||t[0][0]!=="/")&&(t=[]),m=this.currentUrlTree.root}return Af(m,t,h,l??null)}navigateByUrl(t,r={skipLocationChange:!1}){let o=Wn(t)?t:this.parseUrl(t),i=this.urlHandlingStrategy.merge(o,this.rawUrlTree);return this.scheduleNavigation(i,Ta,null,r)}navigate(t,r={skipLocationChange:!1}){return OC(t),this.navigateByUrl(this.createUrlTree(t,r),r)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){try{return this.urlSerializer.parse(t)}catch{return this.urlSerializer.parse("/")}}isActive(t,r){let o;if(r===!0?o=f({},bC):r===!1?o=f({},kC):o=r,Wn(t))return ef(this.currentUrlTree,t,o);let i=this.parseUrl(t);return ef(this.currentUrlTree,i,o)}removeEmptyProps(t){return Object.entries(t).reduce((r,[o,i])=>(i!=null&&(r[o]=i),r),{})}scheduleNavigation(t,r,o,i,s){if(this.disposed)return Promise.resolve(!1);let a,c,l;s?(a=s.resolve,c=s.reject,l=s.promise):l=new Promise((m,y)=>{a=m,c=y});let h=this.pendingTasks.add();return ja(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(h))}),this.navigationTransitions.handleNavigationRequest({source:r,restoredState:o,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:t,extras:i,resolve:a,reject:c,promise:l,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),l.catch(m=>Promise.reject(m))}static \u0275fac=function(r){return new(r||n)};static \u0275prov=P({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function OC(n){for(let e=0;e<n.length;e++)if(n[e]==null)throw new Y(4008,!1)}function MC(n){return!(n instanceof _i)&&!(n instanceof Xn)}var Ui=class{};var Gf=(()=>{class n{router;injector;preloadingStrategy;loader;subscription;constructor(t,r,o,i){this.router=t,this.injector=r,this.preloadingStrategy=o,this.loader=i}setUpPreloading(){this.subscription=this.router.events.pipe(Pe(t=>t instanceof Ye),it(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,r){let o=[];for(let i of r){i.providers&&!i._injector&&(i._injector=oa(i.providers,t,`Route: ${i.path}`));let s=i._injector??t,a=i._loadedInjector??s;(i.loadChildren&&!i._loadedRoutes&&i.canLoad===void 0||i.loadComponent&&!i._loadedComponent)&&o.push(this.preloadConfig(s,i)),(i.children||i._loadedRoutes)&&o.push(this.processRoutes(a,i.children??i._loadedRoutes))}return z(o).pipe(du())}preloadConfig(t,r){return this.preloadingStrategy.preload(r,()=>{let o;r.loadChildren&&r.canLoad===void 0?o=this.loader.loadChildren(t,r):o=I(null);let i=o.pipe(we(s=>s===null?I(void 0):(r._loadedRoutes=s.routes,r._loadedInjector=s.injector,this.processRoutes(s.injector??t,s.routes))));if(r.loadComponent&&!r._loadedComponent){let s=this.loader.loadComponent(r);return z([i,s]).pipe(du())}else return i})}static \u0275fac=function(r){return new(r||n)(w(Fe),w(Hn),w(Ui),w(Ga))};static \u0275prov=P({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),Kf=new K(""),PC=(()=>{class n{urlSerializer;transitions;viewportScroller;zone;options;routerEventsSubscription;scrollEventsSubscription;lastId=0;lastSource="imperative";restoredId=0;store={};constructor(t,r,o,i,s={}){this.urlSerializer=t,this.transitions=r,this.viewportScroller=o,this.zone=i,this.options=s,s.scrollPositionRestoration||="disabled",s.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof cr?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof Ye?(this.lastId=t.id,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.urlAfterRedirects).fragment)):t instanceof ft&&t.code===Yn.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof Jn&&(t.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0]):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(t.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,r){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new Jn(t,this.lastSource==="popstate"?this.store[this.restoredId]:null,r))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static \u0275fac=function(r){Eh()};static \u0275prov=P({token:n,factory:n.\u0275fac})}return n})();function gl(n,...e){return uh([{provide:Kr,multi:!0,useValue:n},[],{provide:Nt,useFactory:zf,deps:[Fe]},{provide:Iu,multi:!0,useFactory:jf},e.map(t=>t.\u0275providers)])}function zf(n){return n.routerState.root}function xi(n,e){return{\u0275kind:n,\u0275providers:e}}function jf(){let n=R(Nr);return e=>{let t=n.get(wh);if(e!==t.components[0])return;let r=n.get(Fe),o=n.get(qf);n.get(ml)===1&&r.initialNavigation(),n.get(Yf,null,gu.Optional)?.setUpPreloading(),n.get(Kf,null,gu.Optional)?.init(),r.resetRootComponentType(t.componentTypes[0]),o.closed||(o.next(),o.complete(),o.unsubscribe())}}var qf=new K("",{factory:()=>new He}),ml=new K("",{providedIn:"root",factory:()=>1});function Vf(){let n=[{provide:ml,useValue:0},Su(()=>{let e=R(Nr);return e.get(ku,Promise.resolve()).then(()=>new Promise(r=>{let o=e.get(Fe),i=e.get(qf);ja(o,()=>{r(!0)}),e.get(za).afterPreactivation=()=>(r(!0),i.closed?I(void 0):i),o.initialNavigation()}))})];return xi(2,n)}function Wf(){let n=[Su(()=>{R(Fe).setUpLocationChangeListener()}),{provide:ml,useValue:2}];return xi(3,n)}var Yf=new K("");function Qf(n){return xi(0,[{provide:Yf,useExisting:Gf},{provide:Ui,useExisting:n}])}function Jf(){return xi(8,[al,{provide:Li,useExisting:al}])}function Xf(n){Eu("NgRouterViewTransitions");let e=[{provide:dl,useValue:Bf},{provide:hl,useValue:f({skipNextTransition:!!n?.skipInitialTransition},n)}];return xi(9,e)}var Zf=[$e,{provide:Br,useClass:ar},Fe,Hr,{provide:Nt,useFactory:zf,deps:[Fe]},Ga,[]],Cl=(()=>{class n{constructor(){}static forRoot(t,r){return{ngModule:n,providers:[Zf,[],{provide:Kr,multi:!0,useValue:t},[],r?.errorHandler?{provide:fl,useValue:r.errorHandler}:[],{provide:Gr,useValue:r||{}},r?.useHash?LC():FC(),NC(),r?.preloadingStrategy?Qf(r.preloadingStrategy).\u0275providers:[],r?.initialNavigation?UC(r):[],r?.bindToComponentInputs?Jf().\u0275providers:[],r?.enableViewTransitions?Xf().\u0275providers:[],xC()]}}static forChild(t){return{ngModule:n,providers:[{provide:Kr,multi:!0,useValue:t}]}}static \u0275fac=function(r){return new(r||n)};static \u0275mod=Ot({type:n});static \u0275inj=bt({})}return n})();function NC(){return{provide:Kf,useFactory:()=>{let n=R(Kh),e=R(ct),t=R(Gr),r=R(za),o=R(Br);return t.scrollOffset&&n.setOffset(t.scrollOffset),new PC(o,r,n,e,t)}}}function LC(){return{provide:Pt,useClass:Ou}}function FC(){return{provide:Pt,useClass:da}}function UC(n){return[n.initialNavigation==="disabled"?Wf().\u0275providers:[],n.initialNavigation==="enabledBlocking"?Vf().\u0275providers:[]]}var pl=new K("");function xC(){return[{provide:pl,useFactory:jf},{provide:Iu,multi:!0,useExisting:pl}]}var Hc={};Me(Hc,{blockAPICallsBeforeInitialize:()=>xc,blockAcquireTokenInPopups:()=>jp,blockNonBrowserEnvironment:()=>Uc,blockRedirectInIframe:()=>zp,blockReloadInHiddenIframes:()=>Kp,clearHash:()=>Gs,createGuid:()=>Wd,getCurrentUri:()=>Se,getHomepage:()=>Vd,invoke:()=>ce,invokeAsync:()=>p,isInIframe:()=>Ks,isInPopup:()=>Gp,preconnect:()=>js,preflightCheck:()=>zs,redirectPreflightCheck:()=>Bc,replaceHash:()=>qd});var g={LIBRARY_NAME:"MSAL.JS",SKU:"msal.js.common",CACHE_PREFIX:"msal",DEFAULT_AUTHORITY:"https://login.microsoftonline.com/common/",DEFAULT_AUTHORITY_HOST:"login.microsoftonline.com",DEFAULT_COMMON_TENANT:"common",ADFS:"adfs",DSTS:"dstsv2",AAD_INSTANCE_DISCOVERY_ENDPT:"https://login.microsoftonline.com/common/discovery/instance?api-version=1.1&authorization_endpoint=",CIAM_AUTH_URL:".ciamlogin.com",AAD_TENANT_DOMAIN_SUFFIX:".onmicrosoft.com",RESOURCE_DELIM:"|",NO_ACCOUNT:"NO_ACCOUNT",CLAIMS:"claims",CONSUMER_UTID:"9188040d-6c67-4c5b-b112-36a304b66dad",OPENID_SCOPE:"openid",PROFILE_SCOPE:"profile",OFFLINE_ACCESS_SCOPE:"offline_access",EMAIL_SCOPE:"email",CODE_GRANT_TYPE:"authorization_code",RT_GRANT_TYPE:"refresh_token",S256_CODE_CHALLENGE_METHOD:"S256",URL_FORM_CONTENT_TYPE:"application/x-www-form-urlencoded;charset=utf-8",AUTHORIZATION_PENDING:"authorization_pending",NOT_DEFINED:"not_defined",EMPTY_STRING:"",NOT_APPLICABLE:"N/A",NOT_AVAILABLE:"Not Available",FORWARD_SLASH:"/",IMDS_ENDPOINT:"http://169.254.169.254/metadata/instance/compute/location",IMDS_VERSION:"2020-06-01",IMDS_TIMEOUT:2e3,AZURE_REGION_AUTO_DISCOVER_FLAG:"TryAutoDetect",REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX:"login.microsoft.com",KNOWN_PUBLIC_CLOUDS:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],SHR_NONCE_VALIDITY:240,INVALID_INSTANCE:"invalid_instance"},ro={SUCCESS:200,SUCCESS_RANGE_START:200,SUCCESS_RANGE_END:299,REDIRECT:302,CLIENT_ERROR:400,CLIENT_ERROR_RANGE_START:400,BAD_REQUEST:400,UNAUTHORIZED:401,NOT_FOUND:404,REQUEST_TIMEOUT:408,GONE:410,TOO_MANY_REQUESTS:429,CLIENT_ERROR_RANGE_END:499,SERVER_ERROR:500,SERVER_ERROR_RANGE_START:500,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504,SERVER_ERROR_RANGE_END:599,MULTI_SIDED_ERROR:600},Qe=[g.OPENID_SCOPE,g.PROFILE_SCOPE,g.OFFLINE_ACCESS_SCOPE],yl=[...Qe,g.EMAIL_SCOPE],ie={CONTENT_TYPE:"Content-Type",CONTENT_LENGTH:"Content-Length",RETRY_AFTER:"Retry-After",CCS_HEADER:"X-AnchorMailbox",WWWAuthenticate:"WWW-Authenticate",AuthenticationInfo:"Authentication-Info",X_MS_REQUEST_ID:"x-ms-request-id",X_MS_HTTP_VERSION:"x-ms-httpver"},qa={ACTIVE_ACCOUNT_FILTERS:"active-account-filters"},Je={COMMON:"common",ORGANIZATIONS:"organizations",CONSUMERS:"consumers"},no={ACCESS_TOKEN:"access_token",XMS_CC:"xms_cc"},W={LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none",CREATE:"create",NO_SESSION:"no_session"},Va={PLAIN:"plain",S256:"S256"},Wa={CODE:"code",IDTOKEN_TOKEN:"id_token token",IDTOKEN_TOKEN_REFRESHTOKEN:"id_token token refresh_token"},pt={QUERY:"query",FRAGMENT:"fragment"},vl={QUERY:"query",FRAGMENT:"fragment",FORM_POST:"form_post"},Bi={IMPLICIT_GRANT:"implicit",AUTHORIZATION_CODE_GRANT:"authorization_code",CLIENT_CREDENTIALS_GRANT:"client_credentials",RESOURCE_OWNER_PASSWORD_GRANT:"password",REFRESH_TOKEN_GRANT:"refresh_token",DEVICE_CODE_GRANT:"device_code",JWT_BEARER:"urn:ietf:params:oauth:grant-type:jwt-bearer"},oo={MSSTS_ACCOUNT_TYPE:"MSSTS",ADFS_ACCOUNT_TYPE:"ADFS",MSAV1_ACCOUNT_TYPE:"MSA",GENERIC_ACCOUNT_TYPE:"Generic"},ne={CACHE_KEY_SEPARATOR:"-",CLIENT_INFO_SEPARATOR:"."},D={ID_TOKEN:"IdToken",ACCESS_TOKEN:"AccessToken",ACCESS_TOKEN_WITH_AUTH_SCHEME:"AccessToken_With_AuthScheme",REFRESH_TOKEN:"RefreshToken"};var Hi="appmetadata",tp="client_info",lr="1",io={CACHE_KEY:"authority-metadata",REFRESH_TIME_SECONDS:3600*24},Ee={CONFIG:"config",CACHE:"cache",NETWORK:"network",HARDCODED_VALUES:"hardcoded_values"},le={SCHEMA_VERSION:5,MAX_CUR_HEADER_BYTES:80,MAX_LAST_HEADER_BYTES:330,MAX_CACHED_ERRORS:50,CACHE_KEY:"server-telemetry",CATEGORY_SEPARATOR:"|",VALUE_SEPARATOR:",",OVERFLOW_TRUE:"1",OVERFLOW_FALSE:"0",UNKNOWN_ERROR:"unknown_error"},U={BEARER:"Bearer",POP:"pop",SSH:"ssh-cert"},Lt={DEFAULT_THROTTLE_TIME_SECONDS:60,DEFAULT_MAX_THROTTLE_TIME_SECONDS:3600,THROTTLING_PREFIX:"throttling",X_MS_LIB_CAPABILITY_VALUE:"retry-after, h429"},Ya={INVALID_GRANT_ERROR:"invalid_grant",CLIENT_MISMATCH_ERROR:"client_mismatch"},Qa={username:"username",password:"password"},$i={httpSuccess:200,httpBadRequest:400},zr={FAILED_AUTO_DETECTION:"1",INTERNAL_CACHE:"2",ENVIRONMENT_VARIABLE:"3",IMDS:"4"},Ja={CONFIGURED_MATCHES_DETECTED:"1",CONFIGURED_NO_AUTO_DETECTION:"2",CONFIGURED_NOT_DETECTED:"3",AUTO_DETECTION_REQUESTED_SUCCESSFUL:"4",AUTO_DETECTION_REQUESTED_FAILED:"5"},gt={NOT_APPLICABLE:"0",FORCE_REFRESH_OR_CLAIMS:"1",NO_CACHED_ACCESS_TOKEN:"2",CACHED_ACCESS_TOKEN_EXPIRED:"3",PROACTIVELY_REFRESHED:"4"},Xa={Jwt:"JWT",Jwk:"JWK",Pop:"pop"};var El=300;var jr={};Me(jr,{postRequestFailed:()=>Ki,unexpectedError:()=>Gi});var Gi="unexpected_error",Ki="post_request_failed";var Za={[Gi]:"Unexpected error in authentication.",[Ki]:"Post request failed from the network, could be a 4xx/5xx or a network unavailability. Please check the exact error code for details."},rp={unexpectedError:{code:Gi,desc:Za[Gi]},postRequestFailed:{code:Ki,desc:Za[Ki]}},O=class n extends Error{constructor(e,t,r){let o=t?`${e}: ${t}`:e;super(o),Object.setPrototypeOf(this,n.prototype),this.errorCode=e||g.EMPTY_STRING,this.errorMessage=t||g.EMPTY_STRING,this.subError=r||g.EMPTY_STRING,this.name="AuthError"}setCorrelationId(e){this.correlationId=e}};function zi(n,e){return new O(n,e?`${Za[n]} ${e}`:Za[n])}var ae={};Me(ae,{authTimeNotFound:()=>Ft,authorizationCodeMissingFromServerResponse:()=>an,bindingKeyNotRemoved:()=>cn,cannotAppendScopeSet:()=>nn,cannotRemoveEmptyScope:()=>rn,clientInfoDecodingError:()=>dr,clientInfoEmptyError:()=>qr,deviceCodeExpired:()=>Wi,deviceCodePollingCancelled:()=>Vi,deviceCodeUnknownError:()=>Yi,emptyInputScopeSet:()=>pr,endSessionEndpointNotSupported:()=>un,endpointResolutionError:()=>Ae,hashNotDeserialized:()=>Qr,invalidAssertion:()=>Xi,invalidCacheEnvironment:()=>xt,invalidCacheRecord:()=>on,invalidClientCredential:()=>Zi,invalidState:()=>Xe,keyIdMissing:()=>ln,maxAgeTranspired:()=>Zr,methodNotImplemented:()=>L,missingTenantIdError:()=>ns,multipleMatchingAccounts:()=>qi,multipleMatchingAppMetadata:()=>en,multipleMatchingTokens:()=>ji,nestedAppAuthBridgeDisabled:()=>os,networkError:()=>Wr,noAccountFound:()=>Qi,noAccountInSilentRequest:()=>Ut,noCryptoObject:()=>gr,noNetworkConnectivity:()=>ts,nonceMismatch:()=>Xr,nullOrEmptyToken:()=>Vr,openIdConfigError:()=>Yr,requestCannotBeMade:()=>tn,stateMismatch:()=>Jr,stateNotFound:()=>fr,tokenClaimsCnfRequiredForSignedJwt:()=>sn,tokenParsingError:()=>hr,tokenRefreshRequired:()=>Bt,unexpectedCredentialType:()=>Ji,userCanceled:()=>rs,userTimeoutReached:()=>es});var dr="client_info_decoding_error",qr="client_info_empty_error",hr="token_parsing_error",Vr="null_or_empty_token",Ae="endpoints_resolution_error",Wr="network_error",Yr="openid_config_error",Qr="hash_not_deserialized",Xe="invalid_state",Jr="state_mismatch",fr="state_not_found",Xr="nonce_mismatch",Ft="auth_time_not_found",Zr="max_age_transpired",ji="multiple_matching_tokens",qi="multiple_matching_accounts",en="multiple_matching_appMetadata",tn="request_cannot_be_made",rn="cannot_remove_empty_scope",nn="cannot_append_scopeset",pr="empty_input_scopeset",Vi="device_code_polling_cancelled",Wi="device_code_expired",Yi="device_code_unknown_error",Ut="no_account_in_silent_request",on="invalid_cache_record",xt="invalid_cache_environment",Qi="no_account_found",gr="no_crypto_object",Ji="unexpected_credential_type",Xi="invalid_assertion",Zi="invalid_client_credential",Bt="token_refresh_required",es="user_timeout_reached",sn="token_claims_cnf_required_for_signedjwt",an="authorization_code_missing_from_server_response",cn="binding_key_not_removed",un="end_session_endpoint_not_supported",ln="key_id_missing",ts="no_network_connectivity",rs="user_canceled",ns="missing_tenant_id_error",L="method_not_implemented",os="nested_app_auth_bridge_disabled";var M={[dr]:"The client info could not be parsed/decoded correctly",[qr]:"The client info was empty",[hr]:"Token cannot be parsed",[Vr]:"The token is null or empty",[Ae]:"Endpoints cannot be resolved",[Wr]:"Network request failed",[Yr]:"Could not retrieve endpoints. Check your authority and verify the .well-known/openid-configuration endpoint returns the required endpoints.",[Qr]:"The hash parameters could not be deserialized",[Xe]:"State was not the expected format",[Jr]:"State mismatch error",[fr]:"State not found",[Xr]:"Nonce mismatch error",[Ft]:"Max Age was requested and the ID token is missing the auth_time variable. auth_time is an optional claim and is not enabled by default - it must be enabled. See https://aka.ms/msaljs/optional-claims for more information.",[Zr]:"Max Age is set to 0, or too much time has elapsed since the last end-user authentication.",[ji]:"The cache contains multiple tokens satisfying the requirements. Call AcquireToken again providing more requirements such as authority or account.",[qi]:"The cache contains multiple accounts satisfying the given parameters. Please pass more info to obtain the correct account",[en]:"The cache contains multiple appMetadata satisfying the given parameters. Please pass more info to obtain the correct appMetadata",[tn]:"Token request cannot be made without authorization code or refresh token.",[rn]:"Cannot remove null or empty scope from ScopeSet",[nn]:"Cannot append ScopeSet",[pr]:"Empty input ScopeSet cannot be processed",[Vi]:"Caller has cancelled token endpoint polling during device code flow by setting DeviceCodeRequest.cancel = true.",[Wi]:"Device code is expired.",[Yi]:"Device code stopped polling for unknown reasons.",[Ut]:"Please pass an account object, silent flow is not supported without account information",[on]:"Cache record object was null or undefined.",[xt]:"Invalid environment when attempting to create cache entry",[Qi]:"No account found in cache for given key.",[gr]:"No crypto object detected.",[Ji]:"Unexpected credential type.",[Xi]:"Client assertion must meet requirements described in https://tools.ietf.org/html/rfc7515",[Zi]:"Client credential (secret, certificate, or assertion) must not be empty when creating a confidential client. An application should at most have one credential",[Bt]:"Cannot return token from cache because it must be refreshed. This may be due to one of the following reasons: forceRefresh parameter is set to true, claims have been requested, there is no cached access token or it is expired.",[es]:"User defined timeout for device code polling reached",[sn]:"Cannot generate a POP jwt if the token_claims are not populated",[an]:"Server response does not contain an authorization code to proceed",[cn]:"Could not remove the credential's binding key from storage.",[un]:"The provided authority does not support logout",[ln]:"A keyId value is missing from the requested bound token's cache record and is required to match the token to it's stored binding key.",[ts]:"No network connectivity. Check your internet connection.",[rs]:"User cancelled the flow.",[ns]:"A tenant id - not common, organizations, or consumers - must be specified when using the client_credentials flow.",[L]:"This method has not been implemented",[os]:"The nested app auth bridge is disabled"},np={clientInfoDecodingError:{code:dr,desc:M[dr]},clientInfoEmptyError:{code:qr,desc:M[qr]},tokenParsingError:{code:hr,desc:M[hr]},nullOrEmptyToken:{code:Vr,desc:M[Vr]},endpointResolutionError:{code:Ae,desc:M[Ae]},networkError:{code:Wr,desc:M[Wr]},unableToGetOpenidConfigError:{code:Yr,desc:M[Yr]},hashNotDeserialized:{code:Qr,desc:M[Qr]},invalidStateError:{code:Xe,desc:M[Xe]},stateMismatchError:{code:Jr,desc:M[Jr]},stateNotFoundError:{code:fr,desc:M[fr]},nonceMismatchError:{code:Xr,desc:M[Xr]},authTimeNotFoundError:{code:Ft,desc:M[Ft]},maxAgeTranspired:{code:Zr,desc:M[Zr]},multipleMatchingTokens:{code:ji,desc:M[ji]},multipleMatchingAccounts:{code:qi,desc:M[qi]},multipleMatchingAppMetadata:{code:en,desc:M[en]},tokenRequestCannotBeMade:{code:tn,desc:M[tn]},removeEmptyScopeError:{code:rn,desc:M[rn]},appendScopeSetError:{code:nn,desc:M[nn]},emptyInputScopeSetError:{code:pr,desc:M[pr]},DeviceCodePollingCancelled:{code:Vi,desc:M[Vi]},DeviceCodeExpired:{code:Wi,desc:M[Wi]},DeviceCodeUnknownError:{code:Yi,desc:M[Yi]},NoAccountInSilentRequest:{code:Ut,desc:M[Ut]},invalidCacheRecord:{code:on,desc:M[on]},invalidCacheEnvironment:{code:xt,desc:M[xt]},noAccountFound:{code:Qi,desc:M[Qi]},noCryptoObj:{code:gr,desc:M[gr]},unexpectedCredentialType:{code:Ji,desc:M[Ji]},invalidAssertion:{code:Xi,desc:M[Xi]},invalidClientCredential:{code:Zi,desc:M[Zi]},tokenRefreshRequired:{code:Bt,desc:M[Bt]},userTimeoutReached:{code:es,desc:M[es]},tokenClaimsRequired:{code:sn,desc:M[sn]},noAuthorizationCodeFromServer:{code:an,desc:M[an]},bindingKeyNotRemovedError:{code:cn,desc:M[cn]},logoutNotSupported:{code:un,desc:M[un]},keyIdMissing:{code:ln,desc:M[ln]},noNetworkConnectivity:{code:ts,desc:M[ts]},userCanceledError:{code:rs,desc:M[rs]},missingTenantIdError:{code:ns,desc:M[ns]},nestedAppAuthBridgeDisabled:{code:os,desc:M[os]}},is=class n extends O{constructor(e,t){super(e,t?`${M[e]}: ${t}`:M[e]),this.name="ClientAuthError",Object.setPrototypeOf(this,n.prototype)}};function C(n,e){return new is(n,e)}var mr={createNewGuid:()=>{throw C(L)},base64Decode:()=>{throw C(L)},base64Encode:()=>{throw C(L)},base64UrlEncode:()=>{throw C(L)},encodeKid:()=>{throw C(L)},getPublicKeyThumbprint(){return d(this,null,function*(){throw C(L)})},removeTokenBindingKey(){return d(this,null,function*(){throw C(L)})},clearKeystore(){return d(this,null,function*(){throw C(L)})},signJwt(){return d(this,null,function*(){throw C(L)})},hashString(){return d(this,null,function*(){throw C(L)})}};var G=function(n){return n[n.Error=0]="Error",n[n.Warning=1]="Warning",n[n.Info=2]="Info",n[n.Verbose=3]="Verbose",n[n.Trace=4]="Trace",n}(G||{}),_e=class n{constructor(e,t,r){this.level=G.Info;let o=()=>{},i=e||n.createDefaultLoggerOptions();this.localCallback=i.loggerCallback||o,this.piiLoggingEnabled=i.piiLoggingEnabled||!1,this.level=typeof i.logLevel=="number"?i.logLevel:G.Info,this.correlationId=i.correlationId||g.EMPTY_STRING,this.packageName=t||g.EMPTY_STRING,this.packageVersion=r||g.EMPTY_STRING}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:G.Info}}clone(e,t,r){return new n({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level,correlationId:r||this.correlationId},e,t)}logMessage(e,t){if(t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii)return;let i=`${`[${new Date().toUTCString()}] : [${t.correlationId||this.correlationId||""}]`} : ${this.packageName}@${this.packageVersion} : ${G[t.logLevel]} - ${e}`;this.executeCallback(t.logLevel,i,t.containsPii||!1)}executeCallback(e,t,r){this.localCallback&&this.localCallback(e,t,r)}error(e,t){this.logMessage(e,{logLevel:G.Error,containsPii:!1,correlationId:t||g.EMPTY_STRING})}errorPii(e,t){this.logMessage(e,{logLevel:G.Error,containsPii:!0,correlationId:t||g.EMPTY_STRING})}warning(e,t){this.logMessage(e,{logLevel:G.Warning,containsPii:!1,correlationId:t||g.EMPTY_STRING})}warningPii(e,t){this.logMessage(e,{logLevel:G.Warning,containsPii:!0,correlationId:t||g.EMPTY_STRING})}info(e,t){this.logMessage(e,{logLevel:G.Info,containsPii:!1,correlationId:t||g.EMPTY_STRING})}infoPii(e,t){this.logMessage(e,{logLevel:G.Info,containsPii:!0,correlationId:t||g.EMPTY_STRING})}verbose(e,t){this.logMessage(e,{logLevel:G.Verbose,containsPii:!1,correlationId:t||g.EMPTY_STRING})}verbosePii(e,t){this.logMessage(e,{logLevel:G.Verbose,containsPii:!0,correlationId:t||g.EMPTY_STRING})}trace(e,t){this.logMessage(e,{logLevel:G.Trace,containsPii:!1,correlationId:t||g.EMPTY_STRING})}tracePii(e,t){this.logMessage(e,{logLevel:G.Trace,containsPii:!0,correlationId:t||g.EMPTY_STRING})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}};var ec="@azure/msal-common",so="15.6.0";var Cr={None:"none",AzurePublic:"https://login.microsoftonline.com",AzurePpe:"https://login.windows-ppe.net",AzureChina:"https://login.chinacloudapi.cn",AzureGermany:"https://login.microsoftonline.de",AzureUsGovernment:"https://login.microsoftonline.us"};var Q={};Me(Q,{createAccessTokenEntity:()=>Sl,createIdTokenEntity:()=>Tl,createRefreshTokenEntity:()=>Il,generateAppMetadataKey:()=>XC,generateAuthorityMetadataExpiresAt:()=>rc,generateCredentialKey:()=>cs,isAccessTokenEntity:()=>GC,isAppMetadataEntity:()=>ZC,isAuthorityMetadataEntity:()=>ey,isAuthorityMetadataExpired:()=>nc,isCredentialEntity:()=>tc,isIdTokenEntity:()=>KC,isRefreshTokenEntity:()=>zC,isServerTelemetryEntity:()=>QC,isThrottlingEntity:()=>JC,updateAuthorityEndpointMetadata:()=>uo,updateCloudDiscoveryMetadata:()=>us});var ao={};Me(ao,{checkMaxAge:()=>ss,extractTokenClaims:()=>Ht,getJWSPayload:()=>op});function Ht(n,e){let t=op(n);try{let r=e(t);return JSON.parse(r)}catch{throw C(hr)}}function op(n){if(!n)throw C(Vr);let t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(n);if(!t||t.length<4)throw C(hr);return t[2]}function ss(n,e){if(e===0||Date.now()-3e5>n+e)throw C(Zr)}var me={};Me(me,{delay:()=>$C,isTokenExpired:()=>co,nowSeconds:()=>Ue,toDateFromSeconds:()=>as,toSecondsFromDate:()=>HC,wasClockTurnedBack:()=>Al});function Ue(){return Math.round(new Date().getTime()/1e3)}function HC(n){return n.getTime()/1e3}function as(n){return n?new Date(Number(n)*1e3):new Date}function co(n,e){let t=Number(n)||0;return Ue()+e>t}function Al(n){return Number(n)>Ue()}function $C(n,e){return new Promise(t=>setTimeout(()=>t(e),n))}function cs(n){return[jC(n),qC(n),VC(n),WC(n),YC(n)].join(ne.CACHE_KEY_SEPARATOR).toLowerCase()}function Tl(n,e,t,r,o){return{credentialType:D.ID_TOKEN,homeAccountId:n,environment:e,clientId:r,secret:t,realm:o}}function Sl(n,e,t,r,o,i,s,a,c,l,h,m,y,S,_){let x={homeAccountId:n,credentialType:D.ACCESS_TOKEN,secret:t,cachedAt:Ue().toString(),expiresOn:s.toString(),extendedExpiresOn:a.toString(),environment:e,clientId:r,realm:o,target:i,tokenType:h||U.BEARER};if(m&&(x.userAssertionHash=m),l&&(x.refreshOn=l.toString()),S&&(x.requestedClaims=S,x.requestedClaimsHash=_),x.tokenType?.toLowerCase()!==U.BEARER.toLowerCase())switch(x.credentialType=D.ACCESS_TOKEN_WITH_AUTH_SCHEME,x.tokenType){case U.POP:let V=Ht(t,c);if(!V?.cnf?.kid)throw C(sn);x.keyId=V.cnf.kid;break;case U.SSH:x.keyId=y}return x}function Il(n,e,t,r,o,i,s){let a={credentialType:D.REFRESH_TOKEN,homeAccountId:n,environment:e,clientId:r,secret:t};return i&&(a.userAssertionHash=i),o&&(a.familyId=o),s&&(a.expiresOn=s.toString()),a}function tc(n){return n.hasOwnProperty("homeAccountId")&&n.hasOwnProperty("environment")&&n.hasOwnProperty("credentialType")&&n.hasOwnProperty("clientId")&&n.hasOwnProperty("secret")}function GC(n){return n?tc(n)&&n.hasOwnProperty("realm")&&n.hasOwnProperty("target")&&(n.credentialType===D.ACCESS_TOKEN||n.credentialType===D.ACCESS_TOKEN_WITH_AUTH_SCHEME):!1}function KC(n){return n?tc(n)&&n.hasOwnProperty("realm")&&n.credentialType===D.ID_TOKEN:!1}function zC(n){return n?tc(n)&&n.credentialType===D.REFRESH_TOKEN:!1}function jC(n){return[n.homeAccountId,n.environment].join(ne.CACHE_KEY_SEPARATOR).toLowerCase()}function qC(n){let e=n.credentialType===D.REFRESH_TOKEN&&n.familyId||n.clientId;return[n.credentialType,e,n.realm||""].join(ne.CACHE_KEY_SEPARATOR).toLowerCase()}function VC(n){return(n.target||"").toLowerCase()}function WC(n){return(n.requestedClaimsHash||"").toLowerCase()}function YC(n){return n.tokenType&&n.tokenType.toLowerCase()!==U.BEARER.toLowerCase()?n.tokenType.toLowerCase():""}function QC(n,e){let t=n.indexOf(le.CACHE_KEY)===0,r=!0;return e&&(r=e.hasOwnProperty("failedRequests")&&e.hasOwnProperty("errors")&&e.hasOwnProperty("cacheHits")),t&&r}function JC(n,e){let t=!1;n&&(t=n.indexOf(Lt.THROTTLING_PREFIX)===0);let r=!0;return e&&(r=e.hasOwnProperty("throttleTime")),t&&r}function XC({environment:n,clientId:e}){return[Hi,n,e].join(ne.CACHE_KEY_SEPARATOR).toLowerCase()}function ZC(n,e){return e?n.indexOf(Hi)===0&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("environment"):!1}function ey(n,e){return e?n.indexOf(io.CACHE_KEY)===0&&e.hasOwnProperty("aliases")&&e.hasOwnProperty("preferred_cache")&&e.hasOwnProperty("preferred_network")&&e.hasOwnProperty("canonical_authority")&&e.hasOwnProperty("authorization_endpoint")&&e.hasOwnProperty("token_endpoint")&&e.hasOwnProperty("issuer")&&e.hasOwnProperty("aliasesFromNetwork")&&e.hasOwnProperty("endpointsFromNetwork")&&e.hasOwnProperty("expiresAt")&&e.hasOwnProperty("jwks_uri"):!1}function rc(){return Ue()+io.REFRESH_TIME_SECONDS}function uo(n,e,t){n.authorization_endpoint=e.authorization_endpoint,n.token_endpoint=e.token_endpoint,n.end_session_endpoint=e.end_session_endpoint,n.issuer=e.issuer,n.endpointsFromNetwork=t,n.jwks_uri=e.jwks_uri}function us(n,e,t){n.aliases=e.aliases,n.preferred_cache=e.preferred_cache,n.preferred_network=e.preferred_network,n.aliasesFromNetwork=t}function nc(n){return n.expiresAt<=Ue()}var xe={};Me(xe,{authorityMismatch:()=>ms,authorityUriInsecure:()=>hn,cannotAllowPlatformBroker:()=>gs,cannotSetOIDCOptions:()=>ps,claimsRequestParsingError:()=>ls,emptyInputScopesError:()=>pn,invalidAuthenticationHeader:()=>fs,invalidAuthorityMetadata:()=>vn,invalidClaims:()=>Ct,invalidCloudDiscoveryMetadata:()=>yr,invalidCodeChallengeMethod:()=>yn,invalidPromptValue:()=>gn,logoutRequestEmpty:()=>Cn,missingNonceAuthenticationHeader:()=>hs,missingSshJwk:()=>Gt,missingSshKid:()=>ds,pkceParamsMissing:()=>$t,redirectUriEmpty:()=>dn,tokenRequestEmpty:()=>mn,untrustedAuthority:()=>En,urlEmptyError:()=>fn,urlParseError:()=>mt});var dn="redirect_uri_empty",ls="claims_request_parsing_error",hn="authority_uri_insecure",mt="url_parse_error",fn="empty_url_error",pn="empty_input_scopes_error",gn="invalid_prompt_value",Ct="invalid_claims",mn="token_request_empty",Cn="logout_request_empty",yn="invalid_code_challenge_method",$t="pkce_params_missing",yr="invalid_cloud_discovery_metadata",vn="invalid_authority_metadata",En="untrusted_authority",Gt="missing_ssh_jwk",ds="missing_ssh_kid",hs="missing_nonce_authentication_header",fs="invalid_authentication_header",ps="cannot_set_OIDCOptions",gs="cannot_allow_platform_broker",ms="authority_mismatch";var J={[dn]:"A redirect URI is required for all calls, and none has been set.",[ls]:"Could not parse the given claims request object.",[hn]:"Authority URIs must use https.  Please see here for valid authority configuration options: https://docs.microsoft.com/en-us/azure/active-directory/develop/msal-js-initializing-client-applications#configuration-options",[mt]:"URL could not be parsed into appropriate segments.",[fn]:"URL was empty or null.",[pn]:"Scopes cannot be passed as null, undefined or empty array because they are required to obtain an access token.",[gn]:"Please see here for valid configuration options: https://azuread.github.io/microsoft-authentication-library-for-js/ref/modules/_azure_msal_common.html#commonauthorizationurlrequest",[Ct]:"Given claims parameter must be a stringified JSON object.",[mn]:"Token request was empty and not found in cache.",[Cn]:"The logout request was null or undefined.",[yn]:'code_challenge_method passed is invalid. Valid values are "plain" and "S256".',[$t]:"Both params: code_challenge and code_challenge_method are to be passed if to be sent in the request",[yr]:"Invalid cloudDiscoveryMetadata provided. Must be a stringified JSON object containing tenant_discovery_endpoint and metadata fields",[vn]:"Invalid authorityMetadata provided. Must by a stringified JSON object containing authorization_endpoint, token_endpoint, issuer fields.",[En]:"The provided authority is not a trusted authority. Please include this authority in the knownAuthorities config parameter.",[Gt]:"Missing sshJwk in SSH certificate request. A stringified JSON Web Key is required when using the SSH authentication scheme.",[ds]:"Missing sshKid in SSH certificate request. A string that uniquely identifies the public SSH key is required when using the SSH authentication scheme.",[hs]:"Unable to find an authentication header containing server nonce. Either the Authentication-Info or WWW-Authenticate headers must be present in order to obtain a server nonce.",[fs]:"Invalid authentication header provided",[ps]:"Cannot set OIDCOptions parameter. Please change the protocol mode to OIDC or use a non-Microsoft authority.",[gs]:"Cannot set allowPlatformBroker parameter to true when not in AAD protocol mode.",[ms]:"Authority mismatch error. Authority provided in login request or PublicClientApplication config does not match the environment of the provided account. Please use a matching account or make an interactive request to login to this authority."},ip={redirectUriNotSet:{code:dn,desc:J[dn]},claimsRequestParsingError:{code:ls,desc:J[ls]},authorityUriInsecure:{code:hn,desc:J[hn]},urlParseError:{code:mt,desc:J[mt]},urlEmptyError:{code:fn,desc:J[fn]},emptyScopesError:{code:pn,desc:J[pn]},invalidPrompt:{code:gn,desc:J[gn]},invalidClaimsRequest:{code:Ct,desc:J[Ct]},tokenRequestEmptyError:{code:mn,desc:J[mn]},logoutRequestEmptyError:{code:Cn,desc:J[Cn]},invalidCodeChallengeMethod:{code:yn,desc:J[yn]},invalidCodeChallengeParams:{code:$t,desc:J[$t]},invalidCloudDiscoveryMetadata:{code:yr,desc:J[yr]},invalidAuthorityMetadata:{code:vn,desc:J[vn]},untrustedAuthority:{code:En,desc:J[En]},missingSshJwk:{code:Gt,desc:J[Gt]},missingSshKid:{code:ds,desc:J[ds]},missingNonceAuthenticationHeader:{code:hs,desc:J[hs]},invalidAuthenticationHeader:{code:fs,desc:J[fs]},cannotSetOIDCOptions:{code:ps,desc:J[ps]},cannotAllowPlatformBroker:{code:gs,desc:J[gs]},authorityMismatch:{code:ms,desc:J[ms]}},Cs=class n extends O{constructor(e){super(e,J[e]),this.name="ClientConfigurationError",Object.setPrototypeOf(this,n.prototype)}};function F(n){return new Cs(n)}var X=class{static isEmptyObj(e){if(e)try{let t=JSON.parse(e);return Object.keys(t).length===0}catch{}return!0}static startsWith(e,t){return e.indexOf(t)===0}static endsWith(e,t){return e.length>=t.length&&e.lastIndexOf(t)===e.length-t.length}static queryStringToObject(e){let t={},r=e.split("&"),o=i=>decodeURIComponent(i.replace(/\+/g," "));return r.forEach(i=>{if(i.trim()){let[s,a]=i.split(/=(.+)/g,2);s&&a&&(t[o(s)]=o(a))}}),t}static trimArrayEntries(e){return e.map(t=>t.trim())}static removeEmptyStringsFromArray(e){return e.filter(t=>!!t)}static jsonParseHelper(e){try{return JSON.parse(e)}catch{return null}}static matchPattern(e,t){return new RegExp(e.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(t)}};var j=class n{constructor(e){let t=e?X.trimArrayEntries([...e]):[],r=t?X.removeEmptyStringsFromArray(t):[];if(!r||!r.length)throw F(pn);this.scopes=new Set,r.forEach(o=>this.scopes.add(o))}static fromString(e){let r=(e||g.EMPTY_STRING).split(" ");return new n(r)}static createSearchScopes(e){let t=new n(e);return t.containsOnlyOIDCScopes()?t.removeScope(g.OFFLINE_ACCESS_SCOPE):t.removeOIDCScopes(),t}containsScope(e){let t=this.printScopesLowerCase().split(" "),r=new n(t);return e?r.scopes.has(e.toLowerCase()):!1}containsScopeSet(e){return!e||e.scopes.size<=0?!1:this.scopes.size>=e.scopes.size&&e.asArray().every(t=>this.containsScope(t))}containsOnlyOIDCScopes(){let e=0;return yl.forEach(t=>{this.containsScope(t)&&(e+=1)}),this.scopes.size===e}appendScope(e){e&&this.scopes.add(e.trim())}appendScopes(e){try{e.forEach(t=>this.appendScope(t))}catch{throw C(nn)}}removeScope(e){if(!e)throw C(rn);this.scopes.delete(e.trim())}removeOIDCScopes(){yl.forEach(e=>{this.scopes.delete(e)})}unionScopeSets(e){if(!e)throw C(pr);let t=new Set;return e.scopes.forEach(r=>t.add(r.toLowerCase())),this.scopes.forEach(r=>t.add(r.toLowerCase())),t}intersectingScopeSets(e){if(!e)throw C(pr);e.containsOnlyOIDCScopes()||e.removeOIDCScopes();let t=this.unionScopeSets(e),r=e.getScopeCount(),o=this.getScopeCount();return t.size<o+r}getScopeCount(){return this.scopes.size}asArray(){let e=[];return this.scopes.forEach(t=>e.push(t)),e}printScopes(){return this.scopes?this.asArray().join(" "):g.EMPTY_STRING}printScopesLowerCase(){return this.printScopes().toLowerCase()}};function lo(n,e){if(!n)throw C(qr);try{let t=e(n);return JSON.parse(t)}catch{throw C(dr)}}function yt(n){if(!n)throw C(dr);let e=n.split(ne.CLIENT_INFO_SEPARATOR,2);return{uid:e[0],utid:e.length<2?g.EMPTY_STRING:e[1]}}function wl(n,e){return!!n&&!!e&&n===e.split(".")[1]}function ho(n,e,t,r){if(r){let{oid:o,sub:i,tid:s,name:a,tfp:c,acr:l}=r,h=s||c||l||"";return{tenantId:h,localAccountId:o||i||"",name:a,isHomeTenant:wl(h,n)}}else return{tenantId:t,localAccountId:e,isHomeTenant:wl(t,n)}}function An(n,e,t,r){let o=n;if(e){let i=e,{isHomeTenant:a}=i,c=nr(i,["isHomeTenant"]);o=f(f({},n),c)}if(t){let s=ho(n.homeAccountId,n.localAccountId,n.tenantId,t),{isHomeTenant:a}=s,c=nr(s,["isHomeTenant"]);return o=T(f(f({},o),c),{idTokenClaims:t,idToken:r}),o}return o}var Te={Default:0,Adfs:1,Dsts:2,Ciam:3};function oc(n){return n&&(n.tid||n.tfp||n.acr)||null}var Z={AAD:"AAD",OIDC:"OIDC",EAR:"EAR"};var oe=class n{generateAccountId(){return[this.homeAccountId,this.environment].join(ne.CACHE_KEY_SEPARATOR).toLowerCase()}generateAccountKey(){return n.generateAccountCacheKey({homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId})}getAccountInfo(){return{homeAccountId:this.homeAccountId,environment:this.environment,tenantId:this.realm,username:this.username,localAccountId:this.localAccountId,name:this.name,nativeAccountId:this.nativeAccountId,authorityType:this.authorityType,tenantProfiles:new Map((this.tenantProfiles||[]).map(e=>[e.tenantId,e]))}}isSingleTenant(){return!this.tenantProfiles}static generateAccountCacheKey(e){let t=e.homeAccountId.split(".")[1];return[e.homeAccountId,e.environment||"",t||e.tenantId||""].join(ne.CACHE_KEY_SEPARATOR).toLowerCase()}static createAccount(e,t,r){let o=new n;t.authorityType===Te.Adfs?o.authorityType=oo.ADFS_ACCOUNT_TYPE:t.protocolMode===Z.OIDC?o.authorityType=oo.GENERIC_ACCOUNT_TYPE:o.authorityType=oo.MSSTS_ACCOUNT_TYPE;let i;e.clientInfo&&r&&(i=lo(e.clientInfo,r)),o.clientInfo=e.clientInfo,o.homeAccountId=e.homeAccountId,o.nativeAccountId=e.nativeAccountId;let s=e.environment||t&&t.getPreferredCache();if(!s)throw C(xt);o.environment=s,o.realm=i?.utid||oc(e.idTokenClaims)||"",o.localAccountId=i?.uid||e.idTokenClaims?.oid||e.idTokenClaims?.sub||"";let a=e.idTokenClaims?.preferred_username||e.idTokenClaims?.upn,c=e.idTokenClaims?.emails?e.idTokenClaims.emails[0]:null;if(o.username=a||c||"",o.name=e.idTokenClaims?.name||"",o.cloudGraphHostName=e.cloudGraphHostName,o.msGraphHost=e.msGraphHost,e.tenantProfiles)o.tenantProfiles=e.tenantProfiles;else{let l=ho(e.homeAccountId,o.localAccountId,o.realm,e.idTokenClaims);o.tenantProfiles=[l]}return o}static createFromAccountInfo(e,t,r){let o=new n;return o.authorityType=e.authorityType||oo.GENERIC_ACCOUNT_TYPE,o.homeAccountId=e.homeAccountId,o.localAccountId=e.localAccountId,o.nativeAccountId=e.nativeAccountId,o.realm=e.tenantId,o.environment=e.environment,o.username=e.username,o.name=e.name,o.cloudGraphHostName=t,o.msGraphHost=r,o.tenantProfiles=Array.from(e.tenantProfiles?.values()||[]),o}static generateHomeAccountId(e,t,r,o,i){if(!(t===Te.Adfs||t===Te.Dsts)){if(e)try{let s=lo(e,o.base64Decode);if(s.uid&&s.utid)return`${s.uid}.${s.utid}`}catch{}r.warning("No client info in response")}return i?.sub||""}static isAccountEntity(e){return e?e.hasOwnProperty("homeAccountId")&&e.hasOwnProperty("environment")&&e.hasOwnProperty("realm")&&e.hasOwnProperty("localAccountId")&&e.hasOwnProperty("username")&&e.hasOwnProperty("authorityType"):!1}static accountInfoIsEqual(e,t,r){if(!e||!t)return!1;let o=!0;if(r){let i=e.idTokenClaims||{},s=t.idTokenClaims||{};o=i.iat===s.iat&&i.nonce===s.nonce}return e.homeAccountId===t.homeAccountId&&e.localAccountId===t.localAccountId&&e.username===t.username&&e.tenantId===t.tenantId&&e.environment===t.environment&&e.nativeAccountId===t.nativeAccountId&&o}};var vr={};Me(vr,{getDeserializedResponse:()=>Rl,mapToQueryString:()=>vt,stripLeadingHashOrQuery:()=>sp});function sp(n){return n.startsWith("#/")?n.substring(2):n.startsWith("#")||n.startsWith("?")?n.substring(1):n}function Rl(n){if(!n||n.indexOf("=")<0)return null;try{let e=sp(n),t=Object.fromEntries(new URLSearchParams(e));if(t.code||t.ear_jwe||t.error||t.error_description||t.state)return t}catch{throw C(Qr)}return null}function vt(n,e=!0,t){let r=new Array;return n.forEach((o,i)=>{!e&&t&&i in t?r.push(`${i}=${o}`):r.push(`${i}=${encodeURIComponent(o)}`)}),r.join("&")}var b=class n{get urlString(){return this._urlString}constructor(e){if(this._urlString=e,!this._urlString)throw F(fn);e.includes("#")||(this._urlString=n.canonicalizeUri(e))}static canonicalizeUri(e){if(e){let t=e.toLowerCase();return X.endsWith(t,"?")?t=t.slice(0,-1):X.endsWith(t,"?/")&&(t=t.slice(0,-2)),X.endsWith(t,"/")||(t+="/"),t}return e}validateAsUri(){let e;try{e=this.getUrlComponents()}catch{throw F(mt)}if(!e.HostNameAndPort||!e.PathSegments)throw F(mt);if(!e.Protocol||e.Protocol.toLowerCase()!=="https:")throw F(hn)}static appendQueryString(e,t){return t?e.indexOf("?")<0?`${e}?${t}`:`${e}&${t}`:e}static removeHashFromUrl(e){return n.canonicalizeUri(e.split("#")[0])}replaceTenantPath(e){let t=this.getUrlComponents(),r=t.PathSegments;return e&&r.length!==0&&(r[0]===Je.COMMON||r[0]===Je.ORGANIZATIONS)&&(r[0]=e),n.constructAuthorityUriFromObject(t)}getUrlComponents(){let e=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=this.urlString.match(e);if(!t)throw F(mt);let r={Protocol:t[1],HostNameAndPort:t[4],AbsolutePath:t[5],QueryString:t[7]},o=r.AbsolutePath.split("/");return o=o.filter(i=>i&&i.length>0),r.PathSegments=o,r.QueryString&&r.QueryString.endsWith("/")&&(r.QueryString=r.QueryString.substring(0,r.QueryString.length-1)),r}static getDomainFromUrl(e){let t=RegExp("^([^:/?#]+://)?([^/?#]*)"),r=e.match(t);if(!r)throw F(mt);return r[2]}static getAbsoluteUrl(e,t){if(e[0]===g.FORWARD_SLASH){let o=new n(t).getUrlComponents();return o.Protocol+"//"+o.HostNameAndPort+e}return e}static constructAuthorityUriFromObject(e){return new n(e.Protocol+"//"+e.HostNameAndPort+"/"+e.PathSegments.join("/"))}static hashContainsKnownProperties(e){return!!Rl(e)}};var cp={endpointMetadata:{"login.microsoftonline.com":{token_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.com/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.com/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.com/{tenantid}/oauth2/v2.0/logout"},"login.chinacloudapi.cn":{token_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.chinacloudapi.cn/{tenantid}/discovery/v2.0/keys",issuer:"https://login.partner.microsoftonline.cn/{tenantid}/v2.0",authorization_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.chinacloudapi.cn/{tenantid}/oauth2/v2.0/logout"},"login.microsoftonline.us":{token_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/token",jwks_uri:"https://login.microsoftonline.us/{tenantid}/discovery/v2.0/keys",issuer:"https://login.microsoftonline.us/{tenantid}/v2.0",authorization_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/authorize",end_session_endpoint:"https://login.microsoftonline.us/{tenantid}/oauth2/v2.0/logout"}},instanceDiscoveryMetadata:{tenant_discovery_endpoint:"https://{canonicalAuthority}/v2.0/.well-known/openid-configuration",metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]}},_l=cp.endpointMetadata,Dl=cp.instanceDiscoveryMetadata,bl=new Set;Dl.metadata.forEach(n=>{n.aliases.forEach(e=>{bl.add(e)})});function up(n,e){let t,r=n.canonicalAuthority;if(r){let o=new b(r).getUrlComponents().HostNameAndPort;t=ap(o,n.cloudDiscoveryMetadata?.metadata,Ee.CONFIG,e)||ap(o,Dl.metadata,Ee.HARDCODED_VALUES,e)||n.knownAuthorities}return t||[]}function ap(n,e,t,r){if(r?.trace(`getAliasesFromMetadata called with source: ${t}`),n&&e){let o=ys(e,n);if(o)return r?.trace(`getAliasesFromMetadata: found cloud discovery metadata in ${t}, returning aliases`),o.aliases;r?.trace(`getAliasesFromMetadata: did not find cloud discovery metadata in ${t}`)}return null}function lp(n){return ys(Dl.metadata,n)}function ys(n,e){for(let t=0;t<n.length;t++){let r=n[t];if(r.aliases.includes(e))return r}return null}var ic="cache_quota_exceeded",vs="cache_error_unknown";var kl={[ic]:"Exceeded cache storage capacity.",[vs]:"Unexpected error occurred when using cache storage."},Kt=class n extends Error{constructor(e,t){let r=t||(kl[e]?kl[e]:kl[vs]);super(`${e}: ${r}`),Object.setPrototypeOf(this,n.prototype),this.name="CacheError",this.errorCode=e,this.errorMessage=r}};var Tn=class{constructor(e,t,r,o){this.clientId=e,this.cryptoImpl=t,this.commonLogger=r.clone(ec,so),this.staticAuthorityOptions=o}getAllAccounts(e){return this.buildTenantProfiles(this.getAccountsFilteredBy(e||{}),e)}getAccountInfoFilteredBy(e){let t=this.getAllAccounts(e);return t.length>1?t.sort(o=>o.idTokenClaims?-1:1)[0]:t.length===1?t[0]:null}getBaseAccountInfo(e){let t=this.getAccountsFilteredBy(e);return t.length>0?t[0].getAccountInfo():null}buildTenantProfiles(e,t){return e.flatMap(r=>this.getTenantProfilesFromAccountEntity(r,t?.tenantId,t))}getTenantedAccountInfoByFilter(e,t,r,o){let i=null,s;if(o&&!this.tenantProfileMatchesFilter(r,o))return null;let a=this.getIdToken(e,t,r.tenantId);return a&&(s=Ht(a.secret,this.cryptoImpl.base64Decode),!this.idTokenClaimsMatchTenantProfileFilter(s,o))?null:(i=An(e,r,s,a?.secret),i)}getTenantProfilesFromAccountEntity(e,t,r){let o=e.getAccountInfo(),i=o.tenantProfiles||new Map,s=this.getTokenKeys();if(t){let c=i.get(t);if(c)i=new Map([[t,c]]);else return[]}let a=[];return i.forEach(c=>{let l=this.getTenantedAccountInfoByFilter(o,s,c,r);l&&a.push(l)}),a}tenantProfileMatchesFilter(e,t){return!(t.localAccountId&&!this.matchLocalAccountIdFromTenantProfile(e,t.localAccountId)||t.name&&e.name!==t.name||t.isHomeTenant!==void 0&&e.isHomeTenant!==t.isHomeTenant)}idTokenClaimsMatchTenantProfileFilter(e,t){return!(t&&(t.localAccountId&&!this.matchLocalAccountIdFromTokenClaims(e,t.localAccountId)||t.loginHint&&!this.matchLoginHintFromTokenClaims(e,t.loginHint)||t.username&&!this.matchUsername(e.preferred_username,t.username)||t.name&&!this.matchName(e,t.name)||t.sid&&!this.matchSid(e,t.sid)))}saveCacheRecord(e,t,r){return d(this,null,function*(){if(!e)throw C(on);try{e.account&&(yield this.setAccount(e.account,t)),e.idToken&&r?.idToken!==!1&&(yield this.setIdTokenCredential(e.idToken,t)),e.accessToken&&r?.accessToken!==!1&&(yield this.saveAccessToken(e.accessToken,t)),e.refreshToken&&r?.refreshToken!==!1&&(yield this.setRefreshTokenCredential(e.refreshToken,t)),e.appMetadata&&this.setAppMetadata(e.appMetadata)}catch(o){throw this.commonLogger?.error("CacheManager.saveCacheRecord: failed"),o instanceof Error?(this.commonLogger?.errorPii(`CacheManager.saveCacheRecord: ${o.message}`,t),o.name==="QuotaExceededError"||o.name==="NS_ERROR_DOM_QUOTA_REACHED"||o.message.includes("exceeded the quota")?(this.commonLogger?.error("CacheManager.saveCacheRecord: exceeded storage quota",t),new Kt(ic)):new Kt(o.name,o.message)):(this.commonLogger?.errorPii(`CacheManager.saveCacheRecord: ${o}`,t),new Kt(vs))}})}saveAccessToken(e,t){return d(this,null,function*(){let r={clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType,requestedClaimsHash:e.requestedClaimsHash},o=this.getTokenKeys(),i=j.fromString(e.target),s=[];o.accessToken.forEach(a=>{if(!this.accessTokenKeyMatchesFilter(a,r,!1))return;let c=this.getAccessTokenCredential(a);c&&this.credentialMatchesFilter(c,r)&&j.fromString(c.target).intersectingScopeSets(i)&&s.push(this.removeAccessToken(a))}),yield Promise.all(s),yield this.setAccessTokenCredential(e,t)})}getAccountsFilteredBy(e){let t=this.getAccountKeys(),r=[];return t.forEach(o=>{if(!this.isAccountKey(o,e.homeAccountId))return;let i=this.getAccount(o,this.commonLogger);if(!i||e.homeAccountId&&!this.matchHomeAccountId(i,e.homeAccountId)||e.username&&!this.matchUsername(i.username,e.username)||e.environment&&!this.matchEnvironment(i,e.environment)||e.realm&&!this.matchRealm(i,e.realm)||e.nativeAccountId&&!this.matchNativeAccountId(i,e.nativeAccountId)||e.authorityType&&!this.matchAuthorityType(i,e.authorityType))return;let s={localAccountId:e?.localAccountId,name:e?.name},a=i.tenantProfiles?.filter(c=>this.tenantProfileMatchesFilter(c,s));a&&a.length===0||r.push(i)}),r}isAccountKey(e,t,r){return!(e.split(ne.CACHE_KEY_SEPARATOR).length<3||t&&!e.toLowerCase().includes(t.toLowerCase())||r&&!e.toLowerCase().includes(r.toLowerCase()))}isCredentialKey(e){if(e.split(ne.CACHE_KEY_SEPARATOR).length<6)return!1;let t=e.toLowerCase();if(t.indexOf(D.ID_TOKEN.toLowerCase())===-1&&t.indexOf(D.ACCESS_TOKEN.toLowerCase())===-1&&t.indexOf(D.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase())===-1&&t.indexOf(D.REFRESH_TOKEN.toLowerCase())===-1)return!1;if(t.indexOf(D.REFRESH_TOKEN.toLowerCase())>-1){let r=`${D.REFRESH_TOKEN}${ne.CACHE_KEY_SEPARATOR}${this.clientId}${ne.CACHE_KEY_SEPARATOR}`,o=`${D.REFRESH_TOKEN}${ne.CACHE_KEY_SEPARATOR}${lr}${ne.CACHE_KEY_SEPARATOR}`;if(t.indexOf(r.toLowerCase())===-1&&t.indexOf(o.toLowerCase())===-1)return!1}else if(t.indexOf(this.clientId.toLowerCase())===-1)return!1;return!0}credentialMatchesFilter(e,t){return!(t.clientId&&!this.matchClientId(e,t.clientId)||t.userAssertionHash&&!this.matchUserAssertionHash(e,t.userAssertionHash)||typeof t.homeAccountId=="string"&&!this.matchHomeAccountId(e,t.homeAccountId)||t.environment&&!this.matchEnvironment(e,t.environment)||t.realm&&!this.matchRealm(e,t.realm)||t.credentialType&&!this.matchCredentialType(e,t.credentialType)||t.familyId&&!this.matchFamilyId(e,t.familyId)||t.target&&!this.matchTarget(e,t.target)||(t.requestedClaimsHash||e.requestedClaimsHash)&&e.requestedClaimsHash!==t.requestedClaimsHash||e.credentialType===D.ACCESS_TOKEN_WITH_AUTH_SCHEME&&(t.tokenType&&!this.matchTokenType(e,t.tokenType)||t.tokenType===U.SSH&&t.keyId&&!this.matchKeyId(e,t.keyId)))}getAppMetadataFilteredBy(e){let t=this.getKeys(),r={};return t.forEach(o=>{if(!this.isAppMetadata(o))return;let i=this.getAppMetadata(o);i&&(e.environment&&!this.matchEnvironment(i,e.environment)||e.clientId&&!this.matchClientId(i,e.clientId)||(r[o]=i))}),r}getAuthorityMetadataByAlias(e){let t=this.getAuthorityMetadataKeys(),r=null;return t.forEach(o=>{if(!this.isAuthorityMetadata(o)||o.indexOf(this.clientId)===-1)return;let i=this.getAuthorityMetadata(o);i&&i.aliases.indexOf(e)!==-1&&(r=i)}),r}removeAllAccounts(){return d(this,null,function*(){let e=this.getAccountKeys(),t=[];e.forEach(r=>{t.push(this.removeAccount(r))}),yield Promise.all(t)})}removeAccount(e){return d(this,null,function*(){let t=this.getAccount(e,this.commonLogger);t&&(yield this.removeAccountContext(t),this.removeItem(e))})}removeAccountContext(e){return d(this,null,function*(){let t=this.getTokenKeys(),r=e.generateAccountId(),o=[];t.idToken.forEach(i=>{i.indexOf(r)===0&&this.removeIdToken(i)}),t.accessToken.forEach(i=>{i.indexOf(r)===0&&o.push(this.removeAccessToken(i))}),t.refreshToken.forEach(i=>{i.indexOf(r)===0&&this.removeRefreshToken(i)}),yield Promise.all(o)})}removeAccessToken(e){return d(this,null,function*(){let t=this.getAccessTokenCredential(e);if(t){if(t.credentialType.toLowerCase()===D.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase()&&t.tokenType===U.POP){let o=t.keyId;if(o)try{yield this.cryptoImpl.removeTokenBindingKey(o)}catch{throw C(cn)}}return this.removeItem(e)}})}removeAppMetadata(){return this.getKeys().forEach(t=>{this.isAppMetadata(t)&&this.removeItem(t)}),!0}readAccountFromCache(e){let t=oe.generateAccountCacheKey(e);return this.getAccount(t,this.commonLogger)}getIdToken(e,t,r,o,i){this.commonLogger.trace("CacheManager - getIdToken called");let s={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:D.ID_TOKEN,clientId:this.clientId,realm:r},a=this.getIdTokensByFilter(s,t),c=a.size;if(c<1)return this.commonLogger.info("CacheManager:getIdToken - No token found"),null;if(c>1){let l=a;if(!r){let h=new Map;a.forEach((y,S)=>{y.realm===e.tenantId&&h.set(S,y)});let m=h.size;if(m<1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account but none match account entity tenant id, returning first result"),a.values().next().value;if(m===1)return this.commonLogger.info("CacheManager:getIdToken - Multiple ID tokens found for account, defaulting to home tenant profile"),h.values().next().value;l=h}return this.commonLogger.info("CacheManager:getIdToken - Multiple matching ID tokens found, clearing them"),l.forEach((h,m)=>{this.removeIdToken(m)}),o&&i&&o.addFields({multiMatchedID:a.size},i),null}return this.commonLogger.info("CacheManager:getIdToken - Returning ID token"),a.values().next().value}getIdTokensByFilter(e,t){let r=t&&t.idToken||this.getTokenKeys().idToken,o=new Map;return r.forEach(i=>{if(!this.idTokenKeyMatchesFilter(i,f({clientId:this.clientId},e)))return;let s=this.getIdTokenCredential(i);s&&this.credentialMatchesFilter(s,e)&&o.set(i,s)}),o}idTokenKeyMatchesFilter(e,t){let r=e.toLowerCase();return!(t.clientId&&r.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&r.indexOf(t.homeAccountId.toLowerCase())===-1)}removeIdToken(e){this.removeItem(e)}removeRefreshToken(e){this.removeItem(e)}getAccessToken(e,t,r,o,i,s){this.commonLogger.trace("CacheManager - getAccessToken called");let a=j.createSearchScopes(t.scopes),c=t.authenticationScheme||U.BEARER,l=c&&c.toLowerCase()!==U.BEARER.toLowerCase()?D.ACCESS_TOKEN_WITH_AUTH_SCHEME:D.ACCESS_TOKEN,h={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:l,clientId:this.clientId,realm:o||e.tenantId,target:a,tokenType:c,keyId:t.sshKid,requestedClaimsHash:t.requestedClaimsHash},m=r&&r.accessToken||this.getTokenKeys().accessToken,y=[];m.forEach(_=>{if(this.accessTokenKeyMatchesFilter(_,h,!0)){let x=this.getAccessTokenCredential(_);x&&this.credentialMatchesFilter(x,h)&&y.push(x)}});let S=y.length;return S<1?(this.commonLogger.info("CacheManager:getAccessToken - No token found"),null):S>1?(this.commonLogger.info("CacheManager:getAccessToken - Multiple access tokens found, clearing them"),y.forEach(_=>{this.removeAccessToken(cs(_))}),i&&s&&i.addFields({multiMatchedAT:y.length},s),null):(this.commonLogger.info("CacheManager:getAccessToken - Returning access token"),y[0])}accessTokenKeyMatchesFilter(e,t,r){let o=e.toLowerCase();if(t.clientId&&o.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&o.indexOf(t.homeAccountId.toLowerCase())===-1||t.realm&&o.indexOf(t.realm.toLowerCase())===-1||t.requestedClaimsHash&&o.indexOf(t.requestedClaimsHash.toLowerCase())===-1)return!1;if(t.target){let i=t.target.asArray();for(let s=0;s<i.length;s++){if(r&&!o.includes(i[s].toLowerCase()))return!1;if(!r&&o.includes(i[s].toLowerCase()))return!0}}return!0}getAccessTokensByFilter(e){let t=this.getTokenKeys(),r=[];return t.accessToken.forEach(o=>{if(!this.accessTokenKeyMatchesFilter(o,e,!0))return;let i=this.getAccessTokenCredential(o);i&&this.credentialMatchesFilter(i,e)&&r.push(i)}),r}getRefreshToken(e,t,r,o,i){this.commonLogger.trace("CacheManager - getRefreshToken called");let s=t?lr:void 0,a={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:D.REFRESH_TOKEN,clientId:this.clientId,familyId:s},c=r&&r.refreshToken||this.getTokenKeys().refreshToken,l=[];c.forEach(m=>{if(this.refreshTokenKeyMatchesFilter(m,a)){let y=this.getRefreshTokenCredential(m);y&&this.credentialMatchesFilter(y,a)&&l.push(y)}});let h=l.length;return h<1?(this.commonLogger.info("CacheManager:getRefreshToken - No refresh token found."),null):(h>1&&o&&i&&o.addFields({multiMatchedRT:h},i),this.commonLogger.info("CacheManager:getRefreshToken - returning refresh token"),l[0])}refreshTokenKeyMatchesFilter(e,t){let r=e.toLowerCase();return!(t.familyId&&r.indexOf(t.familyId.toLowerCase())===-1||!t.familyId&&t.clientId&&r.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&r.indexOf(t.homeAccountId.toLowerCase())===-1)}readAppMetadataFromCache(e){let t={environment:e,clientId:this.clientId},r=this.getAppMetadataFilteredBy(t),o=Object.keys(r).map(s=>r[s]),i=o.length;if(i<1)return null;if(i>1)throw C(en);return o[0]}isAppMetadataFOCI(e){let t=this.readAppMetadataFromCache(e);return!!(t&&t.familyId===lr)}matchHomeAccountId(e,t){return typeof e.homeAccountId=="string"&&t===e.homeAccountId}matchLocalAccountIdFromTokenClaims(e,t){let r=e.oid||e.sub;return t===r}matchLocalAccountIdFromTenantProfile(e,t){return e.localAccountId===t}matchName(e,t){return t.toLowerCase()===e.name?.toLowerCase()}matchUsername(e,t){return!!(e&&typeof e=="string"&&t?.toLowerCase()===e.toLowerCase())}matchUserAssertionHash(e,t){return!!(e.userAssertionHash&&t===e.userAssertionHash)}matchEnvironment(e,t){if(this.staticAuthorityOptions){let o=up(this.staticAuthorityOptions,this.commonLogger);if(o.includes(t)&&o.includes(e.environment))return!0}let r=this.getAuthorityMetadataByAlias(t);return!!(r&&r.aliases.indexOf(e.environment)>-1)}matchCredentialType(e,t){return e.credentialType&&t.toLowerCase()===e.credentialType.toLowerCase()}matchClientId(e,t){return!!(e.clientId&&t===e.clientId)}matchFamilyId(e,t){return!!(e.familyId&&t===e.familyId)}matchRealm(e,t){return e.realm?.toLowerCase()===t.toLowerCase()}matchNativeAccountId(e,t){return!!(e.nativeAccountId&&t===e.nativeAccountId)}matchLoginHintFromTokenClaims(e,t){return e.login_hint===t||e.preferred_username===t||e.upn===t}matchSid(e,t){return e.sid===t}matchAuthorityType(e,t){return!!(e.authorityType&&t.toLowerCase()===e.authorityType.toLowerCase())}matchTarget(e,t){return e.credentialType!==D.ACCESS_TOKEN&&e.credentialType!==D.ACCESS_TOKEN_WITH_AUTH_SCHEME||!e.target?!1:j.fromString(e.target).containsScopeSet(t)}matchTokenType(e,t){return!!(e.tokenType&&e.tokenType===t)}matchKeyId(e,t){return!!(e.keyId&&e.keyId===t)}isAppMetadata(e){return e.indexOf(Hi)!==-1}isAuthorityMetadata(e){return e.indexOf(io.CACHE_KEY)!==-1}generateAuthorityMetadataCacheKey(e){return`${io.CACHE_KEY}-${this.clientId}-${e}`}static toObject(e,t){for(let r in t)e[r]=t[r];return e}},Es=class extends Tn{setAccount(){return d(this,null,function*(){throw C(L)})}getAccount(){throw C(L)}setIdTokenCredential(){return d(this,null,function*(){throw C(L)})}getIdTokenCredential(){throw C(L)}setAccessTokenCredential(){return d(this,null,function*(){throw C(L)})}getAccessTokenCredential(){throw C(L)}setRefreshTokenCredential(){return d(this,null,function*(){throw C(L)})}getRefreshTokenCredential(){throw C(L)}setAppMetadata(){throw C(L)}getAppMetadata(){throw C(L)}setServerTelemetry(){throw C(L)}getServerTelemetry(){throw C(L)}setAuthorityMetadata(){throw C(L)}getAuthorityMetadata(){throw C(L)}getAuthorityMetadataKeys(){throw C(L)}setThrottlingCache(){throw C(L)}getThrottlingCache(){throw C(L)}removeItem(){throw C(L)}getKeys(){throw C(L)}getAccountKeys(){throw C(L)}getTokenKeys(){throw C(L)}};var sc={tokenRenewalOffsetSeconds:El,preventCorsPreflight:!1},ty={loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:G.Info,correlationId:g.EMPTY_STRING},ry={claimsBasedCachingEnabled:!1},ny={sendGetRequestAsync(){return d(this,null,function*(){throw C(L)})},sendPostRequestAsync(){return d(this,null,function*(){throw C(L)})}},oy={sku:g.SKU,version:so,cpu:g.EMPTY_STRING,os:g.EMPTY_STRING},iy={clientSecret:g.EMPTY_STRING,clientAssertion:void 0},sy={azureCloudInstance:Cr.None,tenant:`${g.DEFAULT_COMMON_TENANT}`},ay={application:{appName:"",appVersion:""}};function dp({authOptions:n,systemOptions:e,loggerOptions:t,cacheOptions:r,storageInterface:o,networkInterface:i,cryptoInterface:s,clientCredentials:a,libraryInfo:c,telemetry:l,serverTelemetryManager:h,persistencePlugin:m,serializableCache:y}){let S=f(f({},ty),t);return{authOptions:cy(n),systemOptions:f(f({},sc),e),loggerOptions:S,cacheOptions:f(f({},ry),r),storageInterface:o||new Es(n.clientId,mr,new _e(S)),networkInterface:i||ny,cryptoInterface:s||mr,clientCredentials:a||iy,libraryInfo:f(f({},oy),c),telemetry:f(f({},ay),l),serverTelemetryManager:h||null,persistencePlugin:m||null,serializableCache:y||null}}function cy(n){return f({clientCapabilities:[],azureCloudOptions:sy,skipAuthorityMetadataCache:!1,instanceAware:!1,encodeExtraQueryParams:!1},n)}function ac(n){return n.authOptions.authority.options.protocolMode===Z.OIDC}var Ce={HOME_ACCOUNT_ID:"home_account_id",UPN:"UPN"};var De={};Me(De,{addApplicationTelemetry:()=>Ss,addAuthorizationCode:()=>Ad,addBrokerParameters:()=>Vt,addCcsOid:()=>jt,addCcsUpn:()=>Er,addClaims:()=>_n,addClientAssertion:()=>Rs,addClientAssertionType:()=>_s,addClientCapabilitiesToClaims:()=>hp,addClientId:()=>wn,addClientInfo:()=>bn,addClientSecret:()=>ws,addCodeChallengeParams:()=>Sy,addCodeVerifier:()=>Sd,addCorrelationId:()=>Dn,addDeviceCode:()=>Iy,addDomainHint:()=>yd,addEARParameters:()=>by,addExtraQueryParameters:()=>qt,addGrantType:()=>Ds,addIdTokenHint:()=>Cd,addInstanceAware:()=>bs,addLibraryInfo:()=>Ts,addLoginHint:()=>po,addLogoutHint:()=>Id,addNativeBroker:()=>Ty,addNonce:()=>Ed,addOboAssertion:()=>wy,addPassword:()=>Dy,addPopToken:()=>ks,addPostLogoutRedirectUri:()=>md,addPrompt:()=>vd,addRedirectUri:()=>Rn,addRefreshToken:()=>Td,addRequestTokenUse:()=>Ry,addResponseMode:()=>gd,addResponseType:()=>Ay,addScopes:()=>In,addServerTelemetry:()=>Ms,addSid:()=>fc,addSshJwk:()=>Os,addState:()=>Is,addThrottling:()=>Ps,addUsername:()=>_y,instrumentBrokerParams:()=>Sn});var zt={};Me(zt,{ACCESS_TOKEN:()=>dy,BROKER_CLIENT_ID:()=>As,BROKER_REDIRECT_URI:()=>hc,CCS_HEADER:()=>vy,CLAIMS:()=>Nl,CLIENT_ASSERTION:()=>od,CLIENT_ASSERTION_TYPE:()=>id,CLIENT_ID:()=>Et,CLIENT_INFO:()=>my,CLIENT_REQUEST_ID:()=>zl,CLIENT_SECRET:()=>nd,CODE:()=>Hl,CODE_CHALLENGE:()=>$l,CODE_CHALLENGE_METHOD:()=>Gl,CODE_VERIFIER:()=>Kl,DEVICE_CODE:()=>rd,DOMAIN_HINT:()=>hd,EAR_JWE_CRYPTO:()=>pd,EAR_JWK:()=>fd,ERROR:()=>uy,ERROR_DESCRIPTION:()=>ly,EXPIRES_IN:()=>fy,FOCI:()=>yy,GRANT_TYPE:()=>Pl,ID_TOKEN:()=>hy,ID_TOKEN_HINT:()=>td,INSTANCE_AWARE:()=>fo,LOGIN_HINT:()=>dd,LOGOUT_HINT:()=>ud,NATIVE_BROKER:()=>cd,NONCE:()=>xl,OBO_ASSERTION:()=>sd,ON_BEHALF_OF:()=>Cy,POST_LOGOUT_URI:()=>ed,PROMPT:()=>Bl,REDIRECT_URI:()=>cc,REFRESH_TOKEN:()=>Fl,REFRESH_TOKEN_EXPIRES_IN:()=>py,REQUESTED_TOKEN_USE:()=>ad,REQ_CNF:()=>lc,RESPONSE_MODE:()=>Ml,RESPONSE_TYPE:()=>Ol,RETURN_SPA_CODE:()=>dc,SCOPE:()=>Ll,SESSION_STATE:()=>gy,SID:()=>ld,STATE:()=>Ul,TOKEN_TYPE:()=>uc,X_APP_NAME:()=>Xl,X_APP_VER:()=>Zl,X_CLIENT_CPU:()=>Wl,X_CLIENT_CURR_TELEM:()=>Yl,X_CLIENT_EXTRA_SKU:()=>Ey,X_CLIENT_LAST_TELEM:()=>Ql,X_CLIENT_OS:()=>Vl,X_CLIENT_SKU:()=>jl,X_CLIENT_VER:()=>ql,X_MS_LIB_CAPABILITY:()=>Jl});var Et="client_id",cc="redirect_uri",Ol="response_type",Ml="response_mode",Pl="grant_type",Nl="claims",Ll="scope",uy="error",ly="error_description",dy="access_token",hy="id_token",Fl="refresh_token",fy="expires_in",py="refresh_token_expires_in",Ul="state",xl="nonce",Bl="prompt",gy="session_state",my="client_info",Hl="code",$l="code_challenge",Gl="code_challenge_method",Kl="code_verifier",zl="client-request-id",jl="x-client-SKU",ql="x-client-VER",Vl="x-client-OS",Wl="x-client-CPU",Yl="x-client-current-telemetry",Ql="x-client-last-telemetry",Jl="x-ms-lib-capability",Xl="x-app-name",Zl="x-app-ver",ed="post_logout_redirect_uri",td="id_token_hint",rd="device_code",nd="client_secret",od="client_assertion",id="client_assertion_type",uc="token_type",lc="req_cnf",sd="assertion",ad="requested_token_use",Cy="on_behalf_of",yy="foci",vy="X-AnchorMailbox",dc="return_spa_code",cd="nativebroker",ud="logout_hint",ld="sid",dd="login_hint",hd="domain_hint",Ey="x-client-xtra-sku",As="brk_client_id",hc="brk_redirect_uri",fo="instance_aware",fd="ear_jwk",pd="ear_jwe_crypto";function Sn(n,e,t){if(!e)return;let r=n.get(Et);r&&n.has(As)&&t?.addFields({embeddedClientId:r,embeddedRedirectUri:n.get(cc)},e)}function Ay(n,e){n.set(Ol,e)}function gd(n,e){n.set(Ml,e||vl.QUERY)}function Ty(n){n.set(cd,"1")}function In(n,e,t=!0,r=Qe){t&&!r.includes("openid")&&!e.includes("openid")&&r.push("openid");let o=t?[...e||[],...r]:e||[],i=new j(o);n.set(Ll,i.printScopes())}function wn(n,e){n.set(Et,e)}function Rn(n,e){n.set(cc,e)}function md(n,e){n.set(ed,e)}function Cd(n,e){n.set(td,e)}function yd(n,e){n.set(hd,e)}function po(n,e){n.set(dd,e)}function Er(n,e){n.set(ie.CCS_HEADER,`UPN:${e}`)}function jt(n,e){n.set(ie.CCS_HEADER,`Oid:${e.uid}@${e.utid}`)}function fc(n,e){n.set(ld,e)}function _n(n,e,t){let r=hp(e,t);try{JSON.parse(r)}catch{throw F(Ct)}n.set(Nl,r)}function Dn(n,e){n.set(zl,e)}function Ts(n,e){n.set(jl,e.sku),n.set(ql,e.version),e.os&&n.set(Vl,e.os),e.cpu&&n.set(Wl,e.cpu)}function Ss(n,e){e?.appName&&n.set(Xl,e.appName),e?.appVersion&&n.set(Zl,e.appVersion)}function vd(n,e){n.set(Bl,e)}function Is(n,e){e&&n.set(Ul,e)}function Ed(n,e){n.set(xl,e)}function Sy(n,e,t){if(e&&t)n.set($l,e),n.set(Gl,t);else throw F($t)}function Ad(n,e){n.set(Hl,e)}function Iy(n,e){n.set(rd,e)}function Td(n,e){n.set(Fl,e)}function Sd(n,e){n.set(Kl,e)}function ws(n,e){n.set(nd,e)}function Rs(n,e){e&&n.set(od,e)}function _s(n,e){e&&n.set(id,e)}function wy(n,e){n.set(sd,e)}function Ry(n,e){n.set(ad,e)}function Ds(n,e){n.set(Pl,e)}function bn(n){n.set(tp,"1")}function bs(n){n.has(fo)||n.set(fo,"true")}function qt(n,e){Object.entries(e).forEach(([t,r])=>{!n.has(t)&&r&&n.set(t,r)})}function hp(n,e){let t;if(!n)t={};else try{t=JSON.parse(n)}catch{throw F(Ct)}return e&&e.length>0&&(t.hasOwnProperty(no.ACCESS_TOKEN)||(t[no.ACCESS_TOKEN]={}),t[no.ACCESS_TOKEN][no.XMS_CC]={values:e}),JSON.stringify(t)}function _y(n,e){n.set(Qa.username,e)}function Dy(n,e){n.set(Qa.password,e)}function ks(n,e){e&&(n.set(uc,U.POP),n.set(lc,e))}function Os(n,e){e&&(n.set(uc,U.SSH),n.set(lc,e))}function Ms(n,e){n.set(Yl,e.generateCurrentRequestHeaderValue()),n.set(Ql,e.generateLastRequestHeaderValue())}function Ps(n){n.set(Jl,Lt.X_MS_LIB_CAPABILITY_VALUE)}function Id(n,e){n.set(ud,e)}function Vt(n,e,t){n.has(As)||n.set(As,e),n.has(hc)||n.set(hc,t)}function by(n,e){n.set(fd,encodeURIComponent(e)),n.set(pd,"eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2R0NNIn0")}var gc={};Me(gc,{createDiscoveredInstance:()=>_d});function fp(n){return n.hasOwnProperty("authorization_endpoint")&&n.hasOwnProperty("token_endpoint")&&n.hasOwnProperty("issuer")&&n.hasOwnProperty("jwks_uri")}function pp(n){return n.hasOwnProperty("tenant_discovery_endpoint")&&n.hasOwnProperty("metadata")}function gp(n){return n.hasOwnProperty("error")&&n.hasOwnProperty("error_description")}var u={AcquireTokenByCode:"acquireTokenByCode",AcquireTokenByRefreshToken:"acquireTokenByRefreshToken",AcquireTokenSilent:"acquireTokenSilent",AcquireTokenSilentAsync:"acquireTokenSilentAsync",AcquireTokenPopup:"acquireTokenPopup",AcquireTokenPreRedirect:"acquireTokenPreRedirect",AcquireTokenRedirect:"acquireTokenRedirect",CryptoOptsGetPublicKeyThumbprint:"cryptoOptsGetPublicKeyThumbprint",CryptoOptsSignJwt:"cryptoOptsSignJwt",SilentCacheClientAcquireToken:"silentCacheClientAcquireToken",SilentIframeClientAcquireToken:"silentIframeClientAcquireToken",AwaitConcurrentIframe:"awaitConcurrentIframe",SilentRefreshClientAcquireToken:"silentRefreshClientAcquireToken",SsoSilent:"ssoSilent",StandardInteractionClientGetDiscoveredAuthority:"standardInteractionClientGetDiscoveredAuthority",FetchAccountIdWithNativeBroker:"fetchAccountIdWithNativeBroker",NativeInteractionClientAcquireToken:"nativeInteractionClientAcquireToken",BaseClientCreateTokenRequestHeaders:"baseClientCreateTokenRequestHeaders",NetworkClientSendPostRequestAsync:"networkClientSendPostRequestAsync",RefreshTokenClientExecutePostToTokenEndpoint:"refreshTokenClientExecutePostToTokenEndpoint",AuthorizationCodeClientExecutePostToTokenEndpoint:"authorizationCodeClientExecutePostToTokenEndpoint",BrokerHandhshake:"brokerHandshake",AcquireTokenByRefreshTokenInBroker:"acquireTokenByRefreshTokenInBroker",AcquireTokenByBroker:"acquireTokenByBroker",RefreshTokenClientExecuteTokenRequest:"refreshTokenClientExecuteTokenRequest",RefreshTokenClientAcquireToken:"refreshTokenClientAcquireToken",RefreshTokenClientAcquireTokenWithCachedRefreshToken:"refreshTokenClientAcquireTokenWithCachedRefreshToken",RefreshTokenClientAcquireTokenByRefreshToken:"refreshTokenClientAcquireTokenByRefreshToken",RefreshTokenClientCreateTokenRequestBody:"refreshTokenClientCreateTokenRequestBody",AcquireTokenFromCache:"acquireTokenFromCache",SilentFlowClientAcquireCachedToken:"silentFlowClientAcquireCachedToken",SilentFlowClientGenerateResultFromCacheRecord:"silentFlowClientGenerateResultFromCacheRecord",AcquireTokenBySilentIframe:"acquireTokenBySilentIframe",InitializeBaseRequest:"initializeBaseRequest",InitializeSilentRequest:"initializeSilentRequest",InitializeClientApplication:"initializeClientApplication",InitializeCache:"initializeCache",SilentIframeClientTokenHelper:"silentIframeClientTokenHelper",SilentHandlerInitiateAuthRequest:"silentHandlerInitiateAuthRequest",SilentHandlerMonitorIframeForHash:"silentHandlerMonitorIframeForHash",SilentHandlerLoadFrame:"silentHandlerLoadFrame",SilentHandlerLoadFrameSync:"silentHandlerLoadFrameSync",StandardInteractionClientCreateAuthCodeClient:"standardInteractionClientCreateAuthCodeClient",StandardInteractionClientGetClientConfiguration:"standardInteractionClientGetClientConfiguration",StandardInteractionClientInitializeAuthorizationRequest:"standardInteractionClientInitializeAuthorizationRequest",GetAuthCodeUrl:"getAuthCodeUrl",GetStandardParams:"getStandardParams",HandleCodeResponseFromServer:"handleCodeResponseFromServer",HandleCodeResponse:"handleCodeResponse",HandleResponseEar:"handleResponseEar",HandleResponsePlatformBroker:"handleResponsePlatformBroker",HandleResponseCode:"handleResponseCode",UpdateTokenEndpointAuthority:"updateTokenEndpointAuthority",AuthClientAcquireToken:"authClientAcquireToken",AuthClientExecuteTokenRequest:"authClientExecuteTokenRequest",AuthClientCreateTokenRequestBody:"authClientCreateTokenRequestBody",PopTokenGenerateCnf:"popTokenGenerateCnf",PopTokenGenerateKid:"popTokenGenerateKid",HandleServerTokenResponse:"handleServerTokenResponse",DeserializeResponse:"deserializeResponse",AuthorityFactoryCreateDiscoveredInstance:"authorityFactoryCreateDiscoveredInstance",AuthorityResolveEndpointsAsync:"authorityResolveEndpointsAsync",AuthorityResolveEndpointsFromLocalSources:"authorityResolveEndpointsFromLocalSources",AuthorityGetCloudDiscoveryMetadataFromNetwork:"authorityGetCloudDiscoveryMetadataFromNetwork",AuthorityUpdateCloudDiscoveryMetadata:"authorityUpdateCloudDiscoveryMetadata",AuthorityGetEndpointMetadataFromNetwork:"authorityGetEndpointMetadataFromNetwork",AuthorityUpdateEndpointMetadata:"authorityUpdateEndpointMetadata",AuthorityUpdateMetadataWithRegionalInformation:"authorityUpdateMetadataWithRegionalInformation",RegionDiscoveryDetectRegion:"regionDiscoveryDetectRegion",RegionDiscoveryGetRegionFromIMDS:"regionDiscoveryGetRegionFromIMDS",RegionDiscoveryGetCurrentVersion:"regionDiscoveryGetCurrentVersion",AcquireTokenByCodeAsync:"acquireTokenByCodeAsync",GetEndpointMetadataFromNetwork:"getEndpointMetadataFromNetwork",GetCloudDiscoveryMetadataFromNetworkMeasurement:"getCloudDiscoveryMetadataFromNetworkMeasurement",HandleRedirectPromiseMeasurement:"handleRedirectPromise",HandleNativeRedirectPromiseMeasurement:"handleNativeRedirectPromise",UpdateCloudDiscoveryMetadataMeasurement:"updateCloudDiscoveryMetadataMeasurement",UsernamePasswordClientAcquireToken:"usernamePasswordClientAcquireToken",NativeMessageHandlerHandshake:"nativeMessageHandlerHandshake",NativeGenerateAuthResult:"nativeGenerateAuthResult",RemoveHiddenIframe:"removeHiddenIframe",ClearTokensAndKeysWithClaims:"clearTokensAndKeysWithClaims",CacheManagerGetRefreshToken:"cacheManagerGetRefreshToken",ImportExistingCache:"importExistingCache",SetUserData:"setUserData",LocalStorageUpdated:"localStorageUpdated",GeneratePkceCodes:"generatePkceCodes",GenerateCodeVerifier:"generateCodeVerifier",GenerateCodeChallengeFromVerifier:"generateCodeChallengeFromVerifier",Sha256Digest:"sha256Digest",GetRandomValues:"getRandomValues",GenerateHKDF:"generateHKDF",GenerateBaseKey:"generateBaseKey",Base64Decode:"base64Decode",UrlEncodeArr:"urlEncodeArr",Encrypt:"encrypt",Decrypt:"decrypt",GenerateEarKey:"generateEarKey",DecryptEarResponse:"decryptEarResponse"},dI=new Map([[u.AcquireTokenByCode,"ATByCode"],[u.AcquireTokenByRefreshToken,"ATByRT"],[u.AcquireTokenSilent,"ATS"],[u.AcquireTokenSilentAsync,"ATSAsync"],[u.AcquireTokenPopup,"ATPopup"],[u.AcquireTokenRedirect,"ATRedirect"],[u.CryptoOptsGetPublicKeyThumbprint,"CryptoGetPKThumb"],[u.CryptoOptsSignJwt,"CryptoSignJwt"],[u.SilentCacheClientAcquireToken,"SltCacheClientAT"],[u.SilentIframeClientAcquireToken,"SltIframeClientAT"],[u.SilentRefreshClientAcquireToken,"SltRClientAT"],[u.SsoSilent,"SsoSlt"],[u.StandardInteractionClientGetDiscoveredAuthority,"StdIntClientGetDiscAuth"],[u.FetchAccountIdWithNativeBroker,"FetchAccIdWithNtvBroker"],[u.NativeInteractionClientAcquireToken,"NtvIntClientAT"],[u.BaseClientCreateTokenRequestHeaders,"BaseClientCreateTReqHead"],[u.NetworkClientSendPostRequestAsync,"NetClientSendPost"],[u.RefreshTokenClientExecutePostToTokenEndpoint,"RTClientExecPost"],[u.AuthorizationCodeClientExecutePostToTokenEndpoint,"AuthCodeClientExecPost"],[u.BrokerHandhshake,"BrokerHandshake"],[u.AcquireTokenByRefreshTokenInBroker,"ATByRTInBroker"],[u.AcquireTokenByBroker,"ATByBroker"],[u.RefreshTokenClientExecuteTokenRequest,"RTClientExecTReq"],[u.RefreshTokenClientAcquireToken,"RTClientAT"],[u.RefreshTokenClientAcquireTokenWithCachedRefreshToken,"RTClientATWithCachedRT"],[u.RefreshTokenClientAcquireTokenByRefreshToken,"RTClientATByRT"],[u.RefreshTokenClientCreateTokenRequestBody,"RTClientCreateTReqBody"],[u.AcquireTokenFromCache,"ATFromCache"],[u.SilentFlowClientAcquireCachedToken,"SltFlowClientATCached"],[u.SilentFlowClientGenerateResultFromCacheRecord,"SltFlowClientGenResFromCache"],[u.AcquireTokenBySilentIframe,"ATBySltIframe"],[u.InitializeBaseRequest,"InitBaseReq"],[u.InitializeSilentRequest,"InitSltReq"],[u.InitializeClientApplication,"InitClientApplication"],[u.InitializeCache,"InitCache"],[u.ImportExistingCache,"importCache"],[u.SetUserData,"setUserData"],[u.LocalStorageUpdated,"localStorageUpdated"],[u.SilentIframeClientTokenHelper,"SIClientTHelper"],[u.SilentHandlerInitiateAuthRequest,"SHandlerInitAuthReq"],[u.SilentHandlerMonitorIframeForHash,"SltHandlerMonitorIframeForHash"],[u.SilentHandlerLoadFrame,"SHandlerLoadFrame"],[u.SilentHandlerLoadFrameSync,"SHandlerLoadFrameSync"],[u.StandardInteractionClientCreateAuthCodeClient,"StdIntClientCreateAuthCodeClient"],[u.StandardInteractionClientGetClientConfiguration,"StdIntClientGetClientConf"],[u.StandardInteractionClientInitializeAuthorizationRequest,"StdIntClientInitAuthReq"],[u.GetAuthCodeUrl,"GetAuthCodeUrl"],[u.HandleCodeResponseFromServer,"HandleCodeResFromServer"],[u.HandleCodeResponse,"HandleCodeResp"],[u.HandleResponseEar,"HandleRespEar"],[u.HandleResponseCode,"HandleRespCode"],[u.HandleResponsePlatformBroker,"HandleRespPlatBroker"],[u.UpdateTokenEndpointAuthority,"UpdTEndpointAuth"],[u.AuthClientAcquireToken,"AuthClientAT"],[u.AuthClientExecuteTokenRequest,"AuthClientExecTReq"],[u.AuthClientCreateTokenRequestBody,"AuthClientCreateTReqBody"],[u.PopTokenGenerateCnf,"PopTGenCnf"],[u.PopTokenGenerateKid,"PopTGenKid"],[u.HandleServerTokenResponse,"HandleServerTRes"],[u.DeserializeResponse,"DeserializeRes"],[u.AuthorityFactoryCreateDiscoveredInstance,"AuthFactCreateDiscInst"],[u.AuthorityResolveEndpointsAsync,"AuthResolveEndpointsAsync"],[u.AuthorityResolveEndpointsFromLocalSources,"AuthResolveEndpointsFromLocal"],[u.AuthorityGetCloudDiscoveryMetadataFromNetwork,"AuthGetCDMetaFromNet"],[u.AuthorityUpdateCloudDiscoveryMetadata,"AuthUpdCDMeta"],[u.AuthorityGetEndpointMetadataFromNetwork,"AuthUpdCDMetaFromNet"],[u.AuthorityUpdateEndpointMetadata,"AuthUpdEndpointMeta"],[u.AuthorityUpdateMetadataWithRegionalInformation,"AuthUpdMetaWithRegInfo"],[u.RegionDiscoveryDetectRegion,"RegDiscDetectReg"],[u.RegionDiscoveryGetRegionFromIMDS,"RegDiscGetRegFromIMDS"],[u.RegionDiscoveryGetCurrentVersion,"RegDiscGetCurrentVer"],[u.AcquireTokenByCodeAsync,"ATByCodeAsync"],[u.GetEndpointMetadataFromNetwork,"GetEndpointMetaFromNet"],[u.GetCloudDiscoveryMetadataFromNetworkMeasurement,"GetCDMetaFromNet"],[u.HandleRedirectPromiseMeasurement,"HandleRedirectPromise"],[u.HandleNativeRedirectPromiseMeasurement,"HandleNtvRedirectPromise"],[u.UpdateCloudDiscoveryMetadataMeasurement,"UpdateCDMeta"],[u.UsernamePasswordClientAcquireToken,"UserPassClientAT"],[u.NativeMessageHandlerHandshake,"NtvMsgHandlerHandshake"],[u.NativeGenerateAuthResult,"NtvGenAuthRes"],[u.RemoveHiddenIframe,"RemoveHiddenIframe"],[u.ClearTokensAndKeysWithClaims,"ClearTAndKeysWithClaims"],[u.CacheManagerGetRefreshToken,"CacheManagerGetRT"],[u.GeneratePkceCodes,"GenPkceCodes"],[u.GenerateCodeVerifier,"GenCodeVerifier"],[u.GenerateCodeChallengeFromVerifier,"GenCodeChallengeFromVerifier"],[u.Sha256Digest,"Sha256Digest"],[u.GetRandomValues,"GetRandomValues"],[u.GenerateHKDF,"genHKDF"],[u.GenerateBaseKey,"genBaseKey"],[u.Base64Decode,"b64Decode"],[u.UrlEncodeArr,"urlEncArr"],[u.Encrypt,"encrypt"],[u.Decrypt,"decrypt"],[u.GenerateEarKey,"genEarKey"],[u.DecryptEarResponse,"decryptEarResp"]]),wd={NotStarted:0,InProgress:1,Completed:2};var ce=(n,e,t,r,o)=>(...i)=>{t.trace(`Executing function ${e}`);let s=r?.startMeasurement(e,o);if(o){let a=e+"CallCount";r?.incrementFields({[a]:1},o)}try{let a=n(...i);return s?.end({success:!0}),t.trace(`Returning result from ${e}`),a}catch(a){t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(a))}catch{t.trace("Unable to print error message.")}throw s?.end({success:!1},a),a}},p=(n,e,t,r,o)=>(...i)=>{t.trace(`Executing function ${e}`);let s=r?.startMeasurement(e,o);if(o){let a=e+"CallCount";r?.incrementFields({[a]:1},o)}return r?.setPreQueueTime(e,o),n(...i).then(a=>(t.trace(`Returning result from ${e}`),s?.end({success:!0}),a)).catch(a=>{t.trace(`Error occurred in ${e}`);try{t.trace(JSON.stringify(a))}catch{t.trace("Unable to print error message.")}throw s?.end({success:!1},a),a})};var mp=(()=>{class n{constructor(t,r,o,i){this.networkInterface=t,this.logger=r,this.performanceClient=o,this.correlationId=i}detectRegion(t,r){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.RegionDiscoveryDetectRegion,this.correlationId);let o=t;if(o)r.region_source=zr.ENVIRONMENT_VARIABLE;else{let i=n.IMDS_OPTIONS;try{let s=yield p(this.getRegionFromIMDS.bind(this),u.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(g.IMDS_VERSION,i);if(s.status===$i.httpSuccess&&(o=s.body,r.region_source=zr.IMDS),s.status===$i.httpBadRequest){let a=yield p(this.getCurrentVersion.bind(this),u.RegionDiscoveryGetCurrentVersion,this.logger,this.performanceClient,this.correlationId)(i);if(!a)return r.region_source=zr.FAILED_AUTO_DETECTION,null;let c=yield p(this.getRegionFromIMDS.bind(this),u.RegionDiscoveryGetRegionFromIMDS,this.logger,this.performanceClient,this.correlationId)(a,i);c.status===$i.httpSuccess&&(o=c.body,r.region_source=zr.IMDS)}}catch{return r.region_source=zr.FAILED_AUTO_DETECTION,null}}return o||(r.region_source=zr.FAILED_AUTO_DETECTION),o||null})}getRegionFromIMDS(t,r){return d(this,null,function*(){return this.performanceClient?.addQueueMeasurement(u.RegionDiscoveryGetRegionFromIMDS,this.correlationId),this.networkInterface.sendGetRequestAsync(`${g.IMDS_ENDPOINT}?api-version=${t}&format=text`,r,g.IMDS_TIMEOUT)})}getCurrentVersion(t){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.RegionDiscoveryGetCurrentVersion,this.correlationId);try{let r=yield this.networkInterface.sendGetRequestAsync(`${g.IMDS_ENDPOINT}?format=json`,t);return r.status===$i.httpBadRequest&&r.body&&r.body["newest-versions"]&&r.body["newest-versions"].length>0?r.body["newest-versions"][0]:null}catch{return null}})}}return n.IMDS_OPTIONS={headers:{Metadata:"true"}},n})();var Ge=class n{constructor(e,t,r,o,i,s,a,c){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=r,this.authorityOptions=o,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=i,this.performanceClient=a,this.correlationId=s,this.managedIdentity=c||!1,this.regionDiscovery=new mp(t,this.logger,this.performanceClient,this.correlationId)}getAuthorityType(e){if(e.HostNameAndPort.endsWith(g.CIAM_AUTH_URL))return Te.Ciam;let t=e.PathSegments;if(t.length)switch(t[0].toLowerCase()){case g.ADFS:return Te.Adfs;case g.DSTS:return Te.Dsts}return Te.Default}get authorityType(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)}get protocolMode(){return this.authorityOptions.protocolMode}get options(){return this.authorityOptions}get canonicalAuthority(){return this._canonicalAuthority.urlString}set canonicalAuthority(e){this._canonicalAuthority=new b(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null}get canonicalAuthorityUrlComponents(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents}get hostnameAndPort(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()}get tenant(){return this.canonicalAuthorityUrlComponents.PathSegments[0]}get authorizationEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw C(Ae)}get tokenEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw C(Ae)}get deviceCodeEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw C(Ae)}get endSessionEndpoint(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw C(un);return this.replacePath(this.metadata.end_session_endpoint)}else throw C(Ae)}get selfSignedJwtAudience(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw C(Ae)}get jwksUri(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw C(Ae)}canReplaceTenant(e){return e.PathSegments.length===1&&!n.reservedTenantDomains.has(e.PathSegments[0])&&this.getAuthorityType(e)===Te.Default&&this.protocolMode!==Z.OIDC}replaceTenant(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)}replacePath(e){let t=e,o=new b(this.metadata.canonical_authority).getUrlComponents(),i=o.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach((a,c)=>{let l=i[c];if(c===0&&this.canReplaceTenant(o)){let h=new b(this.metadata.authorization_endpoint).getUrlComponents().PathSegments[0];l!==h&&(this.logger.verbose(`Replacing tenant domain name ${l} with id ${h}`),l=h)}a!==l&&(t=t.replace(`/${l}/`,`/${a}/`))}),this.replaceTenant(t)}get defaultOpenIdConfigurationEndpoint(){let e=this.hostnameAndPort;return this.canonicalAuthority.endsWith("v2.0/")||this.authorityType===Te.Adfs||this.protocolMode===Z.OIDC&&!this.isAliasOfKnownMicrosoftAuthority(e)?`${this.canonicalAuthority}.well-known/openid-configuration`:`${this.canonicalAuthority}v2.0/.well-known/openid-configuration`}discoveryComplete(){return!!this.metadata}resolveEndpointsAsync(){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.AuthorityResolveEndpointsAsync,this.correlationId);let e=this.getCurrentMetadataEntity(),t=yield p(this.updateCloudDiscoveryMetadata.bind(this),u.AuthorityUpdateCloudDiscoveryMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.canonicalAuthority=this.canonicalAuthority.replace(this.hostnameAndPort,e.preferred_network);let r=yield p(this.updateEndpointMetadata.bind(this),u.AuthorityUpdateEndpointMetadata,this.logger,this.performanceClient,this.correlationId)(e);this.updateCachedMetadata(e,t,{source:r}),this.performanceClient?.addFields({cloudDiscoverySource:t,authorityEndpointSource:r},this.correlationId)})}getCurrentMetadataEntity(){let e=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort);return e||(e={aliases:[],preferred_cache:this.hostnameAndPort,preferred_network:this.hostnameAndPort,canonical_authority:this.canonicalAuthority,authorization_endpoint:"",token_endpoint:"",end_session_endpoint:"",issuer:"",aliasesFromNetwork:!1,endpointsFromNetwork:!1,expiresAt:rc(),jwks_uri:""}),e}updateCachedMetadata(e,t,r){t!==Ee.CACHE&&r?.source!==Ee.CACHE&&(e.expiresAt=rc(),e.canonical_authority=this.canonicalAuthority);let o=this.cacheManager.generateAuthorityMetadataCacheKey(e.preferred_cache);this.cacheManager.setAuthorityMetadata(o,e),this.metadata=e}updateEndpointMetadata(e){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.AuthorityUpdateEndpointMetadata,this.correlationId);let t=this.updateEndpointMetadataFromLocalSources(e);if(t){if(t.source===Ee.HARDCODED_VALUES&&this.authorityOptions.azureRegionConfiguration?.azureRegion&&t.metadata){let o=yield p(this.updateMetadataWithRegionalInformation.bind(this),u.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(t.metadata);uo(e,o,!1),e.canonical_authority=this.canonicalAuthority}return t.source}let r=yield p(this.getEndpointMetadataFromNetwork.bind(this),u.AuthorityGetEndpointMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(r)return this.authorityOptions.azureRegionConfiguration?.azureRegion&&(r=yield p(this.updateMetadataWithRegionalInformation.bind(this),u.AuthorityUpdateMetadataWithRegionalInformation,this.logger,this.performanceClient,this.correlationId)(r)),uo(e,r,!0),Ee.NETWORK;throw C(Yr,this.defaultOpenIdConfigurationEndpoint)})}updateEndpointMetadataFromLocalSources(e){this.logger.verbose("Attempting to get endpoint metadata from authority configuration");let t=this.getEndpointMetadataFromConfig();if(t)return this.logger.verbose("Found endpoint metadata in authority configuration"),uo(e,t,!1),{source:Ee.CONFIG};if(this.logger.verbose("Did not find endpoint metadata in the config... Attempting to get endpoint metadata from the hardcoded values."),this.authorityOptions.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get endpoint metadata from the network metadata cache.");else{let o=this.getEndpointMetadataFromHardcodedValues();if(o)return uo(e,o,!1),{source:Ee.HARDCODED_VALUES,metadata:o};this.logger.verbose("Did not find endpoint metadata in hardcoded values... Attempting to get endpoint metadata from the network metadata cache.")}let r=nc(e);return this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!r?(this.logger.verbose("Found endpoint metadata in the cache."),{source:Ee.CACHE}):(r&&this.logger.verbose("The metadata entity is expired."),null)}isAuthoritySameType(e){return new b(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length}getEndpointMetadataFromConfig(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch{throw F(vn)}return null}getEndpointMetadataFromNetwork(){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.AuthorityGetEndpointMetadataFromNetwork,this.correlationId);let e={},t=this.defaultOpenIdConfigurationEndpoint;this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: attempting to retrieve OAuth endpoints from ${t}`);try{let r=yield this.networkInterface.sendGetRequestAsync(t,e);return fp(r.body)?r.body:(this.logger.verbose("Authority.getEndpointMetadataFromNetwork: could not parse response as OpenID configuration"),null)}catch(r){return this.logger.verbose(`Authority.getEndpointMetadataFromNetwork: ${r}`),null}})}getEndpointMetadataFromHardcodedValues(){return this.hostnameAndPort in _l?_l[this.hostnameAndPort]:null}updateMetadataWithRegionalInformation(e){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.AuthorityUpdateMetadataWithRegionalInformation,this.correlationId);let t=this.authorityOptions.azureRegionConfiguration?.azureRegion;if(t){if(t!==g.AZURE_REGION_AUTO_DISCOVER_FLAG)return this.regionDiscoveryMetadata.region_outcome=Ja.CONFIGURED_NO_AUTO_DETECTION,this.regionDiscoveryMetadata.region_used=t,n.replaceWithRegionalInformation(e,t);let r=yield p(this.regionDiscovery.detectRegion.bind(this.regionDiscovery),u.RegionDiscoveryDetectRegion,this.logger,this.performanceClient,this.correlationId)(this.authorityOptions.azureRegionConfiguration?.environmentRegion,this.regionDiscoveryMetadata);if(r)return this.regionDiscoveryMetadata.region_outcome=Ja.AUTO_DETECTION_REQUESTED_SUCCESSFUL,this.regionDiscoveryMetadata.region_used=r,n.replaceWithRegionalInformation(e,r);this.regionDiscoveryMetadata.region_outcome=Ja.AUTO_DETECTION_REQUESTED_FAILED}return e})}updateCloudDiscoveryMetadata(e){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.AuthorityUpdateCloudDiscoveryMetadata,this.correlationId);let t=this.updateCloudDiscoveryMetadataFromLocalSources(e);if(t)return t;let r=yield p(this.getCloudDiscoveryMetadataFromNetwork.bind(this),u.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.logger,this.performanceClient,this.correlationId)();if(r)return us(e,r,!0),Ee.NETWORK;throw F(En)})}updateCloudDiscoveryMetadataFromLocalSources(e){this.logger.verbose("Attempting to get cloud discovery metadata  from authority configuration"),this.logger.verbosePii(`Known Authorities: ${this.authorityOptions.knownAuthorities||g.NOT_APPLICABLE}`),this.logger.verbosePii(`Authority Metadata: ${this.authorityOptions.authorityMetadata||g.NOT_APPLICABLE}`),this.logger.verbosePii(`Canonical Authority: ${e.canonical_authority||g.NOT_APPLICABLE}`);let t=this.getCloudDiscoveryMetadataFromConfig();if(t)return this.logger.verbose("Found cloud discovery metadata in authority configuration"),us(e,t,!1),Ee.CONFIG;if(this.logger.verbose("Did not find cloud discovery metadata in the config... Attempting to get cloud discovery metadata from the hardcoded values."),this.options.skipAuthorityMetadataCache)this.logger.verbose("Skipping hardcoded cloud discovery metadata cache since skipAuthorityMetadataCache is set to true. Attempting to get cloud discovery metadata from the network metadata cache.");else{let o=lp(this.hostnameAndPort);if(o)return this.logger.verbose("Found cloud discovery metadata from hardcoded values."),us(e,o,!1),Ee.HARDCODED_VALUES;this.logger.verbose("Did not find cloud discovery metadata in hardcoded values... Attempting to get cloud discovery metadata from the network metadata cache.")}let r=nc(e);return this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!r?(this.logger.verbose("Found cloud discovery metadata in the cache."),Ee.CACHE):(r&&this.logger.verbose("The metadata entity is expired."),null)}getCloudDiscoveryMetadataFromConfig(){if(this.authorityType===Te.Ciam)return this.logger.verbose("CIAM authorities do not support cloud discovery metadata, generate the aliases from authority host."),n.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("The cloud discovery metadata has been provided as a network response, in the config.");try{this.logger.verbose("Attempting to parse the cloud discovery metadata.");let e=JSON.parse(this.authorityOptions.cloudDiscoveryMetadata),t=ys(e.metadata,this.hostnameAndPort);if(this.logger.verbose("Parsed the cloud discovery metadata."),t)return this.logger.verbose("There is returnable metadata attached to the parsed cloud discovery metadata."),t;this.logger.verbose("There is no metadata attached to the parsed cloud discovery metadata.")}catch{throw this.logger.verbose("Unable to parse the cloud discovery metadata. Throwing Invalid Cloud Discovery Metadata Error."),F(yr)}}return this.isInKnownAuthorities()?(this.logger.verbose("The host is included in knownAuthorities. Creating new cloud discovery metadata from the host."),n.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null}getCloudDiscoveryMetadataFromNetwork(){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.AuthorityGetCloudDiscoveryMetadataFromNetwork,this.correlationId);let e=`${g.AAD_INSTANCE_DISCOVERY_ENDPT}${this.canonicalAuthority}oauth2/v2.0/authorize`,t={},r=null;try{let o=yield this.networkInterface.sendGetRequestAsync(e,t),i,s;if(pp(o.body))i=o.body,s=i.metadata,this.logger.verbosePii(`tenant_discovery_endpoint is: ${i.tenant_discovery_endpoint}`);else if(gp(o.body)){if(this.logger.warning(`A CloudInstanceDiscoveryErrorResponse was returned. The cloud instance discovery network request's status code is: ${o.status}`),i=o.body,i.error===g.INVALID_INSTANCE)return this.logger.error("The CloudInstanceDiscoveryErrorResponse error is invalid_instance."),null;this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error is ${i.error}`),this.logger.warning(`The CloudInstanceDiscoveryErrorResponse error description is ${i.error_description}`),this.logger.warning("Setting the value of the CloudInstanceDiscoveryMetadata (returned from the network) to []"),s=[]}else return this.logger.error("AAD did not return a CloudInstanceDiscoveryResponse or CloudInstanceDiscoveryErrorResponse"),null;this.logger.verbose("Attempting to find a match between the developer's authority and the CloudInstanceDiscoveryMetadata returned from the network request."),r=ys(s,this.hostnameAndPort)}catch(o){if(o instanceof O)this.logger.error(`There was a network error while attempting to get the cloud discovery instance metadata.
Error: ${o.errorCode}
Error Description: ${o.errorMessage}`);else{let i=o;this.logger.error(`A non-MSALJS error was thrown while attempting to get the cloud instance discovery metadata.
Error: ${i.name}
Error Description: ${i.message}`)}return null}return r||(this.logger.warning("The developer's authority was not found within the CloudInstanceDiscoveryMetadata returned from the network request."),this.logger.verbose("Creating custom Authority for custom domain scenario."),r=n.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)),r})}isInKnownAuthorities(){return this.authorityOptions.knownAuthorities.filter(t=>t&&b.getDomainFromUrl(t).toLowerCase()===this.hostnameAndPort).length>0}static generateAuthority(e,t){let r;if(t&&t.azureCloudInstance!==Cr.None){let o=t.tenant?t.tenant:g.DEFAULT_COMMON_TENANT;r=`${t.azureCloudInstance}/${o}/`}return r||e}static createCloudDiscoveryMetadataFromHost(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}}getPreferredCache(){if(this.managedIdentity)return g.DEFAULT_AUTHORITY_HOST;if(this.discoveryComplete())return this.metadata.preferred_cache;throw C(Ae)}isAlias(e){return this.metadata.aliases.indexOf(e)>-1}isAliasOfKnownMicrosoftAuthority(e){return bl.has(e)}static isPublicCloudAuthority(e){return g.KNOWN_PUBLIC_CLOUDS.indexOf(e)>=0}static buildRegionalAuthorityString(e,t,r){let o=new b(e);o.validateAsUri();let i=o.getUrlComponents(),s=`${t}.${i.HostNameAndPort}`;this.isPublicCloudAuthority(i.HostNameAndPort)&&(s=`${t}.${g.REGIONAL_AUTH_PUBLIC_CLOUD_SUFFIX}`);let a=b.constructAuthorityUriFromObject(T(f({},o.getUrlComponents()),{HostNameAndPort:s})).urlString;return r?`${a}?${r}`:a}static replaceWithRegionalInformation(e,t){let r=f({},e);return r.authorization_endpoint=n.buildRegionalAuthorityString(r.authorization_endpoint,t),r.token_endpoint=n.buildRegionalAuthorityString(r.token_endpoint,t),r.end_session_endpoint&&(r.end_session_endpoint=n.buildRegionalAuthorityString(r.end_session_endpoint,t)),r}static transformCIAMAuthority(e){let t=e,o=new b(e).getUrlComponents();if(o.PathSegments.length===0&&o.HostNameAndPort.endsWith(g.CIAM_AUTH_URL)){let i=o.HostNameAndPort.split(".")[0];t=`${t}${i}${g.AAD_TENANT_DOMAIN_SUFFIX}`}return t}};Ge.reservedTenantDomains=new Set(["{tenant}","{tenantid}",Je.COMMON,Je.CONSUMERS,Je.ORGANIZATIONS]);function Cp(n){let r=new b(n).getUrlComponents().PathSegments.slice(-1)[0]?.toLowerCase();switch(r){case Je.COMMON:case Je.ORGANIZATIONS:case Je.CONSUMERS:return;default:return r}}function pc(n){return n.endsWith(g.FORWARD_SLASH)?n:`${n}${g.FORWARD_SLASH}`}function Rd(n){let e=n.cloudDiscoveryMetadata,t;if(e)try{t=JSON.parse(e)}catch{throw F(yr)}return{canonicalAuthority:n.authority?pc(n.authority):void 0,knownAuthorities:n.knownAuthorities,cloudDiscoveryMetadata:t}}function _d(n,e,t,r,o,i,s){return d(this,null,function*(){s?.addQueueMeasurement(u.AuthorityFactoryCreateDiscoveredInstance,i);let a=Ge.transformCIAMAuthority(pc(n)),c=new Ge(a,e,t,r,o,i,s);try{return yield p(c.resolveEndpointsAsync.bind(c),u.AuthorityResolveEndpointsAsync,o,s,i)(),c}catch{throw C(Ae)}})}var be=class n extends O{constructor(e,t,r,o,i){super(e,t,r),this.name="ServerError",this.errorNo=o,this.status=i,Object.setPrototypeOf(this,n.prototype)}};function Wt(n,e,t){return{clientId:n,authority:e.authority,scopes:e.scopes,homeAccountIdentifier:t,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid,embeddedClientId:e.embeddedClientId||e.tokenBodyParameters?.clientId}}var Yt=class n{static generateThrottlingStorageKey(e){return`${Lt.THROTTLING_PREFIX}.${JSON.stringify(e)}`}static preProcess(e,t){let r=n.generateThrottlingStorageKey(t),o=e.getThrottlingCache(r);if(o){if(o.throttleTime<Date.now()){e.removeItem(r);return}throw new be(o.errorCodes?.join(" ")||g.EMPTY_STRING,o.errorMessage,o.subError)}}static postProcess(e,t,r){if(n.checkResponseStatus(r)||n.checkResponseForRetryAfter(r)){let o={throttleTime:n.calculateThrottleTime(parseInt(r.headers[ie.RETRY_AFTER])),error:r.body.error,errorCodes:r.body.error_codes,errorMessage:r.body.error_description,subError:r.body.suberror};e.setThrottlingCache(n.generateThrottlingStorageKey(t),o)}}static checkResponseStatus(e){return e.status===429||e.status>=500&&e.status<600}static checkResponseForRetryAfter(e){return e.headers?e.headers.hasOwnProperty(ie.RETRY_AFTER)&&(e.status<200||e.status>=300):!1}static calculateThrottleTime(e){let t=e<=0?0:e,r=Date.now()/1e3;return Math.floor(Math.min(r+(t||Lt.DEFAULT_THROTTLE_TIME_SECONDS),r+Lt.DEFAULT_MAX_THROTTLE_TIME_SECONDS)*1e3)}static removeThrottle(e,t,r,o){let i=Wt(t,r,o),s=this.generateThrottlingStorageKey(i);e.removeItem(s)}};var go=class n extends O{constructor(e,t,r){super(e.errorCode,e.errorMessage,e.subError),Object.setPrototypeOf(this,n.prototype),this.name="NetworkError",this.error=e,this.httpStatus=t,this.responseHeaders=r}};function kn(n,e,t,r){return n.errorMessage=`${n.errorMessage}, additionalErrorInfo: error.name:${r?.name}, error.message:${r?.message}`,new go(n,e,t)}var Ar=class{constructor(e,t){this.config=dp(e),this.logger=new _e(this.config.loggerOptions,ec,so),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}createTokenRequestHeaders(e){let t={};if(t[ie.CONTENT_TYPE]=g.URL_FORM_CONTENT_TYPE,!this.config.systemOptions.preventCorsPreflight&&e)switch(e.type){case Ce.HOME_ACCOUNT_ID:try{let r=yt(e.credential);t[ie.CCS_HEADER]=`Oid:${r.uid}@${r.utid}`}catch(r){this.logger.verbose("Could not parse home account ID for CCS Header: "+r)}break;case Ce.UPN:t[ie.CCS_HEADER]=`UPN: ${e.credential}`;break}return t}executePostToTokenEndpoint(e,t,r,o,i,s){return d(this,null,function*(){s&&this.performanceClient?.addQueueMeasurement(s,i);let a=yield this.sendPostRequest(o,e,{body:t,headers:r},i);return this.config.serverTelemetryManager&&a.status<500&&a.status!==429&&this.config.serverTelemetryManager.clearTelemetryCache(),a})}sendPostRequest(e,t,r,o){return d(this,null,function*(){Yt.preProcess(this.cacheManager,e);let i;try{i=yield p(this.networkClient.sendPostRequestAsync.bind(this.networkClient),u.NetworkClientSendPostRequestAsync,this.logger,this.performanceClient,o)(t,r);let s=i.headers||{};this.performanceClient?.addFields({refreshTokenSize:i.body.refresh_token?.length||0,httpVerToken:s[ie.X_MS_HTTP_VERSION]||"",requestId:s[ie.X_MS_REQUEST_ID]||""},o)}catch(s){if(s instanceof go){let a=s.responseHeaders;throw a&&this.performanceClient?.addFields({httpVerToken:a[ie.X_MS_HTTP_VERSION]||"",requestId:a[ie.X_MS_REQUEST_ID]||"",contentTypeHeader:a[ie.CONTENT_TYPE]||void 0,contentLengthHeader:a[ie.CONTENT_LENGTH]||void 0,httpStatus:s.httpStatus},o),s.error}throw s instanceof O?s:C(Wr)}return Yt.postProcess(this.cacheManager,e,i),i})}updateAuthority(e,t){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.UpdateTokenEndpointAuthority,t);let r=`https://${e}/${this.authority.tenant}/`,o=yield _d(r,this.networkClient,this.cacheManager,this.authority.options,this.logger,t,this.performanceClient);this.authority=o})}createTokenQueryParameters(e){let t=new Map;return e.embeddedClientId&&Vt(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.tokenQueryParameters&&qt(t,e.tokenQueryParameters),Dn(t,e.correlationId),Sn(t,e.correlationId,this.performanceClient),vt(t)}};var Qt={};Me(Qt,{badToken:()=>Sr,consentRequired:()=>bd,interactionRequired:()=>Dd,loginRequired:()=>kd,nativeAccountUnavailable:()=>Ns,noTokensFound:()=>Tr,refreshTokenExpired:()=>Ls});var Tr="no_tokens_found",Ns="native_account_unavailable",Ls="refresh_token_expired",Dd="interaction_required",bd="consent_required",kd="login_required",Sr="bad_token";var yp=[Dd,bd,kd,Sr],ky=["message_only","additional_action","basic_action","user_password_expired","consent_required","bad_token"],mc={[Tr]:"No refresh token found in the cache. Please sign-in.",[Ns]:"The requested account is not available in the native broker. It may have been deleted or logged out. Please sign-in again using an interactive API.",[Ls]:"Refresh token has expired.",[Sr]:"Identity provider returned bad_token due to an expired or invalid refresh token. Please invoke an interactive API to resolve."},vp={noTokensFoundError:{code:Tr,desc:mc[Tr]},native_account_unavailable:{code:Ns,desc:mc[Ns]},bad_token:{code:Sr,desc:mc[Sr]}},he=class n extends O{constructor(e,t,r,o,i,s,a,c){super(e,t,r),Object.setPrototypeOf(this,n.prototype),this.timestamp=o||g.EMPTY_STRING,this.traceId=i||g.EMPTY_STRING,this.correlationId=s||g.EMPTY_STRING,this.claims=a||g.EMPTY_STRING,this.name="InteractionRequiredAuthError",this.errorNo=c}};function Cc(n,e,t){let r=!!n&&yp.indexOf(n)>-1,o=!!t&&ky.indexOf(t)>-1,i=!!e&&yp.some(s=>e.indexOf(s)>-1);return r||i||o}function mo(n){return new he(n,mc[n])}var Ze=class n{static setRequestState(e,t,r){let o=n.generateLibraryState(e,r);return t?`${o}${g.RESOURCE_DELIM}${t}`:o}static generateLibraryState(e,t){if(!e)throw C(gr);let r={id:e.createNewGuid()};t&&(r.meta=t);let o=JSON.stringify(r);return e.base64Encode(o)}static parseRequestState(e,t){if(!e)throw C(gr);if(!t)throw C(Xe);try{let r=t.split(g.RESOURCE_DELIM),o=r[0],i=r.length>1?r.slice(1).join(g.RESOURCE_DELIM):g.EMPTY_STRING,s=e.base64Decode(o),a=JSON.parse(s);return{userRequestState:i||g.EMPTY_STRING,libraryState:a}}catch{throw C(Xe)}}};var Oy={SW:"sw",UHW:"uhw"},ke=class{constructor(e,t){this.cryptoUtils=e,this.performanceClient=t}generateCnf(e,t){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.PopTokenGenerateCnf,e.correlationId);let r=yield p(this.generateKid.bind(this),u.PopTokenGenerateCnf,t,this.performanceClient,e.correlationId)(e),o=this.cryptoUtils.base64UrlEncode(JSON.stringify(r));return{kid:r.kid,reqCnfString:o}})}generateKid(e){return d(this,null,function*(){return this.performanceClient?.addQueueMeasurement(u.PopTokenGenerateKid,e.correlationId),{kid:yield this.cryptoUtils.getPublicKeyThumbprint(e),xms_ksl:Oy.SW}})}signPopToken(e,t,r){return d(this,null,function*(){return this.signPayload(e,t,r)})}signPayload(e,t,r,o){return d(this,null,function*(){let{resourceRequestMethod:i,resourceRequestUri:s,shrClaims:a,shrNonce:c,shrOptions:l}=r,m=(s?new b(s):void 0)?.getUrlComponents();return this.cryptoUtils.signJwt(f({at:e,ts:Ue(),m:i?.toUpperCase(),u:m?.HostNameAndPort,nonce:c||this.cryptoUtils.createNewGuid(),p:m?.AbsolutePath,q:m?.QueryString?[[],m.QueryString]:void 0,client_claims:a||void 0},o),t,l,r.correlationId)})}};var yc=class{constructor(e,t){this.cache=e,this.hasChanged=t}get cacheHasChanged(){return this.hasChanged}get tokenCache(){return this.cache}};var et=class n{constructor(e,t,r,o,i,s,a){this.clientId=e,this.cacheStorage=t,this.cryptoObj=r,this.logger=o,this.serializableCache=i,this.persistencePlugin=s,this.performanceClient=a}validateTokenResponse(e,t){if(e.error||e.error_description||e.suberror){let r=`Error(s): ${e.error_codes||g.NOT_AVAILABLE} - Timestamp: ${e.timestamp||g.NOT_AVAILABLE} - Description: ${e.error_description||g.NOT_AVAILABLE} - Correlation ID: ${e.correlation_id||g.NOT_AVAILABLE} - Trace ID: ${e.trace_id||g.NOT_AVAILABLE}`,o=e.error_codes?.length?e.error_codes[0]:void 0,i=new be(e.error,r,e.suberror,o,e.status);if(t&&e.status&&e.status>=ro.SERVER_ERROR_RANGE_START&&e.status<=ro.SERVER_ERROR_RANGE_END){this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently unavailable and the access token is unable to be refreshed.
${i}`);return}else if(t&&e.status&&e.status>=ro.CLIENT_ERROR_RANGE_START&&e.status<=ro.CLIENT_ERROR_RANGE_END){this.logger.warning(`executeTokenRequest:validateTokenResponse - AAD is currently available but is unable to refresh the access token.
${i}`);return}throw Cc(e.error,e.error_description,e.suberror)?new he(e.error,e.error_description,e.suberror,e.timestamp||g.EMPTY_STRING,e.trace_id||g.EMPTY_STRING,e.correlation_id||g.EMPTY_STRING,e.claims||g.EMPTY_STRING,o):i}}handleServerTokenResponse(e,t,r,o,i,s,a,c,l){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.HandleServerTokenResponse,e.correlation_id);let h;if(e.id_token){if(h=Ht(e.id_token||g.EMPTY_STRING,this.cryptoObj.base64Decode),i&&i.nonce&&h.nonce!==i.nonce)throw C(Xr);if(o.maxAge||o.maxAge===0){let _=h.auth_time;if(!_)throw C(Ft);ss(_,o.maxAge)}}this.homeAccountIdentifier=oe.generateHomeAccountId(e.client_info||g.EMPTY_STRING,t.authorityType,this.logger,this.cryptoObj,h);let m;i&&i.state&&(m=Ze.parseRequestState(this.cryptoObj,i.state)),e.key_id=e.key_id||o.sshKid||void 0;let y=this.generateCacheRecord(e,t,r,o,h,s,i),S;try{if(this.persistencePlugin&&this.serializableCache&&(this.logger.verbose("Persistence enabled, calling beforeCacheAccess"),S=new yc(this.serializableCache,!0),yield this.persistencePlugin.beforeCacheAccess(S)),a&&!c&&y.account){let _=y.account.generateAccountKey();if(!this.cacheStorage.getAccount(_))return this.logger.warning("Account used to refresh tokens not in persistence, refreshed tokens will not be stored in the cache"),yield n.generateAuthenticationResult(this.cryptoObj,t,y,!1,o,h,m,void 0,l)}yield this.cacheStorage.saveCacheRecord(y,o.correlationId,o.storeInCache)}finally{this.persistencePlugin&&this.serializableCache&&S&&(this.logger.verbose("Persistence enabled, calling afterCacheAccess"),yield this.persistencePlugin.afterCacheAccess(S))}return n.generateAuthenticationResult(this.cryptoObj,t,y,!1,o,h,m,e,l)})}generateCacheRecord(e,t,r,o,i,s,a){let c=t.getPreferredCache();if(!c)throw C(xt);let l=oc(i),h,m;e.id_token&&i&&(h=Tl(this.homeAccountIdentifier,c,e.id_token,this.clientId,l||""),m=Co(this.cacheStorage,t,this.homeAccountIdentifier,this.cryptoObj.base64Decode,i,e.client_info,c,l,a,void 0,this.logger));let y=null;if(e.access_token){let x=e.scope?j.fromString(e.scope):new j(o.scopes||[]),V=(typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0,ve=(typeof e.ext_expires_in=="string"?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,Dt=(typeof e.refresh_in=="string"?parseInt(e.refresh_in,10):e.refresh_in)||void 0,je=r+V,cu=je+ve,ea=Dt&&Dt>0?r+Dt:void 0;y=Sl(this.homeAccountIdentifier,c,e.access_token,this.clientId,l||t.tenant||"",x.printScopes(),je,cu,this.cryptoObj.base64Decode,ea,e.token_type,s,e.key_id,o.claims,o.requestedClaimsHash)}let S=null;if(e.refresh_token){let x;if(e.refresh_token_expires_in){let V=typeof e.refresh_token_expires_in=="string"?parseInt(e.refresh_token_expires_in,10):e.refresh_token_expires_in;x=r+V}S=Il(this.homeAccountIdentifier,c,e.refresh_token,this.clientId,e.foci,s,x)}let _=null;return e.foci&&(_={clientId:this.clientId,environment:c,familyId:e.foci}),{account:m,idToken:h,accessToken:y,refreshToken:S,appMetadata:_}}static generateAuthenticationResult(e,t,r,o,i,s,a,c,l){return d(this,null,function*(){let h=g.EMPTY_STRING,m=[],y=null,S,_,x=g.EMPTY_STRING;if(r.accessToken){if(r.accessToken.tokenType===U.POP&&!i.popKid){let je=new ke(e),{secret:cu,keyId:ea}=r.accessToken;if(!ea)throw C(ln);h=yield je.signPopToken(cu,ea,i)}else h=r.accessToken.secret;m=j.fromString(r.accessToken.target).asArray(),y=as(r.accessToken.expiresOn),S=as(r.accessToken.extendedExpiresOn),r.accessToken.refreshOn&&(_=as(r.accessToken.refreshOn))}r.appMetadata&&(x=r.appMetadata.familyId===lr?lr:"");let V=s?.oid||s?.sub||"",ve=s?.tid||"";c?.spa_accountid&&r.account&&(r.account.nativeAccountId=c?.spa_accountid);let Dt=r.account?An(r.account.getAccountInfo(),void 0,s,r.idToken?.secret):null;return{authority:t.canonicalAuthority,uniqueId:V,tenantId:ve,scopes:m,account:Dt,idToken:r?.idToken?.secret||"",idTokenClaims:s||{},accessToken:h,fromCache:o,expiresOn:y,extExpiresOn:S,refreshOn:_,correlationId:i.correlationId,requestId:l||g.EMPTY_STRING,familyId:x,tokenType:r.accessToken?.tokenType||g.EMPTY_STRING,state:a?a.userRequestState:g.EMPTY_STRING,cloudGraphHostName:r.account?.cloudGraphHostName||g.EMPTY_STRING,msGraphHost:r.account?.msGraphHost||g.EMPTY_STRING,code:c?.spa_code,fromNativeBroker:!1}})}};function Co(n,e,t,r,o,i,s,a,c,l,h){h?.verbose("setCachedAccount called");let y=n.getAccountKeys().find(ve=>ve.startsWith(t)),S=null;y&&(S=n.getAccount(y));let _=S||oe.createAccount({homeAccountId:t,idTokenClaims:o,clientInfo:i,environment:s,cloudGraphHostName:c?.cloud_graph_host_name,msGraphHost:c?.msgraph_host,nativeAccountId:l},e,r),x=_.tenantProfiles||[],V=a||_.realm;if(V&&!x.find(ve=>ve.tenantId===V)){let ve=ho(t,_.localAccountId,V,o);x.push(ve)}return _.tenantProfiles=x,_}var vc=class{static validateRedirectUri(e){if(!e)throw F(dn)}static validatePrompt(e){let t=[];for(let r in W)t.push(W[r]);if(t.indexOf(e)<0)throw F(gn)}static validateClaims(e){try{JSON.parse(e)}catch{throw F(Ct)}}static validateCodeChallengeParams(e,t){if(!e||!t)throw F($t);this.validateCodeChallengeMethod(t)}static validateCodeChallengeMethod(e){if([Va.PLAIN,Va.S256].indexOf(e)<0)throw F(yn)}};function Ec(n,e,t){return d(this,null,function*(){return typeof n=="string"?n:n({clientId:e,tokenEndpoint:t})})}var On=class extends Ar{constructor(e,t){super(e,t),this.includeRedirectUri=!0,this.oidcDefaultScopes=this.config.authOptions.authority.options.OIDCOptions?.defaultScopes}acquireToken(e,t){return d(this,null,function*(){if(this.performanceClient?.addQueueMeasurement(u.AuthClientAcquireToken,e.correlationId),!e.code)throw C(tn);let r=Ue(),o=yield p(this.executeTokenRequest.bind(this),u.AuthClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(this.authority,e),i=o.headers?.[ie.X_MS_REQUEST_ID],s=new et(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin,this.performanceClient);return s.validateTokenResponse(o.body),p(s.handleServerTokenResponse.bind(s),u.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(o.body,this.authority,r,e,t,void 0,void 0,void 0,i)})}getLogoutUri(e){if(!e)throw F(Cn);let t=this.createLogoutUrlQueryString(e);return b.appendQueryString(this.authority.endSessionEndpoint,t)}executeTokenRequest(e,t){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.AuthClientExecuteTokenRequest,t.correlationId);let r=this.createTokenQueryParameters(t),o=b.appendQueryString(e.tokenEndpoint,r),i=yield p(this.createTokenRequestBody.bind(this),u.AuthClientCreateTokenRequestBody,this.logger,this.performanceClient,t.correlationId)(t),s;if(t.clientInfo)try{let l=lo(t.clientInfo,this.cryptoUtils.base64Decode);s={credential:`${l.uid}${ne.CLIENT_INFO_SEPARATOR}${l.utid}`,type:Ce.HOME_ACCOUNT_ID}}catch(l){this.logger.verbose("Could not parse client info for CCS Header: "+l)}let a=this.createTokenRequestHeaders(s||t.ccsCredential),c=Wt(this.config.authOptions.clientId,t);return p(this.executePostToTokenEndpoint.bind(this),u.AuthorizationCodeClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,t.correlationId)(o,i,a,c,t.correlationId,u.AuthorizationCodeClientExecutePostToTokenEndpoint)})}createTokenRequestBody(e){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.AuthClientCreateTokenRequestBody,e.correlationId);let t=new Map;if(wn(t,e.embeddedClientId||e.tokenBodyParameters?.[Et]||this.config.authOptions.clientId),this.includeRedirectUri?Rn(t,e.redirectUri):vc.validateRedirectUri(e.redirectUri),In(t,e.scopes,!0,this.oidcDefaultScopes),Ad(t,e.code),Ts(t,this.config.libraryInfo),Ss(t,this.config.telemetry.application),Ps(t),this.serverTelemetryManager&&!ac(this.config)&&Ms(t,this.serverTelemetryManager),e.codeVerifier&&Sd(t,e.codeVerifier),this.config.clientCredentials.clientSecret&&ws(t,this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){let o=this.config.clientCredentials.clientAssertion;Rs(t,yield Ec(o.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),_s(t,o.assertionType)}if(Ds(t,Bi.AUTHORIZATION_CODE_GRANT),bn(t),e.authenticationScheme===U.POP){let o=new ke(this.cryptoUtils,this.performanceClient),i;e.popKid?i=this.cryptoUtils.encodeKid(e.popKid):i=(yield p(o.generateCnf.bind(o),u.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,ks(t,i)}else if(e.authenticationScheme===U.SSH)if(e.sshJwk)Os(t,e.sshJwk);else throw F(Gt);(!X.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&_n(t,e.claims,this.config.authOptions.clientCapabilities);let r;if(e.clientInfo)try{let o=lo(e.clientInfo,this.cryptoUtils.base64Decode);r={credential:`${o.uid}${ne.CLIENT_INFO_SEPARATOR}${o.utid}`,type:Ce.HOME_ACCOUNT_ID}}catch(o){this.logger.verbose("Could not parse client info for CCS Header: "+o)}else r=e.ccsCredential;if(this.config.systemOptions.preventCorsPreflight&&r)switch(r.type){case Ce.HOME_ACCOUNT_ID:try{let o=yt(r.credential);jt(t,o)}catch(o){this.logger.verbose("Could not parse home account ID for CCS Header: "+o)}break;case Ce.UPN:Er(t,r.credential);break}return e.embeddedClientId&&Vt(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.tokenBodyParameters&&qt(t,e.tokenBodyParameters),e.enableSpaAuthorizationCode&&(!e.tokenBodyParameters||!e.tokenBodyParameters[dc])&&qt(t,{[dc]:"1"}),Sn(t,e.correlationId,this.performanceClient),vt(t)})}createLogoutUrlQueryString(e){let t=new Map;return e.postLogoutRedirectUri&&md(t,e.postLogoutRedirectUri),e.correlationId&&Dn(t,e.correlationId),e.idTokenHint&&Cd(t,e.idTokenHint),e.state&&Is(t,e.state),e.logoutHint&&Id(t,e.logoutHint),e.extraQueryParameters&&qt(t,e.extraQueryParameters),this.config.authOptions.instanceAware&&bs(t),vt(t,this.config.authOptions.encodeExtraQueryParams,e.extraQueryParameters)}};var My=300,Fs=class extends Ar{constructor(e,t){super(e,t)}acquireToken(e){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.RefreshTokenClientAcquireToken,e.correlationId);let t=Ue(),r=yield p(this.executeTokenRequest.bind(this),u.RefreshTokenClientExecuteTokenRequest,this.logger,this.performanceClient,e.correlationId)(e,this.authority),o=r.headers?.[ie.X_MS_REQUEST_ID],i=new et(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.config.serializableCache,this.config.persistencePlugin);return i.validateTokenResponse(r.body),p(i.handleServerTokenResponse.bind(i),u.HandleServerTokenResponse,this.logger,this.performanceClient,e.correlationId)(r.body,this.authority,t,e,void 0,void 0,!0,e.forceCache,o)})}acquireTokenByRefreshToken(e){return d(this,null,function*(){if(!e)throw F(mn);if(this.performanceClient?.addQueueMeasurement(u.RefreshTokenClientAcquireTokenByRefreshToken,e.correlationId),!e.account)throw C(Ut);if(this.cacheManager.isAppMetadataFOCI(e.account.environment))try{return yield p(this.acquireTokenWithCachedRefreshToken.bind(this),u.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!0)}catch(r){let o=r instanceof he&&r.errorCode===Tr,i=r instanceof be&&r.errorCode===Ya.INVALID_GRANT_ERROR&&r.subError===Ya.CLIENT_MISMATCH_ERROR;if(o||i)return p(this.acquireTokenWithCachedRefreshToken.bind(this),u.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!1);throw r}return p(this.acquireTokenWithCachedRefreshToken.bind(this),u.RefreshTokenClientAcquireTokenWithCachedRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,!1)})}acquireTokenWithCachedRefreshToken(e,t){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.RefreshTokenClientAcquireTokenWithCachedRefreshToken,e.correlationId);let r=ce(this.cacheManager.getRefreshToken.bind(this.cacheManager),u.CacheManagerGetRefreshToken,this.logger,this.performanceClient,e.correlationId)(e.account,t,void 0,this.performanceClient,e.correlationId);if(!r)throw mo(Tr);if(r.expiresOn&&co(r.expiresOn,e.refreshTokenExpirationOffsetSeconds||My))throw this.performanceClient?.addFields({rtExpiresOnMs:Number(r.expiresOn)},e.correlationId),mo(Ls);let o=T(f({},e),{refreshToken:r.secret,authenticationScheme:e.authenticationScheme||U.BEARER,ccsCredential:{credential:e.account.homeAccountId,type:Ce.HOME_ACCOUNT_ID}});try{return yield p(this.acquireToken.bind(this),u.RefreshTokenClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(o)}catch(i){if(i instanceof he&&(this.performanceClient?.addFields({rtExpiresOnMs:Number(r.expiresOn)},e.correlationId),i.subError===Sr)){this.logger.verbose("acquireTokenWithRefreshToken: bad refresh token, removing from cache");let s=cs(r);this.cacheManager.removeRefreshToken(s)}throw i}})}executeTokenRequest(e,t){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.RefreshTokenClientExecuteTokenRequest,e.correlationId);let r=this.createTokenQueryParameters(e),o=b.appendQueryString(t.tokenEndpoint,r),i=yield p(this.createTokenRequestBody.bind(this),u.RefreshTokenClientCreateTokenRequestBody,this.logger,this.performanceClient,e.correlationId)(e),s=this.createTokenRequestHeaders(e.ccsCredential),a=Wt(this.config.authOptions.clientId,e);return p(this.executePostToTokenEndpoint.bind(this),u.RefreshTokenClientExecutePostToTokenEndpoint,this.logger,this.performanceClient,e.correlationId)(o,i,s,a,e.correlationId,u.RefreshTokenClientExecutePostToTokenEndpoint)})}createTokenRequestBody(e){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.RefreshTokenClientCreateTokenRequestBody,e.correlationId);let t=new Map;if(wn(t,e.embeddedClientId||e.tokenBodyParameters?.[Et]||this.config.authOptions.clientId),e.redirectUri&&Rn(t,e.redirectUri),In(t,e.scopes,!0,this.config.authOptions.authority.options.OIDCOptions?.defaultScopes),Ds(t,Bi.REFRESH_TOKEN_GRANT),bn(t),Ts(t,this.config.libraryInfo),Ss(t,this.config.telemetry.application),Ps(t),this.serverTelemetryManager&&!ac(this.config)&&Ms(t,this.serverTelemetryManager),Td(t,e.refreshToken),this.config.clientCredentials.clientSecret&&ws(t,this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){let r=this.config.clientCredentials.clientAssertion;Rs(t,yield Ec(r.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),_s(t,r.assertionType)}if(e.authenticationScheme===U.POP){let r=new ke(this.cryptoUtils,this.performanceClient),o;e.popKid?o=this.cryptoUtils.encodeKid(e.popKid):o=(yield p(r.generateCnf.bind(r),u.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,ks(t,o)}else if(e.authenticationScheme===U.SSH)if(e.sshJwk)Os(t,e.sshJwk);else throw F(Gt);if((!X.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&_n(t,e.claims,this.config.authOptions.clientCapabilities),this.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case Ce.HOME_ACCOUNT_ID:try{let r=yt(e.ccsCredential.credential);jt(t,r)}catch(r){this.logger.verbose("Could not parse home account ID for CCS Header: "+r)}break;case Ce.UPN:Er(t,e.ccsCredential.credential);break}return e.embeddedClientId&&Vt(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.tokenBodyParameters&&qt(t,e.tokenBodyParameters),Sn(t,e.correlationId,this.performanceClient),vt(t)})}};var Us=class extends Ar{constructor(e,t){super(e,t)}acquireCachedToken(e){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.SilentFlowClientAcquireCachedToken,e.correlationId);let t=gt.NOT_APPLICABLE;if(e.forceRefresh||!this.config.cacheOptions.claimsBasedCachingEnabled&&!X.isEmptyObj(e.claims))throw this.setCacheOutcome(gt.FORCE_REFRESH_OR_CLAIMS,e.correlationId),C(Bt);if(!e.account)throw C(Ut);let r=e.account.tenantId||Cp(e.authority),o=this.cacheManager.getTokenKeys(),i=this.cacheManager.getAccessToken(e.account,e,o,r,this.performanceClient,e.correlationId);if(i){if(Al(i.cachedAt)||co(i.expiresOn,this.config.systemOptions.tokenRenewalOffsetSeconds))throw this.setCacheOutcome(gt.CACHED_ACCESS_TOKEN_EXPIRED,e.correlationId),C(Bt);i.refreshOn&&co(i.refreshOn,0)&&(t=gt.PROACTIVELY_REFRESHED)}else throw this.setCacheOutcome(gt.NO_CACHED_ACCESS_TOKEN,e.correlationId),C(Bt);let s=e.authority||this.authority.getPreferredCache(),a={account:this.cacheManager.readAccountFromCache(e.account),accessToken:i,idToken:this.cacheManager.getIdToken(e.account,o,r,this.performanceClient,e.correlationId),refreshToken:null,appMetadata:this.cacheManager.readAppMetadataFromCache(s)};return this.setCacheOutcome(t,e.correlationId),this.config.serverTelemetryManager&&this.config.serverTelemetryManager.incrementCacheHits(),[yield p(this.generateResultFromCacheRecord.bind(this),u.SilentFlowClientGenerateResultFromCacheRecord,this.logger,this.performanceClient,e.correlationId)(a,e),t]})}setCacheOutcome(e,t){this.serverTelemetryManager?.setCacheOutcome(e),this.performanceClient?.addFields({cacheOutcome:e},t),e!==gt.NOT_APPLICABLE&&this.logger.info(`Token refresh is required due to cache outcome: ${e}`)}generateResultFromCacheRecord(e,t){return d(this,null,function*(){this.performanceClient?.addQueueMeasurement(u.SilentFlowClientGenerateResultFromCacheRecord,t.correlationId);let r;if(e.idToken&&(r=Ht(e.idToken.secret,this.config.cryptoInterface.base64Decode)),t.maxAge||t.maxAge===0){let o=r?.auth_time;if(!o)throw C(Ft);ss(o,t.maxAge)}return et.generateAuthenticationResult(this.cryptoUtils,this.authority,e,!0,t,r)})}};var Od={sendGetRequestAsync:()=>Promise.reject(C(L)),sendPostRequestAsync:()=>Promise.reject(C(L))};var Jt={};Me(Jt,{getAuthorizationCodePayload:()=>Ly,getAuthorizeUrl:()=>Ny,getStandardAuthorizeRequestParameters:()=>Py,validateAuthorizationResponse:()=>Ep});function Py(n,e,t,r){let o=e.correlationId,i=new Map;wn(i,e.embeddedClientId||e.extraQueryParameters?.[Et]||n.clientId);let s=[...e.scopes||[],...e.extraScopesToConsent||[]];if(In(i,s,!0,n.authority.options.OIDCOptions?.defaultScopes),Rn(i,e.redirectUri),Dn(i,o),gd(i,e.responseMode),bn(i),e.prompt&&(vd(i,e.prompt),r?.addFields({prompt:e.prompt},o)),e.domainHint&&(yd(i,e.domainHint),r?.addFields({domainHintFromRequest:!0},o)),e.prompt!==W.SELECT_ACCOUNT)if(e.sid&&e.prompt===W.NONE)t.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from request"),fc(i,e.sid),r?.addFields({sidFromRequest:!0},o);else if(e.account){let a=Uy(e.account),c=xy(e.account);if(c&&e.domainHint&&(t.warning('AuthorizationCodeClient.createAuthCodeUrlQueryString: "domainHint" param is set, skipping opaque "login_hint" claim. Please consider not passing domainHint'),c=null),c){t.verbose("createAuthCodeUrlQueryString: login_hint claim present on account"),po(i,c),r?.addFields({loginHintFromClaim:!0},o);try{let l=yt(e.account.homeAccountId);jt(i,l)}catch{t.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(a&&e.prompt===W.NONE){t.verbose("createAuthCodeUrlQueryString: Prompt is none, adding sid from account"),fc(i,a),r?.addFields({sidFromClaim:!0},o);try{let l=yt(e.account.homeAccountId);jt(i,l)}catch{t.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}else if(e.loginHint)t.verbose("createAuthCodeUrlQueryString: Adding login_hint from request"),po(i,e.loginHint),Er(i,e.loginHint),r?.addFields({loginHintFromRequest:!0},o);else if(e.account.username){t.verbose("createAuthCodeUrlQueryString: Adding login_hint from account"),po(i,e.account.username),r?.addFields({loginHintFromUpn:!0},o);try{let l=yt(e.account.homeAccountId);jt(i,l)}catch{t.verbose("createAuthCodeUrlQueryString: Could not parse home account ID for CCS Header")}}}else e.loginHint&&(t.verbose("createAuthCodeUrlQueryString: No account, adding login_hint from request"),po(i,e.loginHint),Er(i,e.loginHint),r?.addFields({loginHintFromRequest:!0},o));else t.verbose("createAuthCodeUrlQueryString: Prompt is select_account, ignoring account hints");return e.nonce&&Ed(i,e.nonce),e.state&&Is(i,e.state),(e.claims||n.clientCapabilities&&n.clientCapabilities.length>0)&&_n(i,e.claims,n.clientCapabilities),e.embeddedClientId&&Vt(i,n.clientId,n.redirectUri),n.instanceAware&&(!e.extraQueryParameters||!Object.keys(e.extraQueryParameters).includes(fo))&&bs(i),i}function Ny(n,e,t,r){let o=vt(e,t,r);return b.appendQueryString(n.authorizationEndpoint,o)}function Ly(n,e){if(Ep(n,e),!n.code)throw C(an);return n}function Ep(n,e){if(!n.state||!e)throw n.state?C(fr,"Cached State"):C(fr,"Server State");let t,r;try{t=decodeURIComponent(n.state)}catch{throw C(Xe,n.state)}try{r=decodeURIComponent(e)}catch{throw C(Xe,n.state)}if(t!==r)throw C(Jr);if(n.error||n.error_description||n.suberror){let o=Fy(n);throw Cc(n.error,n.error_description,n.suberror)?new he(n.error||"",n.error_description,n.suberror,n.timestamp||"",n.trace_id||"",n.correlation_id||"",n.claims||"",o):new be(n.error||"",n.error_description,n.suberror,o)}}function Fy(n){let e="code=",t=n.error_uri?.lastIndexOf(e);return t&&t>=0?n.error_uri?.substring(t+e.length):void 0}function Uy(n){return n.idTokenClaims?.sid||null}function xy(n){return n.idTokenClaims?.login_hint||null}var Ap=",",Tp="|";function By(n){let{skus:e,libraryName:t,libraryVersion:r,extensionName:o,extensionVersion:i}=n,s=new Map([[0,[t,r]],[2,[o,i]]]),a=[];if(e?.length){if(a=e.split(Ap),a.length<4)return e}else a=Array.from({length:4},()=>Tp);return s.forEach((c,l)=>{c.length===2&&c[0]?.length&&c[1]?.length&&Hy({skuArr:a,index:l,skuName:c[0],skuVersion:c[1]})}),a.join(Ap)}function Hy(n){let{skuArr:e,index:t,skuName:r,skuVersion:o}=n;t>=e.length||(e[t]=[r,o].join(Tp))}var Mn=class n{constructor(e,t){this.cacheOutcome=gt.NOT_APPLICABLE,this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||g.EMPTY_STRING,this.wrapperVer=e.wrapperVer||g.EMPTY_STRING,this.telemetryCacheKey=le.CACHE_KEY+ne.CACHE_KEY_SEPARATOR+e.clientId}generateCurrentRequestHeaderValue(){let e=`${this.apiId}${le.VALUE_SEPARATOR}${this.cacheOutcome}`,t=[this.wrapperSKU,this.wrapperVer],r=this.getNativeBrokerErrorCode();r?.length&&t.push(`broker_error=${r}`);let o=t.join(le.VALUE_SEPARATOR),i=this.getRegionDiscoveryFields(),s=[e,i].join(le.VALUE_SEPARATOR);return[le.SCHEMA_VERSION,s,o].join(le.CATEGORY_SEPARATOR)}generateLastRequestHeaderValue(){let e=this.getLastRequests(),t=n.maxErrorsToSend(e),r=e.failedRequests.slice(0,2*t).join(le.VALUE_SEPARATOR),o=e.errors.slice(0,t).join(le.VALUE_SEPARATOR),i=e.errors.length,s=t<i?le.OVERFLOW_TRUE:le.OVERFLOW_FALSE,a=[i,s].join(le.VALUE_SEPARATOR);return[le.SCHEMA_VERSION,e.cacheHits,r,o,a].join(le.CATEGORY_SEPARATOR)}cacheFailedRequest(e){let t=this.getLastRequests();t.errors.length>=le.MAX_CACHED_ERRORS&&(t.failedRequests.shift(),t.failedRequests.shift(),t.errors.shift()),t.failedRequests.push(this.apiId,this.correlationId),e instanceof Error&&e&&e.toString()?e instanceof O?e.subError?t.errors.push(e.subError):e.errorCode?t.errors.push(e.errorCode):t.errors.push(e.toString()):t.errors.push(e.toString()):t.errors.push(le.UNKNOWN_ERROR),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t)}incrementCacheHits(){let e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e),e.cacheHits}getLastRequests(){let e={failedRequests:[],errors:[],cacheHits:0};return this.cacheManager.getServerTelemetry(this.telemetryCacheKey)||e}clearTelemetryCache(){let e=this.getLastRequests(),t=n.maxErrorsToSend(e),r=e.errors.length;if(t===r)this.cacheManager.removeItem(this.telemetryCacheKey);else{let o={failedRequests:e.failedRequests.slice(t*2),errors:e.errors.slice(t),cacheHits:0};this.cacheManager.setServerTelemetry(this.telemetryCacheKey,o)}}static maxErrorsToSend(e){let t,r=0,o=0,i=e.errors.length;for(t=0;t<i;t++){let s=e.failedRequests[2*t]||g.EMPTY_STRING,a=e.failedRequests[2*t+1]||g.EMPTY_STRING,c=e.errors[t]||g.EMPTY_STRING;if(o+=s.toString().length+a.toString().length+c.length+3,o<le.MAX_LAST_HEADER_BYTES)r+=1;else break}return r}getRegionDiscoveryFields(){let e=[];return e.push(this.regionUsed||g.EMPTY_STRING),e.push(this.regionSource||g.EMPTY_STRING),e.push(this.regionOutcome||g.EMPTY_STRING),e.join(",")}updateRegionDiscoveryMetadata(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome}setCacheOutcome(e){this.cacheOutcome=e}setNativeBrokerErrorCode(e){let t=this.getLastRequests();t.nativeBrokerErrorCode=e,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t)}getNativeBrokerErrorCode(){return this.getLastRequests().nativeBrokerErrorCode}clearNativeBrokerErrorCode(){let e=this.getLastRequests();delete e.nativeBrokerErrorCode,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e)}static makeExtraSkuString(e){return By(e)}};var Ac="missing_kid_error",Tc="missing_alg_error";var $y={[Ac]:"The JOSE Header for the requested JWT, JWS or JWK object requires a keyId to be configured as the 'kid' header claim. No 'kid' value was provided.",[Tc]:"The JOSE Header for the requested JWT, JWS or JWK object requires an algorithm to be specified as the 'alg' header claim. No 'alg' value was provided."},Md=class n extends O{constructor(e,t){super(e,t),this.name="JoseHeaderError",Object.setPrototypeOf(this,n.prototype)}};function Pd(n){return new Md(n,$y[n])}var xs=class n{constructor(e){this.typ=e.typ,this.alg=e.alg,this.kid=e.kid}static getShrHeaderString(e){if(!e.kid)throw Pd(Ac);if(!e.alg)throw Pd(Tc);let t=new n({typ:e.typ||Xa.Pop,kid:e.kid,alg:e.alg});return JSON.stringify(t)}};var Sc=class{startMeasurement(){}endMeasurement(){}flushMeasurement(){return null}},yo=class{generateId(){return"callback-id"}startMeasurement(e,t){return{end:()=>null,discard:()=>{},add:()=>{},increment:()=>{},event:{eventId:this.generateId(),status:wd.InProgress,authority:"",libraryName:"",libraryVersion:"",clientId:"",name:e,startTimeMs:Date.now(),correlationId:t||""},measurement:new Sc}}startPerformanceMeasurement(){return new Sc}calculateQueuedTime(){return 0}addQueueMeasurement(){}setPreQueueTime(){}endMeasurement(){return null}discardMeasurements(){}removePerformanceCallback(){return!0}addPerformanceCallback(){return""}emitEvents(){}addFields(){}incrementFields(){}cacheEventByCorrelationId(){}};var Pn="pkce_not_created",Bs="ear_jwk_empty",Ic="ear_jwe_empty",Nn="crypto_nonexistent",At="empty_navigate_uri",vo="hash_empty_error",Ir="no_state_in_hash",Eo="hash_does_not_contain_known_properties",Ao="unable_to_parse_state",To="state_interaction_type_mismatch",So="interaction_in_progress",Io="popup_window_error",wo="empty_window_error",tt="user_cancelled",wc="monitor_popup_timeout",Ro="monitor_window_timeout",_o="redirect_in_iframe",Do="block_iframe_reload",bo="block_nested_popups",Rc="iframe_closed_prematurely",Tt="silent_logout_unsupported",ko="no_account_error",_c="silent_prompt_value_error",Oo="no_token_request_cache_error",Mo="unable_to_parse_token_request_cache_error",Dc="auth_request_not_set_error",bc="invalid_cache_type",St="non_browser_environment",It="database_not_open",Xt="no_network_connectivity",Po="post_request_failed",No="get_request_failed",Ln="failed_to_parse_response",Lo="unable_to_load_token",wr="crypto_key_not_found",Fo="auth_code_required",Uo="auth_code_or_nativeAccountId_required",xo="spa_code_and_nativeAccountId_present",Rr="database_unavailable",Bo="unable_to_acquire_token_from_native_platform",Ho="native_handshake_timeout",$o="native_extension_not_installed",_r="native_connection_not_established",Zt="uninitialized_public_client_application",Go="native_prompt_not_supported",Ko="invalid_base64_string",zo="invalid_pop_token_request",kc="failed_to_build_headers",Oc="failed_to_parse_headers",jo="failed_to_decrypt_ear_response";var er="For more visit: aka.ms/msaljs/browser-errors",k={[Pn]:"The PKCE code challenge and verifier could not be generated.",[Bs]:"No EAR encryption key provided. This is unexpected.",[Ic]:"Server response does not contain ear_jwe property. This is unexpected.",[Nn]:"The crypto object or function is not available.",[At]:"Navigation URI is empty. Please check stack trace for more info.",[vo]:`Hash value cannot be processed because it is empty. Please verify that your redirectUri is not clearing the hash. ${er}`,[Ir]:"Hash does not contain state. Please verify that the request originated from msal.",[Eo]:`Hash does not contain known properites. Please verify that your redirectUri is not changing the hash.  ${er}`,[Ao]:"Unable to parse state. Please verify that the request originated from msal.",[To]:"Hash contains state but the interaction type does not match the caller.",[So]:`Interaction is currently in progress. Please ensure that this interaction has been completed before calling an interactive API.   ${er}`,[Io]:"Error opening popup window. This can happen if you are using IE or if popups are blocked in the browser.",[wo]:"window.open returned null or undefined window object.",[tt]:"User cancelled the flow.",[wc]:`Token acquisition in popup failed due to timeout.  ${er}`,[Ro]:`Token acquisition in iframe failed due to timeout.  ${er}`,[_o]:"Redirects are not supported for iframed or brokered applications. Please ensure you are using MSAL.js in a top frame of the window if using the redirect APIs, or use the popup APIs.",[Do]:`Request was blocked inside an iframe because MSAL detected an authentication response.  ${er}`,[bo]:"Request was blocked inside a popup because MSAL detected it was running in a popup.",[Rc]:"The iframe being monitored was closed prematurely.",[Tt]:"Silent logout not supported. Please call logoutRedirect or logoutPopup instead.",[ko]:"No account object provided to acquireTokenSilent and no active account has been set. Please call setActiveAccount or provide an account on the request.",[_c]:"The value given for the prompt value is not valid for silent requests - must be set to 'none' or 'no_session'.",[Oo]:"No token request found in cache.",[Mo]:"The cached token request could not be parsed.",[Dc]:"Auth Request not set. Please ensure initiateAuthRequest was called from the InteractionHandler",[bc]:"Invalid cache type",[St]:"Login and token requests are not supported in non-browser environments.",[It]:"Database is not open!",[Xt]:"No network connectivity. Check your internet connection.",[Po]:"Network request failed: If the browser threw a CORS error, check that the redirectUri is registered in the Azure App Portal as type 'SPA'",[No]:"Network request failed. Please check the network trace to determine root cause.",[Ln]:"Failed to parse network response. Check network trace.",[Lo]:"Error loading token to cache.",[wr]:"Cryptographic Key or Keypair not found in browser storage.",[Fo]:"An authorization code must be provided (as the `code` property on the request) to this flow.",[Uo]:"An authorization code or nativeAccountId must be provided to this flow.",[xo]:"Request cannot contain both spa code and native account id.",[Rr]:"IndexedDB, which is required for persistent cryptographic key storage, is unavailable. This may be caused by browser privacy features which block persistent storage in third-party contexts.",[Bo]:`Unable to acquire token from native platform.  ${er}`,[Ho]:"Timed out while attempting to establish connection to browser extension",[$o]:"Native extension is not installed. If you think this is a mistake call the initialize function.",[_r]:`Connection to native platform has not been established. Please install a compatible browser extension and run initialize().  ${er}`,[Zt]:`You must call and await the initialize function before attempting to call any other MSAL API.  ${er}`,[Go]:"The provided prompt is not supported by the native platform. This request should be routed to the web based flow.",[Ko]:"Invalid base64 encoded string.",[zo]:"Invalid PoP token request. The request should not have both a popKid value and signPopToken set to true.",[kc]:"Failed to build request headers object.",[Oc]:"Failed to parse response headers",[jo]:"Failed to decrypt ear response"},DD={pkceNotGenerated:{code:Pn,desc:k[Pn]},cryptoDoesNotExist:{code:Nn,desc:k[Nn]},emptyNavigateUriError:{code:At,desc:k[At]},hashEmptyError:{code:vo,desc:k[vo]},hashDoesNotContainStateError:{code:Ir,desc:k[Ir]},hashDoesNotContainKnownPropertiesError:{code:Eo,desc:k[Eo]},unableToParseStateError:{code:Ao,desc:k[Ao]},stateInteractionTypeMismatchError:{code:To,desc:k[To]},interactionInProgress:{code:So,desc:k[So]},popupWindowError:{code:Io,desc:k[Io]},emptyWindowError:{code:wo,desc:k[wo]},userCancelledError:{code:tt,desc:k[tt]},monitorPopupTimeoutError:{code:wc,desc:k[wc]},monitorIframeTimeoutError:{code:Ro,desc:k[Ro]},redirectInIframeError:{code:_o,desc:k[_o]},blockTokenRequestsInHiddenIframeError:{code:Do,desc:k[Do]},blockAcquireTokenInPopupsError:{code:bo,desc:k[bo]},iframeClosedPrematurelyError:{code:Rc,desc:k[Rc]},silentLogoutUnsupportedError:{code:Tt,desc:k[Tt]},noAccountError:{code:ko,desc:k[ko]},silentPromptValueError:{code:_c,desc:k[_c]},noTokenRequestCacheError:{code:Oo,desc:k[Oo]},unableToParseTokenRequestCacheError:{code:Mo,desc:k[Mo]},authRequestNotSet:{code:Dc,desc:k[Dc]},invalidCacheType:{code:bc,desc:k[bc]},notInBrowserEnvironment:{code:St,desc:k[St]},databaseNotOpen:{code:It,desc:k[It]},noNetworkConnectivity:{code:Xt,desc:k[Xt]},postRequestFailed:{code:Po,desc:k[Po]},getRequestFailed:{code:No,desc:k[No]},failedToParseNetworkResponse:{code:Ln,desc:k[Ln]},unableToLoadTokenError:{code:Lo,desc:k[Lo]},signingKeyNotFoundInStorage:{code:wr,desc:k[wr]},authCodeRequired:{code:Fo,desc:k[Fo]},authCodeOrNativeAccountRequired:{code:Uo,desc:k[Uo]},spaCodeAndNativeAccountPresent:{code:xo,desc:k[xo]},databaseUnavailable:{code:Rr,desc:k[Rr]},unableToAcquireTokenFromNativePlatform:{code:Bo,desc:k[Bo]},nativeHandshakeTimeout:{code:Ho,desc:k[Ho]},nativeExtensionNotInstalled:{code:$o,desc:k[$o]},nativeConnectionNotEstablished:{code:_r,desc:k[_r]},uninitializedPublicClientApplication:{code:Zt,desc:k[Zt]},nativePromptNotSupported:{code:Go,desc:k[Go]},invalidBase64StringError:{code:Ko,desc:k[Ko]},invalidPopTokenRequest:{code:zo,desc:k[zo]}},Fn=class n extends O{constructor(e,t){super(e,k[e],t),Object.setPrototypeOf(this,n.prototype),this.name="BrowserAuthError"}};function v(n,e){return new Fn(n,e)}var ee={INTERACTION_IN_PROGRESS_VALUE:"interaction_in_progress",INVALID_GRANT_ERROR:"invalid_grant",POPUP_WIDTH:483,POPUP_HEIGHT:600,POPUP_NAME_PREFIX:"msal",DEFAULT_POLL_INTERVAL_MS:30,MSAL_SKU:"msal.js.browser"},Dr={CHANNEL_ID:"53ee284d-920a-4b59-9d30-a60315b26836",PREFERRED_EXTENSION_ID:"ppnbnpeolgkicgegkbkbjmhlideopiji",MATS_TELEMETRY:"MATS"},tr={HandshakeRequest:"Handshake",HandshakeResponse:"HandshakeResponse",GetToken:"GetToken",Response:"Response"},q={LocalStorage:"localStorage",SessionStorage:"sessionStorage",MemoryStorage:"memoryStorage"},Nd={GET:"GET",POST:"POST"},rt={SIGNIN:"signin",SIGNOUT:"signout"},te={ORIGIN_URI:"request.origin",URL_HASH:"urlHash",REQUEST_PARAMS:"request.params",VERIFIER:"code.verifier",INTERACTION_STATUS_KEY:"interaction.status",NATIVE_REQUEST:"request.native"},nt={ACCOUNT_KEYS:"msal.account.keys",TOKEN_KEYS:"msal.token.keys"},Hs={WRAPPER_SKU:"wrapper.sku",WRAPPER_VER:"wrapper.version"},B={acquireTokenRedirect:861,acquireTokenPopup:862,ssoSilent:863,acquireTokenSilent_authCode:864,handleRedirectPromise:865,acquireTokenByCode:866,acquireTokenSilent_silentFlow:61,logout:961,logoutPopup:962},A=function(n){return n.Redirect="redirect",n.Popup="popup",n.Silent="silent",n.None="none",n}(A||{}),re={Startup:"startup",Login:"login",Logout:"logout",AcquireToken:"acquireToken",SsoSilent:"ssoSilent",HandleRedirect:"handleRedirect",None:"none"},Ld={scopes:Qe},Fd="jwk",Ud={React:"@azure/msal-react",Angular:"@azure/msal-angular"},Mc="msal.db",Sp=1,Ip=`${Mc}.keys`,fe={Default:0,AccessToken:1,AccessTokenAndRefreshToken:2,RefreshToken:3,RefreshTokenAndNetwork:4,Skip:5},wp=[fe.Default,fe.Skip,fe.RefreshTokenAndNetwork],Rp="msal.browser.log.level",_p="msal.browser.log.pii";function $s(n){return encodeURIComponent(br(n).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"))}function Ke(n){return Dp(n).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function br(n){return Dp(new TextEncoder().encode(n))}function Dp(n){let e=Array.from(n,t=>String.fromCodePoint(t)).join("");return btoa(e)}function ye(n){return new TextDecoder().decode(wt(n))}function wt(n){let e=n.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw v(Ko)}let t=atob(e);return Uint8Array.from(t,r=>r.codePointAt(0)||0)}var Gy="RSASSA-PKCS1-v1_5",qo="AES-GCM",Op="HKDF",Bd="SHA-256",Ky=2048,zy=new Uint8Array([1,0,1]),bp="0123456789abcdef",kp=new Uint32Array(1),Hd="raw",Mp="encrypt",$d="decrypt",jy="deriveKey",qy="crypto_subtle_undefined",Gd={name:Gy,hash:Bd,modulusLength:Ky,publicExponent:zy};function Pp(n){if(!window)throw v(St);if(!window.crypto)throw v(Nn);if(!n&&!window.crypto.subtle)throw v(Nn,qy)}function Kd(n,e,t){return d(this,null,function*(){e?.addQueueMeasurement(u.Sha256Digest,t);let o=new TextEncoder().encode(n);return window.crypto.subtle.digest(Bd,o)})}function Np(n){return window.crypto.getRandomValues(n)}function xd(){return window.crypto.getRandomValues(kp),kp[0]}function de(){let n=Date.now(),e=xd()*1024+(xd()&1023),t=new Uint8Array(16),r=Math.trunc(e/2**30),o=e&2**30-1,i=xd();t[0]=n/2**40,t[1]=n/2**32,t[2]=n/2**24,t[3]=n/2**16,t[4]=n/2**8,t[5]=n,t[6]=112|r>>>8,t[7]=r,t[8]=128|o>>>24,t[9]=o>>>16,t[10]=o>>>8,t[11]=o,t[12]=i>>>24,t[13]=i>>>16,t[14]=i>>>8,t[15]=i;let s="";for(let a=0;a<t.length;a++)s+=bp.charAt(t[a]>>>4),s+=bp.charAt(t[a]&15),(a===3||a===5||a===7||a===9)&&(s+="-");return s}function Lp(n,e){return d(this,null,function*(){return window.crypto.subtle.generateKey(Gd,n,e)})}function Pc(n){return d(this,null,function*(){return window.crypto.subtle.exportKey(Fd,n)})}function Fp(n,e,t){return d(this,null,function*(){return window.crypto.subtle.importKey(Fd,n,Gd,e,t)})}function Up(n,e){return d(this,null,function*(){return window.crypto.subtle.sign(Gd,n,e)})}function Vo(){return d(this,null,function*(){let n=yield zd(),t={alg:"dir",kty:"oct",k:Ke(new Uint8Array(n))};return br(JSON.stringify(t))})}function Vy(n){return d(this,null,function*(){let e=ye(n),r=JSON.parse(e).k,o=wt(r);return window.crypto.subtle.importKey(Hd,o,qo,!1,[$d])})}function xp(n,e){return d(this,null,function*(){let t=e.split(".");if(t.length!==5)throw v(jo,"jwe_length");let r=yield Vy(n).catch(()=>{throw v(jo,"import_key")});try{let o=new TextEncoder().encode(t[0]),i=wt(t[2]),s=wt(t[3]),a=wt(t[4]),c=a.byteLength*8,l=new Uint8Array(s.length+a.length);l.set(s),l.set(a,s.length);let h=yield window.crypto.subtle.decrypt({name:qo,iv:i,tagLength:c,additionalData:o},r,l);return new TextDecoder().decode(h)}catch{throw v(jo,"decrypt")}})}function zd(){return d(this,null,function*(){let n=yield window.crypto.subtle.generateKey({name:qo,length:256},!0,[Mp,$d]);return window.crypto.subtle.exportKey(Hd,n)})}function jd(n){return d(this,null,function*(){return window.crypto.subtle.importKey(Hd,n,Op,!1,[jy])})}function Bp(n,e,t){return d(this,null,function*(){return window.crypto.subtle.deriveKey({name:Op,salt:e,hash:Bd,info:new TextEncoder().encode(t)},n,{name:qo,length:256},!1,[Mp,$d])})}function Hp(n,e,t){return d(this,null,function*(){let r=new TextEncoder().encode(e),o=window.crypto.getRandomValues(new Uint8Array(16)),i=yield Bp(n,o,t),s=yield window.crypto.subtle.encrypt({name:qo,iv:new Uint8Array(12)},i,r);return{data:Ke(new Uint8Array(s)),nonce:Ke(o)}})}function $p(n,e,t,r){return d(this,null,function*(){let o=wt(r),i=yield Bp(n,wt(e),t),s=yield window.crypto.subtle.decrypt({name:qo,iv:new Uint8Array(12)},i,o);return new TextDecoder().decode(s)})}function Nc(n){return d(this,null,function*(){let e=yield Kd(n),t=new Uint8Array(e);return Ke(t)})}var kr="storage_not_supported",Lc="stubbed_public_client_application_called",Wo="in_mem_redirect_unavailable";var Fc={[kr]:"Given storage configuration option was not supported.",[Lc]:"Stub instance of Public Client Application was called. If using msal-react, please ensure context is not used without a provider. For more visit: aka.ms/msaljs/browser-errors",[Wo]:"Redirect cannot be supported. In-memory storage was selected and storeAuthStateInCookie=false, which would cause the library to be unable to handle the incoming hash. If you would like to use the redirect API, please use session/localStorage or set storeAuthStateInCookie=true."},Wy={storageNotSupportedError:{code:kr,desc:Fc[kr]},stubPcaInstanceCalled:{code:Lc,desc:Fc[Lc]},inMemRedirectUnavailable:{code:Wo,desc:Fc[Wo]}},Un=class n extends O{constructor(e,t){super(e,t),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,n.prototype)}};function Yo(n){return new Un(n,Fc[n])}function Gs(n){n.location.hash="",typeof n.history.replaceState=="function"&&n.history.replaceState(null,"",`${n.location.origin}${n.location.pathname}${n.location.search}`)}function qd(n){let e=n.split("#");e.shift(),window.location.hash=e.length>0?e.join("#"):""}function Ks(){return window.parent!==window}function Gp(){return typeof window<"u"&&!!window.opener&&window.opener!==window&&typeof window.name=="string"&&window.name.indexOf(`${ee.POPUP_NAME_PREFIX}.`)===0}function Se(){return typeof window<"u"&&window.location?window.location.href.split("?")[0].split("#")[0]:""}function Vd(){let e=new b(window.location.href).getUrlComponents();return`${e.Protocol}//${e.HostNameAndPort}/`}function Kp(){if(b.hashContainsKnownProperties(window.location.hash)&&Ks())throw v(Do)}function zp(n){if(Ks()&&!n)throw v(_o)}function jp(){if(Gp())throw v(bo)}function Uc(){if(typeof window>"u")throw v(St)}function xc(n){if(!n)throw v(Zt)}function zs(n){Uc(),Kp(),jp(),xc(n)}function Bc(n,e){if(zs(n),zp(e.system.allowRedirectInIframe),e.cache.cacheLocation===q.MemoryStorage&&!e.cache.storeAuthStateInCookie)throw Yo(Wo)}function js(n){let e=document.createElement("link");e.rel="preconnect",e.href=new URL(n).origin,e.crossOrigin="anonymous",document.head.appendChild(e),window.setTimeout(()=>{try{document.head.removeChild(e)}catch{}},1e4)}function Wd(){return de()}var qs=class n{navigateInternal(e,t){return n.defaultNavigateWindow(e,t)}navigateExternal(e,t){return n.defaultNavigateWindow(e,t)}static defaultNavigateWindow(e,t){return t.noHistory?window.location.replace(e):window.location.assign(e),new Promise(r=>{setTimeout(()=>{r(!0)},t.timeout)})}};var $c=class{sendGetRequestAsync(e,t){return d(this,null,function*(){let r,o={},i=0,s=qp(t);try{r=yield fetch(e,{method:Nd.GET,headers:s})}catch(a){throw kn(v(window.navigator.onLine?No:Xt),void 0,void 0,a)}o=Vp(r.headers);try{return i=r.status,{headers:o,body:yield r.json(),status:i}}catch(a){throw kn(v(Ln),i,o,a)}})}sendPostRequestAsync(e,t){return d(this,null,function*(){let r=t&&t.body||"",o=qp(t),i,s=0,a={};try{i=yield fetch(e,{method:Nd.POST,headers:o,body:r})}catch(c){throw kn(v(window.navigator.onLine?Po:Xt),void 0,void 0,c)}a=Vp(i.headers);try{return s=i.status,{headers:a,body:yield i.json(),status:s}}catch(c){throw kn(v(Ln),s,a,c)}})}};function qp(n){try{let e=new Headers;if(!(n&&n.headers))return e;let t=n.headers;return Object.entries(t).forEach(([r,o])=>{e.append(r,o)}),e}catch(e){throw kn(v(kc),void 0,void 0,e)}}function Vp(n){try{let e={};return n.forEach((t,r)=>{e[r]=t}),e}catch{throw v(Oc)}}var Yy=6e4,Gc=1e4,Qy=3e4,Jy=2e3;function Wp({auth:n,cache:e,system:t,telemetry:r},o){let i={clientId:g.EMPTY_STRING,authority:`${g.DEFAULT_AUTHORITY}`,knownAuthorities:[],cloudDiscoveryMetadata:g.EMPTY_STRING,authorityMetadata:g.EMPTY_STRING,redirectUri:typeof window<"u"?Se():"",postLogoutRedirectUri:g.EMPTY_STRING,navigateToLoginRequestUrl:!0,clientCapabilities:[],protocolMode:Z.AAD,OIDCOptions:{serverResponseType:pt.FRAGMENT,defaultScopes:[g.OPENID_SCOPE,g.PROFILE_SCOPE,g.OFFLINE_ACCESS_SCOPE]},azureCloudOptions:{azureCloudInstance:Cr.None,tenant:g.EMPTY_STRING},skipAuthorityMetadataCache:!1,supportsNestedAppAuth:!1,instanceAware:!1,encodeExtraQueryParams:!1},s={cacheLocation:q.SessionStorage,temporaryCacheLocation:q.SessionStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!!(e&&e.cacheLocation===q.LocalStorage),claimsBasedCachingEnabled:!1},a={loggerCallback:()=>{},logLevel:G.Info,piiLoggingEnabled:!1},c=T(f({},sc),{loggerOptions:a,networkClient:o?new $c:Od,navigationClient:new qs,loadFrameTimeout:0,windowHashTimeout:t?.loadFrameTimeout||Yy,iframeHashTimeout:t?.loadFrameTimeout||Gc,navigateFrameWait:0,redirectNavigationTimeout:Qy,asyncPopups:!1,allowRedirectInIframe:!1,allowPlatformBroker:!1,nativeBrokerHandshakeTimeout:t?.nativeBrokerHandshakeTimeout||Jy,pollIntervalMilliseconds:ee.DEFAULT_POLL_INTERVAL_MS}),l=T(f(f({},c),t),{loggerOptions:t?.loggerOptions||a}),h={application:{appName:g.EMPTY_STRING,appVersion:g.EMPTY_STRING},client:new yo};if(n?.protocolMode!==Z.OIDC&&n?.OIDCOptions&&new _e(l.loggerOptions).warning(JSON.stringify(F(xe.cannotSetOIDCOptions))),n?.protocolMode&&n.protocolMode===Z.OIDC&&l?.allowPlatformBroker)throw F(xe.cannotAllowPlatformBroker);return{auth:T(f(f({},i),n),{OIDCOptions:f(f({},i.OIDCOptions),n?.OIDCOptions)}),cache:f(f({},s),e),system:l,telemetry:f(f({},h),r)}}var Yp="@azure/msal-browser",Rt="4.12.0";var Kc=class n{static loggerCallback(e,t){switch(e){case G.Error:console.error(t);return;case G.Info:console.info(t);return;case G.Verbose:console.debug(t);return;case G.Warning:console.warn(t);return;default:console.log(t);return}}constructor(e){this.browserEnvironment=typeof window<"u",this.config=Wp(e,this.browserEnvironment);let t;try{t=window[q.SessionStorage]}catch{}let r=t?.getItem(Rp),o=t?.getItem(_p)?.toLowerCase(),i=o==="true"?!0:o==="false"?!1:void 0,s=f({},this.config.system.loggerOptions),a=r&&Object.keys(G).includes(r)?G[r]:void 0;a&&(s.loggerCallback=n.loggerCallback,s.logLevel=a),i!==void 0&&(s.piiLoggingEnabled=i),this.logger=new _e(s,Yp,Rt),this.available=!1}getConfig(){return this.config}getLogger(){return this.logger}isAvailable(){return this.available}isBrowserEnvironment(){return this.browserEnvironment}};var zc=(()=>{class n extends Kc{getModuleName(){return n.MODULE_NAME}getId(){return n.ID}initialize(){return d(this,null,function*(){return this.available=typeof window<"u",this.available})}}return n.MODULE_NAME="",n.ID="StandardOperatingContext",n})();var jc=class{constructor(){this.dbName=Mc,this.version=Sp,this.tableName=Ip,this.dbOpen=!1}open(){return d(this,null,function*(){return new Promise((e,t)=>{let r=window.indexedDB.open(this.dbName,this.version);r.addEventListener("upgradeneeded",o=>{o.target.result.createObjectStore(this.tableName)}),r.addEventListener("success",o=>{let i=o;this.db=i.target.result,this.dbOpen=!0,e()}),r.addEventListener("error",()=>t(v(Rr)))})})}closeConnection(){let e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)}validateDbIsOpen(){return d(this,null,function*(){if(!this.dbOpen)return this.open()})}getItem(e){return d(this,null,function*(){return yield this.validateDbIsOpen(),new Promise((t,r)=>{if(!this.db)return r(v(It));let s=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).get(e);s.addEventListener("success",a=>{let c=a;this.closeConnection(),t(c.target.result)}),s.addEventListener("error",a=>{this.closeConnection(),r(a)})})})}setItem(e,t){return d(this,null,function*(){return yield this.validateDbIsOpen(),new Promise((r,o)=>{if(!this.db)return o(v(It));let a=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).put(t,e);a.addEventListener("success",()=>{this.closeConnection(),r()}),a.addEventListener("error",c=>{this.closeConnection(),o(c)})})})}removeItem(e){return d(this,null,function*(){return yield this.validateDbIsOpen(),new Promise((t,r)=>{if(!this.db)return r(v(It));let s=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).delete(e);s.addEventListener("success",()=>{this.closeConnection(),t()}),s.addEventListener("error",a=>{this.closeConnection(),r(a)})})})}getKeys(){return d(this,null,function*(){return yield this.validateDbIsOpen(),new Promise((e,t)=>{if(!this.db)return t(v(It));let i=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).getAllKeys();i.addEventListener("success",s=>{let a=s;this.closeConnection(),e(a.target.result)}),i.addEventListener("error",s=>{this.closeConnection(),t(s)})})})}containsKey(e){return d(this,null,function*(){return yield this.validateDbIsOpen(),new Promise((t,r)=>{if(!this.db)return r(v(It));let s=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).count(e);s.addEventListener("success",a=>{let c=a;this.closeConnection(),t(c.target.result===1)}),s.addEventListener("error",a=>{this.closeConnection(),r(a)})})})}deleteDatabase(){return d(this,null,function*(){return this.db&&this.dbOpen&&this.closeConnection(),new Promise((e,t)=>{let r=window.indexedDB.deleteDatabase(Mc),o=setTimeout(()=>t(!1),200);r.addEventListener("success",()=>(clearTimeout(o),e(!0))),r.addEventListener("blocked",()=>(clearTimeout(o),e(!0))),r.addEventListener("error",()=>(clearTimeout(o),t(!1)))})})}};var rr=class{constructor(){this.cache=new Map}initialize(){return d(this,null,function*(){})}getItem(e){return this.cache.get(e)||null}getUserData(e){return this.getItem(e)}setItem(e,t){this.cache.set(e,t)}setUserData(e,t){return d(this,null,function*(){this.setItem(e,t)})}removeItem(e){this.cache.delete(e)}getKeys(){let e=[];return this.cache.forEach((t,r)=>{e.push(r)}),e}containsKey(e){return this.cache.has(e)}clear(){this.cache.clear()}};var qc=class{constructor(e){this.inMemoryCache=new rr,this.indexedDBCache=new jc,this.logger=e}handleDatabaseAccessError(e){if(e instanceof Fn&&e.errorCode===Rr)this.logger.error("Could not access persistent storage. This may be caused by browser privacy features which block persistent storage in third-party contexts.");else throw e}getItem(e){return d(this,null,function*(){let t=this.inMemoryCache.getItem(e);if(!t)try{return this.logger.verbose("Queried item not found in in-memory cache, now querying persistent storage."),yield this.indexedDBCache.getItem(e)}catch(r){this.handleDatabaseAccessError(r)}return t})}setItem(e,t){return d(this,null,function*(){this.inMemoryCache.setItem(e,t);try{yield this.indexedDBCache.setItem(e,t)}catch(r){this.handleDatabaseAccessError(r)}})}removeItem(e){return d(this,null,function*(){this.inMemoryCache.removeItem(e);try{yield this.indexedDBCache.removeItem(e)}catch(t){this.handleDatabaseAccessError(t)}})}getKeys(){return d(this,null,function*(){let e=this.inMemoryCache.getKeys();if(e.length===0)try{return this.logger.verbose("In-memory cache is empty, now querying persistent storage."),yield this.indexedDBCache.getKeys()}catch(t){this.handleDatabaseAccessError(t)}return e})}containsKey(e){return d(this,null,function*(){let t=this.inMemoryCache.containsKey(e);if(!t)try{return this.logger.verbose("Key not found in in-memory cache, now querying persistent storage."),yield this.indexedDBCache.containsKey(e)}catch(r){this.handleDatabaseAccessError(r)}return t})}clearInMemory(){this.logger.verbose("Deleting in-memory keystore"),this.inMemoryCache.clear(),this.logger.verbose("In-memory keystore deleted")}clearPersistent(){return d(this,null,function*(){try{this.logger.verbose("Deleting persistent keystore");let e=yield this.indexedDBCache.deleteDatabase();return e&&this.logger.verbose("Persistent keystore deleted"),e}catch(e){return this.handleDatabaseAccessError(e),!1}})}};var Qo=(()=>{class n{constructor(t,r,o){this.logger=t,Pp(o??!1),this.cache=new qc(this.logger),this.performanceClient=r}createNewGuid(){return de()}base64Encode(t){return br(t)}base64Decode(t){return ye(t)}base64UrlEncode(t){return $s(t)}encodeKid(t){return this.base64UrlEncode(JSON.stringify({kid:t}))}getPublicKeyThumbprint(t){return d(this,null,function*(){let r=this.performanceClient?.startMeasurement(u.CryptoOptsGetPublicKeyThumbprint,t.correlationId),o=yield Lp(n.EXTRACTABLE,n.POP_KEY_USAGES),i=yield Pc(o.publicKey),s={e:i.e,kty:i.kty,n:i.n},a=Qp(s),c=yield this.hashString(a),l=yield Pc(o.privateKey),h=yield Fp(l,!1,["sign"]);return yield this.cache.setItem(c,{privateKey:h,publicKey:o.publicKey,requestMethod:t.resourceRequestMethod,requestUri:t.resourceRequestUri}),r&&r.end({success:!0}),c})}removeTokenBindingKey(t){return d(this,null,function*(){return yield this.cache.removeItem(t),!(yield this.cache.containsKey(t))})}clearKeystore(){return d(this,null,function*(){this.cache.clearInMemory();try{return yield this.cache.clearPersistent(),!0}catch(t){return t instanceof Error?this.logger.error(`Clearing keystore failed with error: ${t.message}`):this.logger.error("Clearing keystore failed with unknown error"),!1}})}signJwt(t,r,o,i){return d(this,null,function*(){let s=this.performanceClient?.startMeasurement(u.CryptoOptsSignJwt,i),a=yield this.cache.getItem(r);if(!a)throw v(wr);let c=yield Pc(a.publicKey),l=Qp(c),h=$s(JSON.stringify({kid:r})),m=xs.getShrHeaderString(T(f({},o?.header),{alg:c.alg,kid:h})),y=$s(m);t.cnf={jwk:JSON.parse(l)};let S=$s(JSON.stringify(t)),_=`${y}.${S}`,V=new TextEncoder().encode(_),ve=yield Up(a.privateKey,V),Dt=Ke(new Uint8Array(ve)),je=`${_}.${Dt}`;return s&&s.end({success:!0}),je})}hashString(t){return d(this,null,function*(){return Nc(t)})}}return n.POP_KEY_USAGES=["sign","verify"],n.EXTRACTABLE=!0,n})();function Qp(n){return JSON.stringify(n,Object.keys(n).sort())}var Xy=24*60*60*1e3,Vc={Lax:"Lax",None:"None"},Jo=class{initialize(){return Promise.resolve()}getItem(e){let t=`${encodeURIComponent(e)}`,r=document.cookie.split(";");for(let o=0;o<r.length;o++){let i=r[o],[s,...a]=decodeURIComponent(i).trim().split("="),c=a.join("=");if(s===t)return c}return""}getUserData(){throw C(ae.methodNotImplemented)}setItem(e,t,r,o=!0,i=Vc.Lax){let s=`${encodeURIComponent(e)}=${encodeURIComponent(t)};path=/;SameSite=${i};`;if(r){let a=Zy(r);s+=`expires=${a};`}(o||i===Vc.None)&&(s+="Secure;"),document.cookie=s}setUserData(){return d(this,null,function*(){return Promise.reject(C(ae.methodNotImplemented))})}removeItem(e){this.setItem(e,"",-1)}getKeys(){let e=document.cookie.split(";"),t=[];return e.forEach(r=>{let o=decodeURIComponent(r).trim().split("=");t.push(o[0])}),t}containsKey(e){return this.getKeys().includes(e)}};function Zy(n){let e=new Date;return new Date(e.getTime()+n*Xy).toUTCString()}function Vs(n){let e=n.getItem(nt.ACCOUNT_KEYS);return e?JSON.parse(e):[]}function Ws(n,e){let t=e.getItem(`${nt.TOKEN_KEYS}.${n}`);if(t){let r=JSON.parse(t);if(r&&r.hasOwnProperty("idToken")&&r.hasOwnProperty("accessToken")&&r.hasOwnProperty("refreshToken"))return r}return{idToken:[],accessToken:[],refreshToken:[]}}var Jp="msal.cache.encryption",ev="msal.broadcast.cache",Wc=class{constructor(e,t,r){if(!window.localStorage)throw Yo(kr);this.memoryStorage=new rr,this.initialized=!1,this.clientId=e,this.logger=t,this.performanceClient=r,this.broadcast=new BroadcastChannel(ev)}initialize(e){return d(this,null,function*(){let t=new Jo,r=t.getItem(Jp),o={key:"",id:""};if(r)try{o=JSON.parse(r)}catch{}if(o.key&&o.id){let i=ce(wt,u.Base64Decode,this.logger,this.performanceClient,e)(o.key);this.encryptionCookie={id:o.id,key:yield p(jd,u.GenerateHKDF,this.logger,this.performanceClient,e)(i)},yield p(this.importExistingCache.bind(this),u.ImportExistingCache,this.logger,this.performanceClient,e)(e)}else{this.clear();let i=de(),s=yield p(zd,u.GenerateBaseKey,this.logger,this.performanceClient,e)(),a=ce(Ke,u.UrlEncodeArr,this.logger,this.performanceClient,e)(new Uint8Array(s));this.encryptionCookie={id:i,key:yield p(jd,u.GenerateHKDF,this.logger,this.performanceClient,e)(s)};let c={id:i,key:a};t.setItem(Jp,JSON.stringify(c),0,!0,Vc.None)}this.broadcast.addEventListener("message",this.updateCache.bind(this)),this.initialized=!0})}getItem(e){return window.localStorage.getItem(e)}getUserData(e){if(!this.initialized)throw v(Zt);return this.memoryStorage.getItem(e)}setItem(e,t){window.localStorage.setItem(e,t)}setUserData(e,t,r){return d(this,null,function*(){if(!this.initialized||!this.encryptionCookie)throw v(Zt);let{data:o,nonce:i}=yield p(Hp,u.Encrypt,this.logger,this.performanceClient,r)(this.encryptionCookie.key,t,this.getContext(e)),s={id:this.encryptionCookie.id,nonce:i,data:o};this.memoryStorage.setItem(e,t),this.setItem(e,JSON.stringify(s)),this.broadcast.postMessage({key:e,value:t,context:this.getContext(e)})})}removeItem(e){this.memoryStorage.containsKey(e)&&(this.memoryStorage.removeItem(e),this.broadcast.postMessage({key:e,value:null,context:this.getContext(e)})),window.localStorage.removeItem(e)}getKeys(){return Object.keys(window.localStorage)}containsKey(e){return window.localStorage.hasOwnProperty(e)}clear(){this.memoryStorage.clear(),Vs(this).forEach(r=>this.removeItem(r));let t=Ws(this.clientId,this);t.idToken.forEach(r=>this.removeItem(r)),t.accessToken.forEach(r=>this.removeItem(r)),t.refreshToken.forEach(r=>this.removeItem(r)),this.getKeys().forEach(r=>{(r.startsWith(g.CACHE_PREFIX)||r.indexOf(this.clientId)!==-1)&&this.removeItem(r)})}importExistingCache(e){return d(this,null,function*(){if(!this.encryptionCookie)return;let t=Vs(this);t=yield this.importArray(t,e),this.setItem(nt.ACCOUNT_KEYS,JSON.stringify(t));let r=Ws(this.clientId,this);r.idToken=yield this.importArray(r.idToken,e),r.accessToken=yield this.importArray(r.accessToken,e),r.refreshToken=yield this.importArray(r.refreshToken,e),this.setItem(`${nt.TOKEN_KEYS}.${this.clientId}`,JSON.stringify(r))})}getItemFromEncryptedCache(e,t){return d(this,null,function*(){if(!this.encryptionCookie)return null;let r=this.getItem(e);if(!r)return null;let o;try{o=JSON.parse(r)}catch{return null}return!o.id||!o.nonce||!o.data?(this.performanceClient.incrementFields({unencryptedCacheCount:1},t),null):o.id!==this.encryptionCookie.id?(this.performanceClient.incrementFields({encryptedCacheExpiredCount:1},t),null):p($p,u.Decrypt,this.logger,this.performanceClient,t)(this.encryptionCookie.key,o.nonce,this.getContext(e),o.data)})}importArray(e,t){return d(this,null,function*(){let r=[],o=[];return e.forEach(i=>{let s=this.getItemFromEncryptedCache(i,t).then(a=>{a?(this.memoryStorage.setItem(i,a),r.push(i)):this.removeItem(i)});o.push(s)}),yield Promise.all(o),r})}getContext(e){let t="";return e.includes(this.clientId)&&(t=this.clientId),t}updateCache(e){this.logger.trace("Updating internal cache from broadcast event");let t=this.performanceClient.startMeasurement(u.LocalStorageUpdated);t.add({isBackground:!0});let{key:r,value:o,context:i}=e.data;if(!r){this.logger.error("Broadcast event missing key"),t.end({success:!1,errorCode:"noKey"});return}if(i&&i!==this.clientId){this.logger.trace(`Ignoring broadcast event from clientId: ${i}`),t.end({success:!1,errorCode:"contextMismatch"});return}o?(this.memoryStorage.setItem(r,o),this.logger.verbose("Updated item in internal cache")):(this.memoryStorage.removeItem(r),this.logger.verbose("Removed item from internal cache")),t.end({success:!0})}};var Yc=class{constructor(){if(!window.sessionStorage)throw Yo(kr)}initialize(){return d(this,null,function*(){})}getItem(e){return window.sessionStorage.getItem(e)}getUserData(e){return this.getItem(e)}setItem(e,t){window.sessionStorage.setItem(e,t)}setUserData(e,t){return d(this,null,function*(){this.setItem(e,t)})}removeItem(e){window.sessionStorage.removeItem(e)}getKeys(){return Object.keys(window.sessionStorage)}containsKey(e){return window.sessionStorage.hasOwnProperty(e)}};var E={INITIALIZE_START:"msal:initializeStart",INITIALIZE_END:"msal:initializeEnd",ACCOUNT_ADDED:"msal:accountAdded",ACCOUNT_REMOVED:"msal:accountRemoved",ACTIVE_ACCOUNT_CHANGED:"msal:activeAccountChanged",LOGIN_START:"msal:loginStart",LOGIN_SUCCESS:"msal:loginSuccess",LOGIN_FAILURE:"msal:loginFailure",ACQUIRE_TOKEN_START:"msal:acquireTokenStart",ACQUIRE_TOKEN_SUCCESS:"msal:acquireTokenSuccess",ACQUIRE_TOKEN_FAILURE:"msal:acquireTokenFailure",ACQUIRE_TOKEN_NETWORK_START:"msal:acquireTokenFromNetworkStart",SSO_SILENT_START:"msal:ssoSilentStart",SSO_SILENT_SUCCESS:"msal:ssoSilentSuccess",SSO_SILENT_FAILURE:"msal:ssoSilentFailure",ACQUIRE_TOKEN_BY_CODE_START:"msal:acquireTokenByCodeStart",ACQUIRE_TOKEN_BY_CODE_SUCCESS:"msal:acquireTokenByCodeSuccess",ACQUIRE_TOKEN_BY_CODE_FAILURE:"msal:acquireTokenByCodeFailure",HANDLE_REDIRECT_START:"msal:handleRedirectStart",HANDLE_REDIRECT_END:"msal:handleRedirectEnd",POPUP_OPENED:"msal:popupOpened",LOGOUT_START:"msal:logoutStart",LOGOUT_SUCCESS:"msal:logoutSuccess",LOGOUT_FAILURE:"msal:logoutFailure",LOGOUT_END:"msal:logoutEnd",RESTORE_FROM_BFCACHE:"msal:restoreFromBFCache"};var Xo=class n extends Tn{constructor(e,t,r,o,i,s,a){super(e,r,o,a),this.cacheConfig=t,this.logger=o,this.internalStorage=new rr,this.browserStorage=Xp(e,t.cacheLocation,o,i),this.temporaryCacheStorage=Xp(e,t.temporaryCacheLocation,o,i),this.cookieStorage=new Jo,this.performanceClient=i,this.eventHandler=s}initialize(e){return d(this,null,function*(){yield this.browserStorage.initialize(e)})}validateAndParseJson(e){try{let t=JSON.parse(e);return t&&typeof t=="object"?t:null}catch{return null}}getAccount(e){this.logger.trace("BrowserCacheManager.getAccount called");let t=this.browserStorage.getUserData(e);if(!t)return this.removeAccountKeyFromMap(e),null;let r=this.validateAndParseJson(t);return!r||!oe.isAccountEntity(r)?(this.removeAccountKeyFromMap(e),null):Tn.toObject(new oe,r)}setAccount(e,t){return d(this,null,function*(){this.logger.trace("BrowserCacheManager.setAccount called");let r=e.generateAccountKey();yield p(this.browserStorage.setUserData.bind(this.browserStorage),u.SetUserData,this.logger,this.performanceClient)(r,JSON.stringify(e),t);let o=this.addAccountKeyToMap(r);this.cacheConfig.cacheLocation===q.LocalStorage&&o&&this.eventHandler.emitEvent(E.ACCOUNT_ADDED,void 0,e.getAccountInfo())})}getAccountKeys(){return Vs(this.browserStorage)}addAccountKeyToMap(e){this.logger.trace("BrowserCacheManager.addAccountKeyToMap called"),this.logger.tracePii(`BrowserCacheManager.addAccountKeyToMap called with key: ${e}`);let t=this.getAccountKeys();return t.indexOf(e)===-1?(t.push(e),this.browserStorage.setItem(nt.ACCOUNT_KEYS,JSON.stringify(t)),this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key added"),!0):(this.logger.verbose("BrowserCacheManager.addAccountKeyToMap account key already exists in map"),!1)}removeAccountKeyFromMap(e){this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap called"),this.logger.tracePii(`BrowserCacheManager.removeAccountKeyFromMap called with key: ${e}`);let t=this.getAccountKeys(),r=t.indexOf(e);r>-1?(t.splice(r,1),this.browserStorage.setItem(nt.ACCOUNT_KEYS,JSON.stringify(t)),this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap account key removed")):this.logger.trace("BrowserCacheManager.removeAccountKeyFromMap key not found in existing map")}removeAccount(e){return d(this,null,function*(){Bn(n.prototype,this,"removeAccount").call(this,e),this.removeAccountKeyFromMap(e)})}removeAccountContext(e){return d(this,null,function*(){yield Bn(n.prototype,this,"removeAccountContext").call(this,e),this.cacheConfig.cacheLocation===q.LocalStorage&&this.eventHandler.emitEvent(E.ACCOUNT_REMOVED,void 0,e.getAccountInfo())})}removeIdToken(e){super.removeIdToken(e),this.removeTokenKey(e,D.ID_TOKEN)}removeAccessToken(e){return d(this,null,function*(){Bn(n.prototype,this,"removeAccessToken").call(this,e),this.removeTokenKey(e,D.ACCESS_TOKEN)})}removeRefreshToken(e){super.removeRefreshToken(e),this.removeTokenKey(e,D.REFRESH_TOKEN)}getTokenKeys(){return Ws(this.clientId,this.browserStorage)}addTokenKey(e,t){this.logger.trace("BrowserCacheManager addTokenKey called");let r=this.getTokenKeys();switch(t){case D.ID_TOKEN:r.idToken.indexOf(e)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - idToken added to map"),r.idToken.push(e));break;case D.ACCESS_TOKEN:r.accessToken.indexOf(e)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - accessToken added to map"),r.accessToken.push(e));break;case D.REFRESH_TOKEN:r.refreshToken.indexOf(e)===-1&&(this.logger.info("BrowserCacheManager: addTokenKey - refreshToken added to map"),r.refreshToken.push(e));break;default:throw this.logger.error(`BrowserCacheManager:addTokenKey - CredentialType provided invalid. CredentialType: ${t}`),C(ae.unexpectedCredentialType)}this.browserStorage.setItem(`${nt.TOKEN_KEYS}.${this.clientId}`,JSON.stringify(r))}removeTokenKey(e,t){this.logger.trace("BrowserCacheManager removeTokenKey called");let r=this.getTokenKeys();switch(t){case D.ID_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove idToken with key: ${e} from map`);let o=r.idToken.indexOf(e);o>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - idToken removed from map"),r.idToken.splice(o,1)):this.logger.info("BrowserCacheManager: removeTokenKey - idToken does not exist in map. Either it was previously removed or it was never added.");break;case D.ACCESS_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove accessToken with key: ${e} from map`);let i=r.accessToken.indexOf(e);i>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - accessToken removed from map"),r.accessToken.splice(i,1)):this.logger.info("BrowserCacheManager: removeTokenKey - accessToken does not exist in map. Either it was previously removed or it was never added.");break;case D.REFRESH_TOKEN:this.logger.infoPii(`BrowserCacheManager: removeTokenKey - attempting to remove refreshToken with key: ${e} from map`);let s=r.refreshToken.indexOf(e);s>-1?(this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken removed from map"),r.refreshToken.splice(s,1)):this.logger.info("BrowserCacheManager: removeTokenKey - refreshToken does not exist in map. Either it was previously removed or it was never added.");break;default:throw this.logger.error(`BrowserCacheManager:removeTokenKey - CredentialType provided invalid. CredentialType: ${t}`),C(ae.unexpectedCredentialType)}this.browserStorage.setItem(`${nt.TOKEN_KEYS}.${this.clientId}`,JSON.stringify(r))}getIdTokenCredential(e){let t=this.browserStorage.getUserData(e);if(!t)return this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeTokenKey(e,D.ID_TOKEN),null;let r=this.validateAndParseJson(t);return!r||!Q.isIdTokenEntity(r)?(this.logger.trace("BrowserCacheManager.getIdTokenCredential: called, no cache hit"),this.removeTokenKey(e,D.ID_TOKEN),null):(this.logger.trace("BrowserCacheManager.getIdTokenCredential: cache hit"),r)}setIdTokenCredential(e,t){return d(this,null,function*(){this.logger.trace("BrowserCacheManager.setIdTokenCredential called");let r=Q.generateCredentialKey(e);yield p(this.browserStorage.setUserData.bind(this.browserStorage),u.SetUserData,this.logger,this.performanceClient)(r,JSON.stringify(e),t),this.addTokenKey(r,D.ID_TOKEN)})}getAccessTokenCredential(e){let t=this.browserStorage.getUserData(e);if(!t)return this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,D.ACCESS_TOKEN),null;let r=this.validateAndParseJson(t);return!r||!Q.isAccessTokenEntity(r)?(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: called, no cache hit"),this.removeTokenKey(e,D.ACCESS_TOKEN),null):(this.logger.trace("BrowserCacheManager.getAccessTokenCredential: cache hit"),r)}setAccessTokenCredential(e,t){return d(this,null,function*(){this.logger.trace("BrowserCacheManager.setAccessTokenCredential called");let r=Q.generateCredentialKey(e);yield p(this.browserStorage.setUserData.bind(this.browserStorage),u.SetUserData,this.logger,this.performanceClient)(r,JSON.stringify(e),t),this.addTokenKey(r,D.ACCESS_TOKEN)})}getRefreshTokenCredential(e){let t=this.browserStorage.getUserData(e);if(!t)return this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,D.REFRESH_TOKEN),null;let r=this.validateAndParseJson(t);return!r||!Q.isRefreshTokenEntity(r)?(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: called, no cache hit"),this.removeTokenKey(e,D.REFRESH_TOKEN),null):(this.logger.trace("BrowserCacheManager.getRefreshTokenCredential: cache hit"),r)}setRefreshTokenCredential(e,t){return d(this,null,function*(){this.logger.trace("BrowserCacheManager.setRefreshTokenCredential called");let r=Q.generateCredentialKey(e);yield p(this.browserStorage.setUserData.bind(this.browserStorage),u.SetUserData,this.logger,this.performanceClient)(r,JSON.stringify(e),t),this.addTokenKey(r,D.REFRESH_TOKEN)})}getAppMetadata(e){let t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null;let r=this.validateAndParseJson(t);return!r||!Q.isAppMetadataEntity(e,r)?(this.logger.trace("BrowserCacheManager.getAppMetadata: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getAppMetadata: cache hit"),r)}setAppMetadata(e){this.logger.trace("BrowserCacheManager.setAppMetadata called");let t=Q.generateAppMetadataKey(e);this.browserStorage.setItem(t,JSON.stringify(e))}getServerTelemetry(e){let t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null;let r=this.validateAndParseJson(t);return!r||!Q.isServerTelemetryEntity(e,r)?(this.logger.trace("BrowserCacheManager.getServerTelemetry: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getServerTelemetry: cache hit"),r)}setServerTelemetry(e,t){this.logger.trace("BrowserCacheManager.setServerTelemetry called"),this.browserStorage.setItem(e,JSON.stringify(t))}getAuthorityMetadata(e){let t=this.internalStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getAuthorityMetadata: called, no cache hit"),null;let r=this.validateAndParseJson(t);return r&&Q.isAuthorityMetadataEntity(e,r)?(this.logger.trace("BrowserCacheManager.getAuthorityMetadata: cache hit"),r):null}getAuthorityMetadataKeys(){return this.internalStorage.getKeys().filter(t=>this.isAuthorityMetadata(t))}setWrapperMetadata(e,t){this.internalStorage.setItem(Hs.WRAPPER_SKU,e),this.internalStorage.setItem(Hs.WRAPPER_VER,t)}getWrapperMetadata(){let e=this.internalStorage.getItem(Hs.WRAPPER_SKU)||g.EMPTY_STRING,t=this.internalStorage.getItem(Hs.WRAPPER_VER)||g.EMPTY_STRING;return[e,t]}setAuthorityMetadata(e,t){this.logger.trace("BrowserCacheManager.setAuthorityMetadata called"),this.internalStorage.setItem(e,JSON.stringify(t))}getActiveAccount(){let e=this.generateCacheKey(qa.ACTIVE_ACCOUNT_FILTERS),t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getActiveAccount: No active account filters found"),null;let r=this.validateAndParseJson(t);return r?(this.logger.trace("BrowserCacheManager.getActiveAccount: Active account filters schema found"),this.getAccountInfoFilteredBy({homeAccountId:r.homeAccountId,localAccountId:r.localAccountId,tenantId:r.tenantId})):(this.logger.trace("BrowserCacheManager.getActiveAccount: No active account found"),null)}setActiveAccount(e){let t=this.generateCacheKey(qa.ACTIVE_ACCOUNT_FILTERS);if(e){this.logger.verbose("setActiveAccount: Active account set");let r={homeAccountId:e.homeAccountId,localAccountId:e.localAccountId,tenantId:e.tenantId};this.browserStorage.setItem(t,JSON.stringify(r))}else this.logger.verbose("setActiveAccount: No account passed, active account not set"),this.browserStorage.removeItem(t);this.eventHandler.emitEvent(E.ACTIVE_ACCOUNT_CHANGED)}getThrottlingCache(e){let t=this.browserStorage.getItem(e);if(!t)return this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null;let r=this.validateAndParseJson(t);return!r||!Q.isThrottlingEntity(e,r)?(this.logger.trace("BrowserCacheManager.getThrottlingCache: called, no cache hit"),null):(this.logger.trace("BrowserCacheManager.getThrottlingCache: cache hit"),r)}setThrottlingCache(e,t){this.logger.trace("BrowserCacheManager.setThrottlingCache called"),this.browserStorage.setItem(e,JSON.stringify(t))}getTemporaryCache(e,t){let r=t?this.generateCacheKey(e):e;if(this.cacheConfig.storeAuthStateInCookie){let i=this.cookieStorage.getItem(r);if(i)return this.logger.trace("BrowserCacheManager.getTemporaryCache: storeAuthStateInCookies set to true, retrieving from cookies"),i}let o=this.temporaryCacheStorage.getItem(r);if(!o){if(this.cacheConfig.cacheLocation===q.LocalStorage){let i=this.browserStorage.getItem(r);if(i)return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item found in local storage"),i}return this.logger.trace("BrowserCacheManager.getTemporaryCache: No cache item found in local storage"),null}return this.logger.trace("BrowserCacheManager.getTemporaryCache: Temporary cache item returned"),o}setTemporaryCache(e,t,r){let o=r?this.generateCacheKey(e):e;this.temporaryCacheStorage.setItem(o,t),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.setTemporaryCache: storeAuthStateInCookie set to true, setting item cookie"),this.cookieStorage.setItem(o,t,void 0,this.cacheConfig.secureCookies))}removeItem(e){this.browserStorage.removeItem(e)}removeTemporaryItem(e){this.temporaryCacheStorage.removeItem(e),this.cacheConfig.storeAuthStateInCookie&&(this.logger.trace("BrowserCacheManager.removeItem: storeAuthStateInCookie is true, clearing item cookie"),this.cookieStorage.removeItem(e))}getKeys(){return this.browserStorage.getKeys()}clear(){return d(this,null,function*(){yield this.removeAllAccounts(),this.removeAppMetadata(),this.temporaryCacheStorage.getKeys().forEach(e=>{(e.indexOf(g.CACHE_PREFIX)!==-1||e.indexOf(this.clientId)!==-1)&&this.removeTemporaryItem(e)}),this.browserStorage.getKeys().forEach(e=>{(e.indexOf(g.CACHE_PREFIX)!==-1||e.indexOf(this.clientId)!==-1)&&this.browserStorage.removeItem(e)}),this.internalStorage.clear()})}clearTokensAndKeysWithClaims(e,t){return d(this,null,function*(){e.addQueueMeasurement(u.ClearTokensAndKeysWithClaims,t);let r=this.getTokenKeys(),o=[];r.accessToken.forEach(i=>{let s=this.getAccessTokenCredential(i);s?.requestedClaimsHash&&i.includes(s.requestedClaimsHash.toLowerCase())&&o.push(this.removeAccessToken(i))}),yield Promise.all(o),o.length>0&&this.logger.warning(`${o.length} access tokens with claims in the cache keys have been removed from the cache.`)})}generateCacheKey(e){return this.validateAndParseJson(e)?JSON.stringify(e):X.startsWith(e,g.CACHE_PREFIX)?e:`${g.CACHE_PREFIX}.${this.clientId}.${e}`}resetRequestCache(){this.logger.trace("BrowserCacheManager.resetRequestCache called"),this.removeTemporaryItem(this.generateCacheKey(te.REQUEST_PARAMS)),this.removeTemporaryItem(this.generateCacheKey(te.VERIFIER)),this.removeTemporaryItem(this.generateCacheKey(te.ORIGIN_URI)),this.removeTemporaryItem(this.generateCacheKey(te.URL_HASH)),this.removeTemporaryItem(this.generateCacheKey(te.NATIVE_REQUEST)),this.setInteractionInProgress(!1)}cacheAuthorizeRequest(e,t){this.logger.trace("BrowserCacheManager.cacheAuthorizeRequest called");let r=br(JSON.stringify(e));if(this.setTemporaryCache(te.REQUEST_PARAMS,r,!0),t){let o=br(t);this.setTemporaryCache(te.VERIFIER,o,!0)}}getCachedRequest(){this.logger.trace("BrowserCacheManager.getCachedRequest called");let e=this.getTemporaryCache(te.REQUEST_PARAMS,!0);if(!e)throw v(Oo);let t=this.getTemporaryCache(te.VERIFIER,!0),r,o="";try{r=JSON.parse(ye(e)),t&&(o=ye(t))}catch(i){throw this.logger.errorPii(`Attempted to parse: ${e}`),this.logger.error(`Parsing cached token request threw with error: ${i}`),v(Mo)}return[r,o]}getCachedNativeRequest(){this.logger.trace("BrowserCacheManager.getCachedNativeRequest called");let e=this.getTemporaryCache(te.NATIVE_REQUEST,!0);if(!e)return this.logger.trace("BrowserCacheManager.getCachedNativeRequest: No cached native request found"),null;let t=this.validateAndParseJson(e);return t||(this.logger.error("BrowserCacheManager.getCachedNativeRequest: Unable to parse native request"),null)}isInteractionInProgress(e){let t=this.getInteractionInProgress()?.clientId;return e?t===this.clientId:!!t}getInteractionInProgress(){let e=`${g.CACHE_PREFIX}.${te.INTERACTION_STATUS_KEY}`,t=this.getTemporaryCache(e,!1);try{return t?JSON.parse(t):null}catch{return this.logger.error("Cannot parse interaction status. Removing temporary cache items and clearing url hash. Retrying interaction should fix the error"),this.removeTemporaryItem(e),this.resetRequestCache(),Gs(window),null}}setInteractionInProgress(e,t=rt.SIGNIN){let r=`${g.CACHE_PREFIX}.${te.INTERACTION_STATUS_KEY}`;if(e){if(this.getInteractionInProgress())throw v(So);this.setTemporaryCache(r,JSON.stringify({clientId:this.clientId,type:t}),!1)}else!e&&this.getInteractionInProgress()?.clientId===this.clientId&&this.removeTemporaryItem(r)}hydrateCache(e,t){return d(this,null,function*(){let r=Q.createIdTokenEntity(e.account?.homeAccountId,e.account?.environment,e.idToken,this.clientId,e.tenantId),o;t.claims&&(o=yield this.cryptoImpl.hashString(t.claims));let i=Q.createAccessTokenEntity(e.account?.homeAccountId,e.account.environment,e.accessToken,this.clientId,e.tenantId,e.scopes.join(" "),e.expiresOn?me.toSecondsFromDate(e.expiresOn):0,e.extExpiresOn?me.toSecondsFromDate(e.extExpiresOn):0,ye,void 0,e.tokenType,void 0,t.sshKid,t.claims,o),s={idToken:r,accessToken:i};return this.saveCacheRecord(s,e.correlationId)})}saveCacheRecord(e,t,r){return d(this,null,function*(){try{yield Bn(n.prototype,this,"saveCacheRecord").call(this,e,t,r)}catch(o){if(o instanceof Kt&&this.performanceClient&&t)try{let i=this.getTokenKeys();this.performanceClient.addFields({cacheRtCount:i.refreshToken.length,cacheIdCount:i.idToken.length,cacheAtCount:i.accessToken.length},t)}catch{}throw o}})}};function Xp(n,e,t,r){try{switch(e){case q.LocalStorage:return new Wc(n,t,r);case q.SessionStorage:return new Yc;case q.MemoryStorage:default:break}}catch(o){t.error(o)}return new rr}var Zp=(n,e,t,r)=>{let o={cacheLocation:q.MemoryStorage,temporaryCacheLocation:q.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};return new Xo(n,o,mr,e,t,r)};function eg(n,e,t,r){return n.verbose("getAllAccounts called"),t?e.getAllAccounts(r):[]}function tg(n,e,t){if(e.trace("getAccount called"),Object.keys(n).length===0)return e.warning("getAccount: No accountFilter provided"),null;let r=t.getAccountInfoFilteredBy(n);return r?(e.verbose("getAccount: Account matching provided filter found, returning"),r):(e.verbose("getAccount: No matching account found, returning null"),null)}function rg(n,e,t){if(e.trace("getAccountByUsername called"),!n)return e.warning("getAccountByUsername: No username provided"),null;let r=t.getAccountInfoFilteredBy({username:n});return r?(e.verbose("getAccountByUsername: Account matching username found, returning"),e.verbosePii(`getAccountByUsername: Returning signed-in accounts matching username: ${n}`),r):(e.verbose("getAccountByUsername: No matching account found, returning null"),null)}function ng(n,e,t){if(e.trace("getAccountByHomeId called"),!n)return e.warning("getAccountByHomeId: No homeAccountId provided"),null;let r=t.getAccountInfoFilteredBy({homeAccountId:n});return r?(e.verbose("getAccountByHomeId: Account matching homeAccountId found, returning"),e.verbosePii(`getAccountByHomeId: Returning signed-in accounts matching homeAccountId: ${n}`),r):(e.verbose("getAccountByHomeId: No matching account found, returning null"),null)}function og(n,e,t){if(e.trace("getAccountByLocalId called"),!n)return e.warning("getAccountByLocalId: No localAccountId provided"),null;let r=t.getAccountInfoFilteredBy({localAccountId:n});return r?(e.verbose("getAccountByLocalId: Account matching localAccountId found, returning"),e.verbosePii(`getAccountByLocalId: Returning signed-in accounts matching localAccountId: ${n}`),r):(e.verbose("getAccountByLocalId: No matching account found, returning null"),null)}function ig(n,e){e.setActiveAccount(n)}function sg(n){return n.getActiveAccount()}var tv="msal.broadcast.event",Qc=class{constructor(e){this.eventCallbacks=new Map,this.logger=e||new _e({}),typeof BroadcastChannel<"u"&&(this.broadcastChannel=new BroadcastChannel(tv)),this.invokeCrossTabCallbacks=this.invokeCrossTabCallbacks.bind(this)}addEventCallback(e,t,r){if(typeof window<"u"){let o=r||Wd();return this.eventCallbacks.has(o)?(this.logger.error(`Event callback with id: ${o} is already registered. Please provide a unique id or remove the existing callback and try again.`),null):(this.eventCallbacks.set(o,[e,t||[]]),this.logger.verbose(`Event callback registered with id: ${o}`),o)}return null}removeEventCallback(e){this.eventCallbacks.delete(e),this.logger.verbose(`Event callback ${e} removed.`)}emitEvent(e,t,r,o){let i={eventType:e,interactionType:t||null,payload:r||null,error:o||null,timestamp:Date.now()};switch(e){case E.ACCOUNT_ADDED:case E.ACCOUNT_REMOVED:case E.ACTIVE_ACCOUNT_CHANGED:this.broadcastChannel?.postMessage(i);break;default:this.invokeCallbacks(i);break}}invokeCallbacks(e){this.eventCallbacks.forEach(([t,r],o)=>{(r.length===0||r.includes(e.eventType))&&(this.logger.verbose(`Emitting event to callback ${o}: ${e.eventType}`),t.apply(null,[e]))})}invokeCrossTabCallbacks(e){let t=e.data;this.invokeCallbacks(t)}subscribeCrossTab(){this.broadcastChannel?.addEventListener("message",this.invokeCrossTabCallbacks)}unsubscribeCrossTab(){this.broadcastChannel?.removeEventListener("message",this.invokeCrossTabCallbacks)}};var Zo=class{constructor(e,t,r,o,i,s,a,c,l){this.config=e,this.browserStorage=t,this.browserCrypto=r,this.networkClient=this.config.system.networkClient,this.eventHandler=i,this.navigationClient=s,this.nativeMessageHandler=c,this.correlationId=l||de(),this.logger=o.clone(ee.MSAL_SKU,Rt,this.correlationId),this.performanceClient=a}clearCacheOnLogout(e){return d(this,null,function*(){if(e){oe.accountInfoIsEqual(e,this.browserStorage.getActiveAccount(),!1)&&(this.logger.verbose("Setting active account to null"),this.browserStorage.setActiveAccount(null));try{yield this.browserStorage.removeAccount(oe.generateAccountCacheKey(e)),this.logger.verbose("Cleared cache items belonging to the account provided in the logout request.")}catch{this.logger.error("Account provided in logout request was not found. Local cache unchanged.")}}else try{this.logger.verbose("No account provided in logout request, clearing all cache items.",this.correlationId),yield this.browserStorage.clear(),yield this.browserCrypto.clearKeystore()}catch{this.logger.error("Attempted to clear all MSAL cache items and failed. Local cache unchanged.")}})}getRedirectUri(e){this.logger.verbose("getRedirectUri called");let t=e||this.config.auth.redirectUri;return b.getAbsoluteUrl(t,Se())}initializeServerTelemetryManager(e,t){this.logger.verbose("initializeServerTelemetryManager called");let r={clientId:this.config.auth.clientId,correlationId:this.correlationId,apiId:e,forceRefresh:t||!1,wrapperSKU:this.browserStorage.getWrapperMetadata()[0],wrapperVer:this.browserStorage.getWrapperMetadata()[1]};return new Mn(r,this.browserStorage)}getDiscoveredAuthority(e){return d(this,null,function*(){let{account:t}=e,r=e.requestExtraQueryParameters&&e.requestExtraQueryParameters.hasOwnProperty("instance_aware")?e.requestExtraQueryParameters.instance_aware:void 0;this.performanceClient.addQueueMeasurement(u.StandardInteractionClientGetDiscoveredAuthority,this.correlationId);let o={protocolMode:this.config.auth.protocolMode,OIDCOptions:this.config.auth.OIDCOptions,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},i=e.requestAuthority||this.config.auth.authority,s=r?.length?r==="true":this.config.auth.instanceAware,a=t&&s?this.config.auth.authority.replace(b.getDomainFromUrl(i),t.environment):i,c=Ge.generateAuthority(a,e.requestAzureCloudOptions||this.config.auth.azureCloudOptions),l=yield p(gc.createDiscoveredInstance,u.AuthorityFactoryCreateDiscoveredInstance,this.logger,this.performanceClient,this.correlationId)(c,this.config.system.networkClient,this.browserStorage,o,this.logger,this.correlationId,this.performanceClient);if(t&&!l.isAlias(t.environment))throw F(xe.authorityMismatch);return l})}};function Ys(n,e,t,r){return d(this,null,function*(){t.addQueueMeasurement(u.InitializeBaseRequest,n.correlationId);let o=n.authority||e.auth.authority,i=[...n&&n.scopes||[]],s=T(f({},n),{correlationId:n.correlationId,authority:o,scopes:i});if(!s.authenticationScheme)s.authenticationScheme=U.BEARER,r.verbose(`Authentication Scheme wasn't explicitly set in request, defaulting to "Bearer" request`);else{if(s.authenticationScheme===U.SSH){if(!n.sshJwk)throw F(xe.missingSshJwk);if(!n.sshKid)throw F(xe.missingSshKid)}r.verbose(`Authentication Scheme set to "${s.authenticationScheme}" as configured in Auth request`)}return e.cache.claimsBasedCachingEnabled&&n.claims&&!X.isEmptyObj(n.claims)&&(s.requestedClaimsHash=yield Nc(n.claims)),s})}function ag(n,e,t,r,o){return d(this,null,function*(){r.addQueueMeasurement(u.InitializeSilentRequest,n.correlationId);let i=yield p(Ys,u.InitializeBaseRequest,o,r,n.correlationId)(n,t,r,o);return T(f(f({},n),i),{account:e,forceRefresh:n.forceRefresh||!1})})}var Oe=class extends Zo{initializeLogoutRequest(e){this.logger.verbose("initializeLogoutRequest called",e?.correlationId);let t=f({correlationId:this.correlationId||de()},e);if(e)if(e.logoutHint)this.logger.verbose("logoutHint has already been set in logoutRequest");else if(e.account){let r=this.getLogoutHintFromIdTokenClaims(e.account);r&&(this.logger.verbose("Setting logoutHint to login_hint ID Token Claim value for the account provided"),t.logoutHint=r)}else this.logger.verbose("logoutHint was not set and account was not passed into logout request, logoutHint will not be set");else this.logger.verbose("logoutHint will not be set since no logout request was configured");return!e||e.postLogoutRedirectUri!==null?e&&e.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to uri set on logout request",t.correlationId),t.postLogoutRedirectUri=b.getAbsoluteUrl(e.postLogoutRedirectUri,Se())):this.config.auth.postLogoutRedirectUri===null?this.logger.verbose("postLogoutRedirectUri configured as null and no uri set on request, not passing post logout redirect",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("Setting postLogoutRedirectUri to configured uri",t.correlationId),t.postLogoutRedirectUri=b.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,Se())):(this.logger.verbose("Setting postLogoutRedirectUri to current page",t.correlationId),t.postLogoutRedirectUri=b.getAbsoluteUrl(Se(),Se())):this.logger.verbose("postLogoutRedirectUri passed as null, not setting post logout redirect uri",t.correlationId),t}getLogoutHintFromIdTokenClaims(e){let t=e.idTokenClaims;if(t){if(t.login_hint)return t.login_hint;this.logger.verbose("The ID Token Claims tied to the provided account do not contain a login_hint claim, logoutHint will not be added to logout request")}else this.logger.verbose("The provided account does not contain ID Token Claims, logoutHint will not be added to logout request");return null}createAuthCodeClient(e){return d(this,null,function*(){this.performanceClient.addQueueMeasurement(u.StandardInteractionClientCreateAuthCodeClient,this.correlationId);let t=yield p(this.getClientConfiguration.bind(this),u.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)(e);return new On(t,this.performanceClient)})}getClientConfiguration(e){return d(this,null,function*(){let{serverTelemetryManager:t,requestAuthority:r,requestAzureCloudOptions:o,requestExtraQueryParameters:i,account:s}=e;this.performanceClient.addQueueMeasurement(u.StandardInteractionClientGetClientConfiguration,this.correlationId);let a=yield p(this.getDiscoveredAuthority.bind(this),u.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,this.correlationId)({requestAuthority:r,requestAzureCloudOptions:o,requestExtraQueryParameters:i,account:s}),c=this.config.system.loggerOptions;return{authOptions:{clientId:this.config.auth.clientId,authority:a,clientCapabilities:this.config.auth.clientCapabilities,redirectUri:this.config.auth.redirectUri},systemOptions:{tokenRenewalOffsetSeconds:this.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:c.loggerCallback,piiLoggingEnabled:c.piiLoggingEnabled,logLevel:c.logLevel,correlationId:this.correlationId},cacheOptions:{claimsBasedCachingEnabled:this.config.cache.claimsBasedCachingEnabled},cryptoInterface:this.browserCrypto,networkInterface:this.networkClient,storageInterface:this.browserStorage,serverTelemetryManager:t,libraryInfo:{sku:ee.MSAL_SKU,version:Rt,cpu:g.EMPTY_STRING,os:g.EMPTY_STRING},telemetry:this.config.telemetry}})}initializeAuthorizationRequest(e,t){return d(this,null,function*(){this.performanceClient.addQueueMeasurement(u.StandardInteractionClientInitializeAuthorizationRequest,this.correlationId);let r=this.getRedirectUri(e.redirectUri),o={interactionType:t},i=Ze.setRequestState(this.browserCrypto,e&&e.state||g.EMPTY_STRING,o),s=yield p(Ys,u.InitializeBaseRequest,this.logger,this.performanceClient,this.correlationId)(T(f({},e),{correlationId:this.correlationId}),this.config,this.performanceClient,this.logger),a=T(f({},s),{redirectUri:r,state:i,nonce:e.nonce||de(),responseMode:this.config.auth.OIDCOptions.serverResponseType});if(e.loginHint||e.sid)return a;let c=e.account||this.browserStorage.getActiveAccount();return c&&(this.logger.verbose("Setting validated request account",this.correlationId),this.logger.verbosePii(`Setting validated request account: ${c.homeAccountId}`,this.correlationId),a.account=c),a})}};var cg="ContentError",Jc="user_switch";var ug="USER_INTERACTION_REQUIRED",lg="USER_CANCEL",dg="NO_NETWORK",hg="PERSISTENT_ERROR",fg="DISABLED",pg="ACCOUNT_UNAVAILABLE";var rv=-2147186943,nv={[Jc]:"User attempted to switch accounts in the native broker, which is not allowed. All new accounts must sign-in through the standard web flow first, please try again."},ze=class n extends O{constructor(e,t,r){super(e,t),Object.setPrototypeOf(this,n.prototype),this.name="NativeAuthError",this.ext=r}};function Or(n){if(n.ext&&n.ext.status&&(n.ext.status===hg||n.ext.status===fg)||n.ext&&n.ext.error&&n.ext.error===rv)return!0;switch(n.errorCode){case cg:return!0;default:return!1}}function Qs(n,e,t){if(t&&t.status)switch(t.status){case pg:return mo(Qt.nativeAccountUnavailable);case ug:return new he(n,e);case lg:return v(tt);case dg:return v(Xt)}return new ze(n,nv[n]||e,t)}var Be=class n{constructor(e,t,r,o){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=o,this.resolvers=new Map,this.handshakeResolvers=new Map,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=r,this.handshakeEvent=r.startMeasurement(u.NativeMessageHandlerHandshake)}sendMessage(e){return d(this,null,function*(){this.logger.trace("NativeMessageHandler - sendMessage called.");let t={channel:Dr.CHANNEL_ID,extensionId:this.extensionId,responseId:de(),body:e};return this.logger.trace("NativeMessageHandler - Sending request to browser extension"),this.logger.tracePii(`NativeMessageHandler - Sending request to browser extension: ${JSON.stringify(t)}`),this.messageChannel.port1.postMessage(t),new Promise((r,o)=>{this.resolvers.set(t.responseId,{resolve:r,reject:o})})})}static createProvider(e,t,r){return d(this,null,function*(){e.trace("NativeMessageHandler - createProvider called.");try{let o=new n(e,t,r,Dr.PREFERRED_EXTENSION_ID);return yield o.sendHandshakeRequest(),o}catch{let i=new n(e,t,r);return yield i.sendHandshakeRequest(),i}})}sendHandshakeRequest(){return d(this,null,function*(){this.logger.trace("NativeMessageHandler - sendHandshakeRequest called."),window.addEventListener("message",this.windowListener,!1);let e={channel:Dr.CHANNEL_ID,extensionId:this.extensionId,responseId:de(),body:{method:tr.HandshakeRequest}};return this.handshakeEvent.add({extensionId:this.extensionId,extensionHandshakeTimeoutMs:this.handshakeTimeoutMs}),this.messageChannel.port1.onmessage=t=>{this.onChannelMessage(t)},window.postMessage(e,window.origin,[this.messageChannel.port2]),new Promise((t,r)=>{this.handshakeResolvers.set(e.responseId,{resolve:t,reject:r}),this.timeoutId=window.setTimeout(()=>{window.removeEventListener("message",this.windowListener,!1),this.messageChannel.port1.close(),this.messageChannel.port2.close(),this.handshakeEvent.end({extensionHandshakeTimedOut:!0,success:!1}),r(v(Ho)),this.handshakeResolvers.delete(e.responseId)},this.handshakeTimeoutMs)})})}onWindowMessage(e){if(this.logger.trace("NativeMessageHandler - onWindowMessage called"),e.source!==window)return;let t=e.data;if(!(!t.channel||t.channel!==Dr.CHANNEL_ID)&&!(t.extensionId&&t.extensionId!==this.extensionId)&&t.body.method===tr.HandshakeRequest){let r=this.handshakeResolvers.get(t.responseId);if(!r){this.logger.trace(`NativeMessageHandler.onWindowMessage - resolver can't be found for request ${t.responseId}`);return}this.logger.verbose(t.extensionId?`Extension with id: ${t.extensionId} not installed`:"No extension installed"),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),this.handshakeEvent.end({success:!1,extensionInstalled:!1}),r.reject(v($o))}}onChannelMessage(e){this.logger.trace("NativeMessageHandler - onChannelMessage called.");let t=e.data,r=this.resolvers.get(t.responseId),o=this.handshakeResolvers.get(t.responseId);try{let i=t.body.method;if(i===tr.Response){if(!r)return;let s=t.body.response;if(this.logger.trace("NativeMessageHandler - Received response from browser extension"),this.logger.tracePii(`NativeMessageHandler - Received response from browser extension: ${JSON.stringify(s)}`),s.status!=="Success")r.reject(Qs(s.code,s.description,s.ext));else if(s.result)s.result.code&&s.result.description?r.reject(Qs(s.result.code,s.result.description,s.result.ext)):r.resolve(s.result);else throw zi(jr.unexpectedError,"Event does not contain result.");this.resolvers.delete(t.responseId)}else if(i===tr.HandshakeResponse){if(!o){this.logger.trace(`NativeMessageHandler.onChannelMessage - resolver can't be found for request ${t.responseId}`);return}clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=t.extensionId,this.extensionVersion=t.body.version,this.logger.verbose(`NativeMessageHandler - Received HandshakeResponse from extension: ${this.extensionId}`),this.handshakeEvent.end({extensionInstalled:!0,success:!0}),o.resolve(),this.handshakeResolvers.delete(t.responseId)}}catch(i){this.logger.error("Error parsing response from WAM Extension"),this.logger.errorPii(`Error parsing response from WAM Extension: ${i}`),this.logger.errorPii(`Unable to parse ${e}`),r?r.reject(i):o&&o.reject(i)}}getExtensionId(){return this.extensionId}getExtensionVersion(){return this.extensionVersion}static isPlatformBrokerAvailable(e,t,r,o){if(t.trace("isPlatformBrokerAvailable called"),!e.system.allowPlatformBroker)return t.trace("isPlatformBrokerAvailable: allowPlatformBroker is not enabled, returning false"),!1;if(!r)return t.trace("isPlatformBrokerAvailable: Platform extension provider is not initialized, returning false"),!1;if(o)switch(o){case U.BEARER:case U.POP:return t.trace("isPlatformBrokerAvailable: authenticationScheme is supported, returning true"),!0;default:return t.trace("isPlatformBrokerAvailable: authenticationScheme is not supported, returning false"),!1}return!0}};function gg(n,e){if(!e)return null;try{return Ze.parseRequestState(n,e).libraryState.meta}catch{throw C(ae.invalidState)}}function ei(n,e,t){let r=vr.getDeserializedResponse(n);if(!r)throw vr.stripLeadingHashOrQuery(n)?(t.error(`A ${e} is present in the iframe but it does not contain known properties. It's likely that the ${e} has been replaced by code running on the redirectUri page.`),t.errorPii(`The ${e} detected is: ${n}`),v(Eo)):(t.error(`The request has returned to the redirectUri but a ${e} is not present. It's likely that the ${e} has been removed or the page has been redirected by code running on the redirectUri page.`),v(vo));return r}function mg(n,e,t){if(!n.state)throw v(Ir);let r=gg(e,n.state);if(!r)throw v(Ao);if(r.interactionType!==t)throw v(To)}var ti=class{constructor(e,t,r,o,i){this.authModule=e,this.browserStorage=t,this.authCodeRequest=r,this.logger=o,this.performanceClient=i}handleCodeResponse(e,t){return d(this,null,function*(){this.performanceClient.addQueueMeasurement(u.HandleCodeResponse,t.correlationId);let r;try{r=Jt.getAuthorizationCodePayload(e,t.state)}catch(o){throw o instanceof be&&o.subError===tt?v(tt):o}return p(this.handleCodeResponseFromServer.bind(this),u.HandleCodeResponseFromServer,this.logger,this.performanceClient,t.correlationId)(r,t)})}handleCodeResponseFromServer(e,t,r=!0){return d(this,null,function*(){if(this.performanceClient.addQueueMeasurement(u.HandleCodeResponseFromServer,t.correlationId),this.logger.trace("InteractionHandler.handleCodeResponseFromServer called"),this.authCodeRequest.code=e.code,e.cloud_instance_host_name&&(yield p(this.authModule.updateAuthority.bind(this.authModule),u.UpdateTokenEndpointAuthority,this.logger,this.performanceClient,t.correlationId)(e.cloud_instance_host_name,t.correlationId)),r&&(e.nonce=t.nonce||void 0),e.state=t.state,e.client_info)this.authCodeRequest.clientInfo=e.client_info;else{let i=this.createCcsCredentials(t);i&&(this.authCodeRequest.ccsCredential=i)}return yield p(this.authModule.acquireToken.bind(this.authModule),u.AuthClientAcquireToken,this.logger,this.performanceClient,t.correlationId)(this.authCodeRequest,e)})}createCcsCredentials(e){return e.account?{credential:e.account.homeAccountId,type:Ce.HOME_ACCOUNT_ID}:e.loginHint?{credential:e.loginHint,type:Ce.UPN}:null}};var ri=class extends Oe{acquireToken(e){return d(this,null,function*(){this.performanceClient.addQueueMeasurement(u.SilentCacheClientAcquireToken,e.correlationId);let t=this.initializeServerTelemetryManager(B.acquireTokenSilent_silentFlow),r=yield p(this.getClientConfiguration.bind(this),u.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:t,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,account:e.account}),o=new Us(r,this.performanceClient);this.logger.verbose("Silent auth client created");try{let s=(yield p(o.acquireCachedToken.bind(o),u.SilentFlowClientAcquireCachedToken,this.logger,this.performanceClient,e.correlationId)(e))[0];return this.performanceClient.addFields({fromCache:!0},e.correlationId),s}catch(i){throw i instanceof Fn&&i.errorCode===wr&&this.logger.verbose("Signing keypair for bound access token not found. Refreshing bound access token and generating a new crypto keypair."),i}})}logout(e){this.logger.verbose("logoutRedirect called");let t=this.initializeLogoutRequest(e);return this.clearCacheOnLogout(t?.account)}};var Mr=class extends Zo{constructor(e,t,r,o,i,s,a,c,l,h,m,y){super(e,t,r,o,i,s,c,l,y),this.apiId=a,this.accountId=h,this.nativeMessageHandler=l,this.nativeStorageManager=m,this.silentCacheClient=new ri(e,this.nativeStorageManager,r,o,i,s,c,l,y);let S=this.nativeMessageHandler.getExtensionId()===Dr.PREFERRED_EXTENSION_ID?"chrome":this.nativeMessageHandler.getExtensionId()?.length?"unknown":void 0;this.skus=Mn.makeExtraSkuString({libraryName:ee.MSAL_SKU,libraryVersion:Rt,extensionName:S,extensionVersion:this.nativeMessageHandler.getExtensionVersion()})}addRequestSKUs(e){e.extraParameters=T(f({},e.extraParameters),{[zt.X_CLIENT_EXTRA_SKU]:this.skus})}acquireToken(e,t){return d(this,null,function*(){this.performanceClient.addQueueMeasurement(u.NativeInteractionClientAcquireToken,e.correlationId),this.logger.trace("NativeInteractionClient - acquireToken called.");let r=this.performanceClient.startMeasurement(u.NativeInteractionClientAcquireToken,e.correlationId),o=me.nowSeconds(),i=this.initializeServerTelemetryManager(this.apiId);try{let s=yield this.initializeNativeRequest(e);try{let m=yield this.acquireTokensFromCache(this.accountId,s);return r.end({success:!0,isNativeBroker:!1,fromCache:!0}),m}catch(m){if(t===fe.AccessToken)throw this.logger.info("MSAL internal Cache does not contain tokens, return error as per cache policy"),m;this.logger.info("MSAL internal Cache does not contain tokens, proceed to make a native call")}let a=nr(s,[]),c={method:tr.GetToken,request:a},l=yield this.nativeMessageHandler.sendMessage(c),h=this.validateNativeResponse(l);return yield this.handleNativeResponse(h,s,o).then(m=>(r.end({success:!0,isNativeBroker:!0,requestId:m.requestId}),i.clearNativeBrokerErrorCode(),m)).catch(m=>{throw r.end({success:!1,errorCode:m.errorCode,subErrorCode:m.subError,isNativeBroker:!0}),m})}catch(s){throw s instanceof ze&&i.setNativeBrokerErrorCode(s.errorCode),s}})}createSilentCacheRequest(e,t){return{authority:e.authority,correlationId:this.correlationId,scopes:j.fromString(e.scope).asArray(),account:t,forceRefresh:!1}}acquireTokensFromCache(e,t){return d(this,null,function*(){if(!e)throw this.logger.warning("NativeInteractionClient:acquireTokensFromCache - No nativeAccountId provided"),C(ae.noAccountFound);let r=this.browserStorage.getBaseAccountInfo({nativeAccountId:e});if(!r)throw C(ae.noAccountFound);try{let o=this.createSilentCacheRequest(t,r),i=yield this.silentCacheClient.acquireToken(o),s=T(f({},r),{idTokenClaims:i?.idTokenClaims,idToken:i?.idToken});return T(f({},i),{account:s})}catch(o){throw o}})}acquireTokenRedirect(e,t){return d(this,null,function*(){this.logger.trace("NativeInteractionClient - acquireTokenRedirect called.");let r=nr(e,[]);delete r.onRedirectNavigate;let o=yield this.initializeNativeRequest(r),i={method:tr.GetToken,request:o};try{let c=yield this.nativeMessageHandler.sendMessage(i);this.validateNativeResponse(c)}catch(c){if(c instanceof ze&&(this.initializeServerTelemetryManager(this.apiId).setNativeBrokerErrorCode(c.errorCode),Or(c)))throw c}this.browserStorage.setTemporaryCache(te.NATIVE_REQUEST,JSON.stringify(o),!0);let s={apiId:B.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},a=this.config.auth.navigateToLoginRequestUrl?window.location.href:this.getRedirectUri(e.redirectUri);t.end({success:!0}),yield this.navigationClient.navigateExternal(a,s)})}handleRedirectPromise(e,t){return d(this,null,function*(){if(this.logger.trace("NativeInteractionClient - handleRedirectPromise called."),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;let r=this.browserStorage.getCachedNativeRequest();if(!r)return this.logger.verbose("NativeInteractionClient - handleRedirectPromise called but there is no cached request, returning null."),e&&t&&e?.addFields({errorCode:"no_cached_request"},t),null;let c=r,{prompt:o}=c,i=nr(c,["prompt"]);o&&this.logger.verbose("NativeInteractionClient - handleRedirectPromise called and prompt was included in the original request, removing prompt from cached request to prevent second interaction with native broker window."),this.browserStorage.removeItem(this.browserStorage.generateCacheKey(te.NATIVE_REQUEST));let s={method:tr.GetToken,request:i},a=me.nowSeconds();try{this.logger.verbose("NativeInteractionClient - handleRedirectPromise sending message to native broker.");let l=yield this.nativeMessageHandler.sendMessage(s);this.validateNativeResponse(l);let m=yield this.handleNativeResponse(l,i,a);return this.initializeServerTelemetryManager(this.apiId).clearNativeBrokerErrorCode(),m}catch(l){throw l}})}logout(){return this.logger.trace("NativeInteractionClient - logout called."),Promise.reject("Logout not implemented yet")}handleNativeResponse(e,t,r){return d(this,null,function*(){this.logger.trace("NativeInteractionClient - handleNativeResponse called.");let o=ao.extractTokenClaims(e.id_token,ye),i=this.createHomeAccountIdentifier(e,o),s=this.browserStorage.getAccountInfoFilteredBy({nativeAccountId:t.accountId})?.homeAccountId;if(t.extraParameters?.child_client_id&&e.account.id!==t.accountId)this.logger.info("handleNativeServerResponse: Double broker flow detected, ignoring accountId mismatch");else if(i!==s&&e.account.id!==t.accountId)throw Qs(Jc);let a=yield this.getDiscoveredAuthority({requestAuthority:t.authority}),c=Co(this.browserStorage,a,i,ye,o,e.client_info,void 0,o.tid,void 0,e.account.id,this.logger);e.expires_in=Number(e.expires_in);let l=yield this.generateAuthenticationResult(e,t,o,c,a.canonicalAuthority,r);return yield this.cacheAccount(c),yield this.cacheNativeTokens(e,t,i,o,e.access_token,l.tenantId,r),l})}createHomeAccountIdentifier(e,t){return oe.generateHomeAccountId(e.client_info||g.EMPTY_STRING,Te.Default,this.logger,this.browserCrypto,t)}generateScopes(e,t){return e.scope?j.fromString(e.scope):j.fromString(t.scope)}generatePopAccessToken(e,t){return d(this,null,function*(){if(t.tokenType===U.POP&&t.signPopToken){if(e.shr)return this.logger.trace("handleNativeServerResponse: SHR is enabled in native layer"),e.shr;let r=new ke(this.browserCrypto),o={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce};if(!t.keyId)throw C(ae.keyIdMissing);return r.signPopToken(e.access_token,t.keyId,o)}else return e.access_token})}generateAuthenticationResult(e,t,r,o,i,s){return d(this,null,function*(){let a=this.addTelemetryFromNativeResponse(e),c=e.scope?j.fromString(e.scope):j.fromString(t.scope),l=e.account.properties||{},h=l.UID||r.oid||r.sub||g.EMPTY_STRING,m=l.TenantId||r.tid||g.EMPTY_STRING,y=An(o.getAccountInfo(),void 0,r,e.id_token);y.nativeAccountId!==e.account.id&&(y.nativeAccountId=e.account.id);let S=yield this.generatePopAccessToken(e,t),_=t.tokenType===U.POP?U.POP:U.BEARER;return{authority:i,uniqueId:h,tenantId:m,scopes:c.asArray(),account:y,idToken:e.id_token,idTokenClaims:r,accessToken:S,fromCache:a?this.isResponseFromCache(a):!1,expiresOn:me.toDateFromSeconds(s+e.expires_in),tokenType:_,correlationId:this.correlationId,state:e.state,fromNativeBroker:!0}})}cacheAccount(e){return d(this,null,function*(){yield this.browserStorage.setAccount(e,this.correlationId),this.browserStorage.removeAccountContext(e).catch(t=>{this.logger.error(`Error occurred while removing account context from browser storage. ${t}`)})})}cacheNativeTokens(e,t,r,o,i,s,a){let c=Q.createIdTokenEntity(r,t.authority,e.id_token||"",t.clientId,o.tid||""),l=t.tokenType===U.POP?g.SHR_NONCE_VALIDITY:(typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0,h=a+l,m=this.generateScopes(e,t),y=Q.createAccessTokenEntity(r,t.authority,i,t.clientId,o.tid||s,m.printScopes(),h,0,ye,void 0,t.tokenType,void 0,t.keyId),S={idToken:c,accessToken:y};return this.nativeStorageManager.saveCacheRecord(S,this.correlationId,t.storeInCache)}addTelemetryFromNativeResponse(e){let t=this.getMATSFromResponse(e);return t?(this.performanceClient.addFields({extensionId:this.nativeMessageHandler.getExtensionId(),extensionVersion:this.nativeMessageHandler.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null}validateNativeResponse(e){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("id_token")&&e.hasOwnProperty("client_info")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scope")&&e.hasOwnProperty("expires_in"))return e;throw zi(jr.unexpectedError,"Response missing expected properties.")}getMATSFromResponse(e){if(e.properties.MATS)try{return JSON.parse(e.properties.MATS)}catch{this.logger.error("NativeInteractionClient - Error parsing MATS telemetry, returning null instead")}return null}isResponseFromCache(e){return typeof e.is_cached>"u"?(this.logger.verbose("NativeInteractionClient - MATS telemetry does not contain field indicating if response was served from cache. Returning false."),!1):!!e.is_cached}initializeNativeRequest(e){return d(this,null,function*(){this.logger.trace("NativeInteractionClient - initializeNativeRequest called");let t=e.authority||this.config.auth.authority;e.account&&(yield this.getDiscoveredAuthority({requestAuthority:t,requestAzureCloudOptions:e.azureCloudOptions,account:e.account}));let r=new b(t);r.validateAsUri();let l=e,{scopes:o}=l,i=nr(l,["scopes"]),s=new j(o||[]);s.appendScopes(Qe);let a=()=>{switch(this.apiId){case B.ssoSilent:case B.acquireTokenSilent_silentFlow:return this.logger.trace("initializeNativeRequest: silent request sets prompt to none"),W.NONE}if(!e.prompt){this.logger.trace("initializeNativeRequest: prompt was not provided");return}switch(e.prompt){case W.NONE:case W.CONSENT:case W.LOGIN:return this.logger.trace("initializeNativeRequest: prompt is compatible with native flow"),e.prompt;default:throw this.logger.trace(`initializeNativeRequest: prompt = ${e.prompt} is not compatible with native flow`),v(Go)}},c=T(f({},i),{accountId:this.accountId,clientId:this.config.auth.clientId,authority:r.urlString,scope:s.printScopes(),redirectUri:this.getRedirectUri(e.redirectUri),prompt:a(),correlationId:this.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:f(f({},e.extraQueryParameters),e.tokenQueryParameters),extendedExpiryToken:!1,keyId:e.popKid});if(c.signPopToken&&e.popKid)throw v(zo);if(this.handleExtraBrokerParams(c),c.extraParameters=c.extraParameters||{},c.extraParameters.telemetry=Dr.MATS_TELEMETRY,e.authenticationScheme===U.POP){let h={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce},m=new ke(this.browserCrypto),y;if(c.keyId)y=this.browserCrypto.base64UrlEncode(JSON.stringify({kid:c.keyId})),c.signPopToken=!1;else{let S=yield p(m.generateCnf.bind(m),u.PopTokenGenerateCnf,this.logger,this.performanceClient,e.correlationId)(h,this.logger);y=S.reqCnfString,c.keyId=S.kid,c.signPopToken=!0}c.reqCnf=y}return this.addRequestSKUs(c),c})}handleExtraBrokerParams(e){let t=e.extraParameters&&e.extraParameters.hasOwnProperty(zt.BROKER_CLIENT_ID)&&e.extraParameters.hasOwnProperty(zt.BROKER_REDIRECT_URI)&&e.extraParameters.hasOwnProperty(zt.CLIENT_ID);if(!e.embeddedClientId&&!t)return;let r="",o=e.redirectUri;e.embeddedClientId?(e.redirectUri=this.config.auth.redirectUri,r=e.embeddedClientId):e.extraParameters&&(e.redirectUri=e.extraParameters[zt.BROKER_REDIRECT_URI],r=e.extraParameters[zt.CLIENT_ID]),e.extraParameters={child_client_id:r,child_redirect_uri:o},this.performanceClient?.addFields({embeddedClientId:r,embeddedRedirectUri:o},e.correlationId)}};function Cg(n,e,t,r,o){return d(this,null,function*(){let i=Jt.getStandardAuthorizeRequestParameters(T(f({},n.auth),{authority:e}),t,r,o);if(De.addLibraryInfo(i,{sku:ee.MSAL_SKU,version:Rt,os:"",cpu:""}),n.auth.protocolMode!==Z.OIDC&&De.addApplicationTelemetry(i,n.telemetry.application),t.platformBroker&&(De.addNativeBroker(i),t.authenticationScheme===U.POP)){let s=new Qo(r,o),a=new ke(s),c;t.popKid?c=s.encodeKid(t.popKid):c=(yield p(a.generateCnf.bind(a),u.PopTokenGenerateCnf,r,o,t.correlationId)(t,r)).reqCnfString,De.addPopToken(i,c)}return De.instrumentBrokerParams(i,t.correlationId,o),i})}function ni(n,e,t,r,o){return d(this,null,function*(){if(!t.codeChallenge)throw F(xe.pkceParamsMissing);let i=yield p(Cg,u.GetStandardParams,r,o,t.correlationId)(n,e,t,r,o);return De.addResponseType(i,Wa.CODE),De.addCodeChallengeParams(i,t.codeChallenge,g.S256_CODE_CHALLENGE_METHOD),De.addExtraQueryParameters(i,t.extraQueryParameters||{}),Jt.getAuthorizeUrl(e,i,n.auth.encodeExtraQueryParams,t.extraQueryParameters)})}function oi(n,e,t,r,o,i){return d(this,null,function*(){if(!r.earJwk)throw v(Bs);let s=yield Cg(e,t,r,o,i);De.addResponseType(s,Wa.IDTOKEN_TOKEN_REFRESHTOKEN),De.addEARParameters(s,r.earJwk);let a=new Map;De.addExtraQueryParameters(a,r.extraQueryParameters||{});let c=Jt.getAuthorizeUrl(t,a,e.auth.encodeExtraQueryParams,r.extraQueryParameters);return ov(n,c,s)})}function ov(n,e,t){let r=n.createElement("form");return r.method="post",r.action=e,t.forEach((o,i)=>{let s=n.createElement("input");s.hidden=!0,s.name=i,s.value=o,r.appendChild(s)}),n.body.appendChild(r),r}function yg(n,e,t,r,o,i,s,a,c,l){return d(this,null,function*(){if(!l)throw v(_r);let h=new Qo(a,c),m=new Mr(r,o,h,a,s,r.system.navigationClient,t,c,l,e,i,n.correlationId),{userRequestState:y}=Ze.parseRequestState(h,n.state);return p(m.acquireToken.bind(m),u.NativeInteractionClientAcquireToken,a,c,n.correlationId)(T(f({},n),{state:y,prompt:void 0}))})}function ii(n,e,t,r,o,i,s,a,c,l,h,m){return d(this,null,function*(){if(Yt.removeThrottle(s,o.auth.clientId,n),e.accountId)return p(yg,u.HandleResponsePlatformBroker,l,h,n.correlationId)(n,e.accountId,r,o,s,a,c,l,h,m);let y=T(f({},n),{code:e.code||"",codeVerifier:t}),S=new ti(i,s,y,l,h);return yield p(S.handleCodeResponse.bind(S),u.HandleCodeResponse,l,h,n.correlationId)(e,n)})}function si(n,e,t,r,o,i,s,a,c,l,h){return d(this,null,function*(){if(Yt.removeThrottle(i,r.auth.clientId,n),Jt.validateAuthorizationResponse(e,n.state),!e.ear_jwe)throw v(Ic);if(!n.earJwk)throw v(Bs);let m=JSON.parse(yield p(xp,u.DecryptEarResponse,c,l,n.correlationId)(n.earJwk,e.ear_jwe));if(m.accountId)return p(yg,u.HandleResponsePlatformBroker,c,l,n.correlationId)(n,m.accountId,t,r,i,s,a,c,l,h);let y=new et(r.auth.clientId,i,new Qo(c,l),c,null,null,l);y.validateTokenResponse(m);let S={code:"",state:n.state,nonce:n.nonce,client_info:m.client_info,cloud_graph_host_name:m.cloud_graph_host_name,cloud_instance_host_name:m.cloud_instance_host_name,cloud_instance_name:m.cloud_instance_name,msgraph_host:m.msgraph_host};return yield p(y.handleServerTokenResponse.bind(y),u.HandleServerTokenResponse,c,l,n.correlationId)(m,o,me.nowSeconds(),n,S,void 0,void 0,void 0,void 0)})}var iv=32;function Pr(n,e,t){return d(this,null,function*(){n.addQueueMeasurement(u.GeneratePkceCodes,t);let r=ce(sv,u.GenerateCodeVerifier,e,n,t)(n,e,t),o=yield p(av,u.GenerateCodeChallengeFromVerifier,e,n,t)(r,n,e,t);return{verifier:r,challenge:o}})}function sv(n,e,t){try{let r=new Uint8Array(iv);return ce(Np,u.GetRandomValues,e,n,t)(r),Ke(r)}catch{throw v(Pn)}}function av(n,e,t,r){return d(this,null,function*(){e.addQueueMeasurement(u.GenerateCodeChallengeFromVerifier,r);try{let o=yield p(Kd,u.Sha256Digest,t,e,r)(n,e,r);return Ke(new Uint8Array(o))}catch{throw v(Pn)}})}var Xc=class extends Oe{constructor(e,t,r,o,i,s,a,c,l,h){super(e,t,r,o,i,s,a,l,h),this.unloadWindow=this.unloadWindow.bind(this),this.nativeStorage=c,this.eventHandler=i}acquireToken(e,t){try{let o={popupName:this.generatePopupName(e.scopes||Qe,e.authority||this.config.auth.authority),popupWindowAttributes:e.popupWindowAttributes||{},popupWindowParent:e.popupWindowParent??window};return this.performanceClient.addFields({isAsyncPopup:this.config.system.asyncPopups},this.correlationId),this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true, acquiring token"),this.acquireTokenPopupAsync(e,o,t)):(this.logger.verbose("asyncPopup set to false, opening popup before acquiring token"),o.popup=this.openSizedPopup("about:blank",o),this.acquireTokenPopupAsync(e,o,t))}catch(r){return Promise.reject(r)}}logout(e){try{this.logger.verbose("logoutPopup called");let t=this.initializeLogoutRequest(e),r={popupName:this.generateLogoutPopupName(t),popupWindowAttributes:e?.popupWindowAttributes||{},popupWindowParent:e?.popupWindowParent??window},o=e&&e.authority,i=e&&e.mainWindowRedirectUri;return this.config.system.asyncPopups?(this.logger.verbose("asyncPopups set to true"),this.logoutPopupAsync(t,r,o,i)):(this.logger.verbose("asyncPopup set to false, opening popup"),r.popup=this.openSizedPopup("about:blank",r),this.logoutPopupAsync(t,r,o,i))}catch(t){return Promise.reject(t)}}acquireTokenPopupAsync(e,t,r){return d(this,null,function*(){this.logger.verbose("acquireTokenPopupAsync called");let o=yield p(this.initializeAuthorizationRequest.bind(this),u.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,A.Popup);t.popup&&js(o.authority);let i=Be.isPlatformBrokerAvailable(this.config,this.logger,this.nativeMessageHandler,e.authenticationScheme);return o.platformBroker=i,this.config.auth.protocolMode===Z.EAR?this.executeEarFlow(o,t):this.executeCodeFlow(o,t,r)})}executeCodeFlow(e,t,r){return d(this,null,function*(){let o=e.correlationId,i=this.initializeServerTelemetryManager(B.acquireTokenPopup),s=r||(yield p(Pr,u.GeneratePkceCodes,this.logger,this.performanceClient,o)(this.performanceClient,this.logger,o)),a=T(f({},e),{codeChallenge:s.challenge});try{let c=yield p(this.createAuthCodeClient.bind(this),u.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,o)({serverTelemetryManager:i,requestAuthority:a.authority,requestAzureCloudOptions:a.azureCloudOptions,requestExtraQueryParameters:a.extraQueryParameters,account:a.account}),l=yield p(ni,u.GetAuthCodeUrl,this.logger,this.performanceClient,o)(this.config,c.authority,a,this.logger,this.performanceClient),h=this.initiateAuthRequest(l,t);this.eventHandler.emitEvent(E.POPUP_OPENED,A.Popup,{popupWindow:h},null);let m=yield this.monitorPopupForHash(h,t.popupWindowParent),y=ce(ei,u.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(m,this.config.auth.OIDCOptions.serverResponseType,this.logger);return yield p(ii,u.HandleResponseCode,this.logger,this.performanceClient,o)(e,y,s.verifier,B.acquireTokenPopup,this.config,c,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.nativeMessageHandler)}catch(c){throw t.popup?.close(),c instanceof O&&(c.setCorrelationId(this.correlationId),i.cacheFailedRequest(c)),c}})}executeEarFlow(e,t){return d(this,null,function*(){let r=e.correlationId,o=yield p(this.getDiscoveredAuthority.bind(this),u.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,r)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),i=yield p(Vo,u.GenerateEarKey,this.logger,this.performanceClient,r)(),s=T(f({},e),{earJwk:i}),a=t.popup||this.openPopup("about:blank",t);(yield oi(a.document,this.config,o,s,this.logger,this.performanceClient)).submit();let l=yield p(this.monitorPopupForHash.bind(this),u.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,r)(a,t.popupWindowParent),h=ce(ei,u.DeserializeResponse,this.logger,this.performanceClient,this.correlationId)(l,this.config.auth.OIDCOptions.serverResponseType,this.logger);return p(si,u.HandleResponseEar,this.logger,this.performanceClient,r)(s,h,B.acquireTokenPopup,this.config,o,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.nativeMessageHandler)})}logoutPopupAsync(e,t,r,o){return d(this,null,function*(){this.logger.verbose("logoutPopupAsync called"),this.eventHandler.emitEvent(E.LOGOUT_START,A.Popup,e);let i=this.initializeServerTelemetryManager(B.logoutPopup);try{yield this.clearCacheOnLogout(e.account);let s=yield p(this.createAuthCodeClient.bind(this),u.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:i,requestAuthority:r,account:e.account||void 0});try{s.authority.endSessionEndpoint}catch{if(e.account?.homeAccountId&&e.postLogoutRedirectUri&&s.authority.protocolMode===Z.OIDC){if(this.browserStorage.removeAccount(e.account?.homeAccountId),this.eventHandler.emitEvent(E.LOGOUT_SUCCESS,A.Popup,e),o){let l={apiId:B.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},h=b.getAbsoluteUrl(o,Se());yield this.navigationClient.navigateInternal(h,l)}t.popup?.close();return}}let a=s.getLogoutUri(e);this.eventHandler.emitEvent(E.LOGOUT_SUCCESS,A.Popup,e);let c=this.openPopup(a,t);if(this.eventHandler.emitEvent(E.POPUP_OPENED,A.Popup,{popupWindow:c},null),yield this.monitorPopupForHash(c,t.popupWindowParent).catch(()=>{}),o){let l={apiId:B.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},h=b.getAbsoluteUrl(o,Se());this.logger.verbose("Redirecting main window to url specified in the request"),this.logger.verbosePii(`Redirecting main window to: ${h}`),yield this.navigationClient.navigateInternal(h,l)}else this.logger.verbose("No main window navigation requested")}catch(s){throw t.popup?.close(),s instanceof O&&(s.setCorrelationId(this.correlationId),i.cacheFailedRequest(s)),this.eventHandler.emitEvent(E.LOGOUT_FAILURE,A.Popup,null,s),this.eventHandler.emitEvent(E.LOGOUT_END,A.Popup),s}this.eventHandler.emitEvent(E.LOGOUT_END,A.Popup)})}initiateAuthRequest(e,t){if(e)return this.logger.infoPii(`Navigate to: ${e}`),this.openPopup(e,t);throw this.logger.error("Navigate url is empty"),v(At)}monitorPopupForHash(e,t){return new Promise((r,o)=>{this.logger.verbose("PopupHandler.monitorPopupForHash - polling started");let i=setInterval(()=>{if(e.closed){this.logger.error("PopupHandler.monitorPopupForHash - window closed"),clearInterval(i),o(v(tt));return}let s="";try{s=e.location.href}catch{}if(!s||s==="about:blank")return;clearInterval(i);let a="",c=this.config.auth.OIDCOptions.serverResponseType;e&&(c===pt.QUERY?a=e.location.search:a=e.location.hash),this.logger.verbose("PopupHandler.monitorPopupForHash - popup window is on same origin as caller"),r(a)},this.config.system.pollIntervalMilliseconds)}).finally(()=>{this.cleanPopup(e,t)})}openPopup(e,t){try{let r;if(t.popup?(r=t.popup,this.logger.verbosePii(`Navigating popup window to: ${e}`),r.location.assign(e)):typeof t.popup>"u"&&(this.logger.verbosePii(`Opening popup window to: ${e}`),r=this.openSizedPopup(e,t)),!r)throw v(wo);return r.focus&&r.focus(),this.currentWindow=r,t.popupWindowParent.addEventListener("beforeunload",this.unloadWindow),r}catch(r){throw this.logger.error("error opening popup "+r.message),v(Io)}}openSizedPopup(e,{popupName:t,popupWindowAttributes:r,popupWindowParent:o}){let i=o.screenLeft?o.screenLeft:o.screenX,s=o.screenTop?o.screenTop:o.screenY,a=o.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,c=o.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,l=r.popupSize?.width,h=r.popupSize?.height,m=r.popupPosition?.top,y=r.popupPosition?.left;return(!l||l<0||l>a)&&(this.logger.verbose("Default popup window width used. Window width not configured or invalid."),l=ee.POPUP_WIDTH),(!h||h<0||h>c)&&(this.logger.verbose("Default popup window height used. Window height not configured or invalid."),h=ee.POPUP_HEIGHT),(!m||m<0||m>c)&&(this.logger.verbose("Default popup window top position used. Window top not configured or invalid."),m=Math.max(0,c/2-ee.POPUP_HEIGHT/2+s)),(!y||y<0||y>a)&&(this.logger.verbose("Default popup window left position used. Window left not configured or invalid."),y=Math.max(0,a/2-ee.POPUP_WIDTH/2+i)),o.open(e,t,`width=${l}, height=${h}, top=${m}, left=${y}, scrollbars=yes`)}unloadWindow(e){this.currentWindow&&this.currentWindow.close(),e.preventDefault()}cleanPopup(e,t){e.close(),t.removeEventListener("beforeunload",this.unloadWindow)}generatePopupName(e,t){return`${ee.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${e.join("-")}.${t}.${this.correlationId}`}generateLogoutPopupName(e){let t=e.account&&e.account.homeAccountId;return`${ee.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${t}.${this.correlationId}`}};function cv(){if(typeof window>"u"||typeof window.performance>"u"||typeof window.performance.getEntriesByType!="function")return;let n=window.performance.getEntriesByType("navigation");return(n.length?n[0]:void 0)?.type}var Zc=class extends Oe{constructor(e,t,r,o,i,s,a,c,l,h){super(e,t,r,o,i,s,a,l,h),this.nativeStorage=c}acquireToken(e){return d(this,null,function*(){let t=yield p(this.initializeAuthorizationRequest.bind(this),u.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,this.correlationId)(e,A.Redirect);t.platformBroker=Be.isPlatformBrokerAvailable(this.config,this.logger,this.nativeMessageHandler,e.authenticationScheme);let r=i=>{i.persisted&&(this.logger.verbose("Page was restored from back/forward cache. Clearing temporary cache."),this.browserStorage.resetRequestCache(),this.eventHandler.emitEvent(E.RESTORE_FROM_BFCACHE,A.Redirect))},o=this.getRedirectStartPage(e.redirectStartPage);this.logger.verbosePii(`Redirect start page: ${o}`),this.browserStorage.setTemporaryCache(te.ORIGIN_URI,o,!0),window.addEventListener("pageshow",r);try{this.config.auth.protocolMode===Z.EAR?yield this.executeEarFlow(t):yield this.executeCodeFlow(t,e.onRedirectNavigate)}catch(i){throw i instanceof O&&i.setCorrelationId(this.correlationId),window.removeEventListener("pageshow",r),i}})}executeCodeFlow(e,t){return d(this,null,function*(){let r=e.correlationId,o=this.initializeServerTelemetryManager(B.acquireTokenRedirect),i=yield p(Pr,u.GeneratePkceCodes,this.logger,this.performanceClient,r)(this.performanceClient,this.logger,r),s=T(f({},e),{codeChallenge:i.challenge});this.browserStorage.cacheAuthorizeRequest(s,i.verifier);try{let a=yield p(this.createAuthCodeClient.bind(this),u.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:o,requestAuthority:s.authority,requestAzureCloudOptions:s.azureCloudOptions,requestExtraQueryParameters:s.extraQueryParameters,account:s.account}),c=yield p(ni,u.GetAuthCodeUrl,this.logger,this.performanceClient,e.correlationId)(this.config,a.authority,s,this.logger,this.performanceClient);return yield this.initiateAuthRequest(c,t)}catch(a){throw a instanceof O&&(a.setCorrelationId(this.correlationId),o.cacheFailedRequest(a)),a}})}executeEarFlow(e){return d(this,null,function*(){let t=e.correlationId,r=yield p(this.getDiscoveredAuthority.bind(this),u.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,t)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),o=yield p(Vo,u.GenerateEarKey,this.logger,this.performanceClient,t)(),i=T(f({},e),{earJwk:o});this.browserStorage.cacheAuthorizeRequest(i),(yield oi(document,this.config,r,i,this.logger,this.performanceClient)).submit()})}handleRedirectPromise(e="",t,r,o){return d(this,null,function*(){let i=this.initializeServerTelemetryManager(B.handleRedirectPromise);try{let[s,a]=this.getRedirectResponse(e||"");if(!s)return this.logger.info("handleRedirectPromise did not detect a response as a result of a redirect. Cleaning temporary cache."),this.browserStorage.resetRequestCache(),cv()!=="back_forward"?o.event.errorCode="no_server_response":this.logger.verbose("Back navigation event detected. Muting no_server_response error"),null;let c=this.browserStorage.getTemporaryCache(te.ORIGIN_URI,!0)||g.EMPTY_STRING,l=b.removeHashFromUrl(c),h=b.removeHashFromUrl(window.location.href);if(l===h&&this.config.auth.navigateToLoginRequestUrl)return this.logger.verbose("Current page is loginRequestUrl, handling response"),c.indexOf("#")>-1&&qd(c),yield this.handleResponse(s,t,r,i);if(this.config.auth.navigateToLoginRequestUrl){if(!Ks()||this.config.system.allowRedirectInIframe){this.browserStorage.setTemporaryCache(te.URL_HASH,a,!0);let m={apiId:B.handleRedirectPromise,timeout:this.config.system.redirectNavigationTimeout,noHistory:!0},y=!0;if(!c||c==="null"){let S=Vd();this.browserStorage.setTemporaryCache(te.ORIGIN_URI,S,!0),this.logger.warning("Unable to get valid login request url from cache, redirecting to home page"),y=yield this.navigationClient.navigateInternal(S,m)}else this.logger.verbose(`Navigating to loginRequestUrl: ${c}`),y=yield this.navigationClient.navigateInternal(c,m);if(!y)return yield this.handleResponse(s,t,r,i)}}else return this.logger.verbose("NavigateToLoginRequestUrl set to false, handling response"),yield this.handleResponse(s,t,r,i);return null}catch(s){throw s instanceof O&&(s.setCorrelationId(this.correlationId),i.cacheFailedRequest(s)),s}})}getRedirectResponse(e){this.logger.verbose("getRedirectResponseHash called");let t=e;t||(this.config.auth.OIDCOptions.serverResponseType===pt.QUERY?t=window.location.search:t=window.location.hash);let r=vr.getDeserializedResponse(t);if(r){try{mg(r,this.browserCrypto,A.Redirect)}catch(i){return i instanceof O&&this.logger.error(`Interaction type validation failed due to ${i.errorCode}: ${i.errorMessage}`),[null,""]}return Gs(window),this.logger.verbose("Hash contains known properties, returning response hash"),[r,t]}let o=this.browserStorage.getTemporaryCache(te.URL_HASH,!0);return this.browserStorage.removeItem(this.browserStorage.generateCacheKey(te.URL_HASH)),o&&(r=vr.getDeserializedResponse(o),r)?(this.logger.verbose("Hash does not contain known properties, returning cached hash"),[r,o]):[null,""]}handleResponse(e,t,r,o){return d(this,null,function*(){if(!e.state)throw v(Ir);if(e.ear_jwe){let a=yield p(this.getDiscoveredAuthority.bind(this),u.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,t.correlationId)({requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account});return p(si,u.HandleResponseEar,this.logger,this.performanceClient,t.correlationId)(t,e,B.acquireTokenRedirect,this.config,a,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.nativeMessageHandler)}let s=yield p(this.createAuthCodeClient.bind(this),u.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:o,requestAuthority:t.authority});return p(ii,u.HandleResponseCode,this.logger,this.performanceClient,t.correlationId)(t,e,r,B.acquireTokenRedirect,this.config,s,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.nativeMessageHandler)})}initiateAuthRequest(e,t){return d(this,null,function*(){if(this.logger.verbose("RedirectHandler.initiateAuthRequest called"),e){this.logger.infoPii(`RedirectHandler.initiateAuthRequest: Navigate to: ${e}`);let r={apiId:B.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},o=t||this.config.auth.onRedirectNavigate;if(typeof o=="function")if(this.logger.verbose("RedirectHandler.initiateAuthRequest: Invoking onRedirectNavigate callback"),o(e)!==!1){this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate did not return false, navigating"),yield this.navigationClient.navigateExternal(e,r);return}else{this.logger.verbose("RedirectHandler.initiateAuthRequest: onRedirectNavigate returned false, stopping navigation");return}else{this.logger.verbose("RedirectHandler.initiateAuthRequest: Navigating window to navigate url"),yield this.navigationClient.navigateExternal(e,r);return}}else throw this.logger.info("RedirectHandler.initiateAuthRequest: Navigate url is empty"),v(At)})}logout(e){return d(this,null,function*(){this.logger.verbose("logoutRedirect called");let t=this.initializeLogoutRequest(e),r=this.initializeServerTelemetryManager(B.logout);try{this.eventHandler.emitEvent(E.LOGOUT_START,A.Redirect,e),yield this.clearCacheOnLogout(t.account);let o={apiId:B.logout,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},i=yield p(this.createAuthCodeClient.bind(this),u.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:r,requestAuthority:e&&e.authority,requestExtraQueryParameters:e?.extraQueryParameters,account:e&&e.account||void 0});if(i.authority.protocolMode===Z.OIDC)try{i.authority.endSessionEndpoint}catch{if(t.account?.homeAccountId){this.browserStorage.removeAccount(t.account?.homeAccountId),this.eventHandler.emitEvent(E.LOGOUT_SUCCESS,A.Redirect,t);return}}let s=i.getLogoutUri(t);if(this.eventHandler.emitEvent(E.LOGOUT_SUCCESS,A.Redirect,t),e&&typeof e.onRedirectNavigate=="function")if(e.onRedirectNavigate(s)!==!1){this.logger.verbose("Logout onRedirectNavigate did not return false, navigating"),this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0,rt.SIGNOUT),yield this.navigationClient.navigateExternal(s,o);return}else this.browserStorage.setInteractionInProgress(!1),this.logger.verbose("Logout onRedirectNavigate returned false, stopping navigation");else{this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0,rt.SIGNOUT),yield this.navigationClient.navigateExternal(s,o);return}}catch(o){throw o instanceof O&&(o.setCorrelationId(this.correlationId),r.cacheFailedRequest(o)),this.eventHandler.emitEvent(E.LOGOUT_FAILURE,A.Redirect,null,o),this.eventHandler.emitEvent(E.LOGOUT_END,A.Redirect),o}this.eventHandler.emitEvent(E.LOGOUT_END,A.Redirect)})}getRedirectStartPage(e){let t=e||window.location.href;return b.getAbsoluteUrl(t,Se())}};function vg(n,e,t,r,o){return d(this,null,function*(){if(e.addQueueMeasurement(u.SilentHandlerInitiateAuthRequest,r),!n)throw t.info("Navigate url is empty"),v(At);return o?p(uv,u.SilentHandlerLoadFrame,t,e,r)(n,o,e,r):ce(lv,u.SilentHandlerLoadFrameSync,t,e,r)(n)})}function Eg(n,e,t,r,o){return d(this,null,function*(){let i=Qd();if(!i.contentDocument)throw"No document associated with iframe!";return(yield oi(i.contentDocument,n,e,t,r,o)).submit(),i})}function Yd(n,e,t,r,o,i,s){return d(this,null,function*(){return r.addQueueMeasurement(u.SilentHandlerMonitorIframeForHash,i),new Promise((a,c)=>{e<Gc&&o.warning(`system.loadFrameTimeout or system.iframeHashTimeout set to lower (${e}ms) than the default (${Gc}ms). This may result in timeouts.`);let l=window.setTimeout(()=>{window.clearInterval(h),c(v(Ro))},e),h=window.setInterval(()=>{let m="",y=n.contentWindow;try{m=y?y.location.href:""}catch{}if(!m||m==="about:blank")return;let S="";y&&(s===pt.QUERY?S=y.location.search:S=y.location.hash),window.clearTimeout(l),window.clearInterval(h),a(S)},t)}).finally(()=>{ce(dv,u.RemoveHiddenIframe,o,r,i)(n)})})}function uv(n,e,t,r){return t.addQueueMeasurement(u.SilentHandlerLoadFrame,r),new Promise((o,i)=>{let s=Qd();window.setTimeout(()=>{if(!s){i("Unable to load iframe");return}s.src=n,o(s)},e)})}function lv(n){let e=Qd();return e.src=n,e}function Qd(){let n=document.createElement("iframe");return n.className="msalSilentIframe",n.style.visibility="hidden",n.style.position="absolute",n.style.width=n.style.height="0",n.style.border="0",n.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),document.body.appendChild(n),n}function dv(n){document.body===n.parentNode&&document.body.removeChild(n)}var eu=class extends Oe{constructor(e,t,r,o,i,s,a,c,l,h,m){super(e,t,r,o,i,s,c,h,m),this.apiId=a,this.nativeStorage=l}acquireToken(e){return d(this,null,function*(){this.performanceClient.addQueueMeasurement(u.SilentIframeClientAcquireToken,e.correlationId),!e.loginHint&&!e.sid&&(!e.account||!e.account.username)&&this.logger.warning("No user hint provided. The authorization server may need more information to complete this request.");let t=f({},e);t.prompt?t.prompt!==W.NONE&&t.prompt!==W.NO_SESSION&&(this.logger.warning(`SilentIframeClient. Replacing invalid prompt ${t.prompt} with ${W.NONE}`),t.prompt=W.NONE):t.prompt=W.NONE;let r=yield p(this.initializeAuthorizationRequest.bind(this),u.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(t,A.Silent);return r.platformBroker=Be.isPlatformBrokerAvailable(this.config,this.logger,this.nativeMessageHandler,r.authenticationScheme),js(r.authority),this.config.auth.protocolMode===Z.EAR?this.executeEarFlow(r):this.executeCodeFlow(r)})}executeCodeFlow(e){return d(this,null,function*(){let t,r=this.initializeServerTelemetryManager(this.apiId);try{return t=yield p(this.createAuthCodeClient.bind(this),u.StandardInteractionClientCreateAuthCodeClient,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:r,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),yield p(this.silentTokenHelper.bind(this),u.SilentIframeClientTokenHelper,this.logger,this.performanceClient,e.correlationId)(t,e)}catch(o){if(o instanceof O&&(o.setCorrelationId(this.correlationId),r.cacheFailedRequest(o)),!t||!(o instanceof O)||o.errorCode!==ee.INVALID_GRANT_ERROR)throw o;return this.performanceClient.addFields({retryError:o.errorCode},this.correlationId),yield p(this.silentTokenHelper.bind(this),u.SilentIframeClientTokenHelper,this.logger,this.performanceClient,this.correlationId)(t,e)}})}executeEarFlow(e){return d(this,null,function*(){let t=e.correlationId,r=yield p(this.getDiscoveredAuthority.bind(this),u.StandardInteractionClientGetDiscoveredAuthority,this.logger,this.performanceClient,t)({requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),o=yield p(Vo,u.GenerateEarKey,this.logger,this.performanceClient,t)(),i=T(f({},e),{earJwk:o}),s=yield p(Eg,u.SilentHandlerInitiateAuthRequest,this.logger,this.performanceClient,t)(this.config,r,i,this.logger,this.performanceClient),a=this.config.auth.OIDCOptions.serverResponseType,c=yield p(Yd,u.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,t)(s,this.config.system.iframeHashTimeout,this.config.system.pollIntervalMilliseconds,this.performanceClient,this.logger,t,a),l=ce(ei,u.DeserializeResponse,this.logger,this.performanceClient,t)(c,a,this.logger);return p(si,u.HandleResponseEar,this.logger,this.performanceClient,t)(i,l,this.apiId,this.config,r,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.nativeMessageHandler)})}logout(){return Promise.reject(v(Tt))}silentTokenHelper(e,t){return d(this,null,function*(){let r=t.correlationId;this.performanceClient.addQueueMeasurement(u.SilentIframeClientTokenHelper,r);let o=yield p(Pr,u.GeneratePkceCodes,this.logger,this.performanceClient,r)(this.performanceClient,this.logger,r),i=T(f({},t),{codeChallenge:o.challenge}),s=yield p(ni,u.GetAuthCodeUrl,this.logger,this.performanceClient,r)(this.config,e.authority,i,this.logger,this.performanceClient),a=yield p(vg,u.SilentHandlerInitiateAuthRequest,this.logger,this.performanceClient,r)(s,this.performanceClient,this.logger,r,this.config.system.navigateFrameWait),c=this.config.auth.OIDCOptions.serverResponseType,l=yield p(Yd,u.SilentHandlerMonitorIframeForHash,this.logger,this.performanceClient,r)(a,this.config.system.iframeHashTimeout,this.config.system.pollIntervalMilliseconds,this.performanceClient,this.logger,r,c),h=ce(ei,u.DeserializeResponse,this.logger,this.performanceClient,r)(l,c,this.logger);return p(ii,u.HandleResponseCode,this.logger,this.performanceClient,r)(t,h,o.verifier,this.apiId,this.config,e,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.nativeMessageHandler)})}};var tu=class extends Oe{acquireToken(e){return d(this,null,function*(){this.performanceClient.addQueueMeasurement(u.SilentRefreshClientAcquireToken,e.correlationId);let t=yield p(Ys,u.InitializeBaseRequest,this.logger,this.performanceClient,e.correlationId)(e,this.config,this.performanceClient,this.logger),r=f(f({},e),t);e.redirectUri&&(r.redirectUri=this.getRedirectUri(e.redirectUri));let o=this.initializeServerTelemetryManager(B.acquireTokenSilent_silentFlow),i=yield this.createRefreshTokenClient({serverTelemetryManager:o,authorityUrl:r.authority,azureCloudOptions:r.azureCloudOptions,account:r.account});return p(i.acquireTokenByRefreshToken.bind(i),u.RefreshTokenClientAcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(r).catch(s=>{throw s.setCorrelationId(this.correlationId),o.cacheFailedRequest(s),s})})}logout(){return Promise.reject(v(Tt))}createRefreshTokenClient(e){return d(this,null,function*(){let t=yield p(this.getClientConfiguration.bind(this),u.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:e.serverTelemetryManager,requestAuthority:e.authorityUrl,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account});return new Fs(t,this.performanceClient)})}};var ru=class{constructor(e,t,r,o){this.isBrowserEnvironment=typeof window<"u",this.config=e,this.storage=t,this.logger=r,this.cryptoObj=o}loadExternalTokens(e,t,r){return d(this,null,function*(){if(!this.isBrowserEnvironment)throw v(St);let o=e.correlationId||de(),i=t.id_token?ao.extractTokenClaims(t.id_token,ye):void 0,s={protocolMode:this.config.auth.protocolMode,knownAuthorities:this.config.auth.knownAuthorities,cloudDiscoveryMetadata:this.config.auth.cloudDiscoveryMetadata,authorityMetadata:this.config.auth.authorityMetadata,skipAuthorityMetadataCache:this.config.auth.skipAuthorityMetadataCache},a=e.authority?new Ge(Ge.generateAuthority(e.authority,e.azureCloudOptions),this.config.system.networkClient,this.storage,s,this.logger,e.correlationId||de()):void 0,c=yield this.loadAccount(e,r.clientInfo||t.client_info||"",o,i,a),l=yield this.loadIdToken(t,c.homeAccountId,c.environment,c.realm,o),h=yield this.loadAccessToken(e,t,c.homeAccountId,c.environment,c.realm,r,o),m=yield this.loadRefreshToken(t,c.homeAccountId,c.environment,o);return this.generateAuthenticationResult(e,{account:c,idToken:l,accessToken:h,refreshToken:m},i,a)})}loadAccount(e,t,r,o,i){return d(this,null,function*(){if(this.logger.verbose("TokenCache - loading account"),e.account){let l=oe.createFromAccountInfo(e.account);return yield this.storage.setAccount(l,r),l}else if(!i||!t&&!o)throw this.logger.error("TokenCache - if an account is not provided on the request, authority and either clientInfo or idToken must be provided instead."),v(Lo);let s=oe.generateHomeAccountId(t,i.authorityType,this.logger,this.cryptoObj,o),a=o?.tid,c=Co(this.storage,i,s,ye,o,t,i.hostnameAndPort,a,void 0,void 0,this.logger);return yield this.storage.setAccount(c,r),c})}loadIdToken(e,t,r,o,i){return d(this,null,function*(){if(!e.id_token)return this.logger.verbose("TokenCache - no id token found in response"),null;this.logger.verbose("TokenCache - loading id token");let s=Q.createIdTokenEntity(t,r,e.id_token,this.config.auth.clientId,o);return yield this.storage.setIdTokenCredential(s,i),s})}loadAccessToken(e,t,r,o,i,s,a){return d(this,null,function*(){if(t.access_token)if(t.expires_in){if(!t.scope&&(!e.scopes||!e.scopes.length))return this.logger.error("TokenCache - scopes not specified in the request or response. Cannot add token to the cache."),null}else return this.logger.error("TokenCache - no expiration set on the access token. Cannot add it to the cache."),null;else return this.logger.verbose("TokenCache - no access token found in response"),null;this.logger.verbose("TokenCache - loading access token");let c=t.scope?j.fromString(t.scope):new j(e.scopes),l=s.expiresOn||t.expires_in+me.nowSeconds(),h=s.extendedExpiresOn||(t.ext_expires_in||t.expires_in)+me.nowSeconds(),m=Q.createAccessTokenEntity(r,o,t.access_token,this.config.auth.clientId,i,c.printScopes(),l,h,ye);return yield this.storage.setAccessTokenCredential(m,a),m})}loadRefreshToken(e,t,r,o){return d(this,null,function*(){if(!e.refresh_token)return this.logger.verbose("TokenCache - no refresh token found in response"),null;this.logger.verbose("TokenCache - loading refresh token");let i=Q.createRefreshTokenEntity(t,r,e.refresh_token,this.config.auth.clientId,e.foci,void 0,e.refresh_token_expires_in);return yield this.storage.setRefreshTokenCredential(i,o),i})}generateAuthenticationResult(e,t,r,o){let i="",s=[],a=null,c;t?.accessToken&&(i=t.accessToken.secret,s=j.fromString(t.accessToken.target).asArray(),a=me.toDateFromSeconds(t.accessToken.expiresOn),c=me.toDateFromSeconds(t.accessToken.extendedExpiresOn));let l=t.account;return{authority:o?o.canonicalAuthority:"",uniqueId:t.account.localAccountId,tenantId:t.account.realm,scopes:s,account:l.getAccountInfo(),idToken:t.idToken?.secret||"",idTokenClaims:r||{},accessToken:i,fromCache:!0,expiresOn:a,correlationId:e.correlationId||"",requestId:"",extExpiresOn:c,familyId:t.refreshToken?.familyId||"",tokenType:t?.accessToken?.tokenType||"",state:e.state||"",cloudGraphHostName:l.cloudGraphHostName||"",msGraphHost:l.msGraphHost||"",fromNativeBroker:!1}}};var nu=class extends On{constructor(e){super(e),this.includeRedirectUri=!1}};var ou=class extends Oe{constructor(e,t,r,o,i,s,a,c,l,h){super(e,t,r,o,i,s,c,l,h),this.apiId=a}acquireToken(e){return d(this,null,function*(){if(!e.code)throw v(Fo);let t=yield p(this.initializeAuthorizationRequest.bind(this),u.StandardInteractionClientInitializeAuthorizationRequest,this.logger,this.performanceClient,e.correlationId)(e,A.Silent),r=this.initializeServerTelemetryManager(this.apiId);try{let o=T(f({},t),{code:e.code}),i=yield p(this.getClientConfiguration.bind(this),u.StandardInteractionClientGetClientConfiguration,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:r,requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account}),s=new nu(i);this.logger.verbose("Auth code client created");let a=new ti(s,this.browserStorage,o,this.logger,this.performanceClient);return yield p(a.handleCodeResponseFromServer.bind(a),u.HandleCodeResponseFromServer,this.logger,this.performanceClient,e.correlationId)({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},t,!1)}catch(o){throw o instanceof O&&(o.setCorrelationId(this.correlationId),r.cacheFailedRequest(o)),o}})}logout(){return Promise.reject(v(Tt))}};function Ag(n,e,t){let r=window.msal?.clientIds||[],o=r.length,i=r.filter(s=>s===n).length;i>1&&t.warning("There is already an instance of MSAL.js in the window with the same client id."),e.add({msalInstanceCount:o,sameClientIdInstanceCount:i})}function _t(n){let e=n?.idTokenClaims;if(e?.tfp||e?.acr)return"B2C";if(e?.tid){if(e?.tid==="9188040d-6c67-4c5b-b112-36a304b66dad")return"MSA"}else return;return"AAD"}function iu(n,e){try{zs(n)}catch(t){throw e.end({success:!1},t),t}}var ai=class n{constructor(e){this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.initialized=!1,this.logger=this.operatingContext.getLogger(),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new Qo(this.logger,this.performanceClient):mr,this.eventHandler=new Qc(this.logger),this.browserStorage=this.isBrowserEnvironment?new Xo(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler,Rd(this.config.auth)):Zp(this.config.auth.clientId,this.logger,this.performanceClient,this.eventHandler);let t={cacheLocation:q.MemoryStorage,temporaryCacheLocation:q.MemoryStorage,storeAuthStateInCookie:!1,secureCookies:!1,cacheMigrationEnabled:!1,claimsBasedCachingEnabled:!1};this.nativeInternalStorage=new Xo(this.config.auth.clientId,t,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler),this.tokenCache=new ru(this.config,this.browserStorage,this.logger,this.browserCrypto),this.activeSilentTokenRequests=new Map,this.trackPageVisibility=this.trackPageVisibility.bind(this),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this)}static createController(e,t){return d(this,null,function*(){let r=new n(e);return yield r.initialize(t),r})}trackPageVisibility(e){e&&(this.logger.info("Perf: Visibility change detected"),this.performanceClient.incrementFields({visibilityChangeCount:1},e))}initialize(e,t){return d(this,null,function*(){if(this.logger.trace("initialize called"),this.initialized){this.logger.info("initialize has already been called, exiting early.");return}if(!this.isBrowserEnvironment){this.logger.info("in non-browser environment, exiting early."),this.initialized=!0,this.eventHandler.emitEvent(E.INITIALIZE_END);return}let r=e?.correlationId||this.getRequestCorrelationId(),o=this.config.system.allowPlatformBroker,i=this.performanceClient.startMeasurement(u.InitializeClientApplication,r);if(this.eventHandler.emitEvent(E.INITIALIZE_START),!t)try{this.logMultipleInstances(i)}catch{}if(yield p(this.browserStorage.initialize.bind(this.browserStorage),u.InitializeCache,this.logger,this.performanceClient,r)(r),o)try{this.nativeExtensionProvider=yield Be.createProvider(this.logger,this.config.system.nativeBrokerHandshakeTimeout,this.performanceClient)}catch(s){this.logger.verbose(s)}this.config.cache.claimsBasedCachingEnabled||(this.logger.verbose("Claims-based caching is disabled. Clearing the previous cache with claims"),yield p(this.browserStorage.clearTokensAndKeysWithClaims.bind(this.browserStorage),u.ClearTokensAndKeysWithClaims,this.logger,this.performanceClient,r)(this.performanceClient,r)),this.config.system.asyncPopups&&(yield this.preGeneratePkceCodes(r)),this.initialized=!0,this.eventHandler.emitEvent(E.INITIALIZE_END),i.end({allowPlatformBroker:o,success:!0})})}handleRedirectPromise(e){return d(this,null,function*(){if(this.logger.verbose("handleRedirectPromise called"),xc(this.initialized),this.isBrowserEnvironment){let t=e||"",r=this.redirectResponse.get(t);return typeof r>"u"?(r=this.handleRedirectPromiseInternal(e),this.redirectResponse.set(t,r),this.logger.verbose("handleRedirectPromise has been called for the first time, storing the promise")):this.logger.verbose("handleRedirectPromise has been called previously, returning the result from the first call"),r}return this.logger.verbose("handleRedirectPromise returns null, not browser environment"),null})}handleRedirectPromiseInternal(e){return d(this,null,function*(){if(!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("handleRedirectPromise called but there is no interaction in progress, returning null."),null;if(this.browserStorage.getInteractionInProgress()?.type===rt.SIGNOUT)return this.logger.verbose("handleRedirectPromise removing interaction_in_progress flag and returning null after sign-out"),this.browserStorage.setInteractionInProgress(!1),Promise.resolve(null);let r=this.getAllAccounts(),o=this.browserStorage.getCachedNativeRequest(),i=o&&Be.isPlatformBrokerAvailable(this.config,this.logger,this.nativeExtensionProvider)&&this.nativeExtensionProvider&&!e,s;this.eventHandler.emitEvent(E.HANDLE_REDIRECT_START,A.Redirect);let a;try{if(i&&this.nativeExtensionProvider){s=this.performanceClient.startMeasurement(u.AcquireTokenRedirect,o?.correlationId||""),this.logger.trace("handleRedirectPromise - acquiring token from native platform");let c=new Mr(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,B.handleRedirectPromise,this.performanceClient,this.nativeExtensionProvider,o.accountId,this.nativeInternalStorage,o.correlationId);a=p(c.handleRedirectPromise.bind(c),u.HandleNativeRedirectPromiseMeasurement,this.logger,this.performanceClient,s.event.correlationId)(this.performanceClient,s.event.correlationId)}else{let[c,l]=this.browserStorage.getCachedRequest(),h=c.correlationId;s=this.performanceClient.startMeasurement(u.AcquireTokenRedirect,h),this.logger.trace("handleRedirectPromise - acquiring token from web flow");let m=this.createRedirectClient(h);a=p(m.handleRedirectPromise.bind(m),u.HandleRedirectPromiseMeasurement,this.logger,this.performanceClient,s.event.correlationId)(e,c,l,s)}}catch(c){throw this.browserStorage.resetRequestCache(),c}return a.then(c=>(c?(this.browserStorage.resetRequestCache(),r.length<this.getAllAccounts().length?(this.eventHandler.emitEvent(E.LOGIN_SUCCESS,A.Redirect,c),this.logger.verbose("handleRedirectResponse returned result, login success")):(this.eventHandler.emitEvent(E.ACQUIRE_TOKEN_SUCCESS,A.Redirect,c),this.logger.verbose("handleRedirectResponse returned result, acquire token success")),s.end({success:!0,accountType:_t(c.account)})):s.event.errorCode?s.end({success:!1}):s.discard(),this.eventHandler.emitEvent(E.HANDLE_REDIRECT_END,A.Redirect),c)).catch(c=>{this.browserStorage.resetRequestCache();let l=c;throw r.length>0?this.eventHandler.emitEvent(E.ACQUIRE_TOKEN_FAILURE,A.Redirect,null,l):this.eventHandler.emitEvent(E.LOGIN_FAILURE,A.Redirect,null,l),this.eventHandler.emitEvent(E.HANDLE_REDIRECT_END,A.Redirect),s.end({success:!1},l),c})})}acquireTokenRedirect(e){return d(this,null,function*(){let t=this.getRequestCorrelationId(e);this.logger.verbose("acquireTokenRedirect called",t);let r=this.performanceClient.startMeasurement(u.AcquireTokenPreRedirect,t);r.add({accountType:_t(e.account),scenarioId:e.scenarioId});let o=e.onRedirectNavigate;if(o)e.onRedirectNavigate=s=>{let a=typeof o=="function"?o(s):void 0;return a!==!1?r.end({success:!0}):r.discard(),a};else{let s=this.config.auth.onRedirectNavigate;this.config.auth.onRedirectNavigate=a=>{let c=typeof s=="function"?s(a):void 0;return c!==!1?r.end({success:!0}):r.discard(),c}}let i=this.getAllAccounts().length>0;try{Bc(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0,rt.SIGNIN),i?this.eventHandler.emitEvent(E.ACQUIRE_TOKEN_START,A.Redirect,e):this.eventHandler.emitEvent(E.LOGIN_START,A.Redirect,e);let s;return this.nativeExtensionProvider&&this.canUsePlatformBroker(e)?s=new Mr(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,B.acquireTokenRedirect,this.performanceClient,this.nativeExtensionProvider,this.getNativeAccountId(e),this.nativeInternalStorage,t).acquireTokenRedirect(e,r).catch(c=>{if(c instanceof ze&&Or(c))return this.nativeExtensionProvider=void 0,this.createRedirectClient(t).acquireToken(e);if(c instanceof he)return this.logger.verbose("acquireTokenRedirect - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createRedirectClient(t).acquireToken(e);throw c}):s=this.createRedirectClient(t).acquireToken(e),yield s}catch(s){throw this.browserStorage.resetRequestCache(),r.end({success:!1},s),i?this.eventHandler.emitEvent(E.ACQUIRE_TOKEN_FAILURE,A.Redirect,null,s):this.eventHandler.emitEvent(E.LOGIN_FAILURE,A.Redirect,null,s),s}})}acquireTokenPopup(e){let t=this.getRequestCorrelationId(e),r=this.performanceClient.startMeasurement(u.AcquireTokenPopup,t);r.add({scenarioId:e.scenarioId,accountType:_t(e.account)});try{this.logger.verbose("acquireTokenPopup called",t),iu(this.initialized,r),this.browserStorage.setInteractionInProgress(!0,rt.SIGNIN)}catch(a){return Promise.reject(a)}let o=this.getAllAccounts();o.length>0?this.eventHandler.emitEvent(E.ACQUIRE_TOKEN_START,A.Popup,e):this.eventHandler.emitEvent(E.LOGIN_START,A.Popup,e);let i,s=this.getPreGeneratedPkceCodes(t);return this.canUsePlatformBroker(e)?i=this.acquireTokenNative(T(f({},e),{correlationId:t}),B.acquireTokenPopup).then(a=>(r.end({success:!0,isNativeBroker:!0,accountType:_t(a.account)}),a)).catch(a=>{if(a instanceof ze&&Or(a))return this.nativeExtensionProvider=void 0,this.createPopupClient(t).acquireToken(e,s);if(a instanceof he)return this.logger.verbose("acquireTokenPopup - Resolving interaction required error thrown by native broker by falling back to web flow"),this.createPopupClient(t).acquireToken(e,s);throw a}):i=this.createPopupClient(t).acquireToken(e,s),i.then(a=>(o.length<this.getAllAccounts().length?this.eventHandler.emitEvent(E.LOGIN_SUCCESS,A.Popup,a):this.eventHandler.emitEvent(E.ACQUIRE_TOKEN_SUCCESS,A.Popup,a),r.end({success:!0,accessTokenSize:a.accessToken.length,idTokenSize:a.idToken.length,accountType:_t(a.account)}),a)).catch(a=>(o.length>0?this.eventHandler.emitEvent(E.ACQUIRE_TOKEN_FAILURE,A.Popup,null,a):this.eventHandler.emitEvent(E.LOGIN_FAILURE,A.Popup,null,a),r.end({success:!1},a),Promise.reject(a))).finally(()=>d(this,null,function*(){this.browserStorage.setInteractionInProgress(!1),this.config.system.asyncPopups&&(yield this.preGeneratePkceCodes(t))}))}trackPageVisibilityWithMeasurement(){let e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&(this.logger.info("Perf: Visibility change detected in ",e.event.name),e.increment({visibilityChangeCount:1}))}ssoSilent(e){return d(this,null,function*(){let t=this.getRequestCorrelationId(e),r=T(f({},e),{prompt:e.prompt,correlationId:t});this.ssoSilentMeasurement=this.performanceClient.startMeasurement(u.SsoSilent,t),this.ssoSilentMeasurement?.add({scenarioId:e.scenarioId,accountType:_t(e.account)}),iu(this.initialized,this.ssoSilentMeasurement),this.ssoSilentMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),this.logger.verbose("ssoSilent called",t),this.eventHandler.emitEvent(E.SSO_SILENT_START,A.Silent,r);let o;return this.canUsePlatformBroker(r)?o=this.acquireTokenNative(r,B.ssoSilent).catch(i=>{if(i instanceof ze&&Or(i))return this.nativeExtensionProvider=void 0,this.createSilentIframeClient(r.correlationId).acquireToken(r);throw i}):o=this.createSilentIframeClient(r.correlationId).acquireToken(r),o.then(i=>(this.eventHandler.emitEvent(E.SSO_SILENT_SUCCESS,A.Silent,i),this.ssoSilentMeasurement?.end({success:!0,isNativeBroker:i.fromNativeBroker,accessTokenSize:i.accessToken.length,idTokenSize:i.idToken.length,accountType:_t(i.account)}),i)).catch(i=>{throw this.eventHandler.emitEvent(E.SSO_SILENT_FAILURE,A.Silent,null,i),this.ssoSilentMeasurement?.end({success:!1},i),i}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})})}acquireTokenByCode(e){return d(this,null,function*(){let t=this.getRequestCorrelationId(e);this.logger.trace("acquireTokenByCode called",t);let r=this.performanceClient.startMeasurement(u.AcquireTokenByCode,t);iu(this.initialized,r),this.eventHandler.emitEvent(E.ACQUIRE_TOKEN_BY_CODE_START,A.Silent,e),r.add({scenarioId:e.scenarioId});try{if(e.code&&e.nativeAccountId)throw v(xo);if(e.code){let o=e.code,i=this.hybridAuthCodeResponses.get(o);return i?(this.logger.verbose("Existing acquireTokenByCode request found",t),r.discard()):(this.logger.verbose("Initiating new acquireTokenByCode request",t),i=this.acquireTokenByCodeAsync(T(f({},e),{correlationId:t})).then(s=>(this.eventHandler.emitEvent(E.ACQUIRE_TOKEN_BY_CODE_SUCCESS,A.Silent,s),this.hybridAuthCodeResponses.delete(o),r.end({success:!0,isNativeBroker:s.fromNativeBroker,accessTokenSize:s.accessToken.length,idTokenSize:s.idToken.length,accountType:_t(s.account)}),s)).catch(s=>{throw this.hybridAuthCodeResponses.delete(o),this.eventHandler.emitEvent(E.ACQUIRE_TOKEN_BY_CODE_FAILURE,A.Silent,null,s),r.end({success:!1},s),s}),this.hybridAuthCodeResponses.set(o,i)),yield i}else if(e.nativeAccountId)if(this.canUsePlatformBroker(e,e.nativeAccountId)){let o=yield this.acquireTokenNative(T(f({},e),{correlationId:t}),B.acquireTokenByCode,e.nativeAccountId).catch(i=>{throw i instanceof ze&&Or(i)&&(this.nativeExtensionProvider=void 0),i});return r.end({accountType:_t(o.account),success:!0}),o}else throw v(Bo);else throw v(Uo)}catch(o){throw this.eventHandler.emitEvent(E.ACQUIRE_TOKEN_BY_CODE_FAILURE,A.Silent,null,o),r.end({success:!1},o),o}})}acquireTokenByCodeAsync(e){return d(this,null,function*(){return this.logger.trace("acquireTokenByCodeAsync called",e.correlationId),this.acquireTokenByCodeAsyncMeasurement=this.performanceClient.startMeasurement(u.AcquireTokenByCodeAsync,e.correlationId),this.acquireTokenByCodeAsyncMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),yield this.createSilentAuthCodeClient(e.correlationId).acquireToken(e).then(o=>(this.acquireTokenByCodeAsyncMeasurement?.end({success:!0,fromCache:o.fromCache,isNativeBroker:o.fromNativeBroker}),o)).catch(o=>{throw this.acquireTokenByCodeAsyncMeasurement?.end({success:!1},o),o}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})})}acquireTokenFromCache(e,t){return d(this,null,function*(){switch(this.performanceClient.addQueueMeasurement(u.AcquireTokenFromCache,e.correlationId),t){case fe.Default:case fe.AccessToken:case fe.AccessTokenAndRefreshToken:let r=this.createSilentCacheClient(e.correlationId);return p(r.acquireToken.bind(r),u.SilentCacheClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw C(ae.tokenRefreshRequired)}})}acquireTokenByRefreshToken(e,t){return d(this,null,function*(){switch(this.performanceClient.addQueueMeasurement(u.AcquireTokenByRefreshToken,e.correlationId),t){case fe.Default:case fe.AccessTokenAndRefreshToken:case fe.RefreshToken:case fe.RefreshTokenAndNetwork:let r=this.createSilentRefreshClient(e.correlationId);return p(r.acquireToken.bind(r),u.SilentRefreshClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e);default:throw C(ae.tokenRefreshRequired)}})}acquireTokenBySilentIframe(e){return d(this,null,function*(){this.performanceClient.addQueueMeasurement(u.AcquireTokenBySilentIframe,e.correlationId);let t=this.createSilentIframeClient(e.correlationId);return p(t.acquireToken.bind(t),u.SilentIframeClientAcquireToken,this.logger,this.performanceClient,e.correlationId)(e)})}logout(e){return d(this,null,function*(){let t=this.getRequestCorrelationId(e);return this.logger.warning("logout API is deprecated and will be removed in msal-browser v3.0.0. Use logoutRedirect instead.",t),this.logoutRedirect(f({correlationId:t},e))})}logoutRedirect(e){return d(this,null,function*(){let t=this.getRequestCorrelationId(e);return Bc(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0,rt.SIGNOUT),this.createRedirectClient(t).logout(e)})}logoutPopup(e){try{let t=this.getRequestCorrelationId(e);return zs(this.initialized),this.browserStorage.setInteractionInProgress(!0,rt.SIGNOUT),this.createPopupClient(t).logout(e).finally(()=>{this.browserStorage.setInteractionInProgress(!1)})}catch(t){return Promise.reject(t)}}clearCache(e){return d(this,null,function*(){if(!this.isBrowserEnvironment){this.logger.info("in non-browser environment, returning early.");return}let t=this.getRequestCorrelationId(e);return this.createSilentCacheClient(t).logout(e)})}getAllAccounts(e){return eg(this.logger,this.browserStorage,this.isBrowserEnvironment,e)}getAccount(e){return tg(e,this.logger,this.browserStorage)}getAccountByUsername(e){return rg(e,this.logger,this.browserStorage)}getAccountByHomeId(e){return ng(e,this.logger,this.browserStorage)}getAccountByLocalId(e){return og(e,this.logger,this.browserStorage)}setActiveAccount(e){ig(e,this.browserStorage)}getActiveAccount(){return sg(this.browserStorage)}hydrateCache(e,t){return d(this,null,function*(){this.logger.verbose("hydrateCache called");let r=oe.createFromAccountInfo(e.account,e.cloudGraphHostName,e.msGraphHost);return yield this.browserStorage.setAccount(r,e.correlationId),e.fromNativeBroker?(this.logger.verbose("Response was from native broker, storing in-memory"),this.nativeInternalStorage.hydrateCache(e,t)):this.browserStorage.hydrateCache(e,t)})}acquireTokenNative(e,t,r,o){return d(this,null,function*(){if(this.logger.trace("acquireTokenNative called"),!this.nativeExtensionProvider)throw v(_r);return new Mr(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,t,this.performanceClient,this.nativeExtensionProvider,r||this.getNativeAccountId(e),this.nativeInternalStorage,e.correlationId).acquireToken(e,o)})}canUsePlatformBroker(e,t){if(this.logger.trace("canUsePlatformBroker called"),!Be.isPlatformBrokerAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme))return this.logger.trace("canUsePlatformBroker: isPlatformBrokerAvailable returned false, returning false"),!1;if(e.prompt)switch(e.prompt){case W.NONE:case W.CONSENT:case W.LOGIN:this.logger.trace("canUsePlatformBroker: prompt is compatible with platform broker flow");break;default:return this.logger.trace(`canUsePlatformBroker: prompt = ${e.prompt} is not compatible with platform broker flow, returning false`),!1}return!t&&!this.getNativeAccountId(e)?(this.logger.trace("canUsePlatformBroker: nativeAccountId is not available, returning false"),!1):!0}getNativeAccountId(e){let t=e.account||this.getAccount({loginHint:e.loginHint,sid:e.sid})||this.getActiveAccount();return t&&t.nativeAccountId||""}createPopupClient(e){return new Xc(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createRedirectClient(e){return new Zc(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentIframeClient(e){return new eu(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,B.ssoSilent,this.performanceClient,this.nativeInternalStorage,this.nativeExtensionProvider,e)}createSilentCacheClient(e){return new ri(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentRefreshClient(e){return new tu(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeExtensionProvider,e)}createSilentAuthCodeClient(e){return new ou(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,B.acquireTokenByCode,this.performanceClient,this.nativeExtensionProvider,e)}addEventCallback(e,t){return this.eventHandler.addEventCallback(e,t)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){return Uc(),this.performanceClient.addPerformanceCallback(e)}removePerformanceCallback(e){return this.performanceClient.removePerformanceCallback(e)}enableAccountStorageEvents(){if(this.config.cache.cacheLocation!==q.LocalStorage){this.logger.info("Account storage events are only available when cacheLocation is set to localStorage");return}this.eventHandler.subscribeCrossTab()}disableAccountStorageEvents(){if(this.config.cache.cacheLocation!==q.LocalStorage){this.logger.info("Account storage events are only available when cacheLocation is set to localStorage");return}this.eventHandler.unsubscribeCrossTab()}getTokenCache(){return this.tokenCache}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){this.navigationClient=e}getConfiguration(){return this.config}getPerformanceClient(){return this.performanceClient}isBrowserEnv(){return this.isBrowserEnvironment}getRequestCorrelationId(e){return e?.correlationId?e.correlationId:this.isBrowserEnvironment?de():g.EMPTY_STRING}loginRedirect(e){return d(this,null,function*(){let t=this.getRequestCorrelationId(e);return this.logger.verbose("loginRedirect called",t),this.acquireTokenRedirect(f({correlationId:t},e||Ld))})}loginPopup(e){let t=this.getRequestCorrelationId(e);return this.logger.verbose("loginPopup called",t),this.acquireTokenPopup(f({correlationId:t},e||Ld))}acquireTokenSilent(e){return d(this,null,function*(){let t=this.getRequestCorrelationId(e),r=this.performanceClient.startMeasurement(u.AcquireTokenSilent,t);r.add({cacheLookupPolicy:e.cacheLookupPolicy,scenarioId:e.scenarioId}),iu(this.initialized,r),this.logger.verbose("acquireTokenSilent called",t);let o=e.account||this.getActiveAccount();if(!o)throw v(ko);return r.add({accountType:_t(o)}),this.acquireTokenSilentDeduped(e,o,t).then(i=>(r.end({success:!0,fromCache:i.fromCache,isNativeBroker:i.fromNativeBroker,accessTokenSize:i.accessToken.length,idTokenSize:i.idToken.length}),T(f({},i),{state:e.state,correlationId:t}))).catch(i=>{throw i instanceof O&&i.setCorrelationId(t),r.end({success:!1},i),i})})}acquireTokenSilentDeduped(e,t,r){return d(this,null,function*(){let o=Wt(this.config.auth.clientId,T(f({},e),{authority:e.authority||this.config.auth.authority,correlationId:r}),t.homeAccountId),i=JSON.stringify(o),s=this.activeSilentTokenRequests.get(i);if(typeof s>"u"){this.logger.verbose("acquireTokenSilent called for the first time, storing active request",r),this.performanceClient.addFields({deduped:!1},r);let a=p(this.acquireTokenSilentAsync.bind(this),u.AcquireTokenSilentAsync,this.logger,this.performanceClient,r)(T(f({},e),{correlationId:r}),t);return this.activeSilentTokenRequests.set(i,a),a.finally(()=>{this.activeSilentTokenRequests.delete(i)})}else return this.logger.verbose("acquireTokenSilent has been called previously, returning the result from the first call",r),this.performanceClient.addFields({deduped:!0},r),s})}acquireTokenSilentAsync(e,t){return d(this,null,function*(){let r=()=>this.trackPageVisibility(e.correlationId);this.performanceClient.addQueueMeasurement(u.AcquireTokenSilentAsync,e.correlationId),this.eventHandler.emitEvent(E.ACQUIRE_TOKEN_START,A.Silent,e),e.correlationId&&this.performanceClient.incrementFields({visibilityChangeCount:0},e.correlationId),document.addEventListener("visibilitychange",r);let o=yield p(ag,u.InitializeSilentRequest,this.logger,this.performanceClient,e.correlationId)(e,t,this.config,this.performanceClient,this.logger),i=e.cacheLookupPolicy||fe.Default;return this.acquireTokenSilentNoIframe(o,i).catch(a=>d(this,null,function*(){if(hv(a,i))if(this.activeIframeRequest)if(i!==fe.Skip){let[l,h]=this.activeIframeRequest;this.logger.verbose(`Iframe request is already in progress, awaiting resolution for request with correlationId: ${h}`,o.correlationId);let m=this.performanceClient.startMeasurement(u.AwaitConcurrentIframe,o.correlationId);m.add({awaitIframeCorrelationId:h});let y=yield l;if(m.end({success:y}),y)return this.logger.verbose(`Parallel iframe request with correlationId: ${h} succeeded. Retrying cache and/or RT redemption`,o.correlationId),this.acquireTokenSilentNoIframe(o,i);throw this.logger.info(`Iframe request with correlationId: ${h} failed. Interaction is required.`),a}else return this.logger.warning("Another iframe request is currently in progress and CacheLookupPolicy is set to Skip. This may result in degraded performance and/or reliability for both calls. Please consider changing the CacheLookupPolicy to take advantage of request queuing and token cache.",o.correlationId),p(this.acquireTokenBySilentIframe.bind(this),u.AcquireTokenBySilentIframe,this.logger,this.performanceClient,o.correlationId)(o);else{let l;return this.activeIframeRequest=[new Promise(h=>{l=h}),o.correlationId],this.logger.verbose("Refresh token expired/invalid or CacheLookupPolicy is set to Skip, attempting acquire token by iframe.",o.correlationId),p(this.acquireTokenBySilentIframe.bind(this),u.AcquireTokenBySilentIframe,this.logger,this.performanceClient,o.correlationId)(o).then(h=>(l(!0),h)).catch(h=>{throw l(!1),h}).finally(()=>{this.activeIframeRequest=void 0})}else throw a})).then(a=>(this.eventHandler.emitEvent(E.ACQUIRE_TOKEN_SUCCESS,A.Silent,a),e.correlationId&&this.performanceClient.addFields({fromCache:a.fromCache,isNativeBroker:a.fromNativeBroker},e.correlationId),a)).catch(a=>{throw this.eventHandler.emitEvent(E.ACQUIRE_TOKEN_FAILURE,A.Silent,null,a),a}).finally(()=>{document.removeEventListener("visibilitychange",r)})})}acquireTokenSilentNoIframe(e,t){return d(this,null,function*(){return Be.isPlatformBrokerAvailable(this.config,this.logger,this.nativeExtensionProvider,e.authenticationScheme)&&e.account.nativeAccountId?(this.logger.verbose("acquireTokenSilent - attempting to acquire token from native platform"),this.acquireTokenNative(e,B.acquireTokenSilent_silentFlow,e.account.nativeAccountId,t).catch(r=>d(this,null,function*(){throw r instanceof ze&&Or(r)?(this.logger.verbose("acquireTokenSilent - native platform unavailable, falling back to web flow"),this.nativeExtensionProvider=void 0,C(ae.tokenRefreshRequired)):r}))):(this.logger.verbose("acquireTokenSilent - attempting to acquire token from web flow"),t===fe.AccessToken&&this.logger.verbose("acquireTokenSilent - cache lookup policy set to AccessToken, attempting to acquire token from local cache"),p(this.acquireTokenFromCache.bind(this),u.AcquireTokenFromCache,this.logger,this.performanceClient,e.correlationId)(e,t).catch(r=>{if(t===fe.AccessToken)throw r;return this.eventHandler.emitEvent(E.ACQUIRE_TOKEN_NETWORK_START,A.Silent,e),p(this.acquireTokenByRefreshToken.bind(this),u.AcquireTokenByRefreshToken,this.logger,this.performanceClient,e.correlationId)(e,t)}))})}preGeneratePkceCodes(e){return d(this,null,function*(){return this.logger.verbose("Generating new PKCE codes"),this.pkceCode=yield p(Pr,u.GeneratePkceCodes,this.logger,this.performanceClient,e)(this.performanceClient,this.logger,e),Promise.resolve()})}getPreGeneratedPkceCodes(e){this.logger.verbose("Attempting to pick up pre-generated PKCE codes");let t=this.pkceCode?f({},this.pkceCode):void 0;return this.pkceCode=void 0,this.logger.verbose(`${t?"Found":"Did not find"} pre-generated PKCE codes`),this.performanceClient.addFields({usePreGeneratedPkce:!!t},e),t}logMultipleInstances(e){let t=this.config.auth.clientId;if(!window)return;window.msal=window.msal||{},window.msal.clientIds=window.msal.clientIds||[],window.msal.clientIds.length>0&&this.logger.verbose("There is already an instance of MSAL.js in the window."),window.msal.clientIds.push(t),Ag(t,e,this.logger)}};function hv(n,e){let t=!(n instanceof he&&n.subError!==Qt.badToken),r=n.errorCode===ee.INVALID_GRANT_ERROR||n.errorCode===ae.tokenRefreshRequired,o=t&&r||n.errorCode===Qt.noTokensFound||n.errorCode===Qt.refreshTokenExpired,i=wp.includes(e);return o&&i}function Tg(n,e){return d(this,null,function*(){let t=new zc(n);return yield t.initialize(),ai.createController(t,e)})}var Js=class n{static createPublicClientApplication(e){return d(this,null,function*(){let t=yield Tg(e);return new n(e,t)})}constructor(e,t){this.isBroker=!1,this.controller=t||new ai(new zc(e))}initialize(e){return d(this,null,function*(){return this.controller.initialize(e,this.isBroker)})}acquireTokenPopup(e){return d(this,null,function*(){return this.controller.acquireTokenPopup(e)})}acquireTokenRedirect(e){return this.controller.acquireTokenRedirect(e)}acquireTokenSilent(e){return this.controller.acquireTokenSilent(e)}acquireTokenByCode(e){return this.controller.acquireTokenByCode(e)}addEventCallback(e,t){return this.controller.addEventCallback(e,t)}removeEventCallback(e){return this.controller.removeEventCallback(e)}addPerformanceCallback(e){return this.controller.addPerformanceCallback(e)}removePerformanceCallback(e){return this.controller.removePerformanceCallback(e)}enableAccountStorageEvents(){this.controller.enableAccountStorageEvents()}disableAccountStorageEvents(){this.controller.disableAccountStorageEvents()}getAccount(e){return this.controller.getAccount(e)}getAccountByHomeId(e){return this.controller.getAccountByHomeId(e)}getAccountByLocalId(e){return this.controller.getAccountByLocalId(e)}getAccountByUsername(e){return this.controller.getAccountByUsername(e)}getAllAccounts(e){return this.controller.getAllAccounts(e)}handleRedirectPromise(e){return this.controller.handleRedirectPromise(e)}loginPopup(e){return this.controller.loginPopup(e)}loginRedirect(e){return this.controller.loginRedirect(e)}logout(e){return this.controller.logout(e)}logoutRedirect(e){return this.controller.logoutRedirect(e)}logoutPopup(e){return this.controller.logoutPopup(e)}ssoSilent(e){return this.controller.ssoSilent(e)}getTokenCache(){return this.controller.getTokenCache()}getLogger(){return this.controller.getLogger()}setLogger(e){this.controller.setLogger(e)}setActiveAccount(e){this.controller.setActiveAccount(e)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(e,t){return this.controller.initializeWrapperLibrary(e,t)}setNavigationClient(e){this.controller.setNavigationClient(e)}getConfiguration(){return this.controller.getConfiguration()}hydrateCache(e,t){return d(this,null,function*(){return this.controller.hydrateCache(e,t)})}clearCache(e){return this.controller.clearCache(e)}};var Xs=class{static getInteractionStatusFromEvent(e,t){switch(e.eventType){case E.LOGIN_START:return re.Login;case E.SSO_SILENT_START:return re.SsoSilent;case E.ACQUIRE_TOKEN_START:if(e.interactionType===A.Redirect||e.interactionType===A.Popup)return re.AcquireToken;break;case E.HANDLE_REDIRECT_START:return re.HandleRedirect;case E.LOGOUT_START:return re.Logout;case E.SSO_SILENT_SUCCESS:case E.SSO_SILENT_FAILURE:if(t&&t!==re.SsoSilent)break;return re.None;case E.LOGOUT_END:if(t&&t!==re.Logout)break;return re.None;case E.HANDLE_REDIRECT_END:if(t&&t!==re.HandleRedirect)break;return re.None;case E.LOGIN_SUCCESS:case E.LOGIN_FAILURE:case E.ACQUIRE_TOKEN_SUCCESS:case E.ACQUIRE_TOKEN_FAILURE:case E.RESTORE_FROM_BFCACHE:if(e.interactionType===A.Redirect||e.interactionType===A.Popup){if(t&&t!==re.Login&&t!==re.AcquireToken)break;return re.None}break}return null}};var su="@azure/msal-angular",Zs="4.0.12",Jd=new K("MSAL_INSTANCE"),Sg=new K("MSAL_GUARD_CONFIG"),Ig=new K("MSAL_INTERCEPTOR_CONFIG"),fv=new K("MSAL_BROADCAST_CONFIG"),ci=(()=>{class n{constructor(t,r){this.msalInstance=t,this.msalBroadcastConfig=r,this.msalBroadcastConfig&&this.msalBroadcastConfig.eventsToReplay>0?(this.msalInstance.getLogger().clone(su,Zs).verbose(`BroadcastService - eventsToReplay set on BroadcastConfig, replaying the last ${this.msalBroadcastConfig.eventsToReplay} events`),this._msalSubject=new eh(this.msalBroadcastConfig.eventsToReplay)):this._msalSubject=new He,this.msalSubject$=this._msalSubject.asObservable(),this._inProgress=new Ie(re.Startup),this.inProgress$=this._inProgress.asObservable(),this.msalInstance.addEventCallback(o=>{this._msalSubject.next(o);let i=Xs.getInteractionStatusFromEvent(o,this._inProgress.value);i!==null&&(this.msalInstance.getLogger().clone(su,Zs).verbose(`BroadcastService - ${o.eventType} results in setting inProgress from ${this._inProgress.value} to ${i}`),this._inProgress.next(i))})}resetInProgressEvent(){this._inProgress.value===re.Startup&&this._inProgress.next(re.None)}}return n.\u0275fac=function(t){return new(t||n)(w(Jd),w(fv,8))},n.\u0275prov=P({token:n,factory:n.\u0275fac}),n})(),xn=(()=>{class n{constructor(t,r,o){this.instance=t,this.location=r,this.injector=o;let i=this.location.path(!0).split("#").pop();i&&(this.redirectHash=`#${i}`),this.instance.initializeWrapperLibrary(Ud.Angular,Zs)}initialize(){return z(this.instance.initialize())}acquireTokenPopup(t){return z(this.instance.acquireTokenPopup(t))}acquireTokenRedirect(t){return z(this.instance.acquireTokenRedirect(t))}acquireTokenSilent(t){return z(this.instance.acquireTokenSilent(t))}handleRedirectObservable(t){return z(this.instance.initialize().then(()=>this.instance.handleRedirectPromise(t||this.redirectHash)).finally(()=>{this.injector.get(ci).resetInProgressEvent()}))}loginPopup(t){return z(this.instance.loginPopup(t))}loginRedirect(t){return z(this.instance.loginRedirect(t))}logout(t){return z(this.instance.logout(t))}logoutRedirect(t){return z(this.instance.logoutRedirect(t))}logoutPopup(t){return z(this.instance.logoutPopup(t))}ssoSilent(t){return z(this.instance.ssoSilent(t))}getLogger(){return this.logger||(this.logger=this.instance.getLogger().clone(su,Zs)),this.logger}setLogger(t){this.logger=t.clone(su,Zs),this.instance.setLogger(t)}}return n.\u0275fac=function(t){return new(t||n)(w(Jd),w($e),w(Nr))},n.\u0275prov=P({token:n,factory:n.\u0275fac}),n})(),pv=(()=>{class n{constructor(t,r,o,i,s){this.msalGuardConfig=t,this.msalBroadcastService=r,this.authService=o,this.location=i,this.router=s,this.msalBroadcastService.inProgress$.subscribe()}parseUrl(t){return this.router.parseUrl(t)}getDestinationUrl(t){this.authService.getLogger().verbose("Guard - getting destination url");let r=document.getElementsByTagName("base"),o=this.location.normalize(r.length?r[0].href:window.location.origin),i=this.location.prepareExternalUrl(t);return i.startsWith("#")?(this.authService.getLogger().verbose("Guard - destination by hash routing"),`${o}/${i}`):`${o}${t}`}loginInteractively(t){let r=typeof this.msalGuardConfig.authRequest=="function"?this.msalGuardConfig.authRequest(this.authService,t):f({},this.msalGuardConfig.authRequest);if(this.msalGuardConfig.interactionType===A.Popup)return this.authService.getLogger().verbose("Guard - logging in by popup"),this.authService.loginPopup(r).pipe($(i=>(this.authService.getLogger().verbose("Guard - login by popup successful, can activate, setting active account"),this.authService.instance.setActiveAccount(i.account),!0)));this.authService.getLogger().verbose("Guard - logging in by redirect");let o=this.getDestinationUrl(t.url);return this.authService.loginRedirect(f({redirectStartPage:o},r)).pipe($(()=>!1))}activateHelper(t){if(this.msalGuardConfig.interactionType!==A.Popup&&this.msalGuardConfig.interactionType!==A.Redirect)throw new Un("invalid_interaction_type","Invalid interaction type provided to MSAL Guard. InteractionType.Popup or InteractionType.Redirect must be provided in the MsalGuardConfiguration");if(this.authService.getLogger().verbose("MSAL Guard activated"),typeof window<"u"){if(b.hashContainsKnownProperties(window.location.hash)&&Hc.isInIframe()&&!this.authService.instance.getConfiguration().system.allowRedirectInIframe)return this.authService.getLogger().warning("Guard - redirectUri set to page with MSAL Guard. It is recommended to not set redirectUri to a page that requires authentication."),I(!1)}else return this.authService.getLogger().info("Guard - window is undefined, MSAL does not support server-side token acquisition"),I(!0);this.msalGuardConfig.loginFailedRoute&&(this.loginFailedRoute=this.parseUrl(this.msalGuardConfig.loginFailedRoute));let r=this.location.path(!0);return this.authService.initialize().pipe(it(()=>this.authService.handleRedirectObservable()),it(()=>{if(!this.authService.instance.getAllAccounts().length)return t?(this.authService.getLogger().verbose("Guard - no accounts retrieved, log in required to activate"),this.loginInteractively(t)):(this.authService.getLogger().verbose("Guard - no accounts retrieved, no state, cannot load"),I(!1));if(this.authService.getLogger().verbose("Guard - at least 1 account exists, can activate or load"),t){let o=this.includesCode(t.url),i=!!t.root&&!!t.root.fragment&&this.includesCode(`#${t.root.fragment}`),s=this.location.prepareExternalUrl(t.url).indexOf("#")===0;if(o&&(i||s))return this.authService.getLogger().info("Guard - Hash contains known code response, stopping navigation."),r.indexOf("#")>-1?I(this.parseUrl(this.location.path())):I(this.parseUrl(""))}return I(!0)}),ot(o=>(this.authService.getLogger().error("Guard - error while logging in, unable to activate"),this.authService.getLogger().errorPii(`Guard - error: ${o.message}`),this.loginFailedRoute&&t?(this.authService.getLogger().verbose("Guard - loginFailedRoute set, redirecting"),I(this.loginFailedRoute)):I(!1))))}includesCode(t){return t.lastIndexOf("/code")>-1&&t.lastIndexOf("/code")===t.length-5||t.indexOf("#code=")>-1||t.indexOf("&code=")>-1}canActivate(t,r){return this.authService.getLogger().verbose("Guard - canActivate"),this.activateHelper(r)}canActivateChild(t,r){return this.authService.getLogger().verbose("Guard - canActivateChild"),this.activateHelper(r)}canMatch(){return this.authService.getLogger().verbose("Guard - canLoad"),this.activateHelper()}}return n.\u0275fac=function(t){return new(t||n)(w(Sg),w(ci),w(xn),w($e),w(Fe))},n.\u0275prov=P({token:n,factory:n.\u0275fac}),n})(),wg=(()=>{class n{constructor(t,r,o,i,s){this.msalInterceptorConfig=t,this.authService=r,this.location=o,this.msalBroadcastService=i,this._document=s}intercept(t,r){if(this.msalInterceptorConfig.interactionType!==A.Popup&&this.msalInterceptorConfig.interactionType!==A.Redirect)throw new Un("invalid_interaction_type","Invalid interaction type provided to MSAL Interceptor. InteractionType.Popup, InteractionType.Redirect must be provided in the msalInterceptorConfiguration");this.authService.getLogger().verbose("MSAL Interceptor activated");let o=this.getScopesForEndpoint(t.url,t.method);if(!o||o.length===0)return this.authService.getLogger().verbose("Interceptor - no scopes for endpoint"),r.handle(t);let i;this.authService.instance.getActiveAccount()?(this.authService.getLogger().verbose("Interceptor - active account selected"),i=this.authService.instance.getActiveAccount()):(this.authService.getLogger().verbose("Interceptor - no active account, fallback to first account"),i=this.authService.instance.getAllAccounts()[0]);let s=typeof this.msalInterceptorConfig.authRequest=="function"?this.msalInterceptorConfig.authRequest(this.authService,t,{account:i}):T(f({},this.msalInterceptorConfig.authRequest),{account:i});return this.authService.getLogger().info(`Interceptor - ${o.length} scopes found for endpoint`),this.authService.getLogger().infoPii(`Interceptor - [${o}] scopes found for ${t.url}`),this.acquireToken(s,o,i).pipe(pe(a=>{this.authService.getLogger().verbose("Interceptor - setting authorization headers");let c=t.headers.set("Authorization",`Bearer ${a.accessToken}`),l=t.clone({headers:c});return r.handle(l)}))}acquireToken(t,r,o){return this.authService.acquireTokenSilent(T(f({},t),{scopes:r,account:o})).pipe(ot(()=>(this.authService.getLogger().error("Interceptor - acquireTokenSilent rejected with error. Invoking interaction to resolve."),this.msalBroadcastService.inProgress$.pipe(st(1),pe(i=>i===re.None?this.acquireTokenInteractively(t,r):this.msalBroadcastService.inProgress$.pipe(Pe(s=>s===re.None),st(1),pe(()=>this.acquireToken(t,r,o))))))),pe(i=>i.accessToken?I(i):(this.authService.getLogger().error("Interceptor - acquireTokenSilent resolved with null access token. Known issue with B2C tenants, invoking interaction to resolve."),this.msalBroadcastService.inProgress$.pipe(Pe(s=>s===re.None),st(1),pe(()=>this.acquireTokenInteractively(t,r))))))}acquireTokenInteractively(t,r){if(this.msalInterceptorConfig.interactionType===A.Popup)return this.authService.getLogger().verbose("Interceptor - error acquiring token silently, acquiring by popup"),this.authService.acquireTokenPopup(T(f({},t),{scopes:r}));this.authService.getLogger().verbose("Interceptor - error acquiring token silently, acquiring by redirect");let o=window.location.href;return this.authService.acquireTokenRedirect(T(f({},t),{scopes:r,redirectStartPage:o})),qe}getScopesForEndpoint(t,r){this.authService.getLogger().verbose("Interceptor - getting scopes for endpoint");let o=this.location.normalize(t),i=Array.from(this.msalInterceptorConfig.protectedResourceMap.keys()),s=this.matchResourcesToEndpoint(i,o);return s.length>0?this.matchScopesToEndpoint(this.msalInterceptorConfig.protectedResourceMap,s,r):null}matchResourcesToEndpoint(t,r){let o=[];return t.forEach(i=>{let s=this.location.normalize(i),a=this.getAbsoluteUrl(s),c=new URL(a),l=this.getAbsoluteUrl(r),h=new URL(l);this.checkUrlComponents(c,h)&&o.push(i)}),o}checkUrlComponents(t,r){let o=["protocol","host","pathname","search","hash"];for(let i of o)if(t[i]){let s=decodeURIComponent(t[i]);if(!X.matchPattern(s,r[i]))return!1}return!0}getAbsoluteUrl(t){let r=this._document.createElement("a");return r.href=t,r.href}matchScopesToEndpoint(t,r,o){let i=[];return r.forEach(s=>{let a=[],c=t.get(s);if(c===null){i.push(null);return}c.forEach(l=>{if(typeof l=="string")a.push(l);else{let h=o.toLowerCase();l.httpMethod.toLowerCase()===h&&(l.scopes===null?i.push(null):l.scopes.forEach(y=>{a.push(y)}))}}),a.length>0&&i.push(a)}),i.length>0?(i.length>1&&this.authService.getLogger().warning("Interceptor - More than 1 matching scopes for endpoint found."),i[0]):null}}return n.\u0275fac=function(t){return new(t||n)(w(Ig),w(xn),w($e),w(ci),w(se))},n.\u0275prov=P({token:n,factory:n.\u0275fac}),n})();var Rg=(()=>{class n{static forRoot(t,r,o){return{ngModule:n,providers:[{provide:Jd,useValue:t},{provide:Sg,useValue:r},{provide:Ig,useValue:o},xn]}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Ot({type:n}),n.\u0275inj=bt({providers:[pv,ci],imports:[mi]}),n})();var ui=class n{constructor(e,t,r){this.msalService=e;this.msalBroadcastService=t;this.routerService=r;this.msalBroadcastService.msalSubject$.pipe(Pe(o=>o.eventType===E.LOGIN_SUCCESS||o.eventType===E.ACQUIRE_TOKEN_SUCCESS||o.eventType===E.INITIALIZE_END)).subscribe(o=>{if(o.eventType==E.INITIALIZE_END){let i=this.msalService.instance.getAllAccounts();i.length&&this.aquireTokenSilent(i[0])}else if(o.eventType==E.LOGIN_SUCCESS){let i=this.msalService.instance.getAllAccounts();i.length&&this.aquireTokenSilent(i[0])}else if(o.eventType===E.ACQUIRE_TOKEN_SUCCESS){let i=o.payload;i.accessToken?console.log("Got Access token",i.accessToken):console.log("Access Token property not found in payload.")}})}login(){this.msalService.loginRedirect()}aquireTokenSilent(e){let t="api://cf4be252-2340-4a9f-bd46-3bd65df25846/access_as_user".split(",");this.msalService.acquireTokenSilent({scopes:t,account:e}).subscribe({next:r=>{this.routerService.navigate(["/home"])},error:r=>{console.log("error",r)}})}static \u0275fac=function(t){return new(t||n)(kt(xn),kt(ci),kt(Fe))};static \u0275cmp=Lr({type:n,selectors:[["app-login"]],decls:3,vars:0,consts:[[3,"click"]],template:function(t,r){t&1&&(Rh(0,"button",0),wu("click",function(){return r.login()}),Dh(1,"Login"),_h(),Kn(2,"router-outlet"))},dependencies:[Cl,$r],encapsulation:2})};var Dg=[{path:"home",loadComponent:()=>import("./chunk-2SHX4JTL.js").then(n=>n.HomeComponent),data:{preload:!1}},{path:"auth-redirect",component:ui},{path:"login",component:ui},{path:"",component:ui}];var bg={interactionType:A.Redirect},kg=new Js({auth:{clientId:"cf4be252-2340-4a9f-bd46-3bd65df25846",authority:"https://login.microsoftonline.com/fb2492a7-4cfe-4506-95f9-2284aa380e41",redirectUri:"https://localhost:7198/auth-redirect",postLogoutRedirectUri:"https://localhost:7198"},cache:{cacheLocation:q.SessionStorage,storeAuthStateInCookie:!1},system:{loggerOptions:{loggerCallback:()=>{},piiLoggingEnabled:!1}}}),Og={interactionType:A.Redirect,protectedResourceMap:new Map([["https://localhost:7198",["api://cf4be252-2340-4a9f-bd46-3bd65df25846/access_as_user"]]])};var Mg={providers:[kh({eventCoalescing:!0}),gl(Dg),Lh(Fh()),{provide:Nh,useClass:wg,multi:!0},lh($u,Rg.forRoot(kg,bg,Og))]};var au=class n{constructor(e){this.msalService=e;this.msalService.handleRedirectObservable()}title="WebApp_CookieAuth";static \u0275fac=function(t){return new(t||n)(kt(xn))};static \u0275cmp=Lr({type:n,selectors:[["app-root"]],decls:1,vars:0,template:function(t,r){t&1&&Kn(0,"router-outlet")},dependencies:[$r],encapsulation:2})};Hu(au,Mg).catch(n=>console.error(n));
